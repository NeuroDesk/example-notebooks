
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Nipype on Neurodesk &#8212; Neurodesk</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-4Z9774J59Y"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4Z9774J59Y');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4Z9774J59Y');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'workflows/nipype_full';</script>
    <link rel="canonical" href="https://neurodesk.github.io/example-notebooks/workflows/nipype_full.html" />
    <link rel="icon" href="../_static/neurodesk_logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Basic Nipype" href="nipype_short.html" />
    <link rel="prev" title="BIDS conversion" href="bids_conversion.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/neurodesk_logo.svg" class="logo__image only-light" alt="Neurodesk - Home"/>
    <script>document.write(`<img src="../_static/neurodesk_logo.svg" class="logo__image only-dark" alt="Neurodesk - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Neurodesk environment
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Workflows</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="AA_Neurodesk_demo_tour.html">Neurodesk Tools Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="MRIQC.html">MRIQC</a></li>
<li class="toctree-l1"><a class="reference internal" href="PyBIDS.html">PyBIDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="RISE_slideshow.html">RISE Slideshow</a></li>
<li class="toctree-l1"><a class="reference internal" href="bids_conversion.html">BIDS conversion</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Nipype on Neurodesk</a></li>
<li class="toctree-l1"><a class="reference internal" href="nipype_short.html">Basic Nipype</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Structural Imaging</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../structural_imaging/FSL_course_bet.html">FSL course - BET</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structural_imaging/brain_extraction_different_tools.html">Brain Extraction Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structural_imaging/freesurfer.html">FreeSurfer</a></li>


<li class="toctree-l1"><a class="reference internal" href="../structural_imaging/qsmxt.html">QSMxT</a></li>







<li class="toctree-l1"><a class="reference internal" href="../structural_imaging/sct_toolbox.html">SCT Toolbox</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Diffusion Imaging</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../diffusion_imaging/Diffusion_TBSS_Demo.html">TBSS Tutorial</a></li>


<li class="toctree-l1"><a class="reference internal" href="../diffusion_imaging/MRtrix_1.html">MRtrix: Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../diffusion_imaging/MRtrix_2.html">MRtrix: Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../diffusion_imaging/MRtrix_3.html">MRtrix: Part 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../diffusion_imaging/mrtrix3tissue.html">MRtrix3Tissue</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Functional Imaging</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../functional_imaging/AFNI_preprocessing_only.html">AFNI Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional_imaging/AFNI_preprocessing_plus_glm.html">AFNI Preprocessing and GLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional_imaging/FSL_preproc_glm.html">FSL Preprocessing and GLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional_imaging/aslprep.html">ASLprep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional_imaging/deepretinotopy.html">DeepRetinotopy</a></li>

<li class="toctree-l1"><a class="reference internal" href="../functional_imaging/first_and_second_level_spm.html">Nipype-SPM fMRI Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional_imaging/fmriprep.html">fMRIprep</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional_imaging/fsl_all_levels_flanker_nipype.html">Nipype-FSL fMRI Analysis</a></li>



<li class="toctree-l1"><a class="reference internal" href="../functional_imaging/intro_to_preprocessing.html">Introduction to Preprocessing</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://play-america.neurodesk.org/hub/user-redirect/git-pull?repo=https%3A//github.com/NeuroDesk/example-notebooks&urlpath=lab/tree/example-notebooks/books/workflows/nipype_full.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/edit/main/books/workflows/nipype_full.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/issues/new?title=Issue%20on%20page%20%2Fworkflows/nipype_full.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/workflows/nipype_full.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Nipype on Neurodesk</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interactive-rise-slideshow">An interactive RISE slideshow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-cpu-information">Output CPU information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-content">Table of content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-nipype">1. Introduction to Nipype</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nipype-in-jupyter-notebooks-on-neurodesk">2. Nipype in Jupyter Notebooks on Neurodesk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploration-of-nipype-s-building-blocks">3. Exploration of Nipype’s building blocks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-download-of-opensource-data-installations-and-imports"><strong>Preparation: Download of opensource data, installations and imports</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interfaces-the-core-pieces-of-nipype">3.1. Interfaces : The core pieces of Nipype</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-interface-for-fsl-s-brain-extraction-tool-bet"><strong>Example: Interface for FSL’s Brain Extraction Tool <em>BET</em></strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nodes-the-light-wrapper-around-interfaces">3.2. Nodes: The light wrapper around interfaces</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapnode">MapNode</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iterables">Iterables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#joinnode">JoinNode</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-node"><strong>Example: Node</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workflows">3.3. Workflows</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-workflow"><strong>Example: Workflow</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connect-nodes-within-a-workflow">Connect nodes within a workflow</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#execution-plugins-execution-on-different-systems">3.4. Execution Plugins: Execution on different systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-input-first-step-of-every-analysis">3.5. Data Input: First step of every analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-datagrabber"><strong>Example: DataGrabber</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-output">3.6. Data Output</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-datasink"><strong>Example: DataSink</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pydra-a-modern-dataflow-engine-developed-for-the-nipype-project">4. Pydra: A modern dataflow engine developed for the Nipype project</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-features-in-more-detail">Key features in more detail:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies-in-jupyter-python">Dependencies in Jupyter/Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-resources">References/ Resources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<section class="tex2jax_ignore mathjax_ignore" id="nipype-on-neurodesk">
<h1>Nipype on Neurodesk<a class="headerlink" href="#nipype-on-neurodesk" title="Link to this heading">#</a></h1>
<section id="an-interactive-rise-slideshow">
<h2>An interactive RISE slideshow<a class="headerlink" href="#an-interactive-rise-slideshow" title="Link to this heading">#</a></h2>
<p style="font-size: 15px;"> <b>Author:</b> Monika Doerig </p>
<p style="font-size: 12px;">Press <code>Space</code> to proceed through the slideshow.</p></section>
<section id="output-cpu-information">
<h2>Output CPU information<a class="headerlink" href="#output-cpu-information" title="Link to this heading">#</a></h2>
<p>In code cells you press <code class="docutils literal notranslate"><span class="pre">Shift-Enter</span></code> (as usual) to evaluate your code and directly move to the next cell if it is already displayed.</p>
<p>Press <code class="docutils literal notranslate"><span class="pre">Ctrl-Enter</span></code> to run a command without direclty moving to the next cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>/proc/cpuinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;vendor&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq
<span class="o">!</span>cat<span class="w"> </span>/proc/cpuinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;model name&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vendor_id	: GenuineIntel
model name	: Intel(R) Xeon(R) Gold 6126 CPU @ 2.60GHz
</pre></div>
</div>
</div>
</div>
<p style="font-size: 18px;">Keep pressing <code>Space</code> to advance to the next slide.</p><div class="hint">
  <p class="hint-title" style="font-size: 1.5em; color: green;"><i class="fas fa-bullseye" style="color: green;"></i> <span style="font-size: 1.5em;">Objectives</span></p>
  <ul>
    <li>Know the basics of Nipype</li>
    <li>And how to use it on Neurodesk</li>
    <li>Learn how Python can be applied to analyze neuroimaging data through practical examples</li>
    <li>Get pointers to resources</li>
  </ul>
</div><div class="important">
  <p class="important-title" style="font-size: 1.5em; color: blue;"><i class="fas fa-bolt" style="color: blue;"></i> <span style="font-size: 1.5em;">Be aware ...</span></p>
  <ul>
    <li>Nipype is part of a large ecosystem</li>
    <li>Therefore, it is about knowing what is out there and empowering you with new tools</li>
    <li>Sometimes, the devil is in the details</li>
    <li>Things take time</li>
  </ul>
</div></section>
<section id="table-of-content">
<h2>Table of content<a class="headerlink" href="#table-of-content" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="#1.-Introduction-to-Nipype"><span class="xref myst">1. Introduction to Nipype</span></a><br />
<a class="reference internal" href="#2.-Nipype-in-Jupyter-Notebooks-on-Neurodesk"><span class="xref myst">2. Nipype in Jupyter Notebooks on Neurodesk</span></a><br />
<a class="reference internal" href="#3.-Exploration-of-Nipype's-building-blocks"><span class="xref myst">3. Exploration of Nipype’s building blocks</span></a><br />
<a class="reference internal" href="#4.-Pydra:-A-modern-dataflow-engine-developed-for-the-Nipype-project"><span class="xref myst">4. Pydra: A modern dataflow engine developed for the Nipype project</span></a></p>
</section>
<section id="introduction-to-nipype">
<h2>1. Introduction to Nipype<a class="headerlink" href="#introduction-to-nipype" title="Link to this heading">#</a></h2>
<center><img src="https://miykael.github.io/nipype_tutorial/static/images/logoNipype_text.png" width="50%" height="50%"></center><ul class="simple">
<li><p>Open-source Python project that originated within the neuroimaging community</p></li>
<li><p>Provides a unified interface to diverse neuroimaging packages including ANTS, SPM, FSL, FreeSurfer, and others</p></li>
<li><p>Facilitates seamless interaction between these packages</p></li>
<li><p>Its flexibility has made it a preferred basis for widely used pre-processing tools such as fMRIPrep</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> A primary goal driving Nipype is to simplify the integration of various analysis packages, allowing for the utilization of algorithms that are most appropriate for specific problems.</p>
<img src="https://miykael.github.io/nipype_tutorial/static/images/nipype_example_graph.png" style="display: block; margin: auto auto; padding: 5px;" width="50%" height="50%"> 
<figcaption style="text-align: center;"><b>Figure 1:</b> Example Workflow</figcaption></section>
<section id="nipype-in-jupyter-notebooks-on-neurodesk">
<h2>2. Nipype in Jupyter Notebooks on Neurodesk<a class="headerlink" href="#nipype-in-jupyter-notebooks-on-neurodesk" title="Link to this heading">#</a></h2>
<a class="reference internal image-reference" href="https://www.neurodesk.org/static/logos/neurodesk.org_horizontal.png"><img alt="https://www.neurodesk.org/static/logos/neurodesk.org_horizontal.png" src="https://www.neurodesk.org/static/logos/neurodesk.org_horizontal.png" style="width: 25%;" />
</a>
<p>Neurodesk project enables the use of all neuroimaging applications inside computational notebooks</p>
<p><strong>Demonstration of the module system in Python and Nipype:</strong></p>
<p>We will use the software tool <code class="docutils literal notranslate"><span class="pre">lmod</span></code> to manage and load different software packages and libraires. It simplifies the process of accessing and utilizing various software applications and allows users to easily switch between different versions of software packages, manage dependencies, and ensure compatibility with their computing environment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In code cells you press Shift-Enter to evaluate your code and directly move to the next cell if it is already displayed. </span>
<span class="c1"># Or press Ctrl-Enter to run a command without direclty moving to the next cell.</span>

<span class="c1"># Use module to load any software tool with a specific version</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">module</span>
<span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;fsl/6.0.7.4&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;mrtrix3/3.0.4&#39;, &#39;fsl/6.0.7.4&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;FSLOUTPUTTYPE&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;NIFTI_GZ&quot;</span> <span class="c1"># Default is NIFTI</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">nipype.interfaces.fsl.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Info</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">version</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">output_type</span><span class="p">())</span>
<span class="c1"># If the FSL version is changed using lmod above, the kernel of the notebook needs to be restarted!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.0.7.4
NIFTI_GZ
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load afni and spm as well</span>
<span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;afni/22.3.06&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;spm12/r7771&#39;</span><span class="p">)</span> 
<span class="k">await</span> <span class="n">module</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;mrtrix3/3.0.4&#39;, &#39;fsl/6.0.7.4&#39;, &#39;afni/22.3.06&#39;, &#39;spm12/r7771&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="exploration-of-nipype-s-building-blocks">
<h2>3. Exploration of Nipype’s building blocks<a class="headerlink" href="#exploration-of-nipype-s-building-blocks" title="Link to this heading">#</a></h2>
<center><img src="https://miykael.github.io/nipype_tutorial/static/images/nipype_architecture.png" width="50%" height="50%"></center>
  <figcaption><b>Figure 2:</b> Nipype architecture</figcaption><ul class="simple">
<li><p><font size="5"><strong>Interfaces:</strong> Wraps a program/ function </font></p></li>
</ul>
<ul class="simple">
<li><p><font size="5"><strong>Workflow engine:</strong></font></p>
<ul>
<li><p><font size="3"><strong>Nodes:</strong> Wraps an interface for use in a workflow</font></p></li>
<li><p><font size="3"><strong>Workflows:</strong> A directed graph or forest of graphs whose edges represent data flow </font></p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p><font size="5"><strong>Data Input:</strong> Many different modules to grab/ select data depending on the data structure </font></p></li>
</ul>
<ul class="simple">
<li><p><font size="5"><strong>Data Output:</strong> Different modules to handle data stream output  </font></p></li>
</ul>
<ul class="simple">
<li><p><font size="5"><strong>Plugin:</strong> A component that describes how a Workflow should be executed</font></p></li>
</ul>
<section id="preparation-download-of-opensource-data-installations-and-imports">
<h3><strong>Preparation: Download of opensource data, installations and imports</strong><a class="headerlink" href="#preparation-download-of-opensource-data-installations-and-imports" title="Link to this heading">#</a></h3>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download 2 subjects of the Flanker Dataset</span>
<span class="n">PATTERN</span> <span class="o">=</span> <span class="s2">&quot;sub-0[1-2]&quot;</span>
 
<span class="o">!</span>datalad<span class="w"> </span>install<span class="w"> </span>https://github.com/OpenNeuroDatasets/ds000102.git
<span class="o">!</span><span class="nb">cd</span><span class="w"> </span>ds000102<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>datalad<span class="w"> </span>get<span class="w"> </span><span class="nv">$PATTERN</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>action summary:
  get (notneeded: 2)

</pre></div>
</div>
</div>
</div>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">nilearn</span> <span class="n">nibabel</span> <span class="n">numpy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">nipype</span><span class="w"> </span><span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">DataGrabber</span><span class="p">,</span> <span class="n">DataSink</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nipype.interfaces.utility</span><span class="w"> </span><span class="kn">import</span> <span class="n">IdentityInterface</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nipype.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nilearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">plotting</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">opj</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nibabel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nib</span> 

<span class="c1"># Create directory for all the outputs (if it doesn&#39;t exist yet)</span>
<span class="o">!</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>output<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>output
</pre></div>
</div>
</div>
</div>
</section>
<section id="interfaces-the-core-pieces-of-nipype">
<h3>3.1. Interfaces : The core pieces of Nipype<a class="headerlink" href="#interfaces-the-core-pieces-of-nipype" title="Link to this heading">#</a></h3>
<p>Python wrapper around a particular piece of software (even if it is written in another programming language than python):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- FSL
- AFNI
- ANTS
- FreeSurfer
- SPM
- dcm2nii
- Nipy
- MNE
- DIPY
- ...
</pre></div>
</div>
<p>Such an interface knows what sort of options an external program has and how to execute it (e.g., keeps track of the inputs and outputs, and checks their expected types).</p>
<p>In the Nipype framework we can get an information page on an interface class by using the <code class="docutils literal notranslate"><span class="pre">help()</span></code> function.</p>
<section id="example-interface-for-fsl-s-brain-extraction-tool-bet">
<h4><strong>Example: Interface for FSL’s Brain Extraction Tool <em>BET</em></strong><a class="headerlink" href="#example-interface-for-fsl-s-brain-extraction-tool-bet" title="Link to this heading">#</a></h4>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># help() function to get a general explanation of the class as well as a list of possible (mandatory and optional) input and output parameters </span>
<span class="n">fsl</span><span class="o">.</span><span class="n">BET</span><span class="o">.</span><span class="n">help</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wraps the executable command ``bet``.

FSL BET wrapper for skull stripping

For complete details, see the `BET Documentation.
&lt;https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/BET/UserGuide&gt;`_

Examples
--------
&gt;&gt;&gt; from nipype.interfaces import fsl
&gt;&gt;&gt; btr = fsl.BET()
&gt;&gt;&gt; btr.inputs.in_file = &#39;structural.nii&#39;
&gt;&gt;&gt; btr.inputs.frac = 0.7
&gt;&gt;&gt; btr.inputs.out_file = &#39;brain_anat.nii&#39;
&gt;&gt;&gt; btr.cmdline
&#39;bet structural.nii brain_anat.nii -f 0.70&#39;
&gt;&gt;&gt; res = btr.run() # doctest: +SKIP

Inputs::

        [Mandatory]
        in_file: (a pathlike object or string representing an existing file)
                input file to skull strip
                argument: ``%s``, position: 0

        [Optional]
        out_file: (a pathlike object or string representing a file)
                name of output skull stripped image
                argument: ``%s``, position: 1
        outline: (a boolean)
                create surface outline image
                argument: ``-o``
        mask: (a boolean)
                create binary mask image
                argument: ``-m``
        skull: (a boolean)
                create skull image
                argument: ``-s``
        no_output: (a boolean)
                Don&#39;t generate segmented output
                argument: ``-n``
        frac: (a float)
                fractional intensity threshold
                argument: ``-f %.2f``
        vertical_gradient: (a float)
                vertical gradient in fractional intensity threshold (-1, 1)
                argument: ``-g %.2f``
        radius: (an integer)
                head radius
                argument: ``-r %d``
        center: (a list of at most 3 items which are an integer)
                center of gravity in voxels
                argument: ``-c %s``
        threshold: (a boolean)
                apply thresholding to segmented brain image and mask
                argument: ``-t``
        mesh: (a boolean)
                generate a vtk mesh brain surface
                argument: ``-e``
        robust: (a boolean)
                robust brain centre estimation (iterates BET several times)
                argument: ``-R``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        padding: (a boolean)
                improve BET if FOV is very small in Z (by temporarily padding end
                slices)
                argument: ``-Z``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        remove_eyes: (a boolean)
                eye &amp; optic nerve cleanup (can be useful in SIENA)
                argument: ``-S``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        surfaces: (a boolean)
                run bet2 and then betsurf to get additional skull and scalp surfaces
                (includes registrations)
                argument: ``-A``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        t2_guided: (a pathlike object or string representing a file)
                as with creating surfaces, when also feeding in non-brain-extracted
                T2 (includes registrations)
                argument: ``-A2 %s``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        functional: (a boolean)
                apply to 4D fMRI data
                argument: ``-F``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        reduce_bias: (a boolean)
                bias field and neck cleanup
                argument: ``-B``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        output_type: (&#39;NIFTI&#39; or &#39;NIFTI_PAIR&#39; or &#39;NIFTI_GZ&#39; or
                  &#39;NIFTI_PAIR_GZ&#39;)
                FSL output type
        args: (a string)
                Additional parameters to the command
                argument: ``%s``
        environ: (a dictionary with keys which are a bytes or None or a value
                  of class &#39;str&#39; and with values which are a bytes or None or a
                  value of class &#39;str&#39;, nipype default value: {})
                Environment variables

Outputs::

        out_file: (a pathlike object or string representing a file)
                path/name of skullstripped file (if generated)
        mask_file: (a pathlike object or string representing a file)
                path/name of binary brain mask (if generated)
        outline_file: (a pathlike object or string representing a file)
                path/name of outline file (if generated)
        meshfile: (a pathlike object or string representing a file)
                path/name of vtk mesh file (if generated)
        inskull_mask_file: (a pathlike object or string representing a file)
                path/name of inskull mask (if generated)
        inskull_mesh_file: (a pathlike object or string representing a file)
                path/name of inskull mesh outline (if generated)
        outskull_mask_file: (a pathlike object or string representing a file)
                path/name of outskull mask (if generated)
        outskull_mesh_file: (a pathlike object or string representing a file)
                path/name of outskull mesh outline (if generated)
        outskin_mask_file: (a pathlike object or string representing a file)
                path/name of outskin mask (if generated)
        outskin_mesh_file: (a pathlike object or string representing a file)
                path/name of outskin mesh outline (if generated)
        skull_mask_file: (a pathlike object or string representing a file)
                path/name of skull mask (if generated)
        skull_file: (a pathlike object or string representing a file)
                path/name of skull file (if generated)

References:
-----------
None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an instance of the fsl.BET object</span>
<span class="n">skullstrip</span> <span class="o">=</span> <span class="n">fsl</span><span class="o">.</span><span class="n">BET</span><span class="p">()</span>

<span class="c1"># Set input (and output)</span>
<span class="n">skullstrip</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="s1">&#39;./ds000102/sub-01/anat/sub-01_T1w.nii.gz&#39;</span> 

<span class="n">skullstrip</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="s1">&#39;./output/T1w_nipype_bet.nii.gz&#39;</span> <span class="c1"># Interfaces by default spit out results to the local directory why relative paths work (outputs are not stored in temporary files like in Nodes/Workflow)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Execute the node and shows outputs </span>
<span class="n">res</span> <span class="o">=</span> <span class="n">skullstrip</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">res</span><span class="o">.</span><span class="n">outputs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>inskull_mask_file = &lt;undefined&gt;
inskull_mesh_file = &lt;undefined&gt;
mask_file = &lt;undefined&gt;
meshfile = &lt;undefined&gt;
out_file = /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/T1w_nipype_bet.nii.gz
outline_file = &lt;undefined&gt;
outskin_mask_file = &lt;undefined&gt;
outskin_mesh_file = &lt;undefined&gt;
outskull_mask_file = &lt;undefined&gt;
outskull_mesh_file = &lt;undefined&gt;
skull_file = &lt;undefined&gt;
skull_mask_file = &lt;undefined&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gives you transparency to what&#39;s happening under the hood with one additional line</span>
<span class="n">skullstrip</span><span class="o">.</span><span class="n">cmdline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;bet ds000102/sub-01/anat/sub-01_T1w.nii.gz output/T1w_nipype_bet.nii.gz&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="nodes-the-light-wrapper-around-interfaces">
<h3>3.2. Nodes: The light wrapper around interfaces<a class="headerlink" href="#nodes-the-light-wrapper-around-interfaces" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>To streamline the analysis and to execute multiple interfaces in a sensible order, they need to be put in a Node.</p></li>
<li><p>A node is an object that executes a certain function: Nipype interface, a user-specified function or an external script.</p></li>
</ul>
<p>Each node consists of a name, an interface category and at least one input field, and at least one output field.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Nodes expose inputs and outputs of the Interface as its own and add additional functionality allowing to connect Nodes into a Workflow (directed graph):</p>
<img src="https://miykael.github.io/nipype_tutorial/static/images/node_two_nodes.png" style="display: block; margin: 0 auto; padding: 30px;" width="50%" height="50%">
<figcaption><b>Figure 3:</b> Nipype Nodes</figcaption></section>
<section id="mapnode">
<h3>MapNode<a class="headerlink" href="#mapnode" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Quite similar to a normal Node, but it can take a list of inputs and operate over each input separately, ultimately returning a list of outputs.</p></li>
<li><p>Example:  Multiple functional images (A) and each of them should be motion corrected (B1, B2, B3,..). Afterwards, put them all together into a GLM, i.e. the input for the GLM should be an array of [B1, B2, B3, …].</p></li>
</ul>
<center><img src=https://miykael.github.io/nipype_tutorial/static/images/mapnode.png></center>
<figcaption><b>Figure 4:</b> MapNode</figcaption>
</section>
<section id="iterables">
<h3>Iterables<a class="headerlink" href="#iterables" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>For repetitive steps: Iterables split up the execution workflow into many different branches.</p></li>
<li><p>Example: Running the same preprocessing on multiple subjects or doing statistical inference on multiple files.</p></li>
</ul>
<center><img src=https://miykael.github.io/nipype_tutorial/static/images/iterables.png></center>
<figcaption><b>Figure 5:</b> Iterables</figcaption></section>
<section id="joinnode">
<h3>JoinNode<a class="headerlink" href="#joinnode" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Has the opposite effect of iterables: JoinNode merges the different branches back into one node.</p></li>
<li><p>A JoinNode generalizes MapNode to operate in conjunction with an upstream iterable node to reassemble downstream results, e.g., to merge files into a group level analysis.</p></li>
</ul>
<center><img src=https://miykael.github.io/nipype_tutorial/static/images/joinnode.png></center>
<figcaption><b>Figure 6:</b> JoinNode</figcaption>
<section id="example-node">
<h4><strong>Example: Node</strong><a class="headerlink" href="#example-node" title="Link to this heading">#</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">nipype</span><span class="p">.</span><span class="nx">pipeline</span><span class="p">.</span><span class="nx">engine</span><span class="p">.</span><span class="nx">nodes</span><span class="w"> </span><span class="nx">module</span>

<span class="nx">nodename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Nodetype</span><span class="p">(</span><span class="nx">interface_function</span><span class="p">(),</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;labelname&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>nodename:</strong> Variable name of the node in the python environment.</p></li>
<li><p><strong>Nodetype:</strong> Type of node: Node, MapNode or JoinNode.</p></li>
<li><p><strong>interface_function:</strong> Function the node should execute. Can be user specific or coming from an Interface.</p></li>
<li><p><strong>labelname:</strong> Label name of the node in the workflow environment (defines the name of the working directory).</p>
<ul>
<li><p>To execute a node, apply the <code class="docutils literal notranslate"><span class="pre">.run()</span></code> method</p></li>
<li><p>To return the output fields of the underlying interface, use <code class="docutils literal notranslate"><span class="pre">.outputs</span></code></p></li>
<li><p>To get help, <code class="docutils literal notranslate"><span class="pre">.help()</span></code> prints the interface help</p></li>
</ul>
</li>
</ul>
<p>The specification of base_dir is very important (and is why we needed to use absolute paths above) because otherwise all the outputs would be saved somewhere in the temporary files. Unlike interfaces, which by default spit out results to the local directly, the Workflow engine executes things off in its own directory hierarchy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create FSL BET Node with fractional intensity threshold of 0.3 and create a binary mask image</span>

<span class="c1"># For reasons that will become clear in the Workflow section, it&#39;s important to pass filenames to Nodes as absolute paths.</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;ds000102/sub-01/anat/sub-01_T1w.nii.gz&#39;</span><span class="p">)</span> 
<span class="n">output_file</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output/T1w_nipype_bet.nii.gz&#39;</span><span class="p">)</span>

<span class="c1"># Create FSL BET Node with fractional intensity threshold of 0.3 and create a binary mask image</span>
<span class="n">bet</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">BET</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bet_node&#39;</span><span class="p">)</span>

<span class="c1"># Define inputs </span>
<span class="n">bet</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">frac</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">bet</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">bet</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="n">input_file</span>
<span class="n">bet</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="n">output_file</span>

<span class="c1"># Run the node</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">bet</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250606-01:27:47,466 nipype.workflow INFO:
	 [Node] Setting-up &quot;bet_node&quot; in &quot;/tmp/tmp13hyf_z5/bet_node&quot;.
250606-01:27:47,470 nipype.workflow INFO:
	 [Node] Executing &quot;bet_node&quot; &lt;nipype.interfaces.fsl.preprocess.BET&gt;
250606-01:27:51,451 nipype.workflow INFO:
	 [Node] Finished &quot;bet_node&quot;, elapsed time 3.979764s.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shows produced outputs </span>
<span class="n">res</span><span class="o">.</span><span class="n">outputs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>inskull_mask_file = &lt;undefined&gt;
inskull_mesh_file = &lt;undefined&gt;
mask_file = /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/T1w_nipype_bet_mask.nii.gz
meshfile = &lt;undefined&gt;
out_file = /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/T1w_nipype_bet.nii.gz
outline_file = &lt;undefined&gt;
outskin_mask_file = &lt;undefined&gt;
outskin_mesh_file = &lt;undefined&gt;
outskull_mask_file = &lt;undefined&gt;
outskull_mesh_file = &lt;undefined&gt;
skull_file = &lt;undefined&gt;
skull_mask_file = &lt;undefined&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot original input file</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_anat</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;BET input&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
          <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>

<span class="c1"># Plot skullstripped output file (out_file) through the outputs property</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_anat</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">out_file</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;BET output&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
          <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9f3e991b1ed35b5ec81ff63b35b46fdd7ad834a5877e15bc10c0dc22e2036452.png" src="../_images/9f3e991b1ed35b5ec81ff63b35b46fdd7ad834a5877e15bc10c0dc22e2036452.png" />
<img alt="../_images/6927c25cdc20b5bd783d5479288fcb2d8a287875ba07c56e5af05e0a70104359.png" src="../_images/6927c25cdc20b5bd783d5479288fcb2d8a287875ba07c56e5af05e0a70104359.png" />
</div>
</div>
</section>
</section>
<section id="workflows">
<h3>3.3. Workflows<a class="headerlink" href="#workflows" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Define functionality for pipelined execution of interfaces</p></li>
<li><p>Consist of multiple nodes, each representing a specific interface.</p></li>
<li><p>The processing stream is encoded as a directed acyclic graph (DAG), where each stage of processing is a node. Nodes are unidirectionally dependent on others, ensuring no cycles and clear directionality. The Node and Workflow classes make these relationships explicit.</p></li>
<li><p>Edges represent the data flow between nodes.</p></li>
<li><p>Control the setup and the execution of individual interfaces.</p></li>
<li><p>Will take care of inputs and outputs of each interface and arrange the execution of each interface in the most efficient way.</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">nipype</span><span class="p">.</span><span class="nx">pipeline</span><span class="p">.</span><span class="nx">engine</span><span class="p">.</span><span class="nx">workflows</span><span class="w"> </span><span class="nx">module</span>

<span class="nx">Workflow</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">base_dir</span><span class="o">=</span><span class="nx">None</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>name:</strong> Label name of the workflow.</p></li>
<li><p><strong>base_dir:</strong> Defines the working directory for this instance of workflow element. Unlike interfaces, which by default store results in the local directory, the Workflow engine executes things off in its own directory hierarchy. By default (if not set manually), it is a temporary directory (/tmp).</p></li>
</ul>
<p>Workflow methods that we will use during this tutorial:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Workflow.connect()</span></code>: Connect nodes in the pipeline</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Workflow.write_graph()</span></code>: Generates a graphviz dot file and a png file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Workflow.run()</span></code>: Execute the workflow</p></li>
</ul>
<section id="example-workflow">
<h4><strong>Example: Workflow</strong><a class="headerlink" href="#example-workflow" title="Link to this heading">#</a></h4>
<p>First, define different nodes to:</p>
<ul class="simple">
<li><p>Skullstrip an image to obtain a mask</p></li>
<li><p>Smooth the original image</p></li>
<li><p>Mask the smoothed image</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">in_file</span> <span class="o">=</span> <span class="n">input_file</span> <span class="c1"># See node example</span>

<span class="c1"># Skullstrip process</span>
<span class="n">skullstrip</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">BET</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="n">in_file</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;skullstrip&quot;</span><span class="p">)</span>

<span class="c1"># Smooth process</span>
<span class="n">smooth</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">IsotropicSmooth</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="n">in_file</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;smooth&quot;</span><span class="p">)</span>

<span class="c1"># Mask process</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">ApplyMask</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mask&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a working directory for all workflows created during this workshop</span>
<span class="o">!</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span>output/working_dir<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>output/working_dir

<span class="n">wf_work_dir</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output/working_dir&#39;</span><span class="p">)</span> 

<span class="c1"># Initiation of a workflow with specifying the working directory.</span>
<span class="c1"># This specification of base_dir is very important (and is why we needed to use absolute paths above for the input files) because otherwise all the outputs would be saved somewhere in the temporary files.</span>
<span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;smoothflow&quot;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">wf_work_dir</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="connect-nodes-within-a-workflow">
<h4>Connect nodes within a workflow<a class="headerlink" href="#connect-nodes-within-a-workflow" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>method called <code class="docutils literal notranslate"><span class="pre">connect</span></code> that is going to do most of the work</p></li>
<li><p>checks if inputs and outputs are actually provided by the nodes that are being connected</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> There are two different ways to call connect:</p>
<p>Establish one connection at a time:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;source_output&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dest_input&quot;</span><span class="p">)</span><span class="w"> </span>
</pre></div>
</div>
<p>Establish multiple connections between two nodes at once:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">connect</span><span class="p">([(</span><span class="nx">source</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="p">,</span><span class="w"> </span><span class="p">[(</span><span class="s2">&quot;source_output1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dest_input1&quot;</span><span class="p">),</span>
<span class="w">                         </span><span class="p">(</span><span class="s2">&quot;source_output2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dest_input2&quot;</span><span class="p">)</span>
<span class="w">                         </span><span class="p">])</span>
<span class="w">         </span><span class="p">])</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option 1: connect the binary mask of the skullstripping process to the mask node</span>
<span class="n">wf</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">skullstrip</span><span class="p">,</span> <span class="s2">&quot;mask_file&quot;</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;mask_file&quot;</span><span class="p">)</span>

<span class="c1"># Option 2: connect the output of the smoothing node to the input of the masking node</span>
<span class="n">wf</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">smooth</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">)])])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Explore the workflow visually</span>
<span class="n">wf</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">dotfilename</span><span class="o">=</span><span class="s2">&quot;workflow_graph.dot&quot;</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span><span class="s2">&quot;smoothflow/workflow_graph.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250606-01:27:55,578 nipype.workflow INFO:
	 Generated workflow graph: /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/smoothflow/workflow_graph.png (graph2use=hierarchical, simple_form=True).
</pre></div>
</div>
<img alt="../_images/32fcfb2329fe3d59a6dab0a41afe4f4a865b0b313875c6f4ad5ca857ac36427c.png" src="../_images/32fcfb2329fe3d59a6dab0a41afe4f4a865b0b313875c6f4ad5ca857ac36427c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Certain graph types also allow you to further inspect the individual connections between the nodes</span>
<span class="n">wf</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph2use</span><span class="o">=</span><span class="s1">&#39;flat&#39;</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span><span class="s2">&quot;smoothflow/graph_detailed.png&quot;</span><span class="p">))</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250606-01:27:55,939 nipype.workflow INFO:
	 Generated workflow graph: /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/smoothflow/graph.png (graph2use=flat, simple_form=True).
</pre></div>
</div>
<img alt="../_images/633f4e5b88aaaf63d098dc5fa40c770829b503750804aa1f285e463f6566e4f4.png" src="../_images/633f4e5b88aaaf63d098dc5fa40c770829b503750804aa1f285e463f6566e4f4.png" />
</div>
</div>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Execute the workflow (running serially here)</span>
<span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250606-01:27:55,951 nipype.workflow INFO:
	 Workflow smoothflow settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
250606-01:27:55,955 nipype.workflow INFO:
	 Running serially.
250606-01:27:55,956 nipype.workflow INFO:
	 [Node] Setting-up &quot;smoothflow.skullstrip&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/smoothflow/skullstrip&quot;.
250606-01:27:55,959 nipype.workflow INFO:
	 [Node] Executing &quot;skullstrip&quot; &lt;nipype.interfaces.fsl.preprocess.BET&gt;
250606-01:27:59,939 nipype.workflow INFO:
	 [Node] Finished &quot;skullstrip&quot;, elapsed time 3.9788740000000002s.
250606-01:27:59,943 nipype.workflow INFO:
	 [Node] Setting-up &quot;smoothflow.smooth&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/smoothflow/smooth&quot;.
250606-01:27:59,945 nipype.workflow INFO:
	 [Node] Executing &quot;smooth&quot; &lt;nipype.interfaces.fsl.maths.IsotropicSmooth&gt;
250606-01:28:07,569 nipype.workflow INFO:
	 [Node] Finished &quot;smooth&quot;, elapsed time 7.6233450000000005s.
250606-01:28:07,572 nipype.workflow INFO:
	 [Node] Setting-up &quot;smoothflow.mask&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/smoothflow/mask&quot;.
250606-01:28:07,575 nipype.workflow INFO:
	 [Node] Executing &quot;mask&quot; &lt;nipype.interfaces.fsl.maths.ApplyMask&gt;
250606-01:28:08,891 nipype.workflow INFO:
	 [Node] Finished &quot;mask&quot;, elapsed time 1.315226s.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;networkx.classes.digraph.DiGraph at 0x7f033446d350&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the working directories of the workflow</span>
<span class="o">!</span>tree<span class="w">  </span>output/working_dir/smoothflow/<span class="w"> </span>-I<span class="w"> </span><span class="s1">&#39;*js|*json|*html|*pklz|_report&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">output/working_dir/smoothflow/</span>
├── graph.dot
├── graph.png
├── graph_detailed.dot
├── graph_detailed.png
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">mask</span>
│   ├── command.txt
│   └── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_T1w_smooth_masked.nii.gz</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">skullstrip</span>
│   ├── command.txt
│   └── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_T1w_brain_mask.nii.gz</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">smooth</span>
│   ├── command.txt
│   └── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_T1w_smooth.nii.gz</span>
├── workflow_graph.dot
└── workflow_graph.png

3 directories, 12 files
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper function to plot 3D NIfTI images</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_slice</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>

    <span class="c1"># Load the image</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>

    <span class="c1"># Cut in the middle of the brain</span>
    <span class="n">cut</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>

    <span class="c1"># Plot the data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">cut</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">input_file</span><span class="p">,</span>
                         <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s2">&quot;smoothflow/smooth/sub-01_T1w_smooth.nii.gz&quot;</span><span class="p">),</span>
                         <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s2">&quot;smoothflow/skullstrip/sub-01_T1w_brain_mask.nii.gz&quot;</span><span class="p">),</span>
                         <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s2">&quot;smoothflow/mask/sub-01_T1w_smooth_masked.nii.gz&quot;</span><span class="p">)]):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plot_slice</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04d03ab5967cba073d6e10fc41be9e44309a380fb22757f5083234d1e9787fca.png" src="../_images/04d03ab5967cba073d6e10fc41be9e44309a380fb22757f5083234d1e9787fca.png" />
</div>
</div>
</section>
</section>
<section id="execution-plugins-execution-on-different-systems">
<h3>3.4. Execution Plugins: Execution on different systems<a class="headerlink" href="#execution-plugins-execution-on-different-systems" title="Link to this heading">#</a></h3>
<p>Allow seamless execution across many architectures and make using parallel computation quite easy.</p>
<ul class="simple">
<li><p>Local Machines:</p>
<ul>
<li><p><strong>Serial</strong>: Runs the workflow one node at a time in a single process locally. The order of the nodes is determined by a topolocial sort of the workflow.</p></li>
<li><p><strong>Multicore</strong>: Uses the Python multiprocessing library to distribute jobs as new processes on a local system.</p></li>
</ul>
</li>
<li><p>Submission to Cluster Schedulers:</p>
<ul>
<li><p>Plugins like HTCondor, PBS, SLURM, SGE, OAR, and LSF submit jobs to clusters managed by these job scheduling systems.</p></li>
</ul>
</li>
<li><p>Advanced Cluster Integration:</p>
<ul>
<li><p><strong>DAGMan</strong>: Manages complex workflow dependencies for submission to DAGMan cluster scheduler.</p></li>
<li><p><strong>IPython</strong>: Utilizes IPython parallel computing capabilities for distributed execution in clusters.</p></li>
</ul>
</li>
<li><p>Specialized Execution Plugins:</p>
<ul>
<li><p><strong>Soma-Workflow</strong>: Integrates with Soma-Workflow system for distributed execution in HPC environments.</p></li>
</ul>
</li>
</ul>
<p class="important-title" style="font-size: 1.2em; color: red;"><i class="fas fa-exclamation-circle" style="color: red;"></i> <span style="font-size: 1.5em;">Cluster operation often needs a special setup.</span></p>
<p>All plugins can be executed with:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">workflow</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="nx">PLUGIN_NAME</span><span class="p">,</span><span class="w"> </span><span class="nx">plugin_args</span><span class="o">=</span><span class="nx">ARGS_DICT</span><span class="p">)</span>
</pre></div>
</div>
<p>To run the workflow one node at a time:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="s1">&#39;Linear&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To distribute processing on a multicore machine, number of processors/threads will be automatically detected:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">)</span><span class="w"> </span>
</pre></div>
</div>
<p>Plugin arguments:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">arguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;n_procs&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">num_threads</span><span class="p">,</span>
<span class="w">               </span><span class="s1">&#39;memory_gb&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">num_gb</span><span class="p">}</span><span class="w"> </span>

<span class="nx">wf</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">plugin_args</span><span class="o">=</span><span class="nx">arguments</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to use Nipype with SLURM simply call:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="s1">&#39;SLURM&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p style="font-size: 13px;">Optional arguments:</p>
<p style="font-size: 13px;"><code>template</code>: If you want to use your own job submission template (the plugin generates a basic one by default).</p>
<p style="font-size: 13px;"><code>sbatch_args</code>: Takes any arguments such as nodes/partitions/gres/etc that you would want to pass on to the sbatch command underneath.</p>
<p style="font-size: 13px;"><code>jobid_re</code>: Regular expression for custom job submission id search.</p></section>
<section id="data-input-first-step-of-every-analysis">
<h3>3.5. Data Input: First step of every analysis<a class="headerlink" href="#data-input-first-step-of-every-analysis" title="Link to this heading">#</a></h3>
<p>Nipype provides many different modules how to get the data into the framework.</p>
<p>We will work through an example with the DataGrabber module:</p>
<ul class="simple">
<li><p><strong>DataGrabber:</strong>  Versatile input module to retrieve data from a local file system based on user-defined search criteria, including wildcard patterns, regular expressions, and directory hierarchies. It supports almost any file organization of your data.</p></li>
</ul>
<p>But there are many more alternatives available:</p>
<ul class="simple">
<li><p><strong>SelectFiles:</strong> A simpler alternative to the DataGrabber interface, built on Python format strings. Format strings allow you to replace named sections of template strings set off by curly braces ({}).</p></li>
<li><p><strong>BIDSDataGrabber:</strong> Get neuroimaging data organized in BIDS-compliant directory structures. It simplifies the process of accessing and organizing neuroimaging data for analysis pipelines.</p></li>
<li><p><strong>DataFinder:</strong>  Search for paths that match a given regular expression. Allows a less proscriptive approach to gathering input files compared to DataGrabber.</p></li>
<li><p><strong>FreeSurferSource:</strong> Specific case of a file grabber that facilitates the data import of outputs from the FreeSurfer recon-all algorithm.</p></li>
<li><p><strong>JSONFileGrabber:</strong> Datagrabber interface that loads a json file and generates an output for every first-level object.</p></li>
<li><p><strong>S3DataGrabber:</strong> Pull data from an Amazon S3 Bucket.</p></li>
<li><p><strong>SSHDataGrabber:</strong> Extension of DataGrabber module that downloads the file list and optionally the files from a SSH server.</p></li>
<li><p><strong>XNATSource:</strong> Pull data from an XNAT server.</p></li>
</ul>
<section id="example-datagrabber">
<h4><strong>Example: DataGrabber</strong><a class="headerlink" href="#example-datagrabber" title="Link to this heading">#</a></h4>
<p>Let’s assume we want to grab the anatomical and functional images of certain subjects of the Flanker dataset:</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w"> </span>-L<span class="w"> </span><span class="m">4</span><span class="w"> </span>ds000102/<span class="w"> </span>-I<span class="w"> </span><span class="s1">&#39;*csv|*pdf&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">ds000102/</span>
├── CHANGES
├── README
├── T1w.json
├── dataset_description.json
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">derivatives</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">mriqc</span>
├── participants.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-01</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-01_T1w.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/Pf/6k/MD5E-s10581116--757e697a01eeea5c97a7d6fbc7153373.nii.gz/MD5E-s10581116--757e697a01eeea5c97a7d6fbc7153373.nii.gz</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-01_task-flanker_run-1_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/5m/w9/MD5E-s28061534--8e8c44ff53f9b5d46f2caae5916fa4ef.nii.gz/MD5E-s28061534--8e8c44ff53f9b5d46f2caae5916fa4ef.nii.gz</span>
│       ├── sub-01_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-01_task-flanker_run-2_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/2F/58/MD5E-s28143286--f0bcf782c3688e2cf7149b4665949484.nii.gz/MD5E-s28143286--f0bcf782c3688e2cf7149b4665949484.nii.gz</span>
│       └── sub-01_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-02</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-02_T1w.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/3m/FF/MD5E-s10737123--cbd4181ee26559e8ec0a441fa2f834a7.nii.gz/MD5E-s10737123--cbd4181ee26559e8ec0a441fa2f834a7.nii.gz</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-02_task-flanker_run-1_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/8v/2j/MD5E-s29188378--80050f0deb13562c24f2fc23f8d095bd.nii.gz/MD5E-s29188378--80050f0deb13562c24f2fc23f8d095bd.nii.gz</span>
│       ├── sub-02_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-02_task-flanker_run-2_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/fM/Kw/MD5E-s29193540--cc013f2d7d148b448edca8aada349d02.nii.gz/MD5E-s29193540--cc013f2d7d148b448edca8aada349d02.nii.gz</span>
│       └── sub-02_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-03</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-03_T1w.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/7W/9z/MD5E-s10707026--8f1858934cc7c7457e3a4a71cc2131fc.nii.gz/MD5E-s10707026--8f1858934cc7c7457e3a4a71cc2131fc.nii.gz</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-03_task-flanker_run-1_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/q6/kF/MD5E-s28755729--b19466702eee6b9385bd6e19e362f94c.nii.gz/MD5E-s28755729--b19466702eee6b9385bd6e19e362f94c.nii.gz</span>
│       ├── sub-03_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-03_task-flanker_run-2_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/zV/K1/MD5E-s28782544--8d9700a435d08c90f0c1d534efdc8b69.nii.gz/MD5E-s28782544--8d9700a435d08c90f0c1d534efdc8b69.nii.gz</span>
│       └── sub-03_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-04</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-04_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/FW/14/MD5E-s10738444--2a9a2ba4ea7d2324c84bf5a2882f196c.nii.gz/MD5E-s10738444--2a9a2ba4ea7d2324c84bf5a2882f196c.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-04_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9Z/0Q/MD5E-s29062799--27171406951ea275cb5857ea0dc32345.nii.gz/MD5E-s29062799--27171406951ea275cb5857ea0dc32345.nii.gz
│       ├── sub-04_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-04_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/FW/FZ/MD5E-s29071279--f89b61fe3ebab26df1374f2564bd95c2.nii.gz/MD5E-s29071279--f89b61fe3ebab26df1374f2564bd95c2.nii.gz
│       └── sub-04_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-05</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-05_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/k2/Kj/MD5E-s10753867--c4b5788da5f4c627f0f5862da5f46c35.nii.gz/MD5E-s10753867--c4b5788da5f4c627f0f5862da5f46c35.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-05_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/VZ/z5/MD5E-s29667270--0ce9ac78b6aa9a77fc94c655a6ff5a06.nii.gz/MD5E-s29667270--0ce9ac78b6aa9a77fc94c655a6ff5a06.nii.gz
│       ├── sub-05_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-05_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/z7/MP/MD5E-s29660544--752750dabb21e2cf28e87d1d550a71b9.nii.gz/MD5E-s29660544--752750dabb21e2cf28e87d1d550a71b9.nii.gz
│       └── sub-05_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-06</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-06_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/5w/G0/MD5E-s10620585--1132eab3830fe59b8a10b6582bb49004.nii.gz/MD5E-s10620585--1132eab3830fe59b8a10b6582bb49004.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-06_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/3x/qj/MD5E-s29386982--e671c0c647ce7d0d4596e35b702ee970.nii.gz/MD5E-s29386982--e671c0c647ce7d0d4596e35b702ee970.nii.gz
│       ├── sub-06_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-06_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9j/6P/MD5E-s29379265--e513a2746d2b5c603f96044cf48c557c.nii.gz/MD5E-s29379265--e513a2746d2b5c603f96044cf48c557c.nii.gz
│       └── sub-06_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-07</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-07_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/08/fF/MD5E-s10718092--38481fbc489dfb1ec4b174b57591a074.nii.gz/MD5E-s10718092--38481fbc489dfb1ec4b174b57591a074.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-07_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/z1/7W/MD5E-s28946009--5baf7a314874b280543fc0f91f2731af.nii.gz/MD5E-s28946009--5baf7a314874b280543fc0f91f2731af.nii.gz
│       ├── sub-07_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-07_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Jf/W7/MD5E-s28960603--682e13963bfc49cc6ae05e9ba5c62619.nii.gz/MD5E-s28960603--682e13963bfc49cc6ae05e9ba5c62619.nii.gz
│       └── sub-07_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-08</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-08_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/mw/MM/MD5E-s10561256--b94dddd8dc1c146aa8cd97f8d9994146.nii.gz/MD5E-s10561256--b94dddd8dc1c146aa8cd97f8d9994146.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-08_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/zX/v9/MD5E-s28641609--47314e6d1a14b8545686110b5b67f8b8.nii.gz/MD5E-s28641609--47314e6d1a14b8545686110b5b67f8b8.nii.gz
│       ├── sub-08_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-08_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/WZ/F0/MD5E-s28636310--4535bf26281e1c5556ad0d3468e7fe4e.nii.gz/MD5E-s28636310--4535bf26281e1c5556ad0d3468e7fe4e.nii.gz
│       └── sub-08_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-09</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-09_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/QJ/ZZ/MD5E-s10775967--e6a18e64bc0a6b17254a9564cf9b8f82.nii.gz/MD5E-s10775967--e6a18e64bc0a6b17254a9564cf9b8f82.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-09_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/k9/1X/MD5E-s29200533--59e86a903e0ab3d1d320c794ba1f0777.nii.gz/MD5E-s29200533--59e86a903e0ab3d1d320c794ba1f0777.nii.gz
│       ├── sub-09_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-09_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/W3/94/MD5E-s29223017--7f3fb9e260d3bd28e29b0b586ce4c344.nii.gz/MD5E-s29223017--7f3fb9e260d3bd28e29b0b586ce4c344.nii.gz
│       └── sub-09_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-10</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-10_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/5F/3f/MD5E-s10750712--bde2309077bffe22cb65e42ebdce5bfa.nii.gz/MD5E-s10750712--bde2309077bffe22cb65e42ebdce5bfa.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-10_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/3p/qp/MD5E-s29732696--339715d5cec387f4d44dfe94f304a429.nii.gz/MD5E-s29732696--339715d5cec387f4d44dfe94f304a429.nii.gz
│       ├── sub-10_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-10_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/11/Zx/MD5E-s29724034--16f2bf452524a315182f188becc1866d.nii.gz/MD5E-s29724034--16f2bf452524a315182f188becc1866d.nii.gz
│       └── sub-10_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-11</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-11_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/kj/xX/MD5E-s10534963--9e5bff7ec0b5df2850e1d05b1af281ba.nii.gz/MD5E-s10534963--9e5bff7ec0b5df2850e1d05b1af281ba.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-11_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/35/fk/MD5E-s28226875--d5012074c2c7a0a394861b010bcf9a8f.nii.gz/MD5E-s28226875--d5012074c2c7a0a394861b010bcf9a8f.nii.gz
│       ├── sub-11_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-11_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/j7/ff/MD5E-s28198976--c0a64e3b549568c44bb40b1588027c9a.nii.gz/MD5E-s28198976--c0a64e3b549568c44bb40b1588027c9a.nii.gz
│       └── sub-11_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-12</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-12_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/kx/2F/MD5E-s10550168--a7f651adc817b6678148b575654532a4.nii.gz/MD5E-s10550168--a7f651adc817b6678148b575654532a4.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-12_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/M0/fX/MD5E-s28403807--f1c3eb2e519020f4315a696ea845fc01.nii.gz/MD5E-s28403807--f1c3eb2e519020f4315a696ea845fc01.nii.gz
│       ├── sub-12_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-12_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/vW/V0/MD5E-s28424992--8740628349be3c056a0411bf4a852b25.nii.gz/MD5E-s28424992--8740628349be3c056a0411bf4a852b25.nii.gz
│       └── sub-12_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-13</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-13_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/wM/Xw/MD5E-s10609761--440413c3251d182086105649164222c6.nii.gz/MD5E-s10609761--440413c3251d182086105649164222c6.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-13_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/mf/M4/MD5E-s28180916--aa35f4ad0cf630d6396a8a2dd1f3dda6.nii.gz/MD5E-s28180916--aa35f4ad0cf630d6396a8a2dd1f3dda6.nii.gz
│       ├── sub-13_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-13_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/XP/76/MD5E-s28202786--8caf1ac548c87b2b35f85e8ae2bf72c1.nii.gz/MD5E-s28202786--8caf1ac548c87b2b35f85e8ae2bf72c1.nii.gz
│       └── sub-13_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-14</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-14_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Zw/0z/MD5E-s9223596--33abfb5da565f3487e3a7aebc15f940c.nii.gz/MD5E-s9223596--33abfb5da565f3487e3a7aebc15f940c.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-14_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Jp/29/MD5E-s29001492--250f1e4daa9be1d95e06af0d56629cc9.nii.gz/MD5E-s29001492--250f1e4daa9be1d95e06af0d56629cc9.nii.gz
│       ├── sub-14_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-14_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/PK/V2/MD5E-s29068193--5621a3b0af8132c509420b4ad9aaf8fb.nii.gz/MD5E-s29068193--5621a3b0af8132c509420b4ad9aaf8fb.nii.gz
│       └── sub-14_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-15</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-15_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Mz/qq/MD5E-s10752891--ddd2622f115ec0d29a0c7ab2366f6f95.nii.gz/MD5E-s10752891--ddd2622f115ec0d29a0c7ab2366f6f95.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-15_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/08/JJ/MD5E-s28285239--feda22c4526af1910fcee58d4c42f07e.nii.gz/MD5E-s28285239--feda22c4526af1910fcee58d4c42f07e.nii.gz
│       ├── sub-15_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-15_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9f/0W/MD5E-s28289760--433000a1def662e72d8433dba151c61b.nii.gz/MD5E-s28289760--433000a1def662e72d8433dba151c61b.nii.gz
│       └── sub-15_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-16</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-16_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/4g/8k/MD5E-s10927450--a196f7075c793328dd6ff3cebf36ea6b.nii.gz/MD5E-s10927450--a196f7075c793328dd6ff3cebf36ea6b.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-16_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9z/g2/MD5E-s29757991--1a1648b2fa6cc74e31c94f109d8137ba.nii.gz/MD5E-s29757991--1a1648b2fa6cc74e31c94f109d8137ba.nii.gz
│       ├── sub-16_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-16_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/k8/4F/MD5E-s29773832--fe08739ea816254395b985ee704aaa99.nii.gz/MD5E-s29773832--fe08739ea816254395b985ee704aaa99.nii.gz
│       └── sub-16_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-17</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-17_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/jQ/MQ/MD5E-s10826014--8e2a6b062df4d1c4327802f2b905ef36.nii.gz/MD5E-s10826014--8e2a6b062df4d1c4327802f2b905ef36.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-17_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Wz/2P/MD5E-s28991563--9845f461a017a39d1f6e18baaa0c9c41.nii.gz/MD5E-s28991563--9845f461a017a39d1f6e18baaa0c9c41.nii.gz
│       ├── sub-17_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-17_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/jF/3m/MD5E-s29057821--84ccc041163bcc5b3a9443951e2a5a78.nii.gz/MD5E-s29057821--84ccc041163bcc5b3a9443951e2a5a78.nii.gz
│       └── sub-17_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-18</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-18_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/3v/pK/MD5E-s10571510--6fc4b5792bc50ea4d14eb5247676fafe.nii.gz/MD5E-s10571510--6fc4b5792bc50ea4d14eb5247676fafe.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-18_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/94/P2/MD5E-s28185776--5b3879ec6fc4bbe1e48efc64984f88cf.nii.gz/MD5E-s28185776--5b3879ec6fc4bbe1e48efc64984f88cf.nii.gz
│       ├── sub-18_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-18_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/qp/6K/MD5E-s28234699--58019d798a133e5d7806569374dd8160.nii.gz/MD5E-s28234699--58019d798a133e5d7806569374dd8160.nii.gz
│       └── sub-18_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-19</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-19_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Zw/p8/MD5E-s8861893--d338005753d8af3f3d7bd8dc293e2a97.nii.gz/MD5E-s8861893--d338005753d8af3f3d7bd8dc293e2a97.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-19_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/04/k6/MD5E-s28178448--3874e748258cf19aa69a05a7c37ad137.nii.gz/MD5E-s28178448--3874e748258cf19aa69a05a7c37ad137.nii.gz
│       ├── sub-19_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-19_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/mz/P4/MD5E-s28190932--91e6b3e4318ca28f01de8cb967cf8421.nii.gz/MD5E-s28190932--91e6b3e4318ca28f01de8cb967cf8421.nii.gz
│       └── sub-19_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-20</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-20_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/g1/FF/MD5E-s11025608--5929806a7aa5720fc755687e1450b06c.nii.gz/MD5E-s11025608--5929806a7aa5720fc755687e1450b06c.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-20_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/v5/ZJ/MD5E-s29931631--bf9abb057367ce66961f0b7913e8e707.nii.gz/MD5E-s29931631--bf9abb057367ce66961f0b7913e8e707.nii.gz
│       ├── sub-20_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-20_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/J3/KW/MD5E-s29945590--96cfd5b77cd096f6c6a3530015fea32d.nii.gz/MD5E-s29945590--96cfd5b77cd096f6c6a3530015fea32d.nii.gz
│       └── sub-20_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-21</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-21_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/K6/6K/MD5E-s8662805--77b262ddd929fa08d78591bfbe558ac6.nii.gz/MD5E-s8662805--77b262ddd929fa08d78591bfbe558ac6.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-21_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Wz/p9/MD5E-s28756041--9ae556d4e3042532d25af5dc4ab31840.nii.gz/MD5E-s28756041--9ae556d4e3042532d25af5dc4ab31840.nii.gz
│       ├── sub-21_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-21_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/xF/M3/MD5E-s28758438--81866411fc6b6333ec382a20ff0be718.nii.gz/MD5E-s28758438--81866411fc6b6333ec382a20ff0be718.nii.gz
│       └── sub-21_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-22</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-22_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/JG/ZV/MD5E-s9282392--9e7296a6a5b68df46b77836182b6681a.nii.gz/MD5E-s9282392--9e7296a6a5b68df46b77836182b6681a.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-22_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/qW/Gw/MD5E-s28002098--c6bea10177a38667ceea3261a642b3c6.nii.gz/MD5E-s28002098--c6bea10177a38667ceea3261a642b3c6.nii.gz
│       ├── sub-22_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-22_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/VX/Zj/MD5E-s28027568--b34d0df9ad62485aba25296939429885.nii.gz/MD5E-s28027568--b34d0df9ad62485aba25296939429885.nii.gz
│       └── sub-22_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-23</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-23_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/4Z/4x/MD5E-s10626062--db5a6ba6730b319c6425f2e847ce9b14.nii.gz/MD5E-s10626062--db5a6ba6730b319c6425f2e847ce9b14.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-23_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/VK/8F/MD5E-s28965005--4a9a96d9322563510ca14439e7fd6cea.nii.gz/MD5E-s28965005--4a9a96d9322563510ca14439e7fd6cea.nii.gz
│       ├── sub-23_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-23_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/56/20/MD5E-s29050413--753b0d2c23c4af6592501219c2e2c6bd.nii.gz/MD5E-s29050413--753b0d2c23c4af6592501219c2e2c6bd.nii.gz
│       └── sub-23_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-24</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-24_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/jQ/fV/MD5E-s10739691--458f0046eff18ee8c43456637766a819.nii.gz/MD5E-s10739691--458f0046eff18ee8c43456637766a819.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-24_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/km/fV/MD5E-s29354610--29ebfa60e52d49f7dac6814cb5fdc2bc.nii.gz/MD5E-s29354610--29ebfa60e52d49f7dac6814cb5fdc2bc.nii.gz
│       ├── sub-24_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-24_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Wj/KK/MD5E-s29423307--fedaa1d7c6e34420735bb3bbe5a2fe38.nii.gz/MD5E-s29423307--fedaa1d7c6e34420735bb3bbe5a2fe38.nii.gz
│       └── sub-24_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-25</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-25_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Gk/FQ/MD5E-s8998578--f560d832f13e757b485c16d570bf6ebc.nii.gz/MD5E-s8998578--f560d832f13e757b485c16d570bf6ebc.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-25_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/XW/1v/MD5E-s29473003--49b04e7e4b450ec5ef93ff02d4158775.nii.gz/MD5E-s29473003--49b04e7e4b450ec5ef93ff02d4158775.nii.gz
│       ├── sub-25_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-25_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Qm/M7/MD5E-s29460132--b0e9039e9f33510631f229c8c2193285.nii.gz/MD5E-s29460132--b0e9039e9f33510631f229c8c2193285.nii.gz
│       └── sub-25_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-26</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-26_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/kf/9F/MD5E-s10850250--5f103b2660f488e4afa193f9307c1291.nii.gz/MD5E-s10850250--5f103b2660f488e4afa193f9307c1291.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-26_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/QV/10/MD5E-s30127491--8e30aa4bbfcc461bac8598bf621283c5.nii.gz/MD5E-s30127491--8e30aa4bbfcc461bac8598bf621283c5.nii.gz
│       ├── sub-26_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-26_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/3G/Q6/MD5E-s30162480--80fd132e7cb1600ab248249e78f6f1aa.nii.gz/MD5E-s30162480--80fd132e7cb1600ab248249e78f6f1aa.nii.gz
│       └── sub-26_task-flanker_run-2_events.tsv
└── task-flanker_bold.json

80 directories, 136 files
</pre></div>
</div>
</div>
</div>
<p>The two files we desire are at the following locations:</p>
<ul class="simple">
<li><p><strong>anatomical image:</strong>  <span style="color:blue">ds000102</span>/<span style="color:orange">sub-01</span>/anat/<span style="color:orange">sub-01</span>_T1w.nii.gz</p></li>
<li><p><strong>functional image:</strong> <span style="color:blue">ds000102</span>/<span style="color:orange">sub-01</span>/func/<span style="color:orange">sub-01</span>_task-flanker<span style="color:red">_run-1</span>_bold.nii.gz</p></li>
</ul>
<p>This means that we can rewrite the paths as follows:</p>
<ul class="simple">
<li><p><strong>anat</strong> = <span style="color:blue">base_directory</span>/sub-<span style="color:orange">[subject_id]</span>/anat/sub-<span style="color:orange">[subject_id]</span>_T1w.nii.gz</p></li>
<li><p><strong>func</strong> = <span style="color:blue">base_directory</span>/sub-<span style="color:orange">[subject_id]</span>/func/sub-<span style="color:orange">[subject_id]</span>_task-flanker_run_<span style="color:red">[run_id]</span>_bold.nii.gz</p></li>
</ul>
<p>Therefore, we need the parameters <span style="color:orange">subject_id</span> for the anatomical image and the parameters <span style="color:orange">subject_id</span>, and <span style="color:red">run_id</span> for the functional images. In the context of DataGabber, this is specified as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input: Set the input file path</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;ds000102&#39;</span><span class="p">)</span> <span class="c1">#base_directory of the data</span>

<span class="c1"># Dynamic parameters</span>
<span class="n">subj_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;02&#39;</span><span class="p">]</span> <span class="c1">#subject_id</span>
<span class="n">run_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">#run_id</span>

<span class="c1"># Initialise workflow</span>
<span class="n">wf_input</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;data_input&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">wf_work_dir</span><span class="p">)</span> <span class="c1"># base_dir: Set path where nipype will store stepwise results</span>
<span class="n">wf_input</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;crashfile_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create DataGrabber node with input fields for all dynamic parameters (e.g. subject identifier, run identifier), </span>
<span class="c1"># as well as the two desired output fields anat and func.</span>

<span class="n">dg</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span> <span class="n">DataGrabber</span><span class="p">(</span><span class="n">infields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;run_id&quot;</span><span class="p">],</span> <span class="n">outfields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;func&quot;</span><span class="p">]),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dg&quot;</span><span class="p">)</span>

<span class="c1"># Location of dataset folder</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">data_dir</span>
<span class="c1"># Necessary default parameters</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sort_filelist</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#return a sorted filelist to ensure to match files to correct runs/tasks</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span> <span class="c1">#wildcard</span>
<span class="c1"># Specify run_ids</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">run_list</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define arguments to fill the wildcards in the below paths </span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">anat</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]],</span>
    <span class="n">func</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;run_id&quot;</span><span class="p">]],</span>
<span class="p">)</span>

<span class="c1"># Specify the template structure to find the specific data</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">field_template</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">anat</span><span class="o">=</span><span class="s2">&quot;sub-</span><span class="si">%s</span><span class="s2">/anat/sub-</span><span class="si">%s</span><span class="s2">_T1w.nii.gz&quot;</span><span class="p">,</span>
    <span class="n">func</span><span class="o">=</span><span class="s2">&quot;sub-</span><span class="si">%s</span><span class="s2">/func/sub-</span><span class="si">%s</span><span class="s2">_task-flanker_run-</span><span class="si">%d</span><span class="s2">_bold.nii.gz&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To feed dynamic parameters into the node either do this by specifying them directly as node inputs, or using another node and feed <strong>subject_id</strong> as connections to the DataGrabber node.</p>
<p>Specifying the input fields of DataGrabber directly for one subject:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">dg</span><span class="p">.</span><span class="nx">inputs</span><span class="p">.</span><span class="nx">subject_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;01&#39;</span>
</pre></div>
</div>
<p>If we want to start our workflow from creating subgraphs, i.e. running it for more than one subject, we can use another node:
<strong>IdentityInterface</strong>, which is a special use case of <strong>iterables</strong>. It allows to create Nodes that do simple identity mapping, i.e. Nodes that only work on parameters/strings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infosource</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]),</span>
                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;infosource&quot;</span><span class="p">)</span>
<span class="c1"># Run a workflow iterating over various inputs using the iterables attribute of nodes --&gt; splits up the workflow</span>
<span class="n">infosource</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="n">subj_list</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connect the nodes and run the workflow</span>
<span class="n">wf_input</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">infosource</span><span class="p">,</span> <span class="n">dg</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="s2">&quot;subject_id&quot;</span><span class="p">)])])</span>

<span class="n">wf_input</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250606-01:28:12,517 nipype.workflow INFO:
	 Workflow data_input settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
250606-01:28:12,524 nipype.workflow INFO:
	 Running serially.
250606-01:28:12,525 nipype.workflow INFO:
	 [Node] Setting-up &quot;data_input.dg&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/data_input/_subject_id_01/dg&quot;.
250606-01:28:12,536 nipype.workflow INFO:
	 [Node] Executing &quot;dg&quot; &lt;nipype.interfaces.io.DataGrabber&gt;
250606-01:28:12,539 nipype.workflow INFO:
	 [Node] Finished &quot;dg&quot;, elapsed time 0.000577s.
250606-01:28:12,541 nipype.workflow INFO:
	 [Node] Setting-up &quot;data_input.dg&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/data_input/_subject_id_02/dg&quot;.
250606-01:28:12,544 nipype.workflow INFO:
	 [Node] Executing &quot;dg&quot; &lt;nipype.interfaces.io.DataGrabber&gt;
250606-01:28:12,546 nipype.workflow INFO:
	 [Node] Finished &quot;dg&quot;, elapsed time 0.000316s.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;networkx.classes.digraph.DiGraph at 0x7f0334606450&gt;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data-output">
<h3>3.6. Data Output<a class="headerlink" href="#data-output" title="Link to this heading">#</a></h3>
<p>A workflow working directory is like a cache containing the outputs of various processing stages and various extraneous information such as execution reports, hashfiles determining the input state of processes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w">  </span>output/working_dir/smoothflow/<span class="w"> </span>-I<span class="w"> </span><span class="s1">&#39;*js|*dot|*png|*html|*json&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">output/working_dir/smoothflow/</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">mask</span>
│   ├── _inputs.pklz
│   ├── _node.pklz
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">_report</span>
│   │   └── report.rst
│   ├── command.txt
│   ├── result_mask.pklz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_T1w_smooth_masked.nii.gz</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">skullstrip</span>
│   ├── _inputs.pklz
│   ├── _node.pklz
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">_report</span>
│   │   └── report.rst
│   ├── command.txt
│   ├── result_skullstrip.pklz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_T1w_brain_mask.nii.gz</span>
└── <span class=" -Color -Color-Bold -Color-Bold-Blue">smooth</span>
    ├── _inputs.pklz
    ├── _node.pklz
    ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">_report</span>
    │   └── report.rst
    ├── command.txt
    ├── result_smooth.pklz
    └── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_T1w_smooth.nii.gz</span>

6 directories, 18 files
</pre></div>
</div>
</div>
</div>
<p>Data output modules allow to <em>restructure</em> and <em>rename</em> computed output and to spatially differentiate relevant output files from the temporary computed intermediate files in the working directory.</p>
<p>In this tutorial, we will look into the DataSink module:</p>
<ul class="simple">
<li><p><strong>DataSink:</strong> Nipype’s standard output module, which allows the creation of arbitrary input attributes. The names of these attributes define the directory structure to be created for storing the files or directories.</p></li>
</ul>
<p>Nipype also provides some simple frontends for storing values into a JSON File, MySQL and SQLite database or an XNAT Servers.</p>
<ul class="simple">
<li><p><strong>JSONFileSink</strong></p></li>
<li><p><strong>MySQLSink</strong></p></li>
<li><p><strong>SQLiteSink</strong></p></li>
<li><p><strong>XNATSink</strong></p></li>
</ul>
<section id="example-datasink">
<h4><strong>Example: DataSink</strong><a class="headerlink" href="#example-datasink" title="Link to this heading">#</a></h4>
<p>The following code segment defines the DataSink node and sets the <code class="docutils literal notranslate"><span class="pre">base_directory</span></code> in which all outputs will be stored. The <code class="docutils literal notranslate"><span class="pre">container</span></code> input creates a subdirectory within the base_directory.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">from</span><span class="w"> </span><span class="nx">nipype</span><span class="p">.</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">io</span><span class="w"> </span><span class="k">import</span><span class="w"> </span><span class="nx">DataSink</span>


<span class="nx">datasink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Node</span><span class="p">(</span><span class="nx">DataSink</span><span class="p">(),</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;sinker&#39;</span><span class="p">)</span>
<span class="nx">datasink</span><span class="p">.</span><span class="nx">inputs</span><span class="p">.</span><span class="nx">base_directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/path/to/output&#39;</span>
<span class="nx">workflow</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">inputnode</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">datasink</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;container&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To store different outputs in the same place, a second port needs to be created with (.)  This stores the files in a separate subfolder called mask:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">workflow</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">inputnode</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mask_out_file&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">datasink</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;container.mask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to store the files in the same folder, use the .&#64; syntax. The &#64; tells the DataSink interface to not create the subfolder. This will allow to create different named input ports for DataSink and allow the user to store the files in the same folder.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">workflow</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">inputnode</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">datasink</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;container&#39;</span><span class="p">)</span>
<span class="nx">workflow</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">inputnode</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mask_out_file&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">datasink</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;container.@mask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="important-title" style="font-size: 1.5em; color: purple;">
    🥳 <span style="font-size: 1.5em;">Final Example: Mini-Preprocessing-Workflow</span>
</p>
<ul class="simple">
<li><p><strong>Input Stream</strong>: DataGrabber to grab the functional image (run-1) of sub-01</p></li>
<li><p><strong>FSL-Interfaces</strong>: Motion correction and spatial smoothing (kernel of 4 mm) of the functional image</p></li>
<li><p><strong>Output Stream</strong>: DataSink to grab the motion-corrected image, the motion parameters and the smoothed image</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialise Workflow</span>
<span class="n">wf_preproc</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;preproc&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">wf_work_dir</span><span class="p">)</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;crashfile_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>

<span class="c1"># DataGrabber Node</span>
<span class="n">dg</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span> <span class="n">DataGrabber</span><span class="p">(</span><span class="n">infields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="s2">&quot;run_id&quot;</span><span class="p">],</span> <span class="n">outfields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">]),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dg&quot;</span><span class="p">)</span>

<span class="c1"># Location of dataset folder</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">data_dir</span>
<span class="c1"># Necessary default parameters</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sort_filelist</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#return a sorted filelist to ensure to match files to correct runs/tasks</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subject_id</span> <span class="o">=</span> <span class="s1">&#39;01&#39;</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">func</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="s2">&quot;run_id&quot;</span><span class="p">]],</span>
<span class="p">)</span>

<span class="c1"># Specify the template structure to find the specific data</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">field_template</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">func</span><span class="o">=</span><span class="s2">&quot;sub-</span><span class="si">%s</span><span class="s2">/func/sub-</span><span class="si">%s</span><span class="s2">_task-flanker_run-</span><span class="si">%d</span><span class="s2">_bold.nii.gz&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Motion Correction Node</span>
<span class="n">mcflirt</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">MCFLIRT</span><span class="p">(</span><span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> 
               <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mcflirt&#39;</span><span class="p">)</span>

<span class="c1"># Create Smoothing node</span>
<span class="n">smooth</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">IsotropicSmooth</span><span class="p">(</span><span class="n">fwhm</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
              <span class="n">name</span><span class="o">=</span><span class="s1">&#39;smooth&#39;</span><span class="p">)</span>

<span class="c1"># Connect the three nodes to each other</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">dg</span><span class="p">,</span> <span class="n">mcflirt</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;func&quot;</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">)]),</span>
                    <span class="p">(</span><span class="n">mcflirt</span><span class="p">,</span> <span class="n">smooth</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">)])])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create DataSink object</span>
<span class="n">sinker</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">DataSink</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sinker&#39;</span><span class="p">)</span>

<span class="c1"># Name of the output folder</span>
<span class="n">sinker</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s1">&#39;preproc/results&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save output in one folder called &#39;preproc&#39; with .@</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">smooth</span><span class="p">,</span> <span class="n">sinker</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;sub-01.@in_file&#39;</span><span class="p">)]),</span>
                    <span class="p">(</span><span class="n">mcflirt</span><span class="p">,</span> <span class="n">sinker</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;sub-01.@mc_img&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;par_file&#39;</span><span class="p">,</span> <span class="s1">&#39;sub-01.@par_file&#39;</span><span class="p">)]),</span>
                   <span class="p">])</span>

<span class="c1"># Visualize the graph</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph2use</span><span class="o">=</span><span class="s1">&#39;colored&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">simple_form</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">opj</span><span class="p">(</span><span class="n">wf_preproc</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">wf_preproc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;graph.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250606-01:28:13,923 nipype.workflow INFO:
	 Generated workflow graph: /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/graph.png (graph2use=colored, simple_form=True).
</pre></div>
</div>
<img alt="../_images/6684b0d309ede89a63ecb4e1a3b6c1a7349f9b5fbbf5f521832c1e69ac05369a.png" src="../_images/6684b0d309ede89a63ecb4e1a3b6c1a7349f9b5fbbf5f521832c1e69ac05369a.png" />
</div>
</div>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run workflow with distributed processing</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250606-01:28:13,932 nipype.workflow INFO:
	 Workflow preproc settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
250606-01:28:13,943 nipype.workflow INFO:
	 Running in parallel.
250606-01:28:13,958 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 219.48/219.48, Free processors: 32/32.
250606-01:28:15,12 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.dg&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/dg&quot;.
250606-01:28:15,26 nipype.workflow INFO:
	 [Node] Executing &quot;dg&quot; &lt;nipype.interfaces.io.DataGrabber&gt;
250606-01:28:15,30 nipype.workflow INFO:
	 [Node] Finished &quot;dg&quot;, elapsed time 0.000948s.
250606-01:28:15,960 nipype.workflow INFO:
	 [Job 0] Completed (preproc.dg).
250606-01:28:15,964 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 219.48/219.48, Free processors: 32/32.
250606-01:28:16,481 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.mcflirt&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/mcflirt&quot;.
250606-01:28:16,504 nipype.workflow INFO:
	 [Node] Executing &quot;mcflirt&quot; &lt;nipype.interfaces.fsl.preprocess.MCFLIRT&gt;
250606-01:28:17,962 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 219.28/219.48, Free processors: 31/32.
                     Currently running:
                       * preproc.mcflirt
250606-01:28:48,637 nipype.workflow INFO:
	 [Node] Finished &quot;mcflirt&quot;, elapsed time 32.125453s.
250606-01:28:49,977 nipype.workflow INFO:
	 [Job 1] Completed (preproc.mcflirt).
250606-01:28:49,979 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 219.48/219.48, Free processors: 32/32.
250606-01:28:50,115 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.smooth&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/smooth&quot;.
250606-01:28:50,133 nipype.workflow INFO:
	 [Node] Executing &quot;smooth&quot; &lt;nipype.interfaces.fsl.maths.IsotropicSmooth&gt;
250606-01:28:51,973 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 219.28/219.48, Free processors: 31/32.
                     Currently running:
                       * preproc.smooth
250606-01:29:02,65 nipype.workflow INFO:
	 [Node] Finished &quot;smooth&quot;, elapsed time 11.92321s.
250606-01:29:03,975 nipype.workflow INFO:
	 [Job 2] Completed (preproc.smooth).
250606-01:29:03,977 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 219.48/219.48, Free processors: 32/32.
250606-01:29:04,116 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.sinker&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/sinker&quot;.
250606-01:29:04,177 nipype.workflow INFO:
	 [Node] Executing &quot;sinker&quot; &lt;nipype.interfaces.io.DataSink&gt;
250606-01:29:04,181 nipype.workflow INFO:
	 [Node] Finished &quot;sinker&quot;, elapsed time 0.001353s.
250606-01:29:05,975 nipype.workflow INFO:
	 [Job 3] Completed (preproc.sinker).
250606-01:29:05,977 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 219.48/219.48, Free processors: 32/32.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;networkx.classes.digraph.DiGraph at 0x7f033464a6d0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>tree<span class="w"> </span>output/working_dir/preproc/results
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">output/working_dir/preproc/results</span>
└── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-01</span>
    ├── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_task-flanker_run-1_bold_mcf.nii.gz</span>
    ├── sub-01_task-flanker_run-1_bold_mcf.nii.gz.par
    └── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_task-flanker_run-1_bold_mcf_smooth.nii.gz</span>

1 directory, 3 files
</pre></div>
</div>
</div>
</div>
<p class="important-title" style="font-size: 1.5em; color: gold;"><i class="fas fa-lightbulb" style="color: gold;"></i> <span style="font-size: 1.5em;">Tip</span></p>
<ul>
DataSink offers the substitution input field to rename output files.
For example, to get rid of the string 'bold' and to adapt the file ending of the motion parameter file:
</ul><div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define substitution strings</span>
<span class="n">substitutions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;_bold&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s1">&#39;.nii.gz.par&#39;</span><span class="p">,</span> <span class="s1">&#39;.par&#39;</span><span class="p">)]</span>

<span class="c1"># Feed the substitution strings to the DataSink node</span>
<span class="n">sinker</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">=</span> <span class="n">substitutions</span>

<span class="c1"># Run the workflow again with the substitutions in place</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>250606-01:29:12,288 nipype.workflow INFO:
	 Workflow preproc settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
250606-01:29:12,294 nipype.workflow INFO:
	 Running serially.
250606-01:29:12,295 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.dg&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/dg&quot;.
250606-01:29:12,298 nipype.workflow INFO:
	 [Node] Executing &quot;dg&quot; &lt;nipype.interfaces.io.DataGrabber&gt;
250606-01:29:12,300 nipype.workflow INFO:
	 [Node] Finished &quot;dg&quot;, elapsed time 0.00033s.
250606-01:29:12,307 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.mcflirt&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/mcflirt&quot;.
250606-01:29:12,309 nipype.workflow INFO:
	 [Node] Cached &quot;preproc.mcflirt&quot; - collecting precomputed outputs
250606-01:29:12,310 nipype.workflow INFO:
	 [Node] &quot;preproc.mcflirt&quot; found cached.
250606-01:29:12,310 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.smooth&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/smooth&quot;.
250606-01:29:12,312 nipype.workflow INFO:
	 [Node] Cached &quot;preproc.smooth&quot; - collecting precomputed outputs
250606-01:29:12,312 nipype.workflow INFO:
	 [Node] &quot;preproc.smooth&quot; found cached.
250606-01:29:12,313 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.sinker&quot; in &quot;/home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/sinker&quot;.
250606-01:29:12,315 nipype.workflow INFO:
	 [Node] Outdated cache found for &quot;preproc.sinker&quot;.
250606-01:29:12,318 nipype.workflow INFO:
	 [Node] Executing &quot;sinker&quot; &lt;nipype.interfaces.io.DataSink&gt;
250606-01:29:12,319 nipype.interface INFO:
	 sub: /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/results/sub-01/sub-01_task-flanker_run-1_bold_mcf_smooth.nii.gz -&gt; /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/results/sub-01/sub-01_task-flanker_run-1_mcf_smooth.nii.gz
250606-01:29:12,320 nipype.interface INFO:
	 sub: /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/results/sub-01/sub-01_task-flanker_run-1_bold_mcf.nii.gz -&gt; /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/results/sub-01/sub-01_task-flanker_run-1_mcf.nii.gz
250606-01:29:12,321 nipype.interface INFO:
	 sub: /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/results/sub-01/sub-01_task-flanker_run-1_bold_mcf.nii.gz.par -&gt; /home/jovyan/Git_repositories/example-notebooks/books/workflows/output/working_dir/preproc/results/sub-01/sub-01_task-flanker_run-1_mcf.par
250606-01:29:12,322 nipype.workflow INFO:
	 [Node] Finished &quot;sinker&quot;, elapsed time 0.002846s.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;networkx.classes.digraph.DiGraph at 0x7f033442f4d0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>tree<span class="w"> </span>output/working_dir/preproc/results
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">output/working_dir/preproc/results</span>
└── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-01</span>
    ├── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_task-flanker_run-1_bold_mcf.nii.gz</span>
    ├── sub-01_task-flanker_run-1_bold_mcf.nii.gz.par
    ├── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_task-flanker_run-1_bold_mcf_smooth.nii.gz</span>
    ├── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_task-flanker_run-1_mcf.nii.gz</span>
    ├── sub-01_task-flanker_run-1_mcf.par
    └── <span class=" -Color -Color-Bold -Color-Bold-Red">sub-01_task-flanker_run-1_mcf_smooth.nii.gz</span>

1 directory, 6 files
</pre></div>
</div>
</div>
</div>
<p class="important-title" style="font-size: 1.1em; color: green;"><i class="fas fa-check-circle" style="color: green;"></i> <span style="font-size: 1.5em;">Nipype in a Nutshell</span></p>
<p>Nipype offers easy to use building blocks for:</p>
<ul class="simple">
<li><p>establishing neuroimaging data processing services</p></li>
<li><p>constructing tailored data processing pipelines</p></li>
</ul>
</section>
</section>
</section>
<section id="pydra-a-modern-dataflow-engine-developed-for-the-nipype-project">
<h2>4. Pydra: A modern dataflow engine developed for the Nipype project<a class="headerlink" href="#pydra-a-modern-dataflow-engine-developed-for-the-nipype-project" title="Link to this heading">#</a></h2>
<a class="reference internal image-reference" href="https://github.com/nipype/pydra/blob/main/docs/source/_static/logo/pydra_logo.jpg?raw=true"><img alt="https://github.com/nipype/pydra/blob/main/docs/source/_static/logo/pydra_logo.jpg?raw=true" src="https://github.com/nipype/pydra/blob/main/docs/source/_static/logo/pydra_logo.jpg?raw=true" style="width: 30%;" />
</a>
<ul class="simple">
<li><p>Pydra is a rewrite of the Nipype engine and forms the core of the Nipype 2.0 ecosystem and is meant to provide <strong>additional flexibility</strong> allowing users to define custom processing steps, interfaces and nested workflows.</p></li>
</ul>
<ul class="simple">
<li><p>Is a standalone project and designed to support analytics in <strong>any scientific domain</strong> (whereas Nipype is specifically designed for neuroimaging data analysis pipelines).</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span>  Pydra aims to offer a lightweight Python (3.7+) dataflow engine for the construction, manipulation, and distributed execution of computational graphs. It serves as a tool for building reproducible, scalable, reusable, and fully automated scientific workflows.</p>
<p>The architecture in combination with several key features makes Pydra a customizable and powerful dataflow engine:</p>
<ul class="simple">
<li><p><strong>Architecture with three core components:</strong> Tasks (basic runnable components) including Workflows, Submitter (Classes for unpacking Tasks into standalone jobs) and Workers (Classes used to execute Tasks coordinate resource managment).</p></li>
<li><p><strong>Composable dataflows:</strong> Nested dataflows of arbitrary depths encouraging the creation of reusable dataflows.</p></li>
<li><p><strong>Global cache</strong> support to reduce recomputation.</p></li>
<li><p>Support for dataflow execution in <strong>containerized environments</strong> enabling greater consistency for reproducibility.</p></li>
<li><p><strong>Splitting &amp; combining semantics</strong> for creating nested loops over input sets (MapReduce extended to graphs).</p></li>
</ul>
<section id="key-features-in-more-detail">
<h3>Key features in more detail:<a class="headerlink" href="#key-features-in-more-detail" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Composable dataflows:</strong> A dataflow is represented as a directed acyclic graph, where each Task represents a Python function, execution of an external tool, or another dataflow. This enables the creation of simpe linear pipelines to complex nested dataflows of any depth. This approach promotes the development of reusable dataflows, enhancing modularity and scalability.</p></li>
</ul>
<center><img src= "https://github.com/nipype/pydra-tutorial/blob/master/figures/nested_workflow.png?raw=true" width="30%" height="30%"></center>
<figcaption><b>Figure 7:</b> Nested workflow</figcaption>
<div class="important">
  <p class="important-title" style="font-size: 1.3em; color: orange;"><i class="fas fa-search" style="color: orange;"></i> <span style="font-size: 1.3em;">Nipype-Pydra architectures</span></p>
  <ul>
    <li>Pydra dataflow components: Task (basic runnable component with named inputs and outputs) with subclass Workflow</li>
    <li>Nipype basic concepts: Node (defined inputs and outputs), Workflow</li>
  </ul>
</div>
<ul class="simple">
<li><p><strong>Support for Python functions (FunctionTask) and external (shell) commands (ShellCommandTask):</strong> Pydra enables the seamless incorporation and utilization of pre-existing functions within Python libraries, as well as external command-line tools. This facilitates straightforward integration of existing code and software into Pydra workflows.</p></li>
<li><p><strong>Support for execution of Tasks in containerized environments (ContainerTask):</strong> Any dataflow or Task can be executed in an associated container (via Docker or Singularity) enabling greater consistency for reproducibility.</p></li>
</ul>
<div class="important">
  <p class="important-title" style="font-size: 1.3em; color: orange;"><i class="fas fa-search" style="color: orange;"></i> <span style="font-size: 1.3em;">Nipype-Pydra architectures</span></p>
  <ul>
      <li>Pydra Task subclasses: FunctionTask, ShellCommandTask, ContainerTask (Docker, Singularity) </li>
    <li>Nipype advanced concepts: base interfaces or interfaces for using existing functionality in other packages: wrapping of command line tools (nipype.interfaces.base CommandLine), run arbitrary function as nipype interface (nipype.interfaces.utility Function)</li>
  </ul>
</div><ul class="simple">
<li><p><strong>Splitting &amp; combining semantics for creating nested loops over input sets:</strong> Versatile functionality for nested loop creation across input sets: Tasks or dataflows can iterate over input parameter sets, and their outputs can be recombined. This functionality resembles the Map-Reduce model, but Pydra extends this capability to graphs with nested dataflows.</p></li>
</ul>
<center><img src=https://nipype.github.io/pydra/_images/nd_spl_1.png></center>
<figcaption><b>Figure 8:</b> Flexible splitting and merging in Pydra</figcaption>
<div class="important">
  <p class="important-title" style="font-size: 1.3em; color: orange;"><i class="fas fa-search" style="color: orange;"></i> <span style="font-size: 1.3em;">Pydra-Nipype architectures</span></p>
  <ul>
    <li>Pydra: Optional State class: splitter and combiner attribute to specify how inputs should be split into parameter sets, and combined after Task execution</li>
    <li>Nipype: MapNode, Iterables/ Synchronize, JoinNode</li>
  </ul>
</div>
<ul class="simple">
<li><p>Both Pydra and Nipype offer similar functionalities regarding</p>
<ul>
<li><p><strong>Hashing</strong> to manage task execution and caching of intermediate results. Hashes are computed for task inputs and parameters and used to determine task dependencies and to avoid unnecessary recomputation.</p></li>
<li><p><strong>Provenance Tracking</strong> capabilities to captures dataflow execution activities as a provenance graph. It tracks inputs, outputs, and resources consumed by each task in a workflow, providing a detailed record of the workflow execution.</p></li>
</ul>
</li>
</ul>
<p><strong>A content-addressable global cache to reduce recomputation:</strong> Hash values are computed for each graph and each Task. This supports reusing of previously computed and stored dataflows and Tasks. It also allows multiple people in or across laboratories to use each others’s execution outputs on the same data without having to rerun the same computation.</p>
<p><strong>Auditing and provenance tracking:</strong> Pydra provides a simple JSON-LD-based message passing mechanism to capture the dataflow execution activities as a provenance graph. These messages track inputs and outputs of each task in a dataflow, and the resources consumed by the task.</p>
  <p class="important-title" style="font-size: 1.3em; color: green;"><i class="fas fa-check-circle" style="color: green;"></i> <span style="font-size: 1.3em;">Take Home Message</span></p>
  <ul>
    <p><b>Pydra and Nipype are both open-source Python projects and offer similar functionalities for building and executing computational pipelines, including caching. However, they differ in their :</b></p>
    <li>
      <b>Design Philosophy:</b> Building pipelines for neuroimaging in vs. pipelines for any scientific domain 
    </li>
    <li>
      <b>Flexibility:</b> Very flexible splitting and merging semantics in Pydra to create complex pipelines of any depth
    </li>
    <li>
      <b>Execution Model:</b> Pydra leverages modern parallel and distributed computing frameworks such as Dask
    </li>
    <li>
      <b>Community and Ecosystem:</b> Well-established community and ecosystem vs. a growing community 
    </li>
  </ul>
</section>
</section>
<section id="dependencies-in-jupyter-python">
<h2>Dependencies in Jupyter/Python<a class="headerlink" href="#dependencies-in-jupyter-python" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Using the package <a class="reference external" href="https://github.com/rasbt/watermark">watermark</a> to print out computer characteristics and software versions.</p></li>
</ul>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">watermark</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> watermark

<span class="o">%</span><span class="k">watermark</span>
<span class="o">%</span><span class="k">watermark</span> --iversions
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Last updated: 2025-06-06T01:29:15.338246+00:00

Python implementation: CPython
Python version       : 3.11.6
IPython version      : 9.1.0

Compiler    : GCC 12.3.0
OS          : Linux
Release     : 5.4.0-204-generic
Machine     : x86_64
Processor   : x86_64
CPU cores   : 32
Architecture: 64bit

nibabel   : 5.3.2
matplotlib: 3.10.3
IPython   : 9.1.0
nipype    : 1.8.6
nilearn   : 0.11.1
numpy     : 2.2.6
</pre></div>
</div>
</div>
</div>
</section>
<section id="references-resources">
<h2>References/ Resources<a class="headerlink" href="#references-resources" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Gorgolewski K, Burns CD, Madison C, Clark D, Halchenko YO, Waskom ML, Ghosh SS. (2011). Nipype: a flexible, lightweight and extensible neuroimaging data processing framework in Python. Front. Neuroinform. 5:13.</p>
<ul>
<li><p><a class="reference external" href="https://nipype.readthedocs.io/en/latest/">Nipype Documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/nipy/nipype">Nipype Github</a></p></li>
<li><p><a class="reference external" href="https://miykael.github.io/nipype_tutorial/">Nipype Tutorial</a></p></li>
</ul>
</li>
<li><p>Jarecka, Dorota &amp; Goncalves, Mathias &amp; Markiewicz, Christopher &amp; Esteban, Oscar &amp; Lo, Nicole &amp; Kaczmarzyk, Jakub &amp; Ghosh, Satrajit. (2020). Pydra - a flexible and lightweight dataflow engine for scientific analyses. 132-139. 10.25080/Majora-342d178e-012.</p>
<ul>
<li><p><a class="reference external" href="https://pydra.readthedocs.io/en/latest/">Pydra Documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/nipype/pydra">Pydra Github</a></p></li>
<li><p><a class="reference external" href="https://github.com/nipype/pydra-tutorial">Pydra Tutorial</a></p></li>
<li><p><a class="reference external" href="https://github.com/nipype/pydra-ml">Pydra-ML</a></p></li>
</ul>
</li>
<li><p>Renton, A.I., Dao, T.T., Johnstone, T. et al. Neurodesk: an accessible, flexible and portable data analysis environment for reproducible neuroimaging. Nat Methods (2024). https://doi.org/10.1038/s41592-023-02145-x</p>
<ul>
<li><p><a class="reference external" href="https://www.neurodesk.org/">Neurodesk Website</a></p></li>
<li><p><a class="reference external" href="https://www.neurodesk.org/example-notebooks/intro.html">Jupyter Notebook Examples on Neurodesk</a></p></li>
</ul>
</li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./workflows"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="bids_conversion.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">BIDS conversion</p>
      </div>
    </a>
    <a class="right-next"
       href="nipype_short.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Basic Nipype</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interactive-rise-slideshow">An interactive RISE slideshow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-cpu-information">Output CPU information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-content">Table of content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-nipype">1. Introduction to Nipype</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nipype-in-jupyter-notebooks-on-neurodesk">2. Nipype in Jupyter Notebooks on Neurodesk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploration-of-nipype-s-building-blocks">3. Exploration of Nipype’s building blocks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-download-of-opensource-data-installations-and-imports"><strong>Preparation: Download of opensource data, installations and imports</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interfaces-the-core-pieces-of-nipype">3.1. Interfaces : The core pieces of Nipype</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-interface-for-fsl-s-brain-extraction-tool-bet"><strong>Example: Interface for FSL’s Brain Extraction Tool <em>BET</em></strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nodes-the-light-wrapper-around-interfaces">3.2. Nodes: The light wrapper around interfaces</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapnode">MapNode</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iterables">Iterables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#joinnode">JoinNode</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-node"><strong>Example: Node</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workflows">3.3. Workflows</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-workflow"><strong>Example: Workflow</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connect-nodes-within-a-workflow">Connect nodes within a workflow</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#execution-plugins-execution-on-different-systems">3.4. Execution Plugins: Execution on different systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-input-first-step-of-every-analysis">3.5. Data Input: First step of every analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-datagrabber"><strong>Example: DataGrabber</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-output">3.6. Data Output</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-datasink"><strong>Example: DataSink</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pydra-a-modern-dataflow-engine-developed-for-the-nipype-project">4. Pydra: A modern dataflow engine developed for the Nipype project</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-features-in-more-detail">Key features in more detail:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies-in-jupyter-python">Dependencies in Jupyter/Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-resources">References/ Resources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Neurodesk Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>