

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>FSL’s fMRI Data Analysis via Nipype &#8212; Neurodesk</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-4Z9774J59Y"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4Z9774J59Y');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'nipype_fsl_all_levels_flanker';</script>
    <link rel="canonical" href="https://neurodesk.github.io/example-notebooks/intro.html/nipype_fsl_all_levels_flanker.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">Neurodesk</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    FSL’s fMRI Data Analysis via Nipype
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://play-iowa.neurodesk.org/hub/user-redirect/lab/tree/example-notebooks/books/v2/gh/NeuroDesk/example-notebooks/main?urlpath=lab/tree/books/nipype_fsl_all_levels_flanker.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/NeuroDesk/example-notebooks/blob/main/books/nipype_fsl_all_levels_flanker.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/edit/main/books/nipype_fsl_all_levels_flanker.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/issues/new?title=Issue%20on%20page%20%2Fnipype_fsl_all_levels_flanker.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/nipype_fsl_all_levels_flanker.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>FSL’s fMRI Data Analysis via Nipype</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">FSL’s fMRI Data Analysis via Nipype</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-neurodesk">Setup Neurodesk</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#first-level-glm-using-nipype-fsl">First-level GLM using Nipype FSL</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation">Preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-data-path">Set up data path</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#start-the-workflow">Start the workflow</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialisation">Initialisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-correction">Motion Correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functionally-masking">Functionally Masking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grand-mean-scaling">Grand Mean Scaling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#susan-noise-reduction">SUSAN Noise Reduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temporal-filtering">Temporal Filtering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-level-glm">First-Level GLM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-events">Get events</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-contrasts">Set-up contrasts</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#registration">Registration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1">Step 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2">Step 2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-first-level-glm">The first-level GLM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#second-level-glm-using-nipype-fsl">Second level GLM using Nipype FSL</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-level-glm">Second-level GLM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#higher-level-input-files-preparation">Higher-level input files preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-merge-registered-copes-varcopes-masks">Step 1: Merge registered copes &amp; varcopes &amp; masks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-making-mask">Step 2: Making mask</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-masking-copes-varcopes">Step 3: Masking copes &amp; varcopes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-second-level-contrasts-and-fixed-effects">Set up second-level contrasts and fixed-effects</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-second-level-glm">The second-level GLM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regapply">Regapply</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#copes-from-the-second-level-glm">Copes from the second-level GLM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#third-level-glm-using-nipype-fsl">Third-level GLM using Nipype FSL</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#third-level-glm">Third-level GLM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Higher-level input files preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Step 1: Merge registered copes &amp; varcopes &amp; masks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Step 2: Making mask</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Step 3: Masking copes &amp; varcopes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-third-level-contrasts">Set up third-level contrasts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#post-stats">Post-Stats</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothness-estimation">Smoothness estimation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mask-zstats-file">Mask zstats file</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cluster-wise-thresholding">Cluster-wise thresholding</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-the-output">Save the output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unthresholded-copes">Unthresholded COPEs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thresholded-p-0-05-zstats">Thresholded (p &lt; 0.05) zstats</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><a href="https://colab.research.google.com/github/NeuroDesk/example-notebooks/blob/main/books/functional_imaging/nipype_fsl_all_levels_flanker.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Google Colab"/>   </a></p>
<section id="fsl-s-fmri-data-analysis-via-nipype">
<h1>FSL’s fMRI Data Analysis via Nipype<a class="headerlink" href="#fsl-s-fmri-data-analysis-via-nipype" title="Permalink to this heading">#</a></h1>
<p>Author: Monika Doerig</p>
<p>Original peper: <a class="reference external" href="https://www.frontiersin.org/articles/10.3389/fnimg.2022.953215/full">https://www.frontiersin.org/articles/10.3389/fnimg.2022.953215/full</a></p>
<p>Original code: <a class="reference external" href="https://osf.io/prg53/?view_only=9d7974834a484cdb972bcc3989589b78">https://osf.io/prg53/?view_only=9d7974834a484cdb972bcc3989589b78</a></p>
</section>
<section id="setup-neurodesk">
<h1>Setup Neurodesk<a class="headerlink" href="#setup-neurodesk" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
import os
import sys
IN_COLAB = &#39;google.colab&#39; in sys.modules

if IN_COLAB:
  os.environ[&quot;LD_PRELOAD&quot;] = &quot;&quot;;
  os.environ[&quot;APPTAINER_BINDPATH&quot;] = &quot;/content,/tmp,/cvmfs&quot;
  os.environ[&quot;MPLCONFIGDIR&quot;] = &quot;/content/matplotlib-mpldir&quot;
  os.environ[&quot;LMOD_CMD&quot;] = &quot;/usr/share/lmod/lmod/libexec/lmod&quot;

  !curl -J -O https://raw.githubusercontent.com/NeuroDesk/neurocommand/main/googlecolab_setup.sh
  !chmod +x googlecolab_setup.sh
  !./googlecolab_setup.sh

  os.environ[&quot;MODULEPATH&quot;] = &#39;:&#39;.join(map(str, list(map(lambda x: os.path.join(os.path.abspath(&#39;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/&#39;), x),os.listdir(&#39;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/&#39;)))))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Output CPU information:</span>
<span class="o">!</span>cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;vendor&#39;</span> <span class="p">|</span> uniq
<span class="o">!</span>cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;model name&#39;</span> <span class="p">|</span> uniq
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vendor_id	: AuthenticAMD
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>model name	: AMD EPYC-Rome Processor
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pandas nilearn matplotlib
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Defaulting to user installation because normal site-packages is not writeable
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pandas in /home/ubuntu/.local/lib/python3.10/site-packages (2.1.4)
Requirement already satisfied: nilearn in /home/ubuntu/.local/lib/python3.10/site-packages (0.10.2)
Requirement already satisfied: matplotlib in /home/ubuntu/.local/lib/python3.10/site-packages (3.8.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: numpy&lt;2,&gt;=1.22.4 in /home/ubuntu/.local/lib/python3.10/site-packages (from pandas) (1.26.2)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /home/ubuntu/.local/lib/python3.10/site-packages (from pandas) (2.8.2)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/lib/python3/dist-packages (from pandas) (2022.1)
Requirement already satisfied: tzdata&gt;=2022.1 in /home/ubuntu/.local/lib/python3.10/site-packages (from pandas) (2023.3)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: joblib&gt;=1.0.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (1.3.2)
Requirement already satisfied: lxml in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (4.9.4)
Requirement already satisfied: nibabel&gt;=3.2.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (5.2.0)
Requirement already satisfied: packaging in /usr/lib/python3/dist-packages (from nilearn) (21.3)
Requirement already satisfied: requests&gt;=2.25.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (2.32.3)
Requirement already satisfied: scikit-learn&gt;=1.0.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (1.3.2)
Requirement already satisfied: scipy&gt;=1.6.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (1.11.4)
Requirement already satisfied: contourpy&gt;=1.0.1 in /home/ubuntu/.local/lib/python3.10/site-packages (from matplotlib) (1.2.0)
Requirement already satisfied: cycler&gt;=0.10 in /home/ubuntu/.local/lib/python3.10/site-packages (from matplotlib) (0.12.1)
Requirement already satisfied: fonttools&gt;=4.22.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from matplotlib) (4.47.0)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in /home/ubuntu/.local/lib/python3.10/site-packages (from matplotlib) (1.4.5)
Requirement already satisfied: pillow&gt;=8 in /usr/local/lib/python3.10/dist-packages (from matplotlib) (10.4.0)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /usr/lib/python3/dist-packages (from matplotlib) (2.4.7)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: six&gt;=1.5 in /usr/lib/python3/dist-packages (from python-dateutil&gt;=2.8.2-&gt;pandas) (1.16.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /home/ubuntu/.local/lib/python3.10/site-packages (from requests&gt;=2.25.0-&gt;nilearn) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/lib/python3/dist-packages (from requests&gt;=2.25.0-&gt;nilearn) (3.3)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/lib/python3/dist-packages (from requests&gt;=2.25.0-&gt;nilearn) (1.26.5)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/lib/python3/dist-packages (from requests&gt;=2.25.0-&gt;nilearn) (2020.6.20)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from scikit-learn&gt;=1.0.0-&gt;nilearn) (3.2.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: Error parsing dependencies of distro-info: Invalid version: &#39;1.1build1&#39;</span>

</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: Error parsing dependencies of python-debian: Invalid version: &#39;0.1.43ubuntu1&#39;</span>

</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="first-level-glm-using-nipype-fsl">
<h1>First-level GLM using Nipype FSL<a class="headerlink" href="#first-level-glm-using-nipype-fsl" title="Permalink to this heading">#</a></h1>
<p>In this notebook, we recreate the first-level GLM and the first level GLM of FSL GUI using nipype code. For each nipype node, we list the corresponding fsl command from the log file. The dataset we use is a Flanker task, which can be downloaded <a class="reference external" href="https://openneuro.org/datasets/ds000102/versions/00001">here</a>.</p>
<p>We also borrow some helps from this <a class="reference external" href="https://nipype.readthedocs.io/en/latest/users/examples/fmri_fsl.html">document</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#load fsl module</span>
<span class="kn">import</span> <span class="nn">lmod</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">purge</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;fsl/6.0.5.1&#39;</span><span class="p">)</span> <span class="c1">#Original pipeline: FSL 6.0.4, nipype 1.6.1.</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lmod Warning: The environment MODULEPATH has been changed in unexpected ways.
Lmod is unable to use given MODULEPATH. It is using:

&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/_diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/_functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/_workflows::&quot;.

Please use &quot;module use ...&quot; to change MODULEPATH instead. 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Lmod&#39;,
 &#39;Warning:&#39;,
 &#39;The&#39;,
 &#39;environment&#39;,
 &#39;MODULEPATH&#39;,
 &#39;has&#39;,
 &#39;been&#39;,
 &#39;changed&#39;,
 &#39;in&#39;,
 &#39;unexpected&#39;,
 &#39;ways.&#39;,
 &#39;Lmod&#39;,
 &#39;is&#39;,
 &#39;unable&#39;,
 &#39;to&#39;,
 &#39;use&#39;,
 &#39;given&#39;,
 &#39;MODULEPATH.&#39;,
 &#39;It&#39;,
 &#39;is&#39;,
 &#39;using:&#39;,
 &#39;&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/_diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/_functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/_workflows::&quot;.&#39;,
 &#39;Please&#39;,
 &#39;use&#39;,
 &#39;&quot;module&#39;,
 &#39;use&#39;,
 &#39;to&#39;,
 &#39;change&#39;,
 &#39;MODULEPATH&#39;,
 &#39;instead.&#39;,
 &#39;fsl/6.0.5.1&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;FSLDIR&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg/opt/fsl-6.0.5.1/&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;FSLOUTPUTTYPE&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;NIFTI_GZ&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SINGULARITY_BINDPATH&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;/data,/neurodesktop-storage,/tmp,/cvmfs&quot;</span>
</pre></div>
</div>
</div>
</div>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this heading">#</a></h2>
<p>Import all the relevant libraries needed for the preprocessing stage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">str</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">range</span>

<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">Function</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces</span> <span class="kn">import</span> <span class="n">fsl</span><span class="p">,</span> <span class="n">utility</span> <span class="k">as</span> <span class="n">util</span><span class="p">,</span> <span class="n">io</span> <span class="k">as</span> <span class="n">nio</span>
<span class="kn">import</span> <span class="nn">nipype.pipeline.engine</span> <span class="k">as</span> <span class="nn">pe</span>  <span class="c1"># pypeline engine</span>
<span class="kn">import</span> <span class="nn">nipype.algorithms.modelgen</span> <span class="k">as</span> <span class="nn">model</span>  <span class="c1"># model generation</span>
<span class="kn">import</span> <span class="nn">nipype.algorithms.rapidart</span> <span class="k">as</span> <span class="nn">ra</span>  <span class="c1"># artifact detection</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">nilearn</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">surface</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check output type and fsl version</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">output_type</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">version</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NIFTI_GZ
6.0.5.1:57b01774
</pre></div>
</div>
</div>
</div>
<section id="set-up-data-path">
<h3>Set up data path<a class="headerlink" href="#set-up-data-path" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input: Set the BIDS path</span>
<span class="n">data_dir_first</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;ds000102&#39;</span><span class="p">)</span>
<span class="c1"># Output: Set path where nipype will store stepwise results</span>
<span class="n">exp_dir_first</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output_level1&#39;</span><span class="p">)</span>

<span class="c1"># Input: Set path of first level outputs</span>
<span class="n">data_dir_second</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output_level1/level1_results/&#39;</span><span class="p">)</span>
<span class="c1"># Output: Set path where nipype will store stepwise results</span>
<span class="n">exp_dir_second</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output_level2/&#39;</span><span class="p">)</span>

<span class="c1"># Input: Set path of second level outputs</span>
<span class="n">data_dir_third</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output_level2/level2_results/&#39;</span><span class="p">)</span>
<span class="c1"># Output: Set path where nipype will store stepwise results</span>
<span class="n">exp_dir_third</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output_level3/&#39;</span><span class="p">)</span>

<span class="n">PATTERN</span> <span class="o">=</span> <span class="s2">&quot;sub-0*&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>datalad install https://github.com/OpenNeuroDatasets/ds000102.git
<span class="o">!</span><span class="nb">cd</span> ds000102 <span class="o">&amp;&amp;</span> datalad get <span class="nv">$PATTERN</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clone attempt:   0%|              | 0.00/2.00 [00:00&lt;?, ? Candidate locations/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Enumerating: 0.00 Objects [00:00, ? Objects/s]

                                              

Counting:   0%|                               | 0.00/27.0 [00:00&lt;?, ? Objects/s]

                                                                                

Compressing:   0%|                            | 0.00/23.0 [00:00&lt;?, ? Objects/s]

                                                                                

Receiving:   0%|                             | 0.00/2.15k [00:00&lt;?, ? Objects/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                

Resolving:   0%|                                | 0.00/537 [00:00&lt;?, ? Deltas/s]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO   ] scanning for unlocked files (this may take some time) 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO   ] Remote origin not usable by git-annex; setting annex-ignore 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO   ] access to 1 dataset sibling s3-PRIVATE not auto-enabled, enable with:
| 		datalad siblings -d &quot;/storage/tmp/tmpvxi51_fp/ds000102&quot; enable -s s3-PRIVATE 
<span class=" -Color -Color-Bold">install</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): /storage/tmp/tmpvxi51_fp/ds000102 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">dataset</span>)

</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:   0%|                                    | 0.00/618M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   0%|            | 0.00/10.6M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   0%|   | 15.9k/10.6M [00:00&lt;02:06, 83.7k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   0%|   | 32.2k/10.6M [00:00&lt;02:22, 73.9k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   0%|   | 49.6k/10.6M [00:00&lt;02:26, 72.0k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   1%|   | 67.1k/10.6M [00:00&lt;02:32, 68.9k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   1%|   | 84.5k/10.6M [00:01&lt;03:01, 57.7k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   1%|    | 102k/10.6M [00:01&lt;02:46, 63.0k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   1%|    | 119k/10.6M [00:01&lt;02:44, 63.6k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   1%|    | 137k/10.6M [00:02&lt;02:34, 67.4k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   2%|    | 171k/10.6M [00:02&lt;02:24, 71.9k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   2%|    | 206k/10.6M [00:02&lt;02:12, 78.4k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   2%|    | 241k/10.6M [00:03&lt;01:50, 93.9k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   3%|▏    | 276k/10.6M [00:03&lt;01:39, 104k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   3%|▏    | 311k/10.6M [00:03&lt;01:28, 116k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   3%|▏    | 346k/10.6M [00:03&lt;01:16, 133k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   4%|▏    | 398k/10.6M [00:04&lt;01:03, 161k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   4%|▏    | 433k/10.6M [00:04&lt;00:57, 176k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   4%|▏    | 467k/10.6M [00:04&lt;00:51, 198k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   5%|▏    | 502k/10.6M [00:04&lt;00:50, 200k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   5%|▎    | 554k/10.6M [00:04&lt;00:46, 216k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   6%|▎    | 642k/10.6M [00:04&lt;00:36, 271k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   7%|▎    | 729k/10.6M [00:05&lt;00:32, 305k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   8%|▍    | 833k/10.6M [00:05&lt;00:27, 354k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   9%|▍    | 937k/10.6M [00:05&lt;00:24, 389k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  10%|▍   | 1.06M/10.6M [00:05&lt;00:21, 436k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  11%|▍   | 1.18M/10.6M [00:06&lt;00:19, 474k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  12%|▍   | 1.32M/10.6M [00:06&lt;00:16, 577k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  13%|▌   | 1.39M/10.6M [00:06&lt;00:16, 561k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  14%|▌   | 1.49M/10.6M [00:06&lt;00:15, 585k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  16%|▋   | 1.67M/10.6M [00:06&lt;00:11, 793k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  18%|▋   | 1.88M/10.6M [00:06&lt;00:12, 703k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  20%|▊   | 2.09M/10.6M [00:07&lt;00:10, 781k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  22%|▉   | 2.33M/10.6M [00:07&lt;00:09, 867k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  24%|▋  | 2.57M/10.6M [00:07&lt;00:07, 1.11M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  27%|▊  | 2.85M/10.6M [00:07&lt;00:06, 1.21M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  30%|▉  | 3.17M/10.6M [00:08&lt;00:07, 1.04M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  33%|▉  | 3.48M/10.6M [00:08&lt;00:05, 1.30M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  36%|█  | 3.84M/10.6M [00:08&lt;00:04, 1.44M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  40%|█▏ | 4.23M/10.6M [00:08&lt;00:04, 1.52M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  44%|█▎ | 4.65M/10.6M [00:08&lt;00:04, 1.46M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  48%|█▍ | 5.10M/10.6M [00:09&lt;00:03, 1.55M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  53%|█▌ | 5.57M/10.6M [00:09&lt;00:02, 2.00M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  58%|█▋ | 6.09M/10.6M [00:09&lt;00:02, 1.87M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  61%|█▊ | 6.44M/10.6M [00:09&lt;00:01, 2.12M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  68%|██ | 7.22M/10.6M [00:09&lt;00:01, 2.43M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  74%|██▏| 7.83M/10.6M [00:10&lt;00:01, 2.52M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  80%|██▍| 8.52M/10.6M [00:10&lt;00:00, 2.68M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  87%|██▌| 9.24M/10.6M [00:10&lt;00:00, 2.84M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  94%|██▊| 9.99M/10.6M [00:10&lt;00:00, 2.99M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:   2%|▍                           | 10.6M/618M [00:12&lt;12:00, 843k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   0%|            | 0.00/28.1M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   3%|    | 844k/28.1M [00:00&lt;00:07, 3.81M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   6%|▏  | 1.74M/28.1M [00:00&lt;00:06, 3.90M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  10%|▎  | 2.68M/28.1M [00:00&lt;00:06, 4.01M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  13%|▍  | 3.66M/28.1M [00:00&lt;00:05, 4.16M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  17%|▌  | 4.69M/28.1M [00:01&lt;00:05, 4.32M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  21%|▌  | 5.78M/28.1M [00:01&lt;00:04, 5.27M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  25%|▋  | 6.94M/28.1M [00:01&lt;00:04, 4.51M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  29%|▊  | 8.12M/28.1M [00:01&lt;00:03, 5.72M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  33%|▉  | 9.35M/28.1M [00:01&lt;00:03, 5.60M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  38%|█▏ | 10.6M/28.1M [00:02&lt;00:03, 5.59M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  43%|█▎ | 12.1M/28.1M [00:02&lt;00:02, 5.90M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  48%|█▍ | 13.5M/28.1M [00:02&lt;00:02, 6.06M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  51%|█▌ | 14.3M/28.1M [00:02&lt;00:02, 5.63M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  55%|█▋ | 15.3M/28.1M [00:02&lt;00:02, 5.71M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  59%|█▊ | 16.6M/28.1M [00:03&lt;00:01, 6.99M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  65%|█▉ | 18.2M/28.1M [00:03&lt;00:01, 7.04M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  70%|██ | 19.7M/28.1M [00:03&lt;00:01, 6.92M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  73%|██▏| 20.5M/28.1M [00:03&lt;00:01, 6.85M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  77%|██▎| 21.5M/28.1M [00:03&lt;00:00, 7.42M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  83%|██▍| 23.4M/28.1M [00:03&lt;00:00, 7.78M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  92%|██▊| 25.9M/28.1M [00:04&lt;00:00, 9.03M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  97%|██▉| 27.1M/28.1M [00:04&lt;00:00, 8.03M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:   6%|█▋                         | 38.6M/618M [00:17&lt;04:20, 2.23M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   0%|            | 0.00/28.1M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   8%|▏  | 2.27M/28.1M [00:00&lt;00:02, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  15%|▍  | 4.24M/28.1M [00:00&lt;00:02, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  20%|▌  | 5.56M/28.1M [00:00&lt;00:02, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  27%|▊  | 7.63M/28.1M [00:00&lt;00:01, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  34%|█  | 9.61M/28.1M [00:00&lt;00:01, 9.83M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  42%|█▏ | 11.7M/28.1M [00:01&lt;00:01, 9.63M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  49%|█▍ | 13.7M/28.1M [00:01&lt;00:01, 9.38M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  53%|█▌ | 15.0M/28.1M [00:01&lt;00:01, 9.59M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  58%|█▋ | 16.3M/28.1M [00:01&lt;00:01, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  65%|█▉ | 18.3M/28.1M [00:01&lt;00:00, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  69%|██ | 19.6M/28.1M [00:01&lt;00:00, 9.72M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  74%|██▏| 20.9M/28.1M [00:02&lt;00:00, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  79%|██▎| 22.3M/28.1M [00:02&lt;00:00, 9.87M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  87%|██▌| 24.5M/28.1M [00:02&lt;00:00, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  91%|██▋| 25.7M/28.1M [00:02&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  96%|██▉| 27.0M/28.1M [00:02&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz: 100%|██▉| 28.1M/28.1M [00:02&lt;00:00, 10.6M Bytes/s]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  11%|██▉                        | 66.8M/618M [00:20&lt;02:49, 3.26M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/a .. 4_T1w.nii.gz:   0%|            | 0.00/10.7M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/a .. 4_T1w.nii.gz:  15%|▍  | 1.66M/10.7M [00:00&lt;00:00, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/a .. 4_T1w.nii.gz:  34%|█  | 3.63M/10.7M [00:00&lt;00:00, 12.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/a .. 4_T1w.nii.gz:  47%|█▍ | 5.05M/10.7M [00:00&lt;00:00, 9.83M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/a .. 4_T1w.nii.gz:  67%|██ | 7.18M/10.7M [00:00&lt;00:00, 13.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/a .. 4_T1w.nii.gz:  90%|██▋| 9.67M/10.7M [00:00&lt;00:00, 12.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:   0%|            | 0.00/29.1M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:   8%|▏  | 2.40M/29.1M [00:00&lt;00:01, 16.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  16%|▍  | 4.54M/29.1M [00:00&lt;00:02, 12.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  22%|▋  | 6.47M/29.1M [00:00&lt;00:02, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  26%|▊  | 7.67M/29.1M [00:00&lt;00:02, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  31%|▉  | 8.96M/29.1M [00:00&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  38%|█▏ | 11.0M/29.1M [00:01&lt;00:01, 9.92M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  45%|█▎ | 13.1M/29.1M [00:01&lt;00:01, 9.96M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  52%|█▌ | 15.3M/29.1M [00:01&lt;00:01, 9.66M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  57%|█▋ | 16.7M/29.1M [00:01&lt;00:01, 9.48M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  62%|█▊ | 18.1M/29.1M [00:01&lt;00:01, 8.88M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  68%|██ | 19.6M/29.1M [00:01&lt;00:00, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  75%|██▎| 21.9M/29.1M [00:02&lt;00:00, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  82%|██▍| 23.9M/29.1M [00:02&lt;00:00, 9.61M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  88%|██▋| 25.5M/29.1M [00:02&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  94%|██▊| 27.2M/29.1M [00:02&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  17%|████▊                       | 107M/618M [00:25&lt;02:01, 4.23M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:   0%|            | 0.00/29.1M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:   6%|▏  | 1.69M/29.1M [00:00&lt;00:01, 14.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  14%|▍  | 4.13M/29.1M [00:00&lt;00:01, 13.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  21%|▋  | 6.13M/29.1M [00:00&lt;00:01, 11.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  28%|▊  | 8.06M/29.1M [00:00&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  33%|▉  | 9.57M/29.1M [00:00&lt;00:01, 11.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  40%|█▏ | 11.7M/29.1M [00:01&lt;00:01, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  49%|█▍ | 14.3M/29.1M [00:01&lt;00:01, 11.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  57%|█▋ | 16.7M/29.1M [00:01&lt;00:01, 11.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  64%|█▉ | 18.7M/29.1M [00:01&lt;00:00, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  73%|██▏| 21.1M/29.1M [00:01&lt;00:00, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  80%|██▍| 23.4M/29.1M [00:02&lt;00:00, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  84%|██▌| 24.5M/29.1M [00:02&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  88%|██▋| 25.6M/29.1M [00:02&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  92%|██▊| 26.8M/29.1M [00:02&lt;00:00, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-04/f .. _bold.nii.gz:  96%|██▉| 28.0M/29.1M [00:02&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/a .. 9_T1w.nii.gz:   0%|            | 0.00/10.8M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/a .. 9_T1w.nii.gz:  14%|▍  | 1.53M/10.8M [00:00&lt;00:00, 12.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/a .. 9_T1w.nii.gz:  35%|█  | 3.76M/10.8M [00:00&lt;00:00, 12.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/a .. 9_T1w.nii.gz:  52%|█▌ | 5.63M/10.8M [00:00&lt;00:00, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/a .. 9_T1w.nii.gz:  64%|█▉ | 6.89M/10.8M [00:00&lt;00:00, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/a .. 9_T1w.nii.gz:  76%|██▎| 8.23M/10.8M [00:00&lt;00:00, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/a .. 9_T1w.nii.gz:  97%|██▉| 10.5M/10.8M [00:00&lt;00:00, 10.5M Bytes/s]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  24%|██████▋                     | 146M/618M [00:29&lt;01:36, 4.91M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:   0%|            | 0.00/29.2M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:   9%|▎  | 2.62M/29.2M [00:00&lt;00:02, 13.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  16%|▍  | 4.77M/29.2M [00:00&lt;00:02, 11.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  21%|▋  | 6.20M/29.2M [00:00&lt;00:01, 12.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  27%|▊  | 7.93M/29.2M [00:00&lt;00:01, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  35%|█  | 10.2M/29.2M [00:00&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  40%|█▏ | 11.7M/29.2M [00:01&lt;00:01, 11.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  48%|█▍ | 14.2M/29.2M [00:01&lt;00:01, 12.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  55%|█▋ | 16.1M/29.2M [00:01&lt;00:01, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  61%|█▊ | 17.7M/29.2M [00:01&lt;00:01, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  66%|█▉ | 19.4M/29.2M [00:01&lt;00:00, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  74%|██▏| 21.6M/29.2M [00:01&lt;00:00, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  81%|██▍| 23.5M/29.2M [00:02&lt;00:00, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  86%|██▌| 25.1M/29.2M [00:02&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  96%|██▊| 27.9M/29.2M [00:02&lt;00:00, 11.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz: 100%|██▉| 29.1M/29.2M [00:02&lt;00:00, 10.9M Bytes/s]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:   0%|            | 0.00/29.2M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:   5%|▏  | 1.40M/29.2M [00:00&lt;00:02, 13.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  14%|▍  | 3.98M/29.2M [00:00&lt;00:01, 13.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  21%|▌  | 6.00M/29.2M [00:00&lt;00:01, 11.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  27%|▊  | 7.89M/29.2M [00:00&lt;00:02, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  34%|█  | 10.0M/29.2M [00:00&lt;00:01, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  40%|█▏ | 11.6M/29.2M [00:01&lt;00:01, 9.86M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  46%|█▍ | 13.5M/29.2M [00:01&lt;00:01, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  53%|█▌ | 15.6M/29.2M [00:01&lt;00:01, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  57%|█▋ | 16.7M/29.2M [00:01&lt;00:01, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  63%|█▉ | 18.5M/29.2M [00:01&lt;00:00, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  74%|██▏| 21.6M/29.2M [00:01&lt;00:00, 12.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  81%|██▍| 23.6M/29.2M [00:02&lt;00:00, 12.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  87%|██▌| 25.3M/29.2M [00:02&lt;00:00, 11.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  95%|██▊| 27.8M/29.2M [00:02&lt;00:00, 11.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-09/f .. _bold.nii.gz:  99%|██▉| 29.0M/29.2M [00:02&lt;00:00, 11.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                

Get sub-09/f .. _bold.nii.gz:   0%|            | 0.00/29.2M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
Total:  33%|█████████▎                  | 205M/618M [00:36&lt;01:12, 5.68M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/a .. 7_T1w.nii.gz:   0%|            | 0.00/10.7M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/a .. 7_T1w.nii.gz:  20%|▌  | 2.10M/10.7M [00:00&lt;00:00, 12.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/a .. 7_T1w.nii.gz:  36%|█  | 3.83M/10.7M [00:00&lt;00:00, 12.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/a .. 7_T1w.nii.gz:  50%|█▍ | 5.36M/10.7M [00:00&lt;00:00, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/a .. 7_T1w.nii.gz:  62%|█▊ | 6.63M/10.7M [00:00&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/a .. 7_T1w.nii.gz:  81%|██▍| 8.66M/10.7M [00:00&lt;00:00, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:   0%|            | 0.00/28.9M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:   3%|    | 878k/28.9M [00:00&lt;00:03, 7.46M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  11%|▎  | 3.22M/28.9M [00:00&lt;00:02, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  15%|▍  | 4.46M/28.9M [00:00&lt;00:02, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  20%|▌  | 5.91M/28.9M [00:00&lt;00:02, 11.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  27%|▊  | 7.82M/28.9M [00:00&lt;00:02, 9.99M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  34%|█  | 9.82M/28.9M [00:00&lt;00:02, 9.55M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  42%|█▎ | 12.1M/28.9M [00:01&lt;00:01, 9.74M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  49%|█▍ | 14.2M/28.9M [00:01&lt;00:01, 9.61M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  54%|█▋ | 15.7M/28.9M [00:01&lt;00:01, 9.28M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  59%|█▊ | 17.2M/28.9M [00:01&lt;00:01, 9.16M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  69%|██ | 20.0M/28.9M [00:01&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  75%|██▎| 21.8M/28.9M [00:02&lt;00:00, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  79%|██▎| 22.9M/28.9M [00:02&lt;00:00, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  86%|██▌| 24.8M/28.9M [00:02&lt;00:00, 9.97M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  90%|██▋| 26.1M/28.9M [00:02&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  96%|██▉| 27.9M/28.9M [00:02&lt;00:00, 9.98M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:   0%|            | 0.00/29.0M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:   9%|▎  | 2.65M/29.0M [00:00&lt;00:01, 13.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  14%|▍  | 4.12M/29.0M [00:00&lt;00:01, 13.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  21%|▋  | 6.07M/29.0M [00:00&lt;00:01, 11.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  27%|▊  | 7.76M/29.0M [00:00&lt;00:02, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  35%|█  | 10.1M/29.0M [00:00&lt;00:01, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  42%|█▏ | 12.1M/29.0M [00:01&lt;00:01, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  46%|█▎ | 13.2M/29.0M [00:01&lt;00:01, 9.91M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  50%|█▌ | 14.6M/29.0M [00:01&lt;00:01, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  57%|█▋ | 16.6M/29.0M [00:01&lt;00:01, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  61%|█▊ | 17.8M/29.0M [00:01&lt;00:01, 9.80M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  66%|█▉ | 19.1M/29.0M [00:01&lt;00:00, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  74%|██▏| 21.5M/29.0M [00:02&lt;00:00, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  78%|██▎| 22.7M/29.0M [00:02&lt;00:00, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  83%|██▍| 24.0M/29.0M [00:02&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  90%|██▋| 26.1M/29.0M [00:02&lt;00:00, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  94%|██▊| 27.1M/29.0M [00:02&lt;00:00, 9.85M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-07/f .. _bold.nii.gz:  98%|██▉| 28.5M/29.0M [00:02&lt;00:00, 10.7M Bytes/s]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  44%|████████████▍               | 273M/618M [00:44&lt;00:55, 6.19M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:   0%|            | 0.00/10.7M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  29%|▊  | 3.12M/10.7M [00:00&lt;00:00, 14.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  51%|█▌ | 5.48M/10.7M [00:00&lt;00:00, 11.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  71%|██▏| 7.64M/10.7M [00:00&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  82%|██▍| 8.79M/10.7M [00:00&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:   0%|            | 0.00/29.2M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  11%|▎  | 3.09M/29.2M [00:00&lt;00:01, 15.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  18%|▌  | 5.37M/29.2M [00:00&lt;00:01, 13.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  25%|▋  | 7.15M/29.2M [00:00&lt;00:01, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  29%|▊  | 8.48M/29.2M [00:00&lt;00:02, 9.35M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  33%|▉  | 9.66M/29.2M [00:00&lt;00:01, 9.84M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  38%|█▏ | 11.0M/29.2M [00:01&lt;00:01, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  43%|█▎ | 12.6M/29.2M [00:01&lt;00:01, 9.60M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  49%|█▍ | 14.3M/29.2M [00:01&lt;00:01, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  56%|█▋ | 16.4M/29.2M [00:01&lt;00:01, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  63%|█▉ | 18.5M/29.2M [00:01&lt;00:00, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  67%|██ | 19.7M/29.2M [00:01&lt;00:00, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  72%|██▏| 21.0M/29.2M [00:01&lt;00:00, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  79%|██▎| 23.1M/29.2M [00:02&lt;00:00, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  83%|██▍| 24.2M/29.2M [00:02&lt;00:00, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  88%|██▋| 25.6M/29.2M [00:02&lt;00:00, 11.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  95%|██▊| 27.6M/29.2M [00:02&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  99%|██▉| 28.9M/29.2M [00:02&lt;00:00, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:   0%|            | 0.00/29.2M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:   8%|▏  | 2.30M/29.2M [00:00&lt;00:01, 14.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  14%|▍  | 4.07M/29.2M [00:00&lt;00:01, 13.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  22%|▋  | 6.29M/29.2M [00:00&lt;00:02, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  29%|▊  | 8.34M/29.2M [00:00&lt;00:02, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  36%|█  | 10.4M/29.2M [00:01&lt;00:01, 9.60M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  39%|█▏ | 11.5M/29.2M [00:01&lt;00:01, 9.41M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  44%|█▎ | 13.0M/29.2M [00:01&lt;00:01, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  52%|█▌ | 15.0M/29.2M [00:01&lt;00:01, 9.97M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  57%|█▋ | 16.5M/29.2M [00:01&lt;00:01, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  65%|█▉ | 18.9M/29.2M [00:01&lt;00:00, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  69%|██ | 20.1M/29.2M [00:01&lt;00:00, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  73%|██▏| 21.2M/29.2M [00:01&lt;00:00, 11.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  79%|██▍| 23.1M/29.2M [00:02&lt;00:00, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  85%|██▌| 24.8M/29.2M [00:02&lt;00:00, 11.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  93%|██▊| 27.3M/29.2M [00:02&lt;00:00, 11.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  98%|██▉| 28.5M/29.2M [00:02&lt;00:00, 11.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  55%|███████████████▌            | 343M/618M [00:51&lt;00:41, 6.63M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/a .. 3_T1w.nii.gz:   0%|            | 0.00/10.7M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/a .. 3_T1w.nii.gz:  21%|▋  | 2.28M/10.7M [00:00&lt;00:00, 14.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/a .. 3_T1w.nii.gz:  38%|█▏ | 4.10M/10.7M [00:00&lt;00:00, 13.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/a .. 3_T1w.nii.gz:  59%|█▊ | 6.30M/10.7M [00:00&lt;00:00, 12.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/a .. 3_T1w.nii.gz:  72%|██▏| 7.71M/10.7M [00:00&lt;00:00, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/a .. 3_T1w.nii.gz:  84%|██▌| 8.99M/10.7M [00:00&lt;00:00, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/a .. 3_T1w.nii.gz:  95%|██▊| 10.2M/10.7M [00:00&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:   0%|            | 0.00/28.8M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:   4%|   | 1.06M/28.8M [00:00&lt;00:02, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  11%|▎  | 3.08M/28.8M [00:00&lt;00:02, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  14%|▍  | 4.15M/28.8M [00:00&lt;00:02, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  18%|▌  | 5.31M/28.8M [00:00&lt;00:02, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  23%|▋  | 6.63M/28.8M [00:00&lt;00:02, 9.42M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  30%|▉  | 8.56M/28.8M [00:00&lt;00:01, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  37%|█  | 10.5M/28.8M [00:01&lt;00:01, 9.34M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  41%|█▏ | 11.8M/28.8M [00:01&lt;00:01, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  49%|█▍ | 14.1M/28.8M [00:01&lt;00:01, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  60%|█▊ | 17.2M/28.8M [00:01&lt;00:01, 11.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  66%|█▉ | 19.0M/28.8M [00:01&lt;00:00, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  70%|██ | 20.2M/28.8M [00:01&lt;00:00, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  79%|██▍| 22.8M/28.8M [00:02&lt;00:00, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  83%|██▌| 24.0M/28.8M [00:02&lt;00:00, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  88%|██▋| 25.4M/28.8M [00:02&lt;00:00, 11.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  96%|██▉| 27.6M/28.8M [00:02&lt;00:00, 11.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:   0%|            | 0.00/28.8M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:   6%|▏  | 1.76M/28.8M [00:00&lt;00:02, 12.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  12%|▎  | 3.33M/28.8M [00:00&lt;00:02, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  16%|▍  | 4.52M/28.8M [00:00&lt;00:02, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  20%|▌  | 5.63M/28.8M [00:00&lt;00:02, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  26%|▊  | 7.56M/28.8M [00:00&lt;00:02, 9.60M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  34%|█  | 9.67M/28.8M [00:00&lt;00:01, 9.98M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  38%|█▏ | 10.8M/28.8M [00:01&lt;00:02, 8.77M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  42%|█▎ | 12.2M/28.8M [00:01&lt;00:01, 9.85M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  51%|█▌ | 14.8M/28.8M [00:01&lt;00:01, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  56%|█▋ | 16.1M/28.8M [00:01&lt;00:01, 9.26M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  62%|█▊ | 17.7M/28.8M [00:01&lt;00:01, 9.58M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  67%|██ | 19.4M/28.8M [00:02&lt;00:01, 8.84M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  74%|██▏| 21.3M/28.8M [00:02&lt;00:00, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  82%|██▍| 23.7M/28.8M [00:02&lt;00:00, 7.76M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  87%|██▌| 25.0M/28.8M [00:02&lt;00:00, 8.52M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  91%|██▋| 26.2M/28.8M [00:02&lt;00:00, 9.16M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-03/f .. _bold.nii.gz:  98%|██▉| 28.1M/28.8M [00:02&lt;00:00, 9.33M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   0%|            | 0.00/10.6M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  14%|▍  | 1.52M/10.6M [00:00&lt;00:00, 11.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  38%|█▏ | 3.98M/10.6M [00:00&lt;00:00, 12.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  52%|█▌ | 5.48M/10.6M [00:00&lt;00:00, 9.34M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  75%|██▏| 7.91M/10.6M [00:00&lt;00:00, 9.96M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  95%|██▊| 9.99M/10.6M [00:01&lt;00:00, 9.67M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  68%|███████████████████         | 421M/618M [01:01&lt;00:28, 6.89M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:   0%|            | 0.00/28.6M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:   3%|▏   | 967k/28.6M [00:00&lt;00:02, 9.36M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  11%|▎  | 3.16M/28.6M [00:00&lt;00:02, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  19%|▌  | 5.41M/28.6M [00:00&lt;00:02, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  25%|▊  | 7.26M/28.6M [00:00&lt;00:02, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  30%|▉  | 8.46M/28.6M [00:00&lt;00:02, 9.76M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  35%|█  | 9.90M/28.6M [00:00&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  40%|█▏ | 11.4M/28.6M [00:01&lt;00:01, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  46%|█▍ | 13.3M/28.6M [00:01&lt;00:01, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  51%|█▌ | 14.7M/28.6M [00:01&lt;00:01, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  59%|█▊ | 16.9M/28.6M [00:01&lt;00:01, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  64%|█▉ | 18.2M/28.6M [00:01&lt;00:00, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  72%|██▏| 20.7M/28.6M [00:01&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  77%|██▎| 22.2M/28.6M [00:02&lt;00:00, 11.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  85%|██▌| 24.4M/28.6M [00:02&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  90%|██▋| 25.8M/28.6M [00:02&lt;00:00, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  96%|██▊| 27.4M/28.6M [00:02&lt;00:00, 11.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:   0%|            | 0.00/28.6M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:   9%|▎  | 2.61M/28.6M [00:00&lt;00:01, 15.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  15%|▍  | 4.44M/28.6M [00:00&lt;00:01, 13.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  21%|▋  | 6.01M/28.6M [00:00&lt;00:02, 9.91M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  29%|▊  | 8.24M/28.6M [00:00&lt;00:02, 9.92M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  35%|█  | 10.1M/28.6M [00:01&lt;00:02, 9.19M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  39%|█▏ | 11.2M/28.6M [00:01&lt;00:01, 9.22M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  44%|█▎ | 12.7M/28.6M [00:01&lt;00:01, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  51%|█▌ | 14.6M/28.6M [00:01&lt;00:01, 9.59M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  59%|█▊ | 16.8M/28.6M [00:01&lt;00:01, 9.69M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  66%|█▉ | 18.9M/28.6M [00:01&lt;00:01, 9.53M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  70%|██ | 20.0M/28.6M [00:02&lt;00:00, 9.37M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  75%|██▏| 21.3M/28.6M [00:02&lt;00:00, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  82%|██▍| 23.6M/28.6M [00:02&lt;00:00, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  90%|██▋| 25.9M/28.6M [00:02&lt;00:00, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  94%|██▊| 26.9M/28.6M [00:02&lt;00:00, 9.73M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/f .. _bold.nii.gz:  99%|██▉| 28.3M/28.6M [00:02&lt;00:00, 10.6M Bytes/s]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/a .. 6_T1w.nii.gz:   0%|            | 0.00/10.6M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/a .. 6_T1w.nii.gz:  26%|▊  | 2.74M/10.6M [00:00&lt;00:00, 13.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/a .. 6_T1w.nii.gz:  46%|█▍ | 4.93M/10.6M [00:00&lt;00:00, 12.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/a .. 6_T1w.nii.gz:  64%|█▉ | 6.76M/10.6M [00:00&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/a .. 6_T1w.nii.gz:  76%|██▎| 8.02M/10.6M [00:00&lt;00:00, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/a .. 6_T1w.nii.gz:  94%|██▊| 9.97M/10.6M [00:00&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:   0%|            | 0.00/29.4M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:   8%|▏  | 2.31M/29.4M [00:00&lt;00:01, 14.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  14%|▍  | 4.01M/29.4M [00:00&lt;00:02, 11.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  22%|▋  | 6.32M/29.4M [00:00&lt;00:02, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  28%|▊  | 8.22M/29.4M [00:00&lt;00:02, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  33%|▉  | 9.68M/29.4M [00:00&lt;00:01, 11.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  40%|█▏ | 11.7M/29.4M [00:01&lt;00:01, 9.62M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  45%|█▎ | 13.2M/29.4M [00:01&lt;00:01, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  49%|█▍ | 14.5M/29.4M [00:01&lt;00:01, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  54%|█▌ | 15.9M/29.4M [00:01&lt;00:01, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  61%|█▊ | 18.1M/29.4M [00:01&lt;00:01, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  66%|█▉ | 19.5M/29.4M [00:01&lt;00:00, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  74%|██▏| 21.8M/29.4M [00:01&lt;00:00, 11.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  80%|██▍| 23.6M/29.4M [00:02&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  85%|██▌| 25.1M/29.4M [00:02&lt;00:00, 11.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  92%|██▊| 27.0M/29.4M [00:02&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  97%|██▉| 28.4M/29.4M [00:02&lt;00:00, 11.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  84%|███████████████████████▍    | 519M/618M [01:12&lt;00:13, 7.19M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:   0%|            | 0.00/29.4M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:   8%|▏  | 2.35M/29.4M [00:00&lt;00:01, 19.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  17%|▌  | 5.08M/29.4M [00:00&lt;00:02, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  22%|▋  | 6.57M/29.4M [00:00&lt;00:01, 11.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  31%|▉  | 8.99M/29.4M [00:00&lt;00:01, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  36%|█  | 10.5M/29.4M [00:00&lt;00:01, 12.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  43%|█▎ | 12.6M/29.4M [00:01&lt;00:01, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  47%|█▍ | 13.8M/29.4M [00:01&lt;00:01, 11.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  52%|█▌ | 15.4M/29.4M [00:01&lt;00:01, 12.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  60%|█▊ | 17.6M/29.4M [00:01&lt;00:00, 11.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  64%|█▉ | 18.9M/29.4M [00:01&lt;00:00, 12.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  72%|██▏| 21.2M/29.4M [00:01&lt;00:00, 11.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  77%|██▎| 22.8M/29.4M [00:01&lt;00:00, 12.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  85%|██▌| 25.1M/29.4M [00:02&lt;00:00, 11.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  94%|██▊| 27.5M/29.4M [00:02&lt;00:00, 12.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-06/f .. _bold.nii.gz:  98%|██▉| 28.8M/29.4M [00:02&lt;00:00, 12.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  89%|████████████████████████▊   | 548M/618M [01:15&lt;00:09, 7.30M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/a .. 5_T1w.nii.gz:   0%|            | 0.00/10.8M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/a .. 5_T1w.nii.gz:  22%|▋  | 2.33M/10.8M [00:00&lt;00:00, 14.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/a .. 5_T1w.nii.gz:  39%|█▏ | 4.19M/10.8M [00:00&lt;00:00, 13.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/a .. 5_T1w.nii.gz:  60%|█▊ | 6.49M/10.8M [00:00&lt;00:00, 11.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/a .. 5_T1w.nii.gz:  79%|██▎| 8.44M/10.8M [00:00&lt;00:00, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/a .. 5_T1w.nii.gz:  89%|██▋| 9.57M/10.8M [00:00&lt;00:00, 9.74M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:   0%|            | 0.00/29.7M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:   7%|▏  | 2.18M/29.7M [00:00&lt;00:01, 14.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  14%|▍  | 4.06M/29.7M [00:00&lt;00:01, 13.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  22%|▋  | 6.45M/29.7M [00:00&lt;00:02, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  31%|▉  | 9.09M/29.7M [00:00&lt;00:01, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  38%|█▏ | 11.2M/29.7M [00:01&lt;00:01, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  43%|█▎ | 12.7M/29.7M [00:01&lt;00:01, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  49%|█▍ | 14.5M/29.7M [00:01&lt;00:01, 9.95M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  54%|█▌ | 16.0M/29.7M [00:01&lt;00:01, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  61%|█▊ | 18.0M/29.7M [00:01&lt;00:01, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  69%|██ | 20.4M/29.7M [00:01&lt;00:00, 10.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  77%|██▎| 22.7M/29.7M [00:02&lt;00:00, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  83%|██▍| 24.6M/29.7M [00:02&lt;00:00, 9.61M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  90%|██▋| 26.8M/29.7M [00:02&lt;00:00, 9.70M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  98%|██▉| 29.2M/29.7M [00:02&lt;00:00, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  95%|██████████████████████████▋ | 588M/618M [01:19&lt;00:04, 7.37M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:   0%|            | 0.00/29.7M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:   9%|▎  | 2.75M/29.7M [00:00&lt;00:01, 13.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  15%|▍  | 4.52M/29.7M [00:00&lt;00:02, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  20%|▌  | 5.95M/29.7M [00:00&lt;00:02, 11.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  26%|▊  | 7.67M/29.7M [00:00&lt;00:02, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  34%|█  | 10.1M/29.7M [00:00&lt;00:01, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  42%|█▎ | 12.4M/29.7M [00:01&lt;00:01, 10.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  46%|█▎ | 13.6M/29.7M [00:01&lt;00:01, 9.95M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  50%|█▍ | 14.8M/29.7M [00:01&lt;00:01, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  54%|█▋ | 16.1M/29.7M [00:01&lt;00:01, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  59%|█▊ | 17.5M/29.7M [00:01&lt;00:01, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  63%|█▉ | 18.7M/29.7M [00:01&lt;00:01, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  67%|██ | 20.0M/29.7M [00:01&lt;00:00, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  71%|██▏| 21.2M/29.7M [00:01&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  76%|██▎| 22.5M/29.7M [00:02&lt;00:00, 11.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  80%|██▍| 23.8M/29.7M [00:02&lt;00:00, 11.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  88%|██▋| 26.1M/29.7M [00:02&lt;00:00, 11.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-05/f .. _bold.nii.gz:  97%|██▉| 28.6M/29.7M [00:02&lt;00:00, 12.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-01/anat/sub-01_T1w.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-01/func/sub-01_task-flanker_run-2_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-04/anat/sub-04_T1w.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-04/func/sub-04_task-flanker_run-1_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-04/func/sub-04_task-flanker_run-2_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-09/anat/sub-09_T1w.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-09/func/sub-09_task-flanker_run-1_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-09/func/sub-09_task-flanker_run-2_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-07/anat/sub-07_T1w.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
  [1 similar message has been suppressed; disable with datalad.ui.suppress-similar-results=off]
  [17 similar messages have been suppressed; disable with datalad.ui.suppress-similar-results=off]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-01 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-04 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-09 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-07 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-02 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-03 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-08 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-06 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-05 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
action summary:
  get (ok: 36)

</pre></div>
</div>
</div>
</div>
</section>
<section id="start-the-workflow">
<h3>Start the workflow<a class="headerlink" href="#start-the-workflow" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_first</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;level1&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">exp_dir_first</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;crashfile_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>The following two nodes (<code class="docutils literal notranslate"><span class="pre">infosource</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">dg</span></code>) together define all inputs required for the preprocessing workflow</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get subject_id list - we only do 9 subjects here so the notebook runs in a reasonable time</span>
<span class="n">subj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="n">data_dir_first</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">PATTERN</span><span class="p">)]</span>
<span class="n">subj_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">subj_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;01&#39;, &#39;02&#39;, &#39;03&#39;, &#39;04&#39;, &#39;05&#39;, &#39;06&#39;, &#39;07&#39;, &#39;08&#39;, &#39;09&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infosource_first</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]),</span>
                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;infosource&quot;</span><span class="p">)</span>
<span class="n">infosource_first</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="n">subj_list</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dg_first</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">nio</span><span class="o">.</span><span class="n">DataGrabber</span><span class="p">(</span>
        <span class="n">infields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;run_id&quot;</span><span class="p">],</span> <span class="n">outfields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;struct&quot;</span><span class="p">,</span> <span class="s2">&quot;func&quot;</span><span class="p">,</span> <span class="s2">&quot;events&quot;</span><span class="p">]</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dg_first&quot;</span>
<span class="p">)</span>

<span class="c1"># Specify run_ids and return a sorted filelist to ensure we match files to correct runs/tasks</span>
<span class="n">dg_first</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">dg_first</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sort_filelist</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">dg_first</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
<span class="n">dg_first</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">data_dir_first</span>

<span class="c1"># Define arguments fill the wildcards in the below paths </span>
<span class="n">dg_first</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">struct</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]],</span>
    <span class="n">func</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;run_id&quot;</span><span class="p">]],</span>
    <span class="n">events</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;run_id&quot;</span><span class="p">]]</span>
<span class="p">)</span>

<span class="n">dg_first</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">field_template</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">struct</span> <span class="o">=</span> <span class="s2">&quot;sub-</span><span class="si">%s</span><span class="s2">/anat/sub-</span><span class="si">%s</span><span class="s2">_T1w.nii.gz&quot;</span><span class="p">,</span>
    <span class="n">func</span><span class="o">=</span><span class="s2">&quot;sub-</span><span class="si">%s</span><span class="s2">/func/sub-</span><span class="si">%s</span><span class="s2">_task-flanker_run-</span><span class="si">%d</span><span class="s2">_bold.nii.gz&quot;</span><span class="p">,</span>
    <span class="n">events</span><span class="o">=</span><span class="s2">&quot;sub-</span><span class="si">%s</span><span class="s2">/func/sub-</span><span class="si">%s</span><span class="s2">_task-flanker_run-</span><span class="si">%d</span><span class="s2">_events.tsv&quot;</span><span class="p">,</span> 
<span class="p">)</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
        <span class="p">(</span><span class="n">infosource_first</span><span class="p">,</span> <span class="n">dg_first</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="s2">&quot;subject_id&quot;</span><span class="p">)])</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="initialisation">
<h2>Initialisation<a class="headerlink" href="#initialisation" title="Permalink to this heading">#</a></h2>
<p>Convert functional images to float representation. Since there can be more than one functional run we use a MapNode to convert each run.</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="o">../</span><span class="n">sub</span><span class="o">-</span><span class="mi">11</span><span class="o">/</span><span class="n">func</span><span class="o">/</span><span class="n">sub</span><span class="o">-</span><span class="mi">11</span><span class="n">_task</span><span class="o">-</span><span class="n">flanker_run</span><span class="o">-</span><span class="mi">1</span><span class="n">_bold</span> <span class="n">prefiltered_func_data</span> <span class="o">-</span><span class="n">odt</span> <span class="nb">float</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img2float</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">out_data_type</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_dtype&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;img2float&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_first</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="n">img2float</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Extract the middle volume of the first run as the reference</p>
<p>(Head movement, motion-correction)</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslroi</span> <span class="n">prefiltered_func_data</span> <span class="n">example_func</span> <span class="mi">73</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract one roi</span>
<span class="n">extract_ref</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ExtractROI</span><span class="p">(</span><span class="n">t_size</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> 
                         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;extractref&#39;</span><span class="p">,</span>
                         <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">img2float</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">extract_ref</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>

<span class="c1"># Define a function to return the 1 based index of the middle volume</span>
<span class="k">def</span> <span class="nf">getmiddlevolume</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">nibabel</span> <span class="kn">import</span> <span class="n">load</span>
    <span class="n">funcfile</span> <span class="o">=</span> <span class="n">func</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">funcfile</span> <span class="o">=</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">timepoints</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">funcfile</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">timepoints</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> 

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">img2float</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">getmiddlevolume</span><span class="p">),</span> <span class="n">extract_ref</span><span class="p">,</span> <span class="s1">&#39;t_min&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="preprocessing">
<h2>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this heading">#</a></h2>
<section id="motion-correction">
<h3>Motion Correction<a class="headerlink" href="#motion-correction" title="Permalink to this heading">#</a></h3>
<p>Realign the functional runs to the middle volume of each run</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mcflirt</span> <span class="o">-</span><span class="ow">in</span> <span class="n">prefiltered_func_data</span> <span class="o">-</span><span class="n">out</span> <span class="n">prefiltered_func_data_mcf</span> <span class="o">-</span><span class="n">mats</span> <span class="o">-</span><span class="n">plots</span> <span class="o">-</span><span class="n">reffile</span> <span class="n">example_func</span> <span class="o">-</span><span class="n">rmsrel</span> <span class="o">-</span><span class="n">rmsabs</span> <span class="o">-</span><span class="n">spline_final</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>save_mats (a boolean) – Save transformation matrices. Maps to a command-line argument: -mats.
save_plots (a boolean) – Save transformation parameters. Maps to a command-line argument: -plots.
save_rms (a boolean) – Save rms displacement parameters. Maps to a command-line argument: -rmsabs -rmsrel.
Interpolation (‘spline’ or ‘nn’ or ‘sinc’) – Interpolation method for transformation. Maps to a command-line argument: -%s_final.
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">motion_correct</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">MCFLIRT</span><span class="p">(</span><span class="n">save_mats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_rms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;spline&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;realign&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;ref_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">img2float</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">motion_correct</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">extract_ref</span><span class="p">,</span> <span class="s1">&#39;roi_file&#39;</span><span class="p">,</span> <span class="n">motion_correct</span><span class="p">,</span> <span class="s1">&#39;ref_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the estimated motion parameters</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fsl_tsplot</span> <span class="o">-</span><span class="n">i</span> <span class="n">prefiltered_func_data_mcf</span><span class="o">.</span><span class="n">par</span> <span class="o">-</span><span class="n">t</span> <span class="s1">&#39;MCFLIRT estimated rotations (radians)&#39;</span> <span class="o">-</span><span class="n">u</span> <span class="mi">1</span> <span class="o">--</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span> <span class="o">--</span><span class="n">finish</span><span class="o">=</span><span class="mi">3</span> <span class="o">-</span><span class="n">a</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">-</span><span class="n">w</span> <span class="mi">640</span> <span class="o">-</span><span class="n">h</span> <span class="mi">144</span> <span class="o">-</span><span class="n">o</span> <span class="n">rot</span><span class="o">.</span><span class="n">png</span> 

<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fsl_tsplot</span> <span class="o">-</span><span class="n">i</span> <span class="n">prefiltered_func_data_mcf</span><span class="o">.</span><span class="n">par</span> <span class="o">-</span><span class="n">t</span> <span class="s1">&#39;MCFLIRT estimated translations (mm)&#39;</span> <span class="o">-</span><span class="n">u</span> <span class="mi">1</span> <span class="o">--</span><span class="n">start</span><span class="o">=</span><span class="mi">4</span> <span class="o">--</span><span class="n">finish</span><span class="o">=</span><span class="mi">6</span> <span class="o">-</span><span class="n">a</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">-</span><span class="n">w</span> <span class="mi">640</span> <span class="o">-</span><span class="n">h</span> <span class="mi">144</span> <span class="o">-</span><span class="n">o</span> <span class="n">trans</span><span class="o">.</span><span class="n">png</span> 

<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fsl_tsplot</span> <span class="o">-</span><span class="n">i</span> <span class="n">prefiltered_func_data_mcf_abs</span><span class="o">.</span><span class="n">rms</span><span class="p">,</span><span class="n">prefiltered_func_data_mcf_rel</span><span class="o">.</span><span class="n">rms</span> <span class="o">-</span><span class="n">t</span> <span class="s1">&#39;MCFLIRT estimated mean displacement (mm)&#39;</span> <span class="o">-</span><span class="n">u</span> <span class="mi">1</span> <span class="o">-</span><span class="n">w</span> <span class="mi">640</span> <span class="o">-</span><span class="n">h</span> <span class="mi">144</span> <span class="o">-</span><span class="n">a</span> <span class="n">absolute</span><span class="p">,</span><span class="n">relative</span> <span class="o">-</span><span class="n">o</span> <span class="n">disp</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_motion</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">PlotMotionParams</span><span class="p">(</span><span class="n">in_source</span><span class="o">=</span><span class="s1">&#39;fsl&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;plot_motion&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">plot_motion</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;plot_type&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;rotations&#39;</span><span class="p">,</span> <span class="s1">&#39;translations&#39;</span><span class="p">,</span><span class="s1">&#39;displacement&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">motion_correct</span><span class="p">,</span> <span class="s1">&#39;par_file&#39;</span><span class="p">,</span> <span class="n">plot_motion</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="functionally-masking">
<h3>Functionally Masking<a class="headerlink" href="#functionally-masking" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Passing</span> <span class="n">the</span> <span class="n">reference</span> <span class="n">volume</span> <span class="n">to</span> <span class="n">the</span> <span class="n">FSL</span> <span class="n">command</span><span class="o">-</span><span class="n">line</span> <span class="n">tool</span> <span class="n">bet</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">a</span> <span class="n">binary</span> <span class="n">brain</span> <span class="n">mask</span> <span class="ow">and</span> <span class="n">afterward</span> <span class="n">multiplying</span> <span class="n">the</span> <span class="n">processed</span> <span class="n">functional</span> <span class="n">time</span> <span class="n">series</span> <span class="n">by</span> <span class="n">the</span> <span class="n">brain</span> <span class="n">mask</span> <span class="n">using</span> <span class="n">the</span> <span class="n">fslmaths</span> <span class="n">command</span> <span class="n">to</span> <span class="n">produce</span> <span class="n">a</span> <span class="n">skull</span><span class="o">-</span><span class="n">stripped</span> <span class="n">time</span> <span class="n">series</span><span class="o">.</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.nature.com/articles/s41596-018-0065-y">Ciric et al.(2018)</a></p>
<p>Extract the mean volume of each functional run</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_mcf</span> <span class="o">-</span><span class="n">Tmean</span> <span class="n">mean_func</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meanfunc</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-Tmean&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_mean&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;meanfunc&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">motion_correct</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">meanfunc</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Strip the skull from the mean functional to generate a mask</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bet2</span> <span class="n">mean_func</span> <span class="n">mask</span> <span class="o">-</span><span class="n">f</span> <span class="mf">0.3</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">m</span><span class="p">;</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">immv</span> <span class="n">mask_mask</span> <span class="n">mask</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meanfuncmask</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">BET</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">no_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;meanfuncmask&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">meanfunc</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">meanfuncmask</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Mask the functional data with the extracted mask</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_mcf</span> <span class="o">-</span><span class="n">mas</span> <span class="n">mask</span> <span class="n">prefiltered_func_data_bet</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maskfunc</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_bet&#39;</span><span class="p">,</span> <span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-mas&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maskfunc&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;in_file2&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">motion_correct</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">maskfunc</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">meanfuncmask</span><span class="p">,</span> <span class="s1">&#39;mask_file&#39;</span><span class="p">,</span> <span class="n">maskfunc</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="grand-mean-scaling">
<h3>Grand Mean Scaling<a class="headerlink" href="#grand-mean-scaling" title="Permalink to this heading">#</a></h3>
<p>Determine the 2nd and 98th percentile intensities</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslstats</span> <span class="n">prefiltered_func_data_bet</span> <span class="o">-</span><span class="n">p</span> <span class="mi">2</span> <span class="o">-</span><span class="n">p</span> <span class="mi">98</span>
<span class="mf">0.000000</span> <span class="mf">873.492249</span> <span class="p">(</span><span class="n">these</span> <span class="n">numbers</span> <span class="n">are</span> <span class="k">for</span> <span class="n">subject</span><span class="o">-</span><span class="mi">11</span> <span class="n">run</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
<p>More info <a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/Fslutils">here</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">getthresh</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageStats</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-p 2 -p 98&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;getthreshold&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">maskfunc</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">getthresh</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Threshold the first TR of the functional data at 10% of the 98th percentile</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_bet</span> <span class="o">-</span><span class="n">thr</span> <span class="mf">87.3492249</span> <span class="o">-</span><span class="n">Tmin</span> <span class="o">-</span><span class="nb">bin</span> <span class="n">mask</span> <span class="o">-</span><span class="n">odt</span> <span class="n">char</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">out_data_type</span><span class="o">=</span><span class="s1">&#39;char&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_thresh&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;threshold&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;op_string&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">maskfunc</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>

<span class="c1"># Define a function to get 10% of the intensity</span>
<span class="k">def</span> <span class="nf">getthreshop</span><span class="p">(</span><span class="n">thresh</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;-thr </span><span class="si">%.10f</span><span class="s1"> -Tmin -bin&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">thresh</span><span class="p">]</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">getthresh</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;out_stat&#39;</span><span class="p">,</span> <span class="n">getthreshop</span><span class="p">),</span> <span class="n">threshold</span><span class="p">,</span> <span class="s1">&#39;op_string&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Determine the median value of the TRs using the mask</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslstats</span> <span class="n">prefiltered_func_data_mcf</span> <span class="o">-</span><span class="n">k</span> <span class="n">mask</span> <span class="o">-</span><span class="n">p</span> <span class="mi">50</span>
<span class="mf">728.800232</span> <span class="p">(</span><span class="n">this</span> <span class="n">number</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">subject</span><span class="o">-</span><span class="mi">11</span> <span class="n">run</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">medianval</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageStats</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-k </span><span class="si">%s</span><span class="s1"> -p 50&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medianval&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;mask_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">motion_correct</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">medianval</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">medianval</span><span class="p">,</span> <span class="s1">&#39;mask_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Dilate the mask</p>
<p>The brain mask is “dilated” slightly before being used. Because it is normally important that masking be liberal (ie that there be little risk of cutting out valid brain voxels)</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">mask</span> <span class="o">-</span><span class="n">dilF</span> <span class="n">mask</span>
</pre></div>
</div>
<p>The output of <code class="docutils literal notranslate"><span class="pre">dilatemask</span></code> (i.e., <code class="docutils literal notranslate"><span class="pre">/srv/scratch/yc/fsl/hw2/level1/_subject_id_26/dilatemask/mapflow/_dilatemask0/sub-26_task-flanker_run-1_bold_dtype_mcf_bet_thresh_dil.nii.gz</span></code>) is equivalent to <code class="docutils literal notranslate"><span class="pre">mask.nii.gz</span></code> from FSL GUI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dilatemask</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_dil&#39;</span><span class="p">,</span> <span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-dilF&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dilatemask&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">dilatemask</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Mask the motion corrected functional runs with the dilated mask</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_mcf</span> <span class="o">-</span><span class="n">mas</span> <span class="n">mask</span> <span class="n">prefiltered_func_data_thresh</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maskfunc2</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_thresh&#39;</span><span class="p">,</span> <span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-mas&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;in_file2&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maskfunc2&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">motion_correct</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">maskfunc2</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dilatemask</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">maskfunc2</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="susan-noise-reduction">
<h3>SUSAN Noise Reduction<a class="headerlink" href="#susan-noise-reduction" title="Permalink to this heading">#</a></h3>
<p>Determine the mean image from each TR</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_thresh</span> <span class="o">-</span><span class="n">Tmean</span> <span class="n">mean_func</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meanfunc2</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-Tmean&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_mean&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;meanfunc2&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">maskfunc2</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">meanfunc2</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Merge the median values with the mean functional images into a coupled list</p>
<p>The output of this <code class="docutils literal notranslate"><span class="pre">merge</span></code> node will go into <code class="docutils literal notranslate"><span class="pre">susan</span></code> as <code class="docutils literal notranslate"><span class="pre">usans</span></code>,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># why here use node not mapnode?</span>
<span class="n">mergenode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;hstack&#39;</span><span class="p">),</span> 
                       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;merge&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">meanfunc2</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">mergenode</span><span class="p">,</span> <span class="s1">&#39;in1&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">medianval</span><span class="p">,</span> <span class="s1">&#39;out_stat&#39;</span><span class="p">,</span> <span class="n">mergenode</span><span class="p">,</span> <span class="s1">&#39;in2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Smooth each run using SUSAN with the brightness threshold set to 75% of the median value for each run and a mask constituting the mean functional</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="n">susan</span> <span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">bt</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dt</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dim</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">use_median</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">n_usans</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">usan1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">bt1</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">usan2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">bt2</span><span class="o">&gt;</span><span class="p">]]</span> <span class="o">&lt;</span><span class="n">output</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">bt</span><span class="o">&gt;</span> <span class="ow">is</span> <span class="n">brightness</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">should</span> <span class="n">be</span> <span class="n">greater</span> <span class="n">than</span> <span class="n">noise</span> <span class="n">level</span> <span class="ow">and</span> <span class="n">less</span> <span class="n">than</span> <span class="n">contrast</span> <span class="n">of</span> <span class="n">edges</span> <span class="n">to</span> <span class="n">be</span> <span class="n">preserved</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">dt</span><span class="o">&gt;</span> <span class="ow">is</span> <span class="n">spatial</span> <span class="n">size</span> <span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span> <span class="n">half</span><span class="o">-</span><span class="n">width</span><span class="p">)</span> <span class="n">of</span> <span class="n">smoothing</span><span class="p">,</span> <span class="ow">in</span> <span class="n">mm</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">dim</span><span class="o">&gt;</span> <span class="ow">is</span> <span class="n">dimensionality</span> <span class="p">(</span><span class="mi">2</span> <span class="ow">or</span> <span class="mi">3</span><span class="p">),</span> <span class="n">depending</span> <span class="n">on</span> <span class="n">whether</span> <span class="n">smoothing</span> <span class="ow">is</span> <span class="n">to</span> <span class="n">be</span> <span class="n">within</span><span class="o">-</span><span class="n">plane</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fully</span> <span class="mi">3</span><span class="n">D</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">use_median</span><span class="o">&gt;</span> <span class="n">determines</span> <span class="n">whether</span> <span class="n">to</span> <span class="n">use</span> <span class="n">a</span> <span class="n">local</span> <span class="n">median</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">cases</span> <span class="n">where</span> <span class="n">single</span><span class="o">-</span><span class="n">point</span> <span class="n">noise</span> <span class="ow">is</span> <span class="n">detected</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span>
<span class="o">&lt;</span><span class="n">n_usans</span><span class="o">&gt;</span> <span class="n">determines</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">smoothing</span> <span class="n">area</span> <span class="p">(</span><span class="n">USAN</span><span class="p">)</span> <span class="ow">is</span> <span class="n">to</span> <span class="n">be</span> <span class="n">found</span> <span class="kn">from</span> <span class="nn">secondary</span> <span class="n">images</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="ow">or</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span>
<span class="n">A</span> <span class="n">negative</span> <span class="n">value</span> <span class="k">for</span> <span class="nb">any</span> <span class="n">brightness</span> <span class="n">threshold</span> <span class="n">will</span> <span class="n">auto</span><span class="o">-</span><span class="nb">set</span> <span class="n">the</span> <span class="n">threshold</span> <span class="n">at</span> <span class="mi">10</span><span class="o">%</span> <span class="n">of</span> <span class="n">the</span> <span class="n">robust</span> <span class="nb">range</span>
</pre></div>
</div>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">susan</span> <span class="n">prefiltered_func_data_thresh</span> <span class="mf">546.600174</span> <span class="mf">2.12314225053</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">1</span> <span class="n">mean_func</span> <span class="mf">546.600174</span> <span class="n">prefiltered_func_data_smooth</span>
</pre></div>
</div>
<p><strong>Note:</strong></p>
<p>for <code class="docutils literal notranslate"><span class="pre">&lt;bt&gt;</span></code>, Nipype uses a different algorithm to calculate it -&gt; <code class="docutils literal notranslate"><span class="pre">float(fwhm)</span> <span class="pre">/</span> <span class="pre">np.sqrt(8</span> <span class="pre">*</span> <span class="pre">np.log(2))</span></code>. Therefore, to get <code class="docutils literal notranslate"><span class="pre">2.12314225053</span></code>, fwhm should be <code class="docutils literal notranslate"><span class="pre">4.9996179300001655</span></code> instead of <code class="docutils literal notranslate"><span class="pre">5</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fwhm_thr</span> <span class="o">=</span> <span class="mf">4.9996179300001655</span>

<span class="n">smooth</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">SUSAN</span><span class="p">(</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">fwhm_thr</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;smooth&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="s1">&#39;brightness_threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;usans&#39;</span><span class="p">])</span>

<span class="c1"># Define a function to get the brightness threshold for SUSAN</span>
<span class="k">def</span> <span class="nf">getbtthresh</span><span class="p">(</span><span class="n">medianvals</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">medianvals</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">getusans</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[[</span><span class="nb">tuple</span><span class="p">([</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]])]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">maskfunc2</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">smooth</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">medianval</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;out_stat&#39;</span><span class="p">,</span> <span class="n">getbtthresh</span><span class="p">),</span> <span class="n">smooth</span><span class="p">,</span>
                <span class="s1">&#39;brightness_threshold&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">mergenode</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">getusans</span><span class="p">),</span> <span class="n">smooth</span><span class="p">,</span> <span class="s1">&#39;usans&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Mask the smoothed data with the dilated mask</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_smooth</span> <span class="o">-</span><span class="n">mas</span> <span class="n">mask</span> <span class="n">prefiltered_func_data_smooth</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maskfunc3</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-mas&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maskfunc3&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;in_file2&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="s1">&#39;smoothed_file&#39;</span><span class="p">,</span> <span class="n">maskfunc3</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dilatemask</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">maskfunc3</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Scale each volume of the TR so that the median value of the TR is set to 10000</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_smooth</span> <span class="o">-</span><span class="n">mul</span> <span class="mf">13.7211811425</span> <span class="n">prefiltered_func_data_intnorm</span> 
<span class="p">(</span><span class="n">this</span> <span class="n">number</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">subject</span><span class="o">-</span><span class="mi">11</span> <span class="n">run</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intnorm</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_intnorm&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="s1">&#39;op_string&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;intnorm&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">maskfunc3</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">intnorm</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>

<span class="c1"># Define a function to get the scaling factor for intensity normalization</span>
<span class="k">def</span> <span class="nf">getinormscale</span><span class="p">(</span><span class="n">medianvals</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;-mul </span><span class="si">%.10f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">10000.</span> <span class="o">/</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">medianvals</span><span class="p">]</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">medianval</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;out_stat&#39;</span><span class="p">,</span> <span class="n">getinormscale</span><span class="p">),</span> <span class="n">intnorm</span><span class="p">,</span> <span class="s1">&#39;op_string&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="temporal-filtering">
<h3>Temporal Filtering<a class="headerlink" href="#temporal-filtering" title="Permalink to this heading">#</a></h3>
<p>Perform temporal highpass filtering on the data</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_intnorm</span> <span class="o">-</span><span class="n">Tmean</span> <span class="n">tempMean</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_intnorm</span> <span class="o">-</span><span class="n">bptf</span> <span class="mf">25.0</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">add</span> <span class="n">tempMean</span> <span class="n">prefiltered_func_data_tempfilt</span>
</pre></div>
</div>
<p>The output of <code class="docutils literal notranslate"><span class="pre">highpass</span></code> (i.e., <code class="docutils literal notranslate"><span class="pre">sub-11_task-flanker_run-1_bold_dtype_mcf_mask_smooth_mask_intnorm_tempfilt.nii.gz</span></code>) is equivalent to <code class="docutils literal notranslate"><span class="pre">filtered_func_data.nii.gz</span></code> from FSL GUI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a mean functional image from the scaled data and this mean func will be used in performing temporal highpass filtering</span>
<span class="n">meanfunc3</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-Tmean&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;meanfunc3&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">intnorm</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">meanfunc3</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform temporal highpass filtering on the data</span>
<span class="n">hpcutoff</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">TR</span> <span class="o">=</span> <span class="mf">2.</span>  <span class="c1"># ensure float</span>

<span class="n">highpass</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_tempfilt&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;highpass&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;op_string&#39;</span><span class="p">])</span>

<span class="c1"># 25 = (hpcutoff / 2*TR) not (hpcutoff / TR)</span>
<span class="k">def</span> <span class="nf">gethpstring</span><span class="p">(</span><span class="n">tempMean</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;-bptf 25 -1 -add </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tm</span><span class="p">)</span> <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">tempMean</span><span class="p">]</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">intnorm</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">highpass</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">meanfunc3</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span><span class="n">gethpstring</span><span class="p">),</span> <span class="n">highpass</span><span class="p">,</span> <span class="s1">&#39;op_string&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Generate a mean functional image from the functional run</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">prefiltered_func_data_tempfilt</span> <span class="n">filtered_func_data</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">filtered_func_data</span> <span class="o">-</span><span class="n">Tmean</span> <span class="n">mean_func</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meanfunc4</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-Tmean&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;_mean&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;meanfunc4&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">highpass</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">meanfunc4</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="first-level-glm">
<h2>First-Level GLM<a class="headerlink" href="#first-level-glm" title="Permalink to this heading">#</a></h2>
<section id="get-events">
<h3>Get events<a class="headerlink" href="#get-events" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subjinfo</span><span class="p">(</span><span class="n">events</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">nipype.interfaces.base</span> <span class="kn">import</span> <span class="n">Bunch</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

    <span class="n">subject_info</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">ev</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ev</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span><span class="n">ev</span><span class="p">[</span><span class="s1">&#39;correctness&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;correct&#39;</span><span class="p">]</span>
    <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;new_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev</span><span class="p">[</span><span class="s1">&#39;trial_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">run_info</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">onsets</span><span class="o">=</span><span class="p">[],</span> 
                     <span class="n">durations</span><span class="o">=</span><span class="p">[])</span>

    <span class="n">run_info</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ev</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;new_type&quot;</span><span class="p">)])</span>

    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">ev</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;new_type&quot;</span><span class="p">):</span>
        <span class="n">run_info</span><span class="o">.</span><span class="n">onsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">onset</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">run_info</span><span class="o">.</span><span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">subject_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run_info</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">subject_info</span>

<span class="n">get_sub_info</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">Function</span><span class="p">(</span>
        <span class="n">function</span><span class="o">=</span><span class="n">subjinfo</span><span class="p">,</span> <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">],</span> <span class="n">output_names</span><span class="o">=</span><span class="s2">&quot;subject_info&quot;</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;get_sub_info&quot;</span><span class="p">,</span> <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Connect to workflow</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_first</span><span class="p">,</span> <span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="n">get_sub_info</span><span class="p">,</span> <span class="s1">&#39;events&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-up-contrasts">
<h3>Set-up contrasts<a class="headerlink" href="#set-up-contrasts" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;congruent&quot;</span><span class="p">,</span> <span class="s2">&quot;incongruent&quot;</span><span class="p">]</span>

<span class="c1"># Activation Contrasts (similar to https://direct.mit.edu/jocn/article/23/10/3162/5327/Is-Morality-Unified-Evidence-that-Distinct-Neural)</span>
<span class="c1">## From FEAT: &quot;The correct way to tell whether two conditions are significantly different is to run a differential contrast like [1 -1] between them&quot;</span>
<span class="n">cont01</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;congruent&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">condition_names</span><span class="p">,</span>  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">cont02</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;incongruent&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">condition_names</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">cont03</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;congruent-incongruent&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">condition_names</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cont04</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;incongruent-congruent&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">condition_names</span><span class="p">,</span>  <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">contrast_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">cont01</span><span class="p">,</span>
    <span class="n">cont02</span><span class="p">,</span>
    <span class="n">cont03</span><span class="p">,</span>
    <span class="n">cont04</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TR</span> <span class="o">=</span> <span class="mf">2.0</span>  <span class="c1"># Repetition Time</span>
<span class="n">hpcutoff</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># highpass filter cutoff in seconds! </span>

<span class="n">modelspec</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">SpecifyModel</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;modelspec&quot;</span><span class="p">,</span> <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject_info&quot;</span><span class="p">,</span><span class="s2">&quot;functional_runs&quot;</span><span class="p">])</span>
<span class="n">modelspec</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">input_units</span> <span class="o">=</span> <span class="s2">&quot;secs&quot;</span>
<span class="n">modelspec</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">high_pass_filter_cutoff</span> <span class="o">=</span> <span class="n">hpcutoff</span>
<span class="n">modelspec</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">time_repetition</span> <span class="o">=</span> <span class="n">TR</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">get_sub_info</span><span class="p">,</span> <span class="s1">&#39;subject_info&#39;</span><span class="p">,</span> <span class="n">modelspec</span><span class="p">,</span><span class="s1">&#39;subject_info&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">highpass</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span><span class="n">modelspec</span><span class="p">,</span><span class="s1">&#39;functional_runs&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level1design</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">Level1Design</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;level1design&quot;</span><span class="p">,</span> <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;session_info&quot;</span><span class="p">])</span>
<span class="n">level1design</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">interscan_interval</span> <span class="o">=</span> <span class="n">TR</span>
<span class="c1"># Set HRF bases functions</span>
<span class="n">level1design</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">bases</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;derivs&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;gammasigma&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;gammadelay&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">}}</span>
<span class="n">level1design</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">model_serial_correlations</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">level1design</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">contrasts</span> <span class="o">=</span> <span class="n">contrast_list</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modelspec</span><span class="p">,</span><span class="s1">&#39;session_info&#39;</span><span class="p">,</span> <span class="n">level1design</span><span class="p">,</span> <span class="s1">&#39;session_info&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelgen</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">FEATModel</span><span class="p">(),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;modelgen&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fsf_file&#39;</span><span class="p">,</span> <span class="s1">&#39;ev_files&#39;</span><span class="p">])</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">level1design</span><span class="p">,</span> <span class="n">modelgen</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;fsf_files&#39;</span><span class="p">,</span> <span class="s1">&#39;fsf_file&#39;</span><span class="p">),</span> 
                                    <span class="p">(</span><span class="s1">&#39;ev_files&#39;</span><span class="p">,</span><span class="s1">&#39;ev_files&#39;</span><span class="p">)])])</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Corresponding fsl command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">film_gls</span> <span class="o">--</span><span class="ow">in</span><span class="o">=</span><span class="n">filtered_func_data</span> <span class="o">--</span><span class="n">rn</span><span class="o">=</span><span class="n">stats</span> <span class="o">--</span><span class="n">pd</span><span class="o">=</span><span class="n">design</span><span class="o">.</span><span class="n">mat</span> <span class="o">--</span><span class="n">thr</span><span class="o">=</span><span class="mf">1000.0</span> <span class="o">--</span><span class="n">sa</span> <span class="o">--</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span> <span class="o">--</span><span class="n">con</span><span class="o">=</span><span class="n">design</span><span class="o">.</span><span class="n">con</span>  

<span class="o">--</span><span class="n">thr</span><span class="p">:</span> <span class="n">threshold</span>
<span class="o">--</span><span class="n">sa</span><span class="p">:</span> <span class="n">smooth_autocorr</span>
<span class="o">--</span><span class="n">ms</span><span class="p">:</span> <span class="n">mask_size</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level1estimate</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">FILMGLS</span><span class="p">(</span><span class="n">smooth_autocorr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mask_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;level1estimate&#39;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;design_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="s1">&#39;tcon_file&#39;</span><span class="p">])</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
    <span class="p">(</span><span class="n">highpass</span><span class="p">,</span><span class="n">level1estimate</span><span class="p">,[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span><span class="s1">&#39;in_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">modelgen</span><span class="p">,</span><span class="n">level1estimate</span><span class="p">,[(</span><span class="s1">&#39;design_file&#39;</span><span class="p">,</span><span class="s1">&#39;design_file&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;con_file&#39;</span><span class="p">,</span><span class="s1">&#39;tcon_file&#39;</span><span class="p">)])</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>no need to use <code class="docutils literal notranslate"><span class="pre">ContrastMgr</span></code>,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">interface</span> <span class="n">mode</span> <span class="n">this</span> <span class="n">file</span> <span class="n">assumes</span> <span class="n">that</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">required</span> <span class="n">inputs</span> <span class="n">are</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">location</span><span class="o">.</span> <span class="n">This</span> <span class="n">has</span> <span class="n">deprecated</span> <span class="k">for</span> <span class="n">FSL</span> <span class="n">versions</span> <span class="mf">5.0.7</span><span class="o">+</span> <span class="k">as</span> <span class="n">the</span> <span class="n">necessary</span> <span class="n">corrections</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">generated</span> <span class="n">by</span> <span class="n">FILMGLS</span><span class="o">.</span>
</pre></div>
</div>
<p>see this <a class="reference external" href="https://nipype.readthedocs.io/en/latest/api/generated/nipype.interfaces.fsl.model.html#contrastmgr">link</a></p>
</section>
</section>
<section id="registration">
<h2>Registration<a class="headerlink" href="#registration" title="Permalink to this heading">#</a></h2>
<p>According to <a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FEAT/UserGuide#Higher-Level_FEAT_Output">FSL UserGuide</a>, the different sessions need to be <strong>registered</strong> to each other before any multi-session or multi-subject analyses can be carried out. Registration inside FEAT uses <code class="docutils literal notranslate"><span class="pre">FLIRT</span></code> and is a two-statge process:</p>
<ol class="arabic simple">
<li><p>An example FMRI low resolution image is registered to an example high resolution image (normally the same subject’s T1-weighted structural). The transformation for this is saved into the FEAT directory. Then the high res image is registered to a standard image (normally a T1-weighted image in standard space, such as the MNI 152 average image).</p></li>
<li><p>The two transformations are combined into a third, which will take the low resolution FMRI images (and the statistic images derived from the first-level analyses) straight into standard space, when applied later, during group analysis.</p></li>
</ol>
<section id="step-1">
<h3>Step 1<a class="headerlink" href="#step-1" title="Permalink to this heading">#</a></h3>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">flirt</span> <span class="o">-</span><span class="ow">in</span> <span class="n">example_func</span> <span class="o">-</span><span class="n">ref</span> <span class="n">standard</span> <span class="o">-</span><span class="n">out</span> <span class="n">example_func2standard</span> <span class="o">-</span><span class="n">omat</span> <span class="n">example_func2standard</span><span class="o">.</span><span class="n">mat</span> <span class="o">-</span><span class="n">cost</span> <span class="n">corratio</span> <span class="o">-</span><span class="n">dof</span> <span class="mi">12</span> <span class="o">-</span><span class="n">searchrx</span> <span class="o">-</span><span class="mi">90</span> <span class="mi">90</span> <span class="o">-</span><span class="n">searchry</span> <span class="o">-</span><span class="mi">90</span> <span class="mi">90</span> <span class="o">-</span><span class="n">searchrz</span> <span class="o">-</span><span class="mi">90</span> <span class="mi">90</span> <span class="o">-</span><span class="n">interp</span> <span class="n">trilinear</span> 

<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">convert_xfm</span> <span class="o">-</span><span class="n">inverse</span> <span class="o">-</span><span class="n">omat</span> <span class="n">standard2example_func</span><span class="o">.</span><span class="n">mat</span> <span class="n">example_func2standard</span><span class="o">.</span><span class="n">mat</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flt</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">FLIRT</span><span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="s1">&#39;corratio&#39;</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                                    <span class="n">searchr_x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span>
                                    <span class="n">searchr_y</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span>
                                    <span class="n">searchr_z</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span>
                                    <span class="n">interp</span> <span class="o">=</span> <span class="s1">&#39;trilinear&#39;</span><span class="p">),</span> 
               <span class="n">name</span><span class="o">=</span><span class="s1">&#39;example_func2standard&#39;</span><span class="p">,</span>
               <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>

<span class="n">flt</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">fsl</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">standard_image</span><span class="p">(</span><span class="s1">&#39;MNI152_T1_2mm_brain.nii.gz&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">extract_ref</span><span class="p">,</span> <span class="s1">&#39;roi_file&#39;</span><span class="p">,</span> <span class="n">flt</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>

<span class="n">convertxfm</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ConvertXFM</span><span class="p">(</span><span class="n">invert_xfm</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span> 
                         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;convertxfm&#39;</span><span class="p">,</span>
                         <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="s1">&#39;out_matrix_file&#39;</span><span class="p">,</span> <span class="n">convertxfm</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2">
<h3>Step 2<a class="headerlink" href="#step-2" title="Permalink to this heading">#</a></h3>
<p><strong>Corresponding fsl command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">flirt</span> <span class="o">-</span><span class="n">ref</span> <span class="n">reg</span><span class="o">/</span><span class="n">standard</span> <span class="o">-</span><span class="ow">in</span> <span class="n">stats</span><span class="o">/</span><span class="n">cope1</span> <span class="o">-</span><span class="n">out</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">yc</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="n">nipype_fsl_comp</span><span class="o">/</span><span class="n">gui</span><span class="o">/</span><span class="n">sub</span><span class="o">-</span><span class="mi">01</span><span class="o">/</span><span class="n">run1</span><span class="o">.</span><span class="n">feat</span><span class="o">/</span><span class="n">frgrot_chksugax</span> <span class="o">-</span><span class="n">applyxfm</span> <span class="o">-</span><span class="n">init</span> <span class="n">reg</span><span class="o">/</span><span class="n">example_func2standard</span><span class="o">.</span><span class="n">mat</span> <span class="o">-</span><span class="n">interp</span> <span class="n">trilinear</span> <span class="o">-</span><span class="n">datatype</span> <span class="nb">float</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">warp_files</span><span class="p">(</span><span class="n">copes</span><span class="p">,</span> <span class="n">varcopes</span><span class="p">,</span> <span class="n">masks</span><span class="p">,</span> <span class="n">mat</span><span class="p">):</span>
    <span class="c1"># need to reimport here, otherwise errors come out</span>
    <span class="kn">import</span> <span class="nn">nipype.interfaces.fsl</span> <span class="k">as</span> <span class="nn">fsl</span> 
    
    <span class="n">out_copes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out_varcopes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out_masks</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># register mask, same function, different parameters</span>
    <span class="n">warp_mask</span> <span class="o">=</span> <span class="n">fsl</span><span class="o">.</span><span class="n">FLIRT</span><span class="p">(</span><span class="n">apply_xfm</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                     <span class="n">interp</span> <span class="o">=</span> <span class="s1">&#39;nearestneighbour&#39;</span><span class="p">)</span>
    <span class="n">warp_mask</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">fsl</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">standard_image</span><span class="p">(</span><span class="s1">&#39;MNI152_T1_2mm_brain.nii.gz&#39;</span><span class="p">)</span>
    <span class="n">warp_mask</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_matrix_file</span> <span class="o">=</span> <span class="n">mat</span>
    <span class="n">warp_mask</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">output_type</span> <span class="o">=</span> <span class="s2">&quot;NIFTI_GZ&quot;</span>
    <span class="n">warp_mask</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="n">masks</span>
    <span class="n">res_mask</span> <span class="o">=</span> <span class="n">warp_mask</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">out_masks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res_mask</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">out_file</span><span class="p">))</span>
    
    <span class="c1"># register copes &amp; varcopes using same function, different parameters</span>
    <span class="n">warp</span> <span class="o">=</span> <span class="n">fsl</span><span class="o">.</span><span class="n">FLIRT</span><span class="p">(</span><span class="n">apply_xfm</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                     <span class="n">interp</span> <span class="o">=</span> <span class="s1">&#39;trilinear&#39;</span><span class="p">)</span>
    <span class="n">warp</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">fsl</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">standard_image</span><span class="p">(</span><span class="s1">&#39;MNI152_T1_2mm_brain.nii.gz&#39;</span><span class="p">)</span>
    <span class="n">warp</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_matrix_file</span> <span class="o">=</span> <span class="n">mat</span>
    <span class="n">warp</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">output_type</span> <span class="o">=</span> <span class="s2">&quot;NIFTI_GZ&quot;</span>
    
    <span class="c1"># register copes</span>
    <span class="k">for</span> <span class="n">cope</span> <span class="ow">in</span> <span class="n">copes</span><span class="p">:</span>
        <span class="n">warp</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="n">cope</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">warp</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">out_copes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">out_file</span><span class="p">))</span>
        
     <span class="c1"># register varcopes</span>
    <span class="k">for</span> <span class="n">varcope</span> <span class="ow">in</span> <span class="n">varcopes</span><span class="p">:</span>
        <span class="n">warp</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="n">varcope</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">warp</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">out_varcopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">out_file</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">out_copes</span><span class="p">,</span> <span class="n">out_varcopes</span><span class="p">,</span> <span class="n">out_masks</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">warpfunc</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;copes&#39;</span><span class="p">,</span> <span class="s1">&#39;varcopes&#39;</span><span class="p">,</span> <span class="s1">&#39;masks&#39;</span><span class="p">,</span> <span class="s1">&#39;mat&#39;</span><span class="p">],</span>
                                    <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out_copes&#39;</span><span class="p">,</span> <span class="s1">&#39;out_varcopes&#39;</span><span class="p">,</span> <span class="s1">&#39;out_masks&#39;</span><span class="p">],</span>
                                    <span class="n">function</span><span class="o">=</span><span class="n">warp_files</span><span class="p">),</span>
                      <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;copes&#39;</span><span class="p">,</span> <span class="s1">&#39;varcopes&#39;</span><span class="p">,</span> <span class="s1">&#39;masks&#39;</span><span class="p">,</span><span class="s1">&#39;mat&#39;</span><span class="p">],</span>
                      <span class="n">name</span><span class="o">=</span><span class="s1">&#39;warpfunc&#39;</span><span class="p">)</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">level1estimate</span><span class="p">,</span> <span class="s1">&#39;copes&#39;</span><span class="p">,</span> <span class="n">warpfunc</span><span class="p">,</span> <span class="s1">&#39;copes&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">level1estimate</span><span class="p">,</span> <span class="s1">&#39;varcopes&#39;</span><span class="p">,</span> <span class="n">warpfunc</span><span class="p">,</span> <span class="s1">&#39;varcopes&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dilatemask</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">warpfunc</span><span class="p">,</span> <span class="s1">&#39;masks&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="s1">&#39;out_matrix_file&#39;</span><span class="p">,</span> <span class="n">warpfunc</span><span class="p">,</span> <span class="s1">&#39;mat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save all results into single/separate folder for further analysis use</span>
<span class="n">datasink_first</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">nio</span><span class="o">.</span><span class="n">DataSink</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sinker&#39;</span><span class="p">)</span>
<span class="n">datasink_first</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_dir_first</span><span class="p">,</span> <span class="s2">&quot;level1_results&quot;</span><span class="p">)</span>

<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">infosource_first</span><span class="p">,</span> <span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">datasink_first</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">)</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">level1estimate</span><span class="p">,</span> <span class="n">datasink_first</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;results_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;results_dir&#39;</span><span class="p">)])])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">warpfunc</span><span class="p">,</span> <span class="n">datasink_first</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_copes&#39;</span><span class="p">,</span> <span class="s1">&#39;reg_copes&#39;</span><span class="p">)])])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">warpfunc</span><span class="p">,</span> <span class="n">datasink_first</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_varcopes&#39;</span><span class="p">,</span> <span class="s1">&#39;reg_varcopes&#39;</span><span class="p">)])])</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">warpfunc</span><span class="p">,</span> <span class="n">datasink_first</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_masks&#39;</span><span class="p">,</span> <span class="s1">&#39;reg_masks&#39;</span><span class="p">)])])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create 1st-level analysis output graph</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph2use</span><span class="o">=</span><span class="s1">&#39;colored&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">simple_form</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Visualize the graph</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wf_first</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">wf_first</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;graph.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:02:59,598 nipype.workflow INFO:
	 Generated workflow graph: /storage/tmp/tmpvxi51_fp/output_level1/level1/graph.png (graph2use=colored, simple_form=True).
</pre></div>
</div>
<img alt="_images/8010b4778b5ee347acd42069e3835ef642181453b86be90343c7c109230443d6.png" src="_images/8010b4778b5ee347acd42069e3835ef642181453b86be90343c7c109230443d6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;nipype.workflow&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#set to 1 if nipype output is wanted</span>
<span class="c1"># Run Workflow</span>
<span class="n">wf_first</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">plugin</span><span class="o">=</span><span class="s2">&quot;MultiProc&quot;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;n_procs&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:05,263 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:05,269 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float1&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:05,353 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:05,358 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float0&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_02/img2float/mapflow/_img2float0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:05,360 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:05,367 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float0&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:05,391 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:05,395 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float1&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_02/img2float/mapflow/_img2float1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:06,37 nipype.workflow ERROR:
	 Node _img2float0 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:06,41 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010306-ubuntu-_img2float0-74f54fba-9477-4ba8-bce2-a9d032db95d9.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float0/sub-01_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3617274 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float0/sub-01_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float0/sub-01_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:06,44 nipype.workflow ERROR:
	 Node _img2float1 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:06,45 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010306-ubuntu-_img2float1-15c1da2f-6cb6-4a6f-8dbf-82d050d485b4.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float1.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-01/func/sub-01_task-flanker_run-2_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float1/sub-01_task-flanker_run-2_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-01/func/sub-01_task-flanker_run-2_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-01/func/sub-01_task-flanker_run-2_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3617275 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float1/sub-01_task-flanker_run-2_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float1/sub-01_task-flanker_run-2_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:06,50 nipype.workflow ERROR:
	 Node _img2float0 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:06,51 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010306-ubuntu-_img2float0-5941653f-c70c-4cab-b24b-fa9bdc4ba501.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-02/func/sub-02_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_02/img2float/mapflow/_img2float0/sub-02_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-02/func/sub-02_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-02/func/sub-02_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3617280 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_02/img2float/mapflow/_img2float0/sub-02_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_02/img2float/mapflow/_img2float0/sub-02_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:06,55 nipype.workflow ERROR:
	 Node _img2float1 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:06,58 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010306-ubuntu-_img2float1-9c0d663e-7e9f-4d67-a834-3f62d1e9f9b4.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float1.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-02/func/sub-02_task-flanker_run-2_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_02/img2float/mapflow/_img2float1/sub-02_task-flanker_run-2_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-02/func/sub-02_task-flanker_run-2_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-02/func/sub-02_task-flanker_run-2_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3617277 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_02/img2float/mapflow/_img2float1/sub-02_task-flanker_run-2_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_02/img2float/mapflow/_img2float1/sub-02_task-flanker_run-2_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:07,189 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:07,194 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float0&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_04/img2float/mapflow/_img2float0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:07,246 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:07,251 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float1&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_04/img2float/mapflow/_img2float1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:07,294 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:07,300 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float1&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_03/img2float/mapflow/_img2float1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:07,301 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:07,308 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float0&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_03/img2float/mapflow/_img2float0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:08,43 nipype.workflow ERROR:
	 Node _img2float0 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:08,45 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010308-ubuntu-_img2float0-bde6f0f9-f930-46da-a139-6d840e5e41b0.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-03/func/sub-03_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_03/img2float/mapflow/_img2float0/sub-03_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-03/func/sub-03_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-03/func/sub-03_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3617750 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_03/img2float/mapflow/_img2float0/sub-03_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_03/img2float/mapflow/_img2float0/sub-03_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:08,51 nipype.workflow ERROR:
	 Node _img2float1 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:08,52 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010308-ubuntu-_img2float1-0d82be14-4e89-463c-a8ac-d90de08506ca.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float1.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-03/func/sub-03_task-flanker_run-2_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_03/img2float/mapflow/_img2float1/sub-03_task-flanker_run-2_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-03/func/sub-03_task-flanker_run-2_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-03/func/sub-03_task-flanker_run-2_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3617746 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_03/img2float/mapflow/_img2float1/sub-03_task-flanker_run-2_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_03/img2float/mapflow/_img2float1/sub-03_task-flanker_run-2_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:08,57 nipype.workflow ERROR:
	 Node _img2float0 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:08,59 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010308-ubuntu-_img2float0-6a0e078b-e107-41de-b88b-fca9d82ea6b1.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-04/func/sub-04_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_04/img2float/mapflow/_img2float0/sub-04_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-04/func/sub-04_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-04/func/sub-04_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3617762 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_04/img2float/mapflow/_img2float0/sub-04_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_04/img2float/mapflow/_img2float0/sub-04_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:08,64 nipype.workflow ERROR:
	 Node _img2float1 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:08,66 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010308-ubuntu-_img2float1-cfd29641-2143-4ce0-b90d-84f049023d8e.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float1.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-04/func/sub-04_task-flanker_run-2_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_04/img2float/mapflow/_img2float1/sub-04_task-flanker_run-2_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-04/func/sub-04_task-flanker_run-2_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-04/func/sub-04_task-flanker_run-2_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3617777 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_04/img2float/mapflow/_img2float1/sub-04_task-flanker_run-2_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_04/img2float/mapflow/_img2float1/sub-04_task-flanker_run-2_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:09,267 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:09,273 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float0&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_06/img2float/mapflow/_img2float0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:09,295 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:09,299 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float1&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_05/img2float/mapflow/_img2float1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:09,348 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:09,352 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float0&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_05/img2float/mapflow/_img2float0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:10,45 nipype.workflow ERROR:
	 Node _img2float0 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:10,47 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010310-ubuntu-_img2float0-a0262a56-ad3d-4c10-b6d7-5654d6f50dd4.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-05/func/sub-05_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_05/img2float/mapflow/_img2float0/sub-05_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-05/func/sub-05_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-05/func/sub-05_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618019 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_05/img2float/mapflow/_img2float0/sub-05_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_05/img2float/mapflow/_img2float0/sub-05_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:10,52 nipype.workflow ERROR:
	 Node _img2float1 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:10,54 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010310-ubuntu-_img2float1-8ffc7ceb-f151-40d8-bcd4-12b9db36bc02.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float1.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-05/func/sub-05_task-flanker_run-2_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_05/img2float/mapflow/_img2float1/sub-05_task-flanker_run-2_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-05/func/sub-05_task-flanker_run-2_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-05/func/sub-05_task-flanker_run-2_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618026 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_05/img2float/mapflow/_img2float1/sub-05_task-flanker_run-2_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_05/img2float/mapflow/_img2float1/sub-05_task-flanker_run-2_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:10,59 nipype.workflow ERROR:
	 Node _img2float0 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:10,70 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010310-ubuntu-_img2float0-4052a9a9-fa08-42e8-ac08-8ca80592f590.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-06/func/sub-06_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_06/img2float/mapflow/_img2float0/sub-06_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-06/func/sub-06_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-06/func/sub-06_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618024 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_06/img2float/mapflow/_img2float0/sub-06_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_06/img2float/mapflow/_img2float0/sub-06_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:11,72 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:11,80 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float1&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_07/img2float/mapflow/_img2float1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:11,93 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:11,98 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float1&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_06/img2float/mapflow/_img2float1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:11,214 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:11,218 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float0&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_07/img2float/mapflow/_img2float0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:12,47 nipype.workflow ERROR:
	 Node _img2float1 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:12,49 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010312-ubuntu-_img2float1-d57f81c1-f116-4f90-ada1-29d87d8604dc.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float1.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-06/func/sub-06_task-flanker_run-2_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_06/img2float/mapflow/_img2float1/sub-06_task-flanker_run-2_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-06/func/sub-06_task-flanker_run-2_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-06/func/sub-06_task-flanker_run-2_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618369 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_06/img2float/mapflow/_img2float1/sub-06_task-flanker_run-2_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_06/img2float/mapflow/_img2float1/sub-06_task-flanker_run-2_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:12,53 nipype.workflow ERROR:
	 Node _img2float0 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:12,55 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010312-ubuntu-_img2float0-0c740bc2-551a-439c-bc89-030c8bf98c45.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-07/func/sub-07_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_07/img2float/mapflow/_img2float0/sub-07_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-07/func/sub-07_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-07/func/sub-07_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618373 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_07/img2float/mapflow/_img2float0/sub-07_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_07/img2float/mapflow/_img2float0/sub-07_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:12,60 nipype.workflow ERROR:
	 Node _img2float1 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:12,63 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010312-ubuntu-_img2float1-16612859-313a-4c00-a9c5-c800089e2856.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float1.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-07/func/sub-07_task-flanker_run-2_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_07/img2float/mapflow/_img2float1/sub-07_task-flanker_run-2_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-07/func/sub-07_task-flanker_run-2_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-07/func/sub-07_task-flanker_run-2_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618374 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_07/img2float/mapflow/_img2float1/sub-07_task-flanker_run-2_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_07/img2float/mapflow/_img2float1/sub-07_task-flanker_run-2_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:13,504 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:13,508 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float1&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_09/img2float/mapflow/_img2float1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:13,660 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:13,665 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float0&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_08/img2float/mapflow/_img2float0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:13,758 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:13,764 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float0&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_09/img2float/mapflow/_img2float0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:13,790 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:13,794 nipype.workflow WARNING:
	 [Node] Error on &quot;_img2float1&quot; (/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_08/img2float/mapflow/_img2float1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:14,50 nipype.workflow ERROR:
	 Node _img2float0 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:14,55 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010314-ubuntu-_img2float0-64e30868-143c-4b8b-a390-ddee09e8523b.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-08/func/sub-08_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_08/img2float/mapflow/_img2float0/sub-08_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-08/func/sub-08_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-08/func/sub-08_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618571 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_08/img2float/mapflow/_img2float0/sub-08_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_08/img2float/mapflow/_img2float0/sub-08_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:14,58 nipype.workflow ERROR:
	 Node _img2float1 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:14,60 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010314-ubuntu-_img2float1-18007c07-6136-4c5a-bd5f-73003fb12e98.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float1.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-08/func/sub-08_task-flanker_run-2_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_08/img2float/mapflow/_img2float1/sub-08_task-flanker_run-2_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-08/func/sub-08_task-flanker_run-2_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-08/func/sub-08_task-flanker_run-2_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618586 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_08/img2float/mapflow/_img2float1/sub-08_task-flanker_run-2_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_08/img2float/mapflow/_img2float1/sub-08_task-flanker_run-2_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:14,65 nipype.workflow ERROR:
	 Node _img2float0 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:14,66 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010314-ubuntu-_img2float0-870861c0-bc8f-4a24-a6f8-3fcabde6334e.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-09/func/sub-09_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_09/img2float/mapflow/_img2float0/sub-09_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-09/func/sub-09_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-09/func/sub-09_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618579 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_09/img2float/mapflow/_img2float0/sub-09_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_09/img2float/mapflow/_img2float0/sub-09_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:14,71 nipype.workflow ERROR:
	 Node _img2float1 failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:14,72 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010314-ubuntu-_img2float1-5e0b8dc0-c48a-465a-b89c-18ce7d52cb7a.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float1.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-09/func/sub-09_task-flanker_run-2_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_09/img2float/mapflow/_img2float1/sub-09_task-flanker_run-2_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-09/func/sub-09_task-flanker_run-2_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-09/func/sub-09_task-flanker_run-2_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3618595 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_09/img2float/mapflow/_img2float1/sub-09_task-flanker_run-2_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_09/img2float/mapflow/_img2float1/sub-09_task-flanker_run-2_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,49 nipype.workflow ERROR:
	 could not run node: level1.img2float.b0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,52 nipype.workflow ERROR:
	 could not run node: level1.img2float.b0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,53 nipype.workflow ERROR:
	 could not run node: level1.img2float.b1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,57 nipype.workflow ERROR:
	 could not run node: level1.img2float.b1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,58 nipype.workflow ERROR:
	 could not run node: level1.img2float.b2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,62 nipype.workflow ERROR:
	 could not run node: level1.img2float.b2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,64 nipype.workflow ERROR:
	 could not run node: level1.img2float.b3
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,65 nipype.workflow ERROR:
	 could not run node: level1.img2float.b3
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,66 nipype.workflow ERROR:
	 could not run node: level1.img2float.b4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,74 nipype.workflow ERROR:
	 could not run node: level1.img2float.b4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,75 nipype.workflow ERROR:
	 could not run node: level1.img2float.b5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,76 nipype.workflow ERROR:
	 could not run node: level1.img2float.b5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,77 nipype.workflow ERROR:
	 could not run node: level1.img2float.b6
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,78 nipype.workflow ERROR:
	 could not run node: level1.img2float.b6
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,80 nipype.workflow ERROR:
	 could not run node: level1.img2float.b7
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,81 nipype.workflow ERROR:
	 could not run node: level1.img2float.b7
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,87 nipype.workflow ERROR:
	 could not run node: level1.img2float.b8
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:20,89 nipype.workflow ERROR:
	 could not run node: level1.img2float.b8
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
RuntimeError: Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node _img2float0.

Cmdline:
	fslmaths /storage/tmp/tmpvxi51_fp/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz  /storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float0/sub-01_task-flanker_run-1_bold_dtype.nii.gz -odt float
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpvxi51_fp/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fslmaths: line 3: 3617274 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.5.1_20221016/fsl_6.0.5.1_20221016.simg fslmaths &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;out_file&#39; trait of an ImageMathsOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float0/sub-01_task-flanker_run-1_bold_dtype.nii.gz&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1/_subject_id_01/img2float/mapflow/_img2float0/sub-01_task-flanker_run-1_bold_dtype.nii.gz&#39; for output &#39;out_file&#39; of a ImageMaths interface



The above exception was the direct cause of the following exception:

RuntimeError                              Traceback (most recent call last)
Cell In[45], line 4
      2 logging.getLogger(&#39;nipype.workflow&#39;).setLevel(0) #set to 1 if nipype output is wanted
      3 # Run Workflow
----&gt; 4 wf_first.run(plugin=&quot;MultiProc&quot;, plugin_args={&quot;n_procs&quot;: 8})

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/workflows.py:638, in Workflow.run(self, plugin, plugin_args, updatehash)
    636 if str2bool(self.config[&quot;execution&quot;][&quot;create_report&quot;]):
    637     self._write_report_info(self.base_dir, self.name, execgraph)
--&gt; 638 runner.run(execgraph, updatehash=updatehash, config=self.config)
    639 datestr = datetime.utcnow().strftime(&quot;%Y%m%dT%H%M%S&quot;)
    640 if str2bool(self.config[&quot;execution&quot;][&quot;write_provenance&quot;]):

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/base.py:224, in DistributedPluginBase.run(self, graph, config, updatehash)
    218 if len(errors) &gt; 1:
    219     error, cause = (
    220         RuntimeError(f&quot;{len(errors)} raised. Re-raising first.&quot;),
    221         error,
    222     )
--&gt; 224 raise error from cause

RuntimeError: 18 raised. Re-raising first.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="the-first-level-glm">
<h2>The first-level GLM<a class="headerlink" href="#the-first-level-glm" title="Permalink to this heading">#</a></h2>
<p>Here we randomly choose the four copes from subject-09 run-1</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fsaverage</span> <span class="o">=</span> <span class="n">nilearn</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">fetch_surf_fsaverage</span><span class="p">()</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nipype_cope1</span> <span class="o">=</span> <span class="s1">&#39;./output_level1/level1_results/09/results_dir/_subject_id_09/_level1estimate0/results/cope1.nii.gz&#39;</span>
<span class="n">nipype_cope2</span> <span class="o">=</span> <span class="s1">&#39;./output_level1/level1_results/09/results_dir/_subject_id_09/_level1estimate0/results/cope2.nii.gz&#39;</span>
<span class="n">nipype_cope3</span> <span class="o">=</span> <span class="s1">&#39;./output_level1/level1_results/09/results_dir/_subject_id_09/_level1estimate0/results/cope3.nii.gz&#39;</span>
<span class="n">nipype_cope4</span> <span class="o">=</span> <span class="s1">&#39;./output_level1/level1_results/09/results_dir/_subject_id_09/_level1estimate0/results/cope4.nii.gz&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE1&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE2&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE3&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope4</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE4&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">48</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE1&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE2&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/plotting/img_plotting.py:972,</span> in <span class="ni">plot_stat_map</span><span class="nt">(stat_map_img, bg_img, cut_coords, output_file, display_mode, colorbar, cbar_tick_format, figure, axes, title, threshold, annotate, draw_cross, black_bg, cmap, symmetric_cbar, dim, vmin, vmax, radiological, resampling_interpolation, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">910</span> <span class="sd">&quot;&quot;&quot;Plot cuts of an ROI/mask image.</span>
<span class="g g-Whitespace">    </span><span class="mi">911</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">912</span><span class="sd"> By default 3 cuts: Frontal, Axial, and Lateral.</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">969</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">970</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">971</span> <span class="c1"># dim the background</span>
<span class="ne">--&gt; </span><span class="mi">972</span> <span class="n">bg_img</span><span class="p">,</span> <span class="n">black_bg</span><span class="p">,</span> <span class="n">bg_vmin</span><span class="p">,</span> <span class="n">bg_vmax</span> <span class="o">=</span> <span class="n">_load_anat</span><span class="p">(</span><span class="n">bg_img</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">973</span>                                                 <span class="n">black_bg</span><span class="o">=</span><span class="n">black_bg</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">975</span> <span class="n">stat_map_img</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">check_niimg_3d</span><span class="p">(</span><span class="n">stat_map_img</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">977</span> <span class="n">cbar_vmin</span><span class="p">,</span> <span class="n">cbar_vmax</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">_get_colorbar_and_data_ranges</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">978</span>     <span class="n">_safe_get_data</span><span class="p">(</span><span class="n">stat_map_img</span><span class="p">,</span> <span class="n">ensure_finite</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">979</span>     <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">980</span>     <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">981</span>     <span class="n">symmetric_cbar</span><span class="o">=</span><span class="n">symmetric_cbar</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/plotting/img_plotting.py:403,</span> in <span class="ni">_load_anat</span><span class="nt">(anat_img, dim, black_bg)</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span>         <span class="n">black_bg</span> <span class="o">=</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">403</span>     <span class="n">anat_img</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">check_niimg_3d</span><span class="p">(</span><span class="n">anat_img</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span>     <span class="c1"># Clean anat_img for non-finite values to avoid computing unnecessary</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="c1"># border data values.</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>     <span class="n">data</span> <span class="o">=</span> <span class="n">_safe_get_data</span><span class="p">(</span><span class="n">anat_img</span><span class="p">,</span> <span class="n">ensure_finite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/_utils/niimg_conversions.py:374,</span> in <span class="ni">check_niimg_3d</span><span class="nt">(niimg, dtype)</span>
<span class="g g-Whitespace">    </span><span class="mi">340</span> <span class="k">def</span> <span class="nf">check_niimg_3d</span><span class="p">(</span><span class="n">niimg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span>     <span class="sd">&quot;&quot;&quot;Check that niimg is a proper 3D niimg-like object and load it.</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">343</span><span class="sd">     Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">372</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">373</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">374</span>     <span class="k">return</span> <span class="n">check_niimg</span><span class="p">(</span><span class="n">niimg</span><span class="p">,</span> <span class="n">ensure_ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/_utils/niimg_conversions.py:306,</span> in <span class="ni">check_niimg</span><span class="nt">(niimg, ensure_ndim, atleast_4d, dtype, return_iterator, wildcards)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">306</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">niimg</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="ne">ValueError</span>: File not found: &#39;./output_level1/level1_results/09/results_dir/_subject_id_09/_level1estimate0/results/cope1.nii.gz&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="second-level-glm-using-nipype-fsl">
<h1>Second level GLM using Nipype FSL<a class="headerlink" href="#second-level-glm-using-nipype-fsl" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;level2&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">exp_dir_second</span><span class="p">)</span>
<span class="n">wf_second</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;crashfile_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>The following two nodes (<code class="docutils literal notranslate"><span class="pre">infosource</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">dg</span></code>) together define all inputs required for the preprocessing workflow</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we want to group the outcome by contrast not subject</span>
<span class="n">contr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">infosource_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;contr_id&quot;</span><span class="p">]),</span>
                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;infosource_second&quot;</span><span class="p">)</span>
<span class="n">infosource_second</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;contr_id&quot;</span><span class="p">,</span> <span class="n">contr_list</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># here we use SelectFiles, instead of DataGrabber, because the former is more flexible with formatting syntax</span>
<span class="n">templates_second</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;reg_copes&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_copes/*/*/cope</span><span class="si">{contr_id}</span><span class="s2">_flirt.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reg_varcopes&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_varcopes/*/*/varcope</span><span class="si">{contr_id}</span><span class="s2">_flirt.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reg_masks&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_masks/*/*/*.nii.gz&quot;</span>
<span class="p">}</span>
<span class="n">dg_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">nio</span><span class="o">.</span><span class="n">SelectFiles</span><span class="p">(</span><span class="n">templates_second</span><span class="p">),</span>
             <span class="n">name</span><span class="o">=</span><span class="s2">&quot;selectfiles_second&quot;</span><span class="p">)</span>
<span class="n">dg_second</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">data_dir_second</span>

<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
        <span class="p">(</span><span class="n">infosource_second</span><span class="p">,</span> <span class="n">dg_second</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;contr_id&quot;</span><span class="p">,</span> <span class="s2">&quot;contr_id&quot;</span><span class="p">)])</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TraitError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">51</span><span class="p">],</span> <span class="n">line</span> <span class="mi">9</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">templates_second</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="s2">&quot;reg_copes&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_copes/*/*/cope</span><span class="si">{contr_id}</span><span class="s2">_flirt.nii.gz&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s2">&quot;reg_varcopes&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_varcopes/*/*/varcope</span><span class="si">{contr_id}</span><span class="s2">_flirt.nii.gz&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="s2">&quot;reg_masks&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_masks/*/*/*.nii.gz&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">}</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">dg_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">nio</span><span class="o">.</span><span class="n">SelectFiles</span><span class="p">(</span><span class="n">templates_second</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;selectfiles_second&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="n">dg_second</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">data_dir_second</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>         <span class="p">(</span><span class="n">infosource_second</span><span class="p">,</span> <span class="n">dg_second</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;contr_id&quot;</span><span class="p">,</span> <span class="s2">&quot;contr_id&quot;</span><span class="p">)])</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">])</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py:135,</span> in <span class="ni">BasePath.validate</span><span class="nt">(self, objekt, name, value, return_pathlike)</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">135</span>         <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">objekt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span>         <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">objekt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/traits/base_trait_handler.py:74,</span> in <span class="ni">BaseTraitHandler.error</span><span class="nt">(self, object, name, value)</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>     <span class="sd">&quot;&quot;&quot;Raises a TraitError exception.</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">60</span><span class="sd">     This method is called by the validate() method when an assigned value</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="sd">         The proposed new value for the attribute.</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">74</span>     <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span>         <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_info</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span>     <span class="p">)</span>

<span class="ne">TraitError</span>: The &#39;base_directory&#39; trait of a SelectFilesInputSpec instance must be a pathlike object or string representing an existing directory, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level1/level1_results&#39; &lt;class &#39;str&#39;&gt; was specified.
</pre></div>
</div>
</div>
</div>
<section id="second-level-glm">
<h2>Second-level GLM<a class="headerlink" href="#second-level-glm" title="Permalink to this heading">#</a></h2>
<p>Combining results from multiple runs of one subject into one</p>
<section id="higher-level-input-files-preparation">
<h3>Higher-level input files preparation<a class="headerlink" href="#higher-level-input-files-preparation" title="Permalink to this heading">#</a></h3>
<section id="step-1-merge-registered-copes-varcopes-masks">
<h4>Step 1: Merge registered copes &amp; varcopes &amp; masks<a class="headerlink" href="#step-1-merge-registered-copes-varcopes-masks" title="Permalink to this heading">#</a></h4>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmerge</span> <span class="o">-</span><span class="n">t</span> <span class="n">mask</span> <span class="p">(</span><span class="n">masks</span> <span class="kn">from</span> <span class="nn">all</span> <span class="mi">52</span> <span class="n">inputs</span><span class="p">)</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmerge</span> <span class="o">-</span><span class="n">t</span> <span class="n">cope</span> <span class="p">(</span><span class="n">copes</span> <span class="kn">from</span> <span class="nn">all</span> <span class="mi">52</span> <span class="n">inputs</span><span class="p">)</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmerge</span> <span class="o">-</span><span class="n">t</span> <span class="n">varcop</span> <span class="p">(</span><span class="n">varcopes</span> <span class="kn">from</span> <span class="nn">all</span> <span class="mi">52</span> <span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">copemerge_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_files&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;copemerge_second&quot;</span><span class="p">)</span>

<span class="n">varcopemerge_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_files&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;varcopemerge_second&quot;</span><span class="p">)</span>

<span class="n">maskmerge_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_files&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;maskmerge_second&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">sort_copes</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="n">numelements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">outfiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numelements</span><span class="p">):</span>
        <span class="n">outfiles</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="n">outfiles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">outfiles</span>

<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_second</span><span class="p">,</span> <span class="s1">&#39;reg_varcopes&#39;</span><span class="p">,</span> <span class="n">varcopemerge_second</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_second</span><span class="p">,</span> <span class="s1">&#39;reg_copes&#39;</span><span class="p">,</span> <span class="n">copemerge_second</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_second</span><span class="p">,</span> <span class="s1">&#39;reg_masks&#39;</span><span class="p">,</span> <span class="n">maskmerge_second</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-making-mask">
<h4>Step 2: Making mask<a class="headerlink" href="#step-2-making-mask" title="Permalink to this heading">#</a></h4>
<p>In FSL, there are many commands about <code class="docutils literal notranslate"><span class="pre">maskunique</span></code>, which is unless for the second level. We can ignore it.</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">mask</span> <span class="o">-</span><span class="n">Tmin</span> <span class="n">mask</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">minmask_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-Tmin&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;minmask_second&#39;</span><span class="p">)</span>

<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">maskmerge_second</span><span class="p">,</span> <span class="s1">&#39;merged_file&#39;</span><span class="p">,</span> <span class="n">minmask_second</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-3-masking-copes-varcopes">
<h4>Step 3: Masking copes &amp; varcopes<a class="headerlink" href="#step-3-masking-copes-varcopes" title="Permalink to this heading">#</a></h4>
<p><strong>Corresponding FSL command:</strong></p>
<p>we have four contrasts so the following commands repeat four times</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">cope1</span> <span class="o">-</span><span class="n">mas</span> <span class="n">mask</span> <span class="n">cope1</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">varcope1</span> <span class="o">-</span><span class="n">mas</span> <span class="n">mask</span> <span class="n">varcope1</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maskcope_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-mas&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maskcope_second&#39;</span><span class="p">)</span>

<span class="n">maskvarcope_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-mas&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maskvarcope_second&#39;</span><span class="p">)</span>

<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">copemerge_second</span><span class="p">,</span> <span class="s1">&#39;merged_file&#39;</span><span class="p">,</span> <span class="n">maskcope_second</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">minmask_second</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">maskcope_second</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">)</span>
<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">varcopemerge_second</span><span class="p">,</span> <span class="s1">&#39;merged_file&#39;</span><span class="p">,</span> <span class="n">maskvarcope_second</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">minmask_second</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">maskvarcope_second</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="set-up-second-level-contrasts-and-fixed-effects">
<h3>Set up second-level contrasts and fixed-effects<a class="headerlink" href="#set-up-second-level-contrasts-and-fixed-effects" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_contrasts_l2</span><span class="p">(</span><span class="n">in_files</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">glob</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">in_files</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">in_files</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>
    <span class="n">n_sub</span> <span class="o">=</span> <span class="mi">9</span>  
    <span class="c1"># n_sub = 26</span>
    <span class="n">ev_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ev&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_sub</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">weight_mtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_sub</span><span class="p">,</span><span class="n">n_sub</span><span class="p">))</span>
    <span class="n">weight_mtx</span> <span class="o">=</span> <span class="n">weight_mtx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">weight_mtx</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
    <span class="c1">#contr = [&#39;&#39;,&#39;T&#39;,ev_list,list(weight_mtx[0])] --&gt; original paper</span>
    <span class="n">contr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">ev_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">weight_mtx</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span> <span class="c1">#adaptation so the construction of the array works</span>
    <span class="n">contr_lst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">contr</span><span class="p">,</span> <span class="p">(</span><span class="n">n_sub</span><span class="p">,</span><span class="n">n_sub</span><span class="p">))</span>
    <span class="n">contr_lst</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">contr_lst</span><span class="p">]</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sub</span><span class="p">):</span>
        <span class="c1"># Instead of trying to change the tuple, create a new tuple with the changed value.</span>
        <span class="n">contr_lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">contr_lst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">contr_lst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">contr_lst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">weight_mtx</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">reg_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="kc">None</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ev_list</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">reg_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">start_lst</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">total</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">ev_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">start_lst</span><span class="p">[</span><span class="n">start_idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">start_lst</span><span class="p">[</span><span class="n">end_idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">reg_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_lst</span>    
    <span class="k">return</span> <span class="n">contr_lst</span><span class="p">,</span> <span class="n">reg_dict</span>

<span class="n">contrastgen_l2</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_files&#39;</span><span class="p">],</span>
                                    <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;contr_lst&#39;</span><span class="p">,</span> <span class="s1">&#39;reg_dict&#39;</span><span class="p">],</span>
                                    <span class="n">function</span><span class="o">=</span><span class="n">get_contrasts_l2</span><span class="p">),</span>
                      <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_files&#39;</span><span class="p">],</span>
                      <span class="n">name</span><span class="o">=</span><span class="s1">&#39;contrastgen_l2&#39;</span><span class="p">)</span>

<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_second</span><span class="p">,</span><span class="s1">&#39;reg_copes&#39;</span><span class="p">,</span> <span class="n">contrastgen_l2</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Nipype recommends using <a class="reference external" href="https://nipype.readthedocs.io/en/latest/api/generated/nipype.interfaces.fsl.model.html#l2model">L2Model</a>, which only works for the single subject. It takes the number of runs (copes at the first level) as input and does estimations for subject one by one.
Instead, we use <a class="reference external" href="https://nipype.readthedocs.io/en/latest/api/generated/nipype.interfaces.fsl.model.html#multipleregressdesign">MultipleRegressDesign</a>. As it’s name indicates, this one can deal with multiple predictors (subjects) at the same time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level2model</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">MultipleRegressDesign</span><span class="p">(),</span>
                      <span class="n">name</span><span class="o">=</span><span class="s1">&#39;l2model&#39;</span><span class="p">)</span>

<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">contrastgen_l2</span><span class="p">,</span> <span class="n">level2model</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;contr_lst&#39;</span><span class="p">,</span><span class="s1">&#39;contrasts&#39;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s1">&#39;reg_dict&#39;</span><span class="p">,</span><span class="s1">&#39;regressors&#39;</span><span class="p">)])])</span>

<span class="n">level2estimate</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">FLAMEO</span><span class="p">(</span><span class="n">run_mode</span><span class="o">=</span><span class="s1">&#39;fe&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;level2estimate&quot;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cope_file&#39;</span><span class="p">,</span> <span class="s1">&#39;var_cope_file&#39;</span><span class="p">])</span>

<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
    <span class="p">(</span><span class="n">maskcope_second</span><span class="p">,</span> <span class="n">level2estimate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;cope_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">maskvarcope_second</span><span class="p">,</span> <span class="n">level2estimate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;var_cope_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">minmask_second</span><span class="p">,</span> <span class="n">level2estimate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;mask_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">level2model</span><span class="p">,</span> <span class="n">level2estimate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;design_mat&#39;</span><span class="p">,</span> <span class="s1">&#39;design_file&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;design_con&#39;</span><span class="p">,</span> <span class="s1">&#39;t_con_file&#39;</span><span class="p">),</span> 
                                   <span class="p">(</span><span class="s1">&#39;design_grp&#39;</span><span class="p">,</span> <span class="s1">&#39;cov_split_file&#39;</span><span class="p">)]),</span>
<span class="p">])</span>

<span class="n">datasink_second</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">nio</span><span class="o">.</span><span class="n">DataSink</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sinker&#39;</span><span class="p">)</span>
<span class="n">datasink_second</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_dir_second</span><span class="p">,</span> <span class="s2">&quot;level2_results&quot;</span><span class="p">)</span>

<span class="n">int2string</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;contrast_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">infosource_second</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;contr_id&#39;</span><span class="p">,</span><span class="n">int2string</span><span class="p">),</span> <span class="n">datasink_second</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">)</span>
<span class="n">wf_second</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">level2estimate</span><span class="p">,</span> <span class="n">datasink_second</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;stats_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;stats_dir&#39;</span><span class="p">)])])</span>

<span class="c1"># Create 1st-level analysis output graph</span>
<span class="n">wf_second</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph2use</span><span class="o">=</span><span class="s1">&#39;colored&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">simple_form</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Visualize the graph</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wf_second</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">wf_second</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;graph.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6ef2bf35830c66d625ecd51ab5af4933b1c752516909330d101493bdc2d4b5b4.png" src="_images/6ef2bf35830c66d625ecd51ab5af4933b1c752516909330d101493bdc2d4b5b4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Workflow</span>
<span class="n">wf_second</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">plugin</span><span class="o">=</span><span class="s2">&quot;MultiProc&quot;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;n_procs&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:22,374 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:22,396 nipype.workflow WARNING:
	 [Node] Error on &quot;level2.selectfiles_second&quot; (/storage/tmp/tmpvxi51_fp/output_level2/level2/selectfiles_second)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:23,927 nipype.workflow ERROR:
	 Node selectfiles_second failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:23,933 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010323-ubuntu-selectfiles_second-8bd208cf-3b9a-4e5e-846e-fbaf89afdd1b.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node selectfiles_second.

Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 429, in aggregate_outputs
	    predicted_outputs = self._list_outputs()  # Predictions from _list_outputs
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/io.py&quot;, line 1469, in _list_outputs
	    raise IOError(msg)
	OSError: No files were found matching reg_copes template: /storage/tmp/tmpvxi51_fp/output_level2/level2/selectfiles_second/*/reg_copes/*/*/cope&lt;undefined&gt;_flirt.nii.gz
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:25,915 nipype.workflow ERROR:
	 could not run node: level2.selectfiles_second
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">57</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Run Workflow</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">wf_second</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">plugin</span><span class="o">=</span><span class="s2">&quot;MultiProc&quot;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;n_procs&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/workflows.py:638,</span> in <span class="ni">Workflow.run</span><span class="nt">(self, plugin, plugin_args, updatehash)</span>
<span class="g g-Whitespace">    </span><span class="mi">636</span> <span class="k">if</span> <span class="n">str2bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;create_report&quot;</span><span class="p">]):</span>
<span class="g g-Whitespace">    </span><span class="mi">637</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_write_report_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">execgraph</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">638</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">execgraph</span><span class="p">,</span> <span class="n">updatehash</span><span class="o">=</span><span class="n">updatehash</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">639</span> <span class="n">datestr</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">640</span> <span class="k">if</span> <span class="n">str2bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;write_provenance&quot;</span><span class="p">]):</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/base.py:224,</span> in <span class="ni">DistributedPluginBase.run</span><span class="nt">(self, graph, config, updatehash)</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>     <span class="n">error</span><span class="p">,</span> <span class="n">cause</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>         <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> raised. Re-raising first.&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>         <span class="n">error</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">224</span> <span class="k">raise</span> <span class="n">error</span> <span class="kn">from</span> <span class="nn">cause</span>

<span class="ne">RuntimeError</span>: Traceback (most recent call last):
  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">67</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run_node</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">updatehash</span><span class="o">=</span><span class="n">updatehash</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">527</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_interface</span><span class="p">(</span><span class="n">execute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">645</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_run_interface</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_command</span><span class="p">(</span><span class="n">execute</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">771</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_run_command</span>
    <span class="k">raise</span> <span class="n">NodeExecutionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="n">nipype</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">NodeExecutionError</span><span class="p">:</span> <span class="ne">Exception</span> <span class="n">raised</span> <span class="k">while</span> <span class="n">executing</span> <span class="n">Node</span> <span class="n">selectfiles_second</span><span class="o">.</span>

<span class="ne">Traceback</span>:
	<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
	  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">400</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
	    <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_outputs</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>
	  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">429</span><span class="p">,</span> <span class="ow">in</span> <span class="n">aggregate_outputs</span>
	    <span class="n">predicted_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_outputs</span><span class="p">()</span>  <span class="c1"># Predictions from _list_outputs</span>
	  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/io.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1469</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_list_outputs</span>
	    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
	<span class="ne">OSError</span><span class="p">:</span> <span class="n">No</span> <span class="n">files</span> <span class="n">were</span> <span class="n">found</span> <span class="n">matching</span> <span class="n">reg_copes</span> <span class="n">template</span><span class="p">:</span> <span class="o">/</span><span class="n">storage</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">tmpvxi51_fp</span><span class="o">/</span><span class="n">output_level2</span><span class="o">/</span><span class="n">level2</span><span class="o">/</span><span class="n">selectfiles_second</span><span class="o">/*/</span><span class="n">reg_copes</span><span class="o">/*/*/</span><span class="n">cope</span><span class="o">&lt;</span><span class="n">undefined</span><span class="o">&gt;</span><span class="n">_flirt</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="the-second-level-glm">
<h2>The second-level GLM<a class="headerlink" href="#the-second-level-glm" title="Permalink to this heading">#</a></h2>
<p>Here we choose the four copes from subject-01</p>
<section id="regapply">
<h3>Regapply<a class="headerlink" href="#regapply" title="Permalink to this heading">#</a></h3>
<p>This happens before the second-level GLM, all results from the first level are needed to be registered into the standard space</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nipype_cope1</span> <span class="o">=</span> <span class="s1">&#39;./output_level1/level1_results/01/reg_copes/_subject_id_01/_warpfunc1/cope1_flirt.nii.gz&#39;</span>
<span class="n">nipype_cope2</span> <span class="o">=</span> <span class="s1">&#39;./output_level1/level1_results/01/reg_copes/_subject_id_01/_warpfunc1/cope2_flirt.nii.gz&#39;</span>
<span class="n">nipype_cope3</span> <span class="o">=</span> <span class="s1">&#39;./output_level1/level1_results/01/reg_copes/_subject_id_01/_warpfunc1/cope3_flirt.nii.gz&#39;</span>
<span class="n">nipype_cope4</span> <span class="o">=</span> <span class="s1">&#39;./output_level1/level1_results/01/reg_copes/_subject_id_01/_warpfunc1/cope4_flirt.nii.gz&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE1&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE2&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE3&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope4</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope4</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE4&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">59</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE1&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE2&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_stat_map</span><span class="p">(</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE3&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/plotting/img_plotting.py:972,</span> in <span class="ni">plot_stat_map</span><span class="nt">(stat_map_img, bg_img, cut_coords, output_file, display_mode, colorbar, cbar_tick_format, figure, axes, title, threshold, annotate, draw_cross, black_bg, cmap, symmetric_cbar, dim, vmin, vmax, radiological, resampling_interpolation, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">910</span> <span class="sd">&quot;&quot;&quot;Plot cuts of an ROI/mask image.</span>
<span class="g g-Whitespace">    </span><span class="mi">911</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">912</span><span class="sd"> By default 3 cuts: Frontal, Axial, and Lateral.</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">969</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">970</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">971</span> <span class="c1"># dim the background</span>
<span class="ne">--&gt; </span><span class="mi">972</span> <span class="n">bg_img</span><span class="p">,</span> <span class="n">black_bg</span><span class="p">,</span> <span class="n">bg_vmin</span><span class="p">,</span> <span class="n">bg_vmax</span> <span class="o">=</span> <span class="n">_load_anat</span><span class="p">(</span><span class="n">bg_img</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">973</span>                                                 <span class="n">black_bg</span><span class="o">=</span><span class="n">black_bg</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">975</span> <span class="n">stat_map_img</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">check_niimg_3d</span><span class="p">(</span><span class="n">stat_map_img</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">977</span> <span class="n">cbar_vmin</span><span class="p">,</span> <span class="n">cbar_vmax</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">_get_colorbar_and_data_ranges</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">978</span>     <span class="n">_safe_get_data</span><span class="p">(</span><span class="n">stat_map_img</span><span class="p">,</span> <span class="n">ensure_finite</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">979</span>     <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">980</span>     <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">981</span>     <span class="n">symmetric_cbar</span><span class="o">=</span><span class="n">symmetric_cbar</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/plotting/img_plotting.py:403,</span> in <span class="ni">_load_anat</span><span class="nt">(anat_img, dim, black_bg)</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span>         <span class="n">black_bg</span> <span class="o">=</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">403</span>     <span class="n">anat_img</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">check_niimg_3d</span><span class="p">(</span><span class="n">anat_img</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span>     <span class="c1"># Clean anat_img for non-finite values to avoid computing unnecessary</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="c1"># border data values.</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>     <span class="n">data</span> <span class="o">=</span> <span class="n">_safe_get_data</span><span class="p">(</span><span class="n">anat_img</span><span class="p">,</span> <span class="n">ensure_finite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/_utils/niimg_conversions.py:374,</span> in <span class="ni">check_niimg_3d</span><span class="nt">(niimg, dtype)</span>
<span class="g g-Whitespace">    </span><span class="mi">340</span> <span class="k">def</span> <span class="nf">check_niimg_3d</span><span class="p">(</span><span class="n">niimg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span>     <span class="sd">&quot;&quot;&quot;Check that niimg is a proper 3D niimg-like object and load it.</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">343</span><span class="sd">     Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">372</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">373</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">374</span>     <span class="k">return</span> <span class="n">check_niimg</span><span class="p">(</span><span class="n">niimg</span><span class="p">,</span> <span class="n">ensure_ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/_utils/niimg_conversions.py:306,</span> in <span class="ni">check_niimg</span><span class="nt">(niimg, ensure_ndim, atleast_4d, dtype, return_iterator, wildcards)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">306</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">niimg</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="ne">ValueError</span>: File not found: &#39;./output_level1/level1_results/01/reg_copes/_subject_id_01/_warpfunc1/cope1_flirt.nii.gz&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="copes-from-the-second-level-glm">
<h3>Copes from the second-level GLM<a class="headerlink" href="#copes-from-the-second-level-glm" title="Permalink to this heading">#</a></h3>
<p>copes from subject-01</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nipype_cope1</span> <span class="o">=</span> <span class="s1">&#39;./output_level2/level2_results/contrast_1/stats_dir/_contr_id_1/stats/cope1.nii.gz&#39;</span>
<span class="n">nipype_cope2</span> <span class="o">=</span> <span class="s1">&#39;./output_level2/level2_results/contrast_2/stats_dir/_contr_id_2/stats/cope1.nii.gz&#39;</span>
<span class="n">nipype_cope3</span> <span class="o">=</span> <span class="s1">&#39;./output_level2/level2_results/contrast_3/stats_dir/_contr_id_3/stats/cope1.nii.gz&#39;</span>
<span class="n">nipype_cope4</span> <span class="o">=</span> <span class="s1">&#39;./output_level2/level2_results/contrast_4/stats_dir/_contr_id_4/stats/cope1.nii.gz&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotting</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE1&#39;</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE2&#39;</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE3&#39;</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">nipype_cope4</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope4</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">61</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE1&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE2&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Nipype - COPE3&#39;</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/plotting/img_plotting.py:1078,</span> in <span class="ni">plot_glass_brain</span><span class="nt">(stat_map_img, output_file, display_mode, colorbar, cbar_tick_format, figure, axes, title, threshold, annotate, black_bg, cmap, alpha, vmin, vmax, plot_abs, symmetric_cbar, resampling_interpolation, radiological, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1075</span>     <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">cold_hot</span> <span class="k">if</span> <span class="n">black_bg</span> <span class="k">else</span> <span class="n">cm</span><span class="o">.</span><span class="n">cold_white_hot</span>
<span class="g g-Whitespace">   </span><span class="mi">1077</span> <span class="k">if</span> <span class="n">stat_map_img</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1078</span>     <span class="n">stat_map_img</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">check_niimg_3d</span><span class="p">(</span><span class="n">stat_map_img</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1079</span>     <span class="k">if</span> <span class="n">plot_abs</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1080</span>         <span class="n">cbar_vmin</span><span class="p">,</span> <span class="n">cbar_vmax</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">_get_colorbar_and_data_ranges</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1081</span>             <span class="n">_safe_get_data</span><span class="p">(</span><span class="n">stat_map_img</span><span class="p">,</span> <span class="n">ensure_finite</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1082</span>             <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1083</span>             <span class="n">symmetric_cbar</span><span class="o">=</span><span class="n">symmetric_cbar</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1084</span>             <span class="n">force_min_stat_map_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/_utils/niimg_conversions.py:374,</span> in <span class="ni">check_niimg_3d</span><span class="nt">(niimg, dtype)</span>
<span class="g g-Whitespace">    </span><span class="mi">340</span> <span class="k">def</span> <span class="nf">check_niimg_3d</span><span class="p">(</span><span class="n">niimg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span>     <span class="sd">&quot;&quot;&quot;Check that niimg is a proper 3D niimg-like object and load it.</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">343</span><span class="sd">     Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">372</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">373</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">374</span>     <span class="k">return</span> <span class="n">check_niimg</span><span class="p">(</span><span class="n">niimg</span><span class="p">,</span> <span class="n">ensure_ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/_utils/niimg_conversions.py:306,</span> in <span class="ni">check_niimg</span><span class="nt">(niimg, ensure_ndim, atleast_4d, dtype, return_iterator, wildcards)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">306</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">niimg</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="ne">ValueError</span>: File not found: &#39;./output_level2/level2_results/contrast_1/stats_dir/_contr_id_1/stats/cope1.nii.gz&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="third-level-glm-using-nipype-fsl">
<h1>Third-level GLM using Nipype FSL<a class="headerlink" href="#third-level-glm-using-nipype-fsl" title="Permalink to this heading">#</a></h1>
<p>Start the workflow</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;level3&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">exp_dir_third</span><span class="p">)</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;crashfile_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>The following two nodes (<code class="docutils literal notranslate"><span class="pre">infosource</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">dg</span></code>) together define all inputs required for the preprocessing workflow</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we want to group the outcome by contrast not subject</span>
<span class="n">contr_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">infosource_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;contr_id&quot;</span><span class="p">]),</span>
                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;infosource_third&quot;</span><span class="p">)</span>
<span class="n">infosource_third</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;contr_id&quot;</span><span class="p">,</span> <span class="n">contr_list</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># here we use SelectFiles, instead of DataGrabber, because the former is more flexible with formatting syntax</span>
<span class="n">templates_third</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;copes&quot;</span><span class="p">:</span><span class="s2">&quot;contrast_</span><span class="si">{contr_id}</span><span class="s2">/*/_contr_id_</span><span class="si">{contr_id}</span><span class="s2">/*/cope*.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;varcopes&quot;</span><span class="p">:</span><span class="s2">&quot;contrast_</span><span class="si">{contr_id}</span><span class="s2">/*/_contr_id_</span><span class="si">{contr_id}</span><span class="s2">/*/varcope*.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;masks&quot;</span><span class="p">:</span><span class="s2">&quot;contrast_</span><span class="si">{contr_id}</span><span class="s2">/*/_contr_id_</span><span class="si">{contr_id}</span><span class="s2">/*/mask.nii.gz&quot;</span>
<span class="p">}</span>
<span class="n">templates</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;reg_copes&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_copes/*/*/cope</span><span class="si">{contr_id}</span><span class="s2">_flirt.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reg_varcopes&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_varcopes/*/*/varcope</span><span class="si">{contr_id}</span><span class="s2">_flirt.nii.gz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reg_masks&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_masks/*/*/*.nii.gz&quot;</span>
<span class="p">}</span>

<span class="n">dg_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">nio</span><span class="o">.</span><span class="n">SelectFiles</span><span class="p">(</span><span class="n">templates_third</span><span class="p">),</span>
             <span class="n">name</span><span class="o">=</span><span class="s2">&quot;selectfiles_third&quot;</span><span class="p">)</span>
<span class="n">dg_third</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">data_dir_third</span>

<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
        <span class="p">(</span><span class="n">infosource_third</span><span class="p">,</span> <span class="n">dg_third</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;contr_id&quot;</span><span class="p">,</span> <span class="s2">&quot;contr_id&quot;</span><span class="p">)])</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TraitError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span> <span class="n">line</span> <span class="mi">15</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">templates</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="s2">&quot;reg_copes&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_copes/*/*/cope</span><span class="si">{contr_id}</span><span class="s2">_flirt.nii.gz&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="s2">&quot;reg_varcopes&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_varcopes/*/*/varcope</span><span class="si">{contr_id}</span><span class="s2">_flirt.nii.gz&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="s2">&quot;reg_masks&quot;</span><span class="p">:</span><span class="s2">&quot;*/reg_masks/*/*/*.nii.gz&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">dg_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">nio</span><span class="o">.</span><span class="n">SelectFiles</span><span class="p">(</span><span class="n">templates_third</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>              <span class="n">name</span><span class="o">=</span><span class="s2">&quot;selectfiles_third&quot;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">15</span> <span class="n">dg_third</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">data_dir_third</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>         <span class="p">(</span><span class="n">infosource_third</span><span class="p">,</span> <span class="n">dg_third</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;contr_id&quot;</span><span class="p">,</span> <span class="s2">&quot;contr_id&quot;</span><span class="p">)])</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="p">])</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py:135,</span> in <span class="ni">BasePath.validate</span><span class="nt">(self, objekt, name, value, return_pathlike)</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">135</span>         <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">objekt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span>         <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">objekt</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/traits/base_trait_handler.py:74,</span> in <span class="ni">BaseTraitHandler.error</span><span class="nt">(self, object, name, value)</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>     <span class="sd">&quot;&quot;&quot;Raises a TraitError exception.</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">60</span><span class="sd">     This method is called by the validate() method when an assigned value</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="sd">         The proposed new value for the attribute.</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">74</span>     <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span>         <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_info</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">value</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span>     <span class="p">)</span>

<span class="ne">TraitError</span>: The &#39;base_directory&#39; trait of a SelectFilesInputSpec instance must be a pathlike object or string representing an existing directory, but a value of &#39;/storage/tmp/tmpvxi51_fp/output_level2/level2_results&#39; &lt;class &#39;str&#39;&gt; was specified.
</pre></div>
</div>
</div>
</div>
<section id="third-level-glm">
<h2>Third-level GLM<a class="headerlink" href="#third-level-glm" title="Permalink to this heading">#</a></h2>
<p>Combining results from multiple runs of one subject into one</p>
<section id="id1">
<h3>Higher-level input files preparation<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<section id="id2">
<h4>Step 1: Merge registered copes &amp; varcopes &amp; masks<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmerge</span> <span class="o">-</span><span class="n">t</span> <span class="n">mask</span> <span class="p">(</span><span class="n">masks</span> <span class="kn">from</span> <span class="nn">all</span> <span class="mi">26</span> <span class="n">inputs</span><span class="p">)</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmerge</span> <span class="o">-</span><span class="n">t</span> <span class="n">cope</span> <span class="p">(</span><span class="n">copes</span> <span class="kn">from</span> <span class="nn">all</span> <span class="mi">26</span> <span class="n">inputs</span><span class="p">)</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmerge</span> <span class="o">-</span><span class="n">t</span> <span class="n">varcop</span> <span class="p">(</span><span class="n">varcopes</span> <span class="kn">from</span> <span class="nn">all</span> <span class="mi">26</span> <span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">copemerge_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_files&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;copemerge_third&quot;</span><span class="p">)</span>

<span class="n">varcopemerge_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_files&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;varcopemerge_third&quot;</span><span class="p">)</span>

<span class="n">maskmerge_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_files&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;maskmerge_third&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">repeat_mask</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">glob</span>
    <span class="c1"># n_sub = len(glob.glob(os.path.join(os.getcwd(), &#39;ds000102&#39;)+&quot;/sub-0*&quot;))    </span>
    <span class="n">n_sub</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">mask_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="p">]</span>
    <span class="n">repeated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mask_lst</span><span class="p">,</span><span class="n">n_sub</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">repeated</span><span class="p">)</span>

<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_third</span><span class="p">,</span> <span class="s1">&#39;copes&#39;</span><span class="p">,</span> <span class="n">copemerge_third</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_third</span><span class="p">,</span> <span class="s1">&#39;varcopes&#39;</span><span class="p">,</span> <span class="n">varcopemerge_third</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_third</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;masks&#39;</span><span class="p">,</span> <span class="n">repeat_mask</span><span class="p">),</span> <span class="n">maskmerge_third</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h4>Step 2: Making mask<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h4>
<p>In FSL, there are many commands about <code class="docutils literal notranslate"><span class="pre">maskunique</span></code>, which is unless for the second level. We can ignore it.</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">mask</span> <span class="o">-</span><span class="n">Tmin</span> <span class="n">mask</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># /usr/local/fsl/bin/fslmaths mask -Tmin mask</span>
<span class="n">minmask_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-Tmin&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;minmask_third&#39;</span><span class="p">)</span>

<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">maskmerge_third</span><span class="p">,</span> <span class="s1">&#39;merged_file&#39;</span><span class="p">,</span> <span class="n">minmask_third</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h4>Step 3: Masking copes &amp; varcopes<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<p><strong>Corresponding FSL command:</strong></p>
<p>we have four contrasts so the following commands repeat four times</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">cope1</span> <span class="o">-</span><span class="n">mas</span> <span class="n">mask</span> <span class="n">cope1</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">varcope1</span> <span class="o">-</span><span class="n">mas</span> <span class="n">mask</span> <span class="n">varcope1</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maskcope_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-mas&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maskcope_third&#39;</span><span class="p">)</span>

<span class="n">maskvarcope_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-mas&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maskvarcope_third&#39;</span><span class="p">)</span>

<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">copemerge_third</span><span class="p">,</span> <span class="s1">&#39;merged_file&#39;</span><span class="p">,</span> <span class="n">maskcope_third</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">minmask_third</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">maskcope_third</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">)</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">varcopemerge_third</span><span class="p">,</span> <span class="s1">&#39;merged_file&#39;</span><span class="p">,</span> <span class="n">maskvarcope_third</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">minmask_third</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">maskvarcope_third</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="set-up-third-level-contrasts">
<h3>Set up third-level contrasts<a class="headerlink" href="#set-up-third-level-contrasts" title="Permalink to this heading">#</a></h3>
<p>Since we only have a single-group set-up, we can actually use <a class="reference external" href="https://nipype.readthedocs.io/en/latest/api/generated/nipype.interfaces.fsl.model.html#l2model">L2Model</a>.
If we have an ANOVA-like design, using <a class="reference external" href="https://nipype.readthedocs.io/en/latest/api/generated/nipype.interfaces.fsl.model.html#multipleregressdesign">MultipleRegressDesign</a> would be a better option.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">num_copes</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

<span class="n">level3model</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">L2Model</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;l3model&#39;</span><span class="p">)</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dg_third</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;copes&#39;</span><span class="p">,</span><span class="n">num_copes</span><span class="p">),</span> <span class="n">level3model</span><span class="p">,</span> <span class="s1">&#39;num_copes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level3estimate</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">FLAMEO</span><span class="p">(</span><span class="n">run_mode</span><span class="o">=</span><span class="s1">&#39;flame1&#39;</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;level3estimate&quot;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cope_file&#39;</span><span class="p">,</span> <span class="s1">&#39;var_cope_file&#39;</span><span class="p">])</span>

<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
    <span class="p">(</span><span class="n">maskcope_third</span><span class="p">,</span> <span class="n">level3estimate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;cope_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">maskvarcope_third</span><span class="p">,</span> <span class="n">level3estimate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;var_cope_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">minmask_third</span><span class="p">,</span> <span class="n">level3estimate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;mask_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">level3model</span><span class="p">,</span> <span class="n">level3estimate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;design_mat&#39;</span><span class="p">,</span> <span class="s1">&#39;design_file&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;design_con&#39;</span><span class="p">,</span> <span class="s1">&#39;t_con_file&#39;</span><span class="p">),</span> 
                                   <span class="p">(</span><span class="s1">&#39;design_grp&#39;</span><span class="p">,</span> <span class="s1">&#39;cov_split_file&#39;</span><span class="p">)]),</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="post-stats">
<h3>Post-Stats<a class="headerlink" href="#post-stats" title="Permalink to this heading">#</a></h3>
<section id="smoothness-estimation">
<h4>Smoothness estimation<a class="headerlink" href="#smoothness-estimation" title="Permalink to this heading">#</a></h4>
<p>to get <code class="docutils literal notranslate"><span class="pre">dlh</span></code> and <code class="docutils literal notranslate"><span class="pre">volume</span></code> for thresholding
<strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">smoothest</span> <span class="o">-</span><span class="n">d</span> <span class="mi">25</span> <span class="o">-</span><span class="n">m</span> <span class="n">mask</span> <span class="o">-</span><span class="n">r</span> <span class="n">stats</span><span class="o">/</span><span class="n">res4d</span> <span class="o">&gt;</span> <span class="n">stats</span><span class="o">/</span><span class="n">smoothness</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smoothest</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">SmoothEstimate</span><span class="p">(</span><span class="n">dof</span><span class="o">=</span><span class="mi">25</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;smoothest&quot;</span><span class="p">,</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residual_fit_file&#39;</span><span class="p">,</span> <span class="s1">&#39;mask_file&#39;</span><span class="p">])</span>

<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">minmask_third</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">smoothest</span><span class="p">,</span> <span class="s1">&#39;mask_file&#39;</span><span class="p">)</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">level3estimate</span><span class="p">,</span> <span class="s1">&#39;res4d&#39;</span><span class="p">,</span> <span class="n">smoothest</span><span class="p">,</span> <span class="s1">&#39;residual_fit_file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mask-zstats-file">
<h4>Mask zstats file<a class="headerlink" href="#mask-zstats-file" title="Permalink to this heading">#</a></h4>
<p>preparation for thresholding</p>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fslmaths</span> <span class="n">stats</span><span class="o">/</span><span class="n">zstat1</span> <span class="o">-</span><span class="n">mas</span> <span class="n">mask</span> <span class="n">thresh_zstat1</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level3mask</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">ImageMaths</span><span class="p">(</span><span class="n">op_string</span><span class="o">=</span><span class="s1">&#39;-mas&#39;</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;in_file2&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;level3mask&#39;</span><span class="p">)</span>

<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
    <span class="p">(</span><span class="n">level3estimate</span><span class="p">,</span><span class="n">level3mask</span><span class="p">,[(</span><span class="s1">&#39;zstats&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">minmask_third</span><span class="p">,</span> <span class="n">level3mask</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file2&#39;</span><span class="p">)]),</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cluster-wise-thresholding">
<h4>Cluster-wise thresholding<a class="headerlink" href="#cluster-wise-thresholding" title="Permalink to this heading">#</a></h4>
<p><strong>Corresponding FSL command:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fsl</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">cluster</span> <span class="o">-</span><span class="n">i</span> <span class="n">thresh_zstat1</span> <span class="o">-</span><span class="n">t</span> <span class="mf">3.1</span> <span class="o">--</span><span class="n">othresh</span><span class="o">=</span><span class="n">thresh_zstat1</span> <span class="o">-</span><span class="n">o</span> <span class="n">cluster_mask_zstat1</span> <span class="o">--</span><span class="n">connectivity</span><span class="o">=</span><span class="mi">26</span> <span class="o">--</span><span class="n">mm</span> <span class="o">--</span><span class="n">olmax</span><span class="o">=</span><span class="n">lmax_zstat1_std</span><span class="o">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">scalarname</span><span class="o">=</span><span class="n">Z</span> <span class="o">-</span><span class="n">p</span> <span class="mf">0.05</span> <span class="o">-</span><span class="n">d</span> <span class="mf">0.0595781</span> <span class="o">--</span><span class="n">volume</span><span class="o">=</span><span class="mi">254734</span> <span class="o">-</span><span class="n">c</span> <span class="n">stats</span><span class="o">/</span><span class="n">cope1</span> <span class="o">&gt;</span> <span class="n">cluster_zstat1_std</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">level3threshold</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">3.1</span><span class="p">,</span>
                              <span class="n">pthreshold</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
                              <span class="n">use_mm</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                              <span class="n">out_threshold_file</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">out_index_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                              <span class="n">out_localmax_txt_file</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">,</span><span class="s1">&#39;cope_file&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;level3threshold&#39;</span><span class="p">)</span>

<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
    <span class="p">(</span><span class="n">level3mask</span><span class="p">,</span> <span class="n">level3threshold</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">level3estimate</span><span class="p">,</span> <span class="n">level3threshold</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;copes&#39;</span><span class="p">,</span> <span class="s1">&#39;cope_file&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">smoothest</span><span class="p">,</span> <span class="n">level3threshold</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;dlh&#39;</span><span class="p">,</span> <span class="s1">&#39;dlh&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">)]),</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="save-the-output">
<h2>Save the output<a class="headerlink" href="#save-the-output" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasink_third</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">nio</span><span class="o">.</span><span class="n">DataSink</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sinker&#39;</span><span class="p">)</span>
<span class="n">datasink_third</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_dir_third</span><span class="p">,</span> <span class="s2">&quot;level3_results&quot;</span><span class="p">)</span>

<span class="n">int2string</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;contrast_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">infosource_third</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;contr_id&#39;</span><span class="p">,</span><span class="n">int2string</span><span class="p">),</span> <span class="n">datasink_third</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">)</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
    <span class="p">(</span><span class="n">level3estimate</span><span class="p">,</span> <span class="n">datasink_third</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;stats_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;stats_dir&#39;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="n">level3threshold</span><span class="p">,</span> <span class="n">datasink_third</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;threshold_file&#39;</span><span class="p">,</span> <span class="s1">&#39;thresholded&#39;</span><span class="p">),</span>
                                <span class="p">(</span><span class="s1">&#39;localmax_txt_file&#39;</span><span class="p">,</span> <span class="s1">&#39;localmax_txt&#39;</span><span class="p">),</span>
                                <span class="p">(</span><span class="s1">&#39;index_file&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">)]),</span>
           <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create 1st-level analysis output graph</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph2use</span><span class="o">=</span><span class="s1">&#39;colored&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">simple_form</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Visualize the graph</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wf_third</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">wf_third</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;graph.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/666685b69e21eecc386ede4f5f63347ba95d35abedc30889b748f0c26ed92c89.png" src="_images/666685b69e21eecc386ede4f5f63347ba95d35abedc30889b748f0c26ed92c89.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="c1"># Run Workflow</span>
<span class="n">wf_third</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">plugin</span><span class="o">=</span><span class="s2">&quot;MultiProc&quot;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;n_procs&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:27,575 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:27,585 nipype.workflow WARNING:
	 [Node] Error on &quot;level3.selectfiles_third&quot; (/storage/tmp/tmpvxi51_fp/output_level3/level3/selectfiles_third)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:29,143 nipype.workflow ERROR:
	 Node selectfiles_third failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:29,153 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpvxi51_fp/crash-20241017-010329-ubuntu-selectfiles_third-f662a9b1-a730-4a36-a914-5e77ea58d41e.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node selectfiles_third.

Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 429, in aggregate_outputs
	    predicted_outputs = self._list_outputs()  # Predictions from _list_outputs
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/io.py&quot;, line 1469, in _list_outputs
	    raise IOError(msg)
	OSError: No files were found matching copes template: /storage/tmp/tmpvxi51_fp/output_level3/level3/selectfiles_third/contrast_&lt;undefined&gt;/*/_contr_id_&lt;undefined&gt;/*/cope*.nii.gz
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>241017-01:03:31,113 nipype.workflow ERROR:
	 could not run node: level3.selectfiles_third
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">75</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Run Workflow</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">wf_third</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">plugin</span><span class="o">=</span><span class="s2">&quot;MultiProc&quot;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;n_procs&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/workflows.py:638,</span> in <span class="ni">Workflow.run</span><span class="nt">(self, plugin, plugin_args, updatehash)</span>
<span class="g g-Whitespace">    </span><span class="mi">636</span> <span class="k">if</span> <span class="n">str2bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;create_report&quot;</span><span class="p">]):</span>
<span class="g g-Whitespace">    </span><span class="mi">637</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_write_report_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">execgraph</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">638</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">execgraph</span><span class="p">,</span> <span class="n">updatehash</span><span class="o">=</span><span class="n">updatehash</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">639</span> <span class="n">datestr</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">640</span> <span class="k">if</span> <span class="n">str2bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;write_provenance&quot;</span><span class="p">]):</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/base.py:224,</span> in <span class="ni">DistributedPluginBase.run</span><span class="nt">(self, graph, config, updatehash)</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>     <span class="n">error</span><span class="p">,</span> <span class="n">cause</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>         <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> raised. Re-raising first.&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>         <span class="n">error</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">224</span> <span class="k">raise</span> <span class="n">error</span> <span class="kn">from</span> <span class="nn">cause</span>

<span class="ne">RuntimeError</span>: Traceback (most recent call last):
  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">67</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run_node</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">updatehash</span><span class="o">=</span><span class="n">updatehash</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">527</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_interface</span><span class="p">(</span><span class="n">execute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">645</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_run_interface</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_command</span><span class="p">(</span><span class="n">execute</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">771</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_run_command</span>
    <span class="k">raise</span> <span class="n">NodeExecutionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="n">nipype</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">NodeExecutionError</span><span class="p">:</span> <span class="ne">Exception</span> <span class="n">raised</span> <span class="k">while</span> <span class="n">executing</span> <span class="n">Node</span> <span class="n">selectfiles_third</span><span class="o">.</span>

<span class="ne">Traceback</span>:
	<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
	  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">400</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
	    <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_outputs</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span>
	  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">429</span><span class="p">,</span> <span class="ow">in</span> <span class="n">aggregate_outputs</span>
	    <span class="n">predicted_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_outputs</span><span class="p">()</span>  <span class="c1"># Predictions from _list_outputs</span>
	  <span class="n">File</span> <span class="s2">&quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/io.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1469</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_list_outputs</span>
	    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
	<span class="ne">OSError</span><span class="p">:</span> <span class="n">No</span> <span class="n">files</span> <span class="n">were</span> <span class="n">found</span> <span class="n">matching</span> <span class="n">copes</span> <span class="n">template</span><span class="p">:</span> <span class="o">/</span><span class="n">storage</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">tmpvxi51_fp</span><span class="o">/</span><span class="n">output_level3</span><span class="o">/</span><span class="n">level3</span><span class="o">/</span><span class="n">selectfiles_third</span><span class="o">/</span><span class="n">contrast_</span><span class="o">&lt;</span><span class="n">undefined</span><span class="o">&gt;/*/</span><span class="n">_contr_id_</span><span class="o">&lt;</span><span class="n">undefined</span><span class="o">&gt;/*/</span><span class="n">cope</span><span class="o">*.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="unthresholded-copes">
<h2>Unthresholded COPEs<a class="headerlink" href="#unthresholded-copes" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nipype_cope1</span> <span class="o">=</span> <span class="s1">&#39;./output_level3/level3_results/contrast_1/stats_dir/_contr_id_1/stats/cope1.nii.gz&#39;</span>
<span class="n">nipype_cope2</span> <span class="o">=</span> <span class="s1">&#39;./output_level3/level3_results/contrast_2/stats_dir/_contr_id_2/stats/cope1.nii.gz&#39;</span>
<span class="n">nipype_cope3</span> <span class="o">=</span> <span class="s1">&#39;./output_level3/level3_results/contrast_3/stats_dir/_contr_id_3/stats/cope1.nii.gz&#39;</span>
<span class="n">nipype_cope4</span> <span class="o">=</span> <span class="s1">&#39;./output_level3/level3_results/contrast_4/stats_dir/_contr_id_4/stats/cope1.nii.gz&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_nipype_cope1</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">vol_to_surf</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">fsaverage</span><span class="o">.</span><span class="n">pial_right</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_surf_stat_map</span><span class="p">(</span>
        <span class="n">fsaverage</span><span class="o">.</span><span class="n">infl_right</span><span class="p">,</span> <span class="n">t_nipype_cope1</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - COPE1&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">bg_map</span><span class="o">=</span><span class="n">fsaverage</span><span class="o">.</span><span class="n">sulc_right</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">t_nipype_cope2</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">vol_to_surf</span><span class="p">(</span><span class="n">nipype_cope2</span><span class="p">,</span> <span class="n">fsaverage</span><span class="o">.</span><span class="n">pial_right</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_surf_stat_map</span><span class="p">(</span>
        <span class="n">fsaverage</span><span class="o">.</span><span class="n">infl_right</span><span class="p">,</span> <span class="n">t_nipype_cope2</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - COPE2&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">bg_map</span><span class="o">=</span><span class="n">fsaverage</span><span class="o">.</span><span class="n">sulc_right</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">t_nipype_cope3</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">vol_to_surf</span><span class="p">(</span><span class="n">nipype_cope3</span><span class="p">,</span> <span class="n">fsaverage</span><span class="o">.</span><span class="n">pial_right</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_surf_stat_map</span><span class="p">(</span>
        <span class="n">fsaverage</span><span class="o">.</span><span class="n">infl_right</span><span class="p">,</span> <span class="n">t_nipype_cope3</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - COPE3&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">bg_map</span><span class="o">=</span><span class="n">fsaverage</span><span class="o">.</span><span class="n">sulc_right</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">t_nipype_cope4</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">vol_to_surf</span><span class="p">(</span><span class="n">nipype_cope4</span><span class="p">,</span> <span class="n">fsaverage</span><span class="o">.</span><span class="n">pial_right</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_surf_stat_map</span><span class="p">(</span>
        <span class="n">fsaverage</span><span class="o">.</span><span class="n">infl_right</span><span class="p">,</span> <span class="n">t_nipype_cope4</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - COPE4&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">bg_map</span><span class="o">=</span><span class="n">fsaverage</span><span class="o">.</span><span class="n">sulc_right</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">77</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">t_nipype_cope1</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">vol_to_surf</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span> <span class="n">fsaverage</span><span class="o">.</span><span class="n">pial_right</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_surf_stat_map</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>         <span class="n">fsaverage</span><span class="o">.</span><span class="n">infl_right</span><span class="p">,</span> <span class="n">t_nipype_cope1</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>         <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - COPE1&quot;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>         <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="n">bg_map</span><span class="o">=</span><span class="n">fsaverage</span><span class="o">.</span><span class="n">sulc_right</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/surface/surface.py:638,</span> in <span class="ni">vol_to_surf</span><span class="nt">(img, surf_mesh, radius, interpolation, kind, n_samples, mask_img, inner_mesh, depth)</span>
<span class="g g-Whitespace">    </span><span class="mi">635</span> <span class="k">if</span> <span class="n">interpolation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sampling_schemes</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">636</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;interpolation&#39; should be one of &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">637</span>                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sampling_schemes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">638</span> <span class="n">img</span> <span class="o">=</span> <span class="n">load_img</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">639</span> <span class="k">if</span> <span class="n">mask_img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">640</span>     <span class="n">mask_img</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">check_niimg</span><span class="p">(</span><span class="n">mask_img</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/image/image.py:1334,</span> in <span class="ni">load_img</span><span class="nt">(img, wildcards, dtype)</span>
<span class="g g-Whitespace">   </span><span class="mi">1296</span> <span class="k">def</span> <span class="nf">load_img</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">wildcards</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1297</span>     <span class="sd">&quot;&quot;&quot;Load a Niimg-like object from filenames or list of filenames.</span>
<span class="g g-Whitespace">   </span><span class="mi">1298</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1299</span><span class="sd">     .. versionadded:: 0.2.5</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">1332</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1333</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1334</span>     <span class="k">return</span> <span class="n">check_niimg</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">wildcards</span><span class="o">=</span><span class="n">wildcards</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/_utils/niimg_conversions.py:306,</span> in <span class="ni">check_niimg</span><span class="nt">(niimg, ensure_ndim, atleast_4d, dtype, return_iterator, wildcards)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">306</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">niimg</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="ne">ValueError</span>: File not found: &#39;./output_level3/level3_results/contrast_1/stats_dir/_contr_id_1/stats/cope1.nii.gz&#39;
</pre></div>
</div>
</div>
</div>
<section id="thresholded-p-0-05-zstats">
<h3>Thresholded (p &lt; 0.05) zstats<a class="headerlink" href="#thresholded-p-0-05-zstats" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nipype_cope1</span> <span class="o">=</span> <span class="s1">&#39;./output_level3/level3_results/contrast_1/thresholded/_contr_id_1/zstat1_maths_threshold.nii.gz&#39;</span>
<span class="n">nipype_cope2</span> <span class="o">=</span> <span class="s1">&#39;./output_level3/level3_results/contrast_2/thresholded/_contr_id_2/zstat1_maths_threshold.nii.gz&#39;</span>
<span class="n">nipype_cope3</span> <span class="o">=</span> <span class="s1">&#39;./output_level3/level3_results/contrast_3/thresholded/_contr_id_3/zstat1_maths_threshold.nii.gz&#39;</span>
<span class="n">nipype_cope4</span> <span class="o">=</span> <span class="s1">&#39;./output_level3/level3_results/contrast_4/thresholded/_contr_id_4/zstat1_maths_threshold.nii.gz&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotting</span><span class="o">.</span><span class="n">plot_img_on_surf</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span>
                          <span class="n">views</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lateral&#39;</span><span class="p">],</span>
                          <span class="n">hemispheres</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - Thresholded-zstats1&quot;</span><span class="p">,</span>
                          <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plotting</span><span class="o">.</span><span class="n">plot_img_on_surf</span><span class="p">(</span><span class="n">nipype_cope2</span><span class="p">,</span>
                          <span class="n">views</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lateral&#39;</span><span class="p">],</span>
                          <span class="n">hemispheres</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - Thresholded-zstats2&quot;</span><span class="p">,</span>
                          <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plotting</span><span class="o">.</span><span class="n">plot_img_on_surf</span><span class="p">(</span><span class="n">nipype_cope3</span><span class="p">,</span>
                          <span class="n">views</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lateral&#39;</span><span class="p">],</span>
                          <span class="n">hemispheres</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - Thresholded-zstats3&quot;</span><span class="p">,</span>
                          <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plotting</span><span class="o">.</span><span class="n">plot_img_on_surf</span><span class="p">(</span><span class="n">nipype_cope4</span><span class="p">,</span>
                          <span class="n">views</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lateral&#39;</span><span class="p">],</span>
                          <span class="n">hemispheres</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - Thresholded-zstats4&quot;</span><span class="p">,</span>
                          <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_img_on_surf</span><span class="p">(</span><span class="n">nipype_cope1</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>                           <span class="n">views</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lateral&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                           <span class="n">hemispheres</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>                           <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - Thresholded-zstats1&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>                           <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">plotting</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_img_on_surf</span><span class="p">(</span><span class="n">nipype_cope2</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>                           <span class="n">views</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lateral&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>                           <span class="n">hemispheres</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>                           <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Nipype - Thresholded-zstats2&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>                           <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/plotting/surf_plotting.py:1380,</span> in <span class="ni">plot_img_on_surf</span><span class="nt">(stat_map, surf_mesh, mask_img, hemispheres, bg_on_data, inflate, views, output_file, title, colorbar, vmin, vmax, threshold, symmetric_cbar, cmap, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1375</span>     <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1376</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1377</span>             <span class="s1">&#39;plot_img_on_surf does not accept &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">1378</span>             <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1"> as an argument&#39;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1380</span> <span class="n">stat_map</span> <span class="o">=</span> <span class="n">check_niimg_3d</span><span class="p">(</span><span class="n">stat_map</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1381</span> <span class="n">modes</span> <span class="o">=</span> <span class="n">_check_views</span><span class="p">(</span><span class="n">views</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1382</span> <span class="n">hemis</span> <span class="o">=</span> <span class="n">_check_hemispheres</span><span class="p">(</span><span class="n">hemispheres</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/_utils/niimg_conversions.py:374,</span> in <span class="ni">check_niimg_3d</span><span class="nt">(niimg, dtype)</span>
<span class="g g-Whitespace">    </span><span class="mi">340</span> <span class="k">def</span> <span class="nf">check_niimg_3d</span><span class="p">(</span><span class="n">niimg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span>     <span class="sd">&quot;&quot;&quot;Check that niimg is a proper 3D niimg-like object and load it.</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">343</span><span class="sd">     Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">372</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">373</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">374</span>     <span class="k">return</span> <span class="n">check_niimg</span><span class="p">(</span><span class="n">niimg</span><span class="p">,</span> <span class="n">ensure_ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nilearn/_utils/niimg_conversions.py:306,</span> in <span class="ni">check_niimg</span><span class="nt">(niimg, ensure_ndim, atleast_4d, dtype, return_iterator, wildcards)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">306</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">niimg</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: &#39;</span><span class="si">{</span><span class="n">niimg</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="ne">ValueError</span>: File not found: &#39;./output_level3/level3_results/contrast_1/thresholded/_contr_id_1/zstat1_maths_threshold.nii.gz&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">FSL’s fMRI Data Analysis via Nipype</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-neurodesk">Setup Neurodesk</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#first-level-glm-using-nipype-fsl">First-level GLM using Nipype FSL</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation">Preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-data-path">Set up data path</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#start-the-workflow">Start the workflow</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialisation">Initialisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-correction">Motion Correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functionally-masking">Functionally Masking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grand-mean-scaling">Grand Mean Scaling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#susan-noise-reduction">SUSAN Noise Reduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temporal-filtering">Temporal Filtering</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-level-glm">First-Level GLM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-events">Get events</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-contrasts">Set-up contrasts</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#registration">Registration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1">Step 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2">Step 2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-first-level-glm">The first-level GLM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#second-level-glm-using-nipype-fsl">Second level GLM using Nipype FSL</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-level-glm">Second-level GLM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#higher-level-input-files-preparation">Higher-level input files preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-merge-registered-copes-varcopes-masks">Step 1: Merge registered copes &amp; varcopes &amp; masks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-making-mask">Step 2: Making mask</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-masking-copes-varcopes">Step 3: Masking copes &amp; varcopes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-second-level-contrasts-and-fixed-effects">Set up second-level contrasts and fixed-effects</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-second-level-glm">The second-level GLM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regapply">Regapply</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#copes-from-the-second-level-glm">Copes from the second-level GLM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#third-level-glm-using-nipype-fsl">Third-level GLM using Nipype FSL</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#third-level-glm">Third-level GLM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Higher-level input files preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Step 1: Merge registered copes &amp; varcopes &amp; masks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Step 2: Making mask</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Step 3: Masking copes &amp; varcopes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-third-level-contrasts">Set up third-level contrasts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#post-stats">Post-Stats</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothness-estimation">Smoothness estimation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mask-zstats-file">Mask zstats file</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cluster-wise-thresholding">Cluster-wise thresholding</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-the-output">Save the output</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unthresholded-copes">Unthresholded COPEs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thresholded-p-0-05-zstats">Thresholded (p &lt; 0.05) zstats</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Neurodesk Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>