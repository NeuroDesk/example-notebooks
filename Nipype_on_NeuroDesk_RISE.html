

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Nipype on Neurodesk &#8212; Neurodesk</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-4Z9774J59Y"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4Z9774J59Y');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Nipype_on_NeuroDesk_RISE';</script>
    <link rel="canonical" href="https://neurodesk.github.io/example-notebooks/intro.html/Nipype_on_NeuroDesk_RISE.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">Neurodesk</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    Nipype on Neurodesk
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://play-iowa.neurodesk.org/hub/user-redirect/lab/tree/example-notebooks/books/v2/gh/NeuroDesk/example-notebooks/main?urlpath=lab/tree/books/Nipype_on_NeuroDesk_RISE.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/NeuroDesk/example-notebooks/blob/main/books/Nipype_on_NeuroDesk_RISE.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/edit/main/books/Nipype_on_NeuroDesk_RISE.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/issues/new?title=Issue%20on%20page%20%2FNipype_on_NeuroDesk_RISE.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Nipype_on_NeuroDesk_RISE.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Nipype on Neurodesk</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interactive-rise-slideshow">An interactive RISE slideshow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-neurodesk">Set up Neurodesk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-content">Table of content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-nipype">1. Introduction to Nipype</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nipype-in-jupyter-notebooks-on-neurodesk">2. Nipype in Jupyter Notebooks on Neurodesk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploration-of-nipype-s-building-blocks">3. Exploration of Nipype’s building blocks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-download-of-opensource-data-installations-and-imports"><strong>Preparation: Download of opensource data, installations and imports</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interfaces-the-core-pieces-of-nipype">3.1. Interfaces : The core pieces of Nipype</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-interface-for-fsl-s-brain-extraction-tool-bet"><strong>Example: Interface for FSL’s Brain Extraction Tool <em>BET</em></strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nodes-the-light-wrapper-around-interfaces">3.2. Nodes: The light wrapper around interfaces</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapnode">MapNode</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iterables">Iterables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#joinnode">JoinNode</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-node"><strong>Example: Node</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workflows">3.3. Workflows</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-workflow"><strong>Example: Workflow</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connect-nodes-within-a-workflow">Connect nodes within a workflow</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#execution-plugins-execution-on-different-systems">3.4. Execution Plugins: Execution on different systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-input-first-step-of-every-analysis">3.5. Data Input: First step of every analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-datagrabber"><strong>Example: DataGrabber</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-output">3.6. Data Output</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-datasink"><strong>Example: DataSink</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pydra-a-modern-dataflow-engine-developed-for-the-nipype-project">4. Pydra: A modern dataflow engine developed for the Nipype project</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-features-in-more-detail">Key features in more detail:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies-in-jupyter-python">Dependencies in Jupyter/Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-resources">References/ Resources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><a href="https://play-ashburn.neurodesk.org/v2/gh/neurodesk/example-notebooks/main?labpath=/home/jovyan/examples/example-notebooks/template.ipynb" target="_parent"><img src="https://img.shields.io/badge/launch-binder-579aca.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADUElEQVR4nCyTzUtkRxfGn6pTtz/FtvsVp32NKBgF6QiBCU505xBpBdsJiMkyi2SRxSSEZPI3JKuEbGYREgaCi0zMENBeSCSCqwzRCCIzSBtHuqEl9ihif9zbfe+tqnCaqdXh1q1znuec31EAkM/nEYlEcH5+jmw2K5VSwvM8rVT3GmEYIh6PUxiGtlKpmNHRUQRBgK2tLdDi4iLOzs4wMjKCaDRKxhijlLIRx0kmk8lhIkoHQeArpTpaa5vJZCgej9vj42NMT09DVSoVXF5ewm21SAihAbwJ4HM/CO42ms2slJIT/wvgD2vtN9baQ8/zqFqtaiKCYIlLS0uklNJBEHwspfyu2WpF+lIpTIyPo9Fs4sXZGYzWiMVinTAMPyWi7621VCwWtSgUCuxNSynfl1L+zDLvzs3pd+/do/8PDsJrt1EqlfDL+rp+9vw5xWIxobV+T2u97jgOScdxjLU2o5R66LquffvOHfPJ/fuqL5USFxcXgs9bt2+LLx88UIPZrAmCwBLRQwBpfistayFaBZCBELqvr4+01uAJOI6DiOPg5uYG2Vu3MDc3R51ORwsh+olopft2cnISxpgvhBBvdNptWyqVZOnkBP/LZPD6xARe1mqonp+jVqvh1ydPcHV1ZdiGtbZORL91m7i8vLzt+/47+Xxe53I5+vPpU9xcX+O14WEcHBygv78fuVwOPP/t7W19eHhI0Wj0942NjbxaXV1Fu91uEhFb6c52fn4ejUYD+/v73XhsbIxBQrlcxs7ODqSUFkBjZWUFMpPJwFq7z/Stra1ZrthqtdgWewZb9DyPi6BYLHIC+2oSf/f29kIODQ1Ba/2YIerp6RG+79tkMgm+dF23i3E6nWYGGF/L/xhjQmvt41QqBbm3t8cQ/QPgaykllUqlIAgCI4RAIpFgCsFxo1E35XI5UEoRgK+klC9OT09JLCwsCMdx5NHRkZmamnqktf5gYGAAMzMzmJ2dNaxid3dXsrV6vQ4ierS5uflhoVCQYRgawcsEQLDsRCJhr6+vP/J9/7NOp5Nj2dwL3rxYLPZMKfVtOp3+0XVdwX0CYBXL44ArWWsZrB9yudxP1Wp12vO88VfLdNLTk/yrVnvpu64rm82m4e98/gsAAP//Lbmu802E+U4AAAAASUVORK5CYII=" alt="Open In Binder"/>  </a>
<a href="https://colab.research.google.com/github/NeuroDesk/example-notebooks/blob/main/template.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>   </a></p>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<section class="tex2jax_ignore mathjax_ignore" id="nipype-on-neurodesk">
<h1>Nipype on Neurodesk<a class="headerlink" href="#nipype-on-neurodesk" title="Permalink to this heading">#</a></h1>
<section id="an-interactive-rise-slideshow">
<h2>An interactive RISE slideshow<a class="headerlink" href="#an-interactive-rise-slideshow" title="Permalink to this heading">#</a></h2>
<p style="font-size: 15px;"> <b>Author:</b> Monika Doerig </p>
<p style="font-size: 12px;">Press <code>Space</code> to proceed through the slideshow.</p></section>
<section id="set-up-neurodesk">
<h2>Set up Neurodesk<a class="headerlink" href="#set-up-neurodesk" title="Permalink to this heading">#</a></h2>
<p>In code cells you press <code class="docutils literal notranslate"><span class="pre">Shift-Enter</span></code> (as usual) to evaluate your code and directly move to the next cell if it is already displayed.</p>
<p>Press <code class="docutils literal notranslate"><span class="pre">Ctrl-Enter</span></code> to run a command without direclty moving to the next cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
import os
import sys
IN_COLAB = &#39;google.colab&#39; in sys.modules

if IN_COLAB:
  os.environ[&quot;LD_PRELOAD&quot;] = &quot;&quot;;
  os.environ[&quot;APPTAINER_BINDPATH&quot;] = &quot;/content,/tmp,/cvmfs&quot;
  os.environ[&quot;MPLCONFIGDIR&quot;] = &quot;/content/matplotlib-mpldir&quot;
  os.environ[&quot;LMOD_CMD&quot;] = &quot;/usr/share/lmod/lmod/libexec/lmod&quot;

  !curl -J -O https://raw.githubusercontent.com/NeuroDesk/neurocommand/main/googlecolab_setup.sh
  !chmod +x googlecolab_setup.sh
  !./googlecolab_setup.sh

  os.environ[&quot;MODULEPATH&quot;] = &#39;:&#39;.join(map(str, list(map(lambda x: os.path.join(os.path.abspath(&#39;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/&#39;), x),os.listdir(&#39;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/&#39;)))))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Output CPU information:</span>
<span class="o">!</span>cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;vendor&#39;</span> <span class="p">|</span> uniq
<span class="o">!</span>cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;model name&#39;</span> <span class="p">|</span> uniq
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vendor_id	: AuthenticAMD
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>model name	: AMD EPYC-Rome Processor
</pre></div>
</div>
</div>
</div>
<p style="font-size: 18px;">Keep pressing <code>Space</code> to advance to the next slide.</p><div class="hint">
  <p class="hint-title" style="font-size: 1.5em; color: green;"><i class="fas fa-bullseye" style="color: green;"></i> <span style="font-size: 1.5em;">Objectives</span></p>
  <ul>
    <li>Know the basics of Nipype</li>
    <li>And how to use it on Neurodesk</li>
    <li>Learn how Python can be applied to analyze neuroimaging data through practical examples</li>
    <li>Get pointers to resources</li>
  </ul>
</div><div class="important">
  <p class="important-title" style="font-size: 1.5em; color: blue;"><i class="fas fa-bolt" style="color: blue;"></i> <span style="font-size: 1.5em;">Be aware ...</span></p>
  <ul>
    <li>Nipype is part of a large ecosystem</li>
    <li>Therefore, it is about knowing what is out there and empowering you with new tools</li>
    <li>Sometimes, the devil is in the details</li>
    <li>Things take time</li>
  </ul>
</div></section>
<section id="table-of-content">
<h2>Table of content<a class="headerlink" href="#table-of-content" title="Permalink to this heading">#</a></h2>
<p><span class="xref myst">1. Introduction to Nipype</span><br />
<span class="xref myst">2. Nipype in Jupyter Notebooks on Neurodesk</span><br />
<span class="xref myst">3. Exploration of Nipype’s building blocks</span><br />
<span class="xref myst">4. Pydra: A modern dataflow engine developed for the Nipype project</span></p>
</section>
<section id="introduction-to-nipype">
<h2>1. Introduction to Nipype<a class="headerlink" href="#introduction-to-nipype" title="Permalink to this heading">#</a></h2>
<center><img src="https://miykael.github.io/nipype_tutorial/static/images/logoNipype_text.png" width="50%" height="50%"></center><ul class="simple">
<li><p>Open-source Python project that originated within the neuroimaging community</p></li>
<li><p>Provides a unified interface to diverse neuroimaging packages including ANTS, SPM, FSL, FreeSurfer, and others</p></li>
<li><p>Facilitates seamless interaction between these packages</p></li>
<li><p>Its flexibility has made it a preferred basis for widely used pre-processing tools such as fMRIPrep</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> A primary goal driving Nipype is to simplify the integration of various analysis packages, allowing for the utilization of algorithms that are most appropriate for specific problems.</p>
<img src="https://miykael.github.io/nipype_tutorial/static/images/nipype_example_graph.png" style="float: right; margin: 0 auto; padding: 5px;" width="50%" height="50%"> 
<figcaption style="text-align: right;"><b>Figure 1:</b> Example Workflow</figcaption></section>
<section id="nipype-in-jupyter-notebooks-on-neurodesk">
<h2>2. Nipype in Jupyter Notebooks on Neurodesk<a class="headerlink" href="#nipype-in-jupyter-notebooks-on-neurodesk" title="Permalink to this heading">#</a></h2>
<img src="https://www.neurodesk.org/static/favicons/neurodesk_logo.svg" style="float: right; margin: 0 auto; padding: 5px;" width="20%" height="20%">
<p>Neurodesk project enables the use of all neuroimaging applications inside computational notebooks</p>
<p><strong>Demonstration of the module system in Python and Nipype:</strong></p>
<p>We will use the software tool <code class="docutils literal notranslate"><span class="pre">lmod</span></code> to manage and load different software packages and libraires. It simplifies the process of accessing and utilizing various software applications and allows users to easily switch between different versions of software packages, manage dependencies, and ensure compatibility with their computing environment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In code cells you press Shift-Enter to evaluate your code and directly move to the next cell if it is already displayed. </span>
<span class="c1"># Or press Ctrl-Enter to run a command without direclty moving to the next cell.</span>

<span class="c1"># Use lmod to load any software tool with a specific version</span>
<span class="kn">import</span> <span class="nn">lmod</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;fsl/6.0.7.4&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Lmod&#39;,
 &#39;Warning:&#39;,
 &#39;The&#39;,
 &#39;environment&#39;,
 &#39;MODULEPATH&#39;,
 &#39;has&#39;,
 &#39;been&#39;,
 &#39;changed&#39;,
 &#39;in&#39;,
 &#39;unexpected&#39;,
 &#39;ways.&#39;,
 &#39;Lmod&#39;,
 &#39;is&#39;,
 &#39;unable&#39;,
 &#39;to&#39;,
 &#39;use&#39;,
 &#39;given&#39;,
 &#39;MODULEPATH.&#39;,
 &#39;It&#39;,
 &#39;is&#39;,
 &#39;using:&#39;,
 &#39;&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.&#39;,
 &#39;Please&#39;,
 &#39;use&#39;,
 &#39;&quot;module&#39;,
 &#39;use&#39;,
 &#39;to&#39;,
 &#39;change&#39;,
 &#39;MODULEPATH&#39;,
 &#39;instead.&#39;,
 &#39;fsl/6.0.7.4&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;FSLOUTPUTTYPE&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;NIFTI_GZ&quot;</span> <span class="c1"># Default is NIFTI</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.fsl.base</span> <span class="kn">import</span> <span class="n">Info</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">version</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Info</span><span class="o">.</span><span class="n">output_type</span><span class="p">())</span>
<span class="c1"># If the FSL version is changed using lmod above, the kernel of the notebook needs to be restarted!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.0.7.4
NIFTI_GZ
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load afni and spm as well</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;afni/22.3.06&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;spm12/r7771&#39;</span><span class="p">)</span> 
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lmod Warning: The environment MODULEPATH has been changed in unexpected ways.
Lmod is unable to use given MODULEPATH. It is using:

&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.

Please use &quot;module use ...&quot; to change MODULEPATH instead. 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lmod Warning: The environment MODULEPATH has been changed in unexpected ways.
Lmod is unable to use given MODULEPATH. It is using:

&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.

Please use &quot;module use ...&quot; to change MODULEPATH instead. 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Lmod&#39;,
 &#39;Warning:&#39;,
 &#39;The&#39;,
 &#39;environment&#39;,
 &#39;MODULEPATH&#39;,
 &#39;has&#39;,
 &#39;been&#39;,
 &#39;changed&#39;,
 &#39;in&#39;,
 &#39;unexpected&#39;,
 &#39;ways.&#39;,
 &#39;Lmod&#39;,
 &#39;is&#39;,
 &#39;unable&#39;,
 &#39;to&#39;,
 &#39;use&#39;,
 &#39;given&#39;,
 &#39;MODULEPATH.&#39;,
 &#39;It&#39;,
 &#39;is&#39;,
 &#39;using:&#39;,
 &#39;&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.&#39;,
 &#39;Please&#39;,
 &#39;use&#39;,
 &#39;&quot;module&#39;,
 &#39;use&#39;,
 &#39;to&#39;,
 &#39;change&#39;,
 &#39;MODULEPATH&#39;,
 &#39;instead.&#39;,
 &#39;fsl/6.0.7.4&#39;,
 &#39;afni/22.3.06&#39;,
 &#39;spm12/r7771&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="exploration-of-nipype-s-building-blocks">
<h2>3. Exploration of Nipype’s building blocks<a class="headerlink" href="#exploration-of-nipype-s-building-blocks" title="Permalink to this heading">#</a></h2>
<center><img src="https://miykael.github.io/nipype_tutorial/static/images/nipype_architecture.png" width="50%" height="50%"></center>
  <figcaption><b>Figure 2:</b> Nipype architecture</figcaption><ul class="simple">
<li><p><font size="5"><strong>Interfaces:</strong> Wraps a program/ function </font></p></li>
</ul>
<ul class="simple">
<li><p><font size="5"><strong>Workflow engine:</strong></font></p>
<ul>
<li><p><font size="3"><strong>Nodes:</strong> Wraps an interface for use in a workflow</font></p></li>
<li><p><font size="3"><strong>Workflows:</strong> A directed graph or forest of graphs whose edges represent data flow </font></p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p><font size="5"><strong>Data Input:</strong> Many different modules to grab/ select data depending on the data structure </font></p></li>
</ul>
<ul class="simple">
<li><p><font size="5"><strong>Data Output:</strong> Different modules to handle data stream output  </font></p></li>
</ul>
<ul class="simple">
<li><p><font size="5"><strong>Plugin:</strong> A component that describes how a Workflow should be executed</font></p></li>
</ul>
<section id="preparation-download-of-opensource-data-installations-and-imports">
<h3><strong>Preparation: Download of opensource data, installations and imports</strong><a class="headerlink" href="#preparation-download-of-opensource-data-installations-and-imports" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download 2 subjects of the Flanker Dataset</span>
<span class="n">PATTERN</span> <span class="o">=</span> <span class="s2">&quot;sub-0[1-2]&quot;</span>
 
<span class="o">!</span>datalad install https://github.com/OpenNeuroDatasets/ds000102.git
<span class="o">!</span><span class="nb">cd</span> ds000102 <span class="o">&amp;&amp;</span> datalad get <span class="nv">$PATTERN</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>It is highly recommended to configure Git before using DataLad. Set both &#39;user.name&#39; and &#39;user.email&#39; configuration variables.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clone attempt:   0%|              | 0.00/2.00 [00:00&lt;?, ? Candidate locations/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Enumerating: 0.00 Objects [00:00, ? Objects/s]

                                              

Counting:   0%|                               | 0.00/27.0 [00:00&lt;?, ? Objects/s]

                                                                                

Compressing:   0%|                            | 0.00/23.0 [00:00&lt;?, ? Objects/s]

                                                                                

Receiving:   0%|                             | 0.00/2.15k [00:00&lt;?, ? Objects/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                

Resolving:   0%|                                | 0.00/537 [00:00&lt;?, ? Deltas/s]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO   ] scanning for unlocked files (this may take some time) 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO   ] Remote origin not usable by git-annex; setting annex-ignore 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO   ] access to 1 dataset sibling s3-PRIVATE not auto-enabled, enable with:
| 		datalad siblings -d &quot;/storage/tmp/tmpnvedqc2o/ds000102&quot; enable -s s3-PRIVATE 
<span class=" -Color -Color-Bold">install</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): /storage/tmp/tmpnvedqc2o/ds000102 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">dataset</span>)

</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>It is highly recommended to configure Git before using DataLad. Set both &#39;user.name&#39; and &#39;user.email&#39; configuration variables.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:   0%|                                    | 0.00/136M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:   0%|            | 0.00/10.7M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:   0%|    | 33.4k/10.7M [00:00&lt;01:07, 158k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:   1%|    | 68.2k/10.7M [00:00&lt;01:04, 166k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:   1%|     | 120k/10.7M [00:00&lt;00:53, 198k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:   2%|     | 173k/10.7M [00:00&lt;00:48, 216k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:   2%|     | 260k/10.7M [00:01&lt;00:36, 285k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:   4%|▏    | 469k/10.7M [00:01&lt;00:19, 521k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:   8%|▎   | 869k/10.7M [00:01&lt;00:09, 1.09M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  16%|▍  | 1.72M/10.7M [00:01&lt;00:04, 1.86M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  32%|▉  | 3.39M/10.7M [00:01&lt;00:01, 3.70M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  44%|█▎ | 4.77M/10.7M [00:02&lt;00:01, 5.41M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  53%|█▌ | 5.64M/10.7M [00:02&lt;00:00, 5.89M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  66%|█▉ | 7.08M/10.7M [00:02&lt;00:00, 7.70M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  80%|██▍| 8.60M/10.7M [00:02&lt;00:00, 7.88M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/a .. 2_T1w.nii.gz:  91%|██▋| 9.75M/10.7M [00:02&lt;00:00, 7.96M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:   8%|██▏                        | 10.7M/136M [00:03&lt;00:45, 2.73M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:   0%|            | 0.00/29.2M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  10%|▎  | 2.84M/29.2M [00:00&lt;00:01, 14.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  16%|▍  | 4.54M/29.2M [00:00&lt;00:02, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  20%|▌  | 5.78M/29.2M [00:00&lt;00:02, 11.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  24%|▋  | 7.01M/29.2M [00:00&lt;00:01, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  29%|▊  | 8.32M/29.2M [00:00&lt;00:01, 11.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  36%|█  | 10.4M/29.2M [00:00&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  41%|█▏ | 12.0M/29.2M [00:01&lt;00:01, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  46%|█▍ | 13.5M/29.2M [00:01&lt;00:01, 9.95M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  54%|█▌ | 15.8M/29.2M [00:01&lt;00:01, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  59%|█▊ | 17.2M/29.2M [00:01&lt;00:01, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  67%|█▉ | 19.4M/29.2M [00:01&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  74%|██▏| 21.6M/29.2M [00:01&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  81%|██▍| 23.8M/29.2M [00:02&lt;00:00, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  89%|██▋| 26.0M/29.2M [00:02&lt;00:00, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  95%|██▊| 27.6M/29.2M [00:02&lt;00:00, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  99%|██▉| 29.0M/29.2M [00:02&lt;00:00, 9.94M Bytes/s]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  29%|███████▉                   | 39.9M/136M [00:07&lt;00:17, 5.45M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:   0%|            | 0.00/29.2M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:   5%|▏  | 1.50M/29.2M [00:00&lt;00:01, 14.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  15%|▍  | 4.28M/29.2M [00:00&lt;00:01, 14.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  21%|▋  | 6.12M/29.2M [00:00&lt;00:01, 11.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  29%|▊  | 8.36M/29.2M [00:00&lt;00:01, 11.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  36%|█  | 10.6M/29.2M [00:00&lt;00:01, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  43%|█▎ | 12.6M/29.2M [00:01&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  52%|█▌ | 15.1M/29.2M [00:01&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  60%|█▊ | 17.4M/29.2M [00:01&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  67%|██ | 19.7M/29.2M [00:01&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  75%|██▎| 21.9M/29.2M [00:01&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  83%|██▍| 24.1M/29.2M [00:02&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  91%|██▋| 26.4M/29.2M [00:02&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-02/f .. _bold.nii.gz:  98%|██▉| 28.6M/29.2M [00:02&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:  51%|█████████████▋             | 69.1M/136M [00:10&lt;00:10, 6.53M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:   0%|            | 0.00/10.6M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  24%|▋  | 2.59M/10.6M [00:00&lt;00:00, 13.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  40%|█▏ | 4.21M/10.6M [00:00&lt;00:00, 14.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  57%|█▋ | 6.05M/10.6M [00:00&lt;00:00, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  74%|██▏| 7.85M/10.6M [00:00&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz:  86%|██▌| 9.08M/10.6M [00:00&lt;00:00, 9.86M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/a .. 1_T1w.nii.gz: 100%|██▉| 10.5M/10.6M [00:00&lt;00:00, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   0%|            | 0.00/28.1M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   7%|▏  | 2.03M/28.1M [00:00&lt;00:01, 14.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  16%|▍  | 4.37M/28.1M [00:00&lt;00:01, 14.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  22%|▋  | 6.05M/28.1M [00:00&lt;00:01, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  27%|▊  | 7.48M/28.1M [00:00&lt;00:01, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  33%|▉  | 9.18M/28.1M [00:00&lt;00:01, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  38%|█▏ | 10.6M/28.1M [00:00&lt;00:01, 11.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  46%|█▍ | 13.0M/28.1M [00:01&lt;00:01, 11.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  54%|█▌ | 15.1M/28.1M [00:01&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  62%|█▊ | 17.4M/28.1M [00:01&lt;00:00, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  69%|██ | 19.5M/28.1M [00:01&lt;00:00, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  77%|██▎| 21.7M/28.1M [00:01&lt;00:00, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  83%|██▍| 23.3M/28.1M [00:02&lt;00:00, 10.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  89%|██▋| 24.9M/28.1M [00:02&lt;00:00, 10.2M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  94%|██▊| 26.3M/28.1M [00:02&lt;00:00, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   0%|            | 0.00/28.1M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
Total:  79%|██████████████████████▏     | 108M/136M [00:15&lt;00:03, 7.16M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   0%|            | 0.00/28.1M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   8%|▏  | 2.32M/28.1M [00:00&lt;00:01, 14.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  15%|▍  | 4.23M/28.1M [00:00&lt;00:01, 14.1M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  22%|▋  | 6.17M/28.1M [00:00&lt;00:01, 11.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  28%|▊  | 7.79M/28.1M [00:00&lt;00:01, 11.0M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  32%|▉  | 9.02M/28.1M [00:00&lt;00:01, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  37%|█  | 10.4M/28.1M [00:00&lt;00:01, 11.3M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  45%|█▎ | 12.6M/28.1M [00:01&lt;00:01, 10.9M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  53%|█▌ | 14.9M/28.1M [00:01&lt;00:01, 10.7M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  61%|█▊ | 17.2M/28.1M [00:01&lt;00:01, 10.8M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  68%|██ | 19.2M/28.1M [00:01&lt;00:00, 10.4M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  77%|██▎| 21.6M/28.1M [00:01&lt;00:00, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  84%|██▌| 23.7M/28.1M [00:02&lt;00:00, 10.6M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:  93%|██▊| 26.0M/28.1M [00:02&lt;00:00, 10.5M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-01/f .. _bold.nii.gz:   0%|            | 0.00/28.1M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-02/anat/sub-02_T1w.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-02/func/sub-02_task-flanker_run-1_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-02/func/sub-02_task-flanker_run-2_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-01/anat/sub-01_T1w.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-01/func/sub-01_task-flanker_run-2_bold.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-02 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-01 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
action summary:
  get (ok: 8)

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> pip install nilearn
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Defaulting to user installation because normal site-packages is not writeable
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: nilearn in /home/ubuntu/.local/lib/python3.10/site-packages (0.10.2)
Requirement already satisfied: joblib&gt;=1.0.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (1.3.2)
Requirement already satisfied: lxml in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (4.9.4)
Requirement already satisfied: nibabel&gt;=3.2.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (5.2.0)
Requirement already satisfied: numpy&gt;=1.19.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (1.26.2)
Requirement already satisfied: packaging in /usr/lib/python3/dist-packages (from nilearn) (21.3)
Requirement already satisfied: pandas&gt;=1.1.5 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (2.1.4)
Requirement already satisfied: requests&gt;=2.25.0 in /usr/lib/python3/dist-packages (from nilearn) (2.25.1)
Requirement already satisfied: scikit-learn&gt;=1.0.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (1.3.2)
Requirement already satisfied: scipy&gt;=1.6.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from nilearn) (1.11.4)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: python-dateutil&gt;=2.8.2 in /home/ubuntu/.local/lib/python3.10/site-packages (from pandas&gt;=1.1.5-&gt;nilearn) (2.8.2)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/lib/python3/dist-packages (from pandas&gt;=1.1.5-&gt;nilearn) (2022.1)
Requirement already satisfied: tzdata&gt;=2022.1 in /home/ubuntu/.local/lib/python3.10/site-packages (from pandas&gt;=1.1.5-&gt;nilearn) (2023.3)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from scikit-learn&gt;=1.0.0-&gt;nilearn) (3.2.0)
Requirement already satisfied: six&gt;=1.5 in /usr/lib/python3/dist-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&gt;=1.1.5-&gt;nilearn) (1.16.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: Error parsing dependencies of distro-info: Invalid version: &#39;1.1build1&#39;</span>
<span class=" -Color -Color-Yellow">WARNING: Error parsing dependencies of python-debian: Invalid version: &#39;0.1.43ubuntu1&#39;</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">DataGrabber</span><span class="p">,</span> <span class="n">DataSink</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces.utility</span> <span class="kn">import</span> <span class="n">IdentityInterface</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces</span> <span class="kn">import</span> <span class="n">fsl</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span> 
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">opj</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span> 

<span class="c1"># Create directory for all the outputs (if it doesn&#39;t exist yet)</span>
<span class="o">!</span> <span class="o">[</span> ! -d output <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir output
</pre></div>
</div>
</div>
</div>
</section>
<section id="interfaces-the-core-pieces-of-nipype">
<h3>3.1. Interfaces : The core pieces of Nipype<a class="headerlink" href="#interfaces-the-core-pieces-of-nipype" title="Permalink to this heading">#</a></h3>
<p>Python wrapper around a particular piece of software (even if it is written in another programming language than python):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- FSL
- AFNI
- ANTS
- FreeSurfer
- SPM
- dcm2nii
- Nipy
- MNE
- DIPY
- ...
</pre></div>
</div>
<p>Such an interface knows what sort of options an external program has and how to execute it (e.g., keeps track of the inputs and outputs, and checks their expected types).</p>
<p>In the Nipype framework we can get an information page on an interface class by using the <code class="docutils literal notranslate"><span class="pre">help()</span></code> function.</p>
<section id="example-interface-for-fsl-s-brain-extraction-tool-bet">
<h4><strong>Example: Interface for FSL’s Brain Extraction Tool <em>BET</em></strong><a class="headerlink" href="#example-interface-for-fsl-s-brain-extraction-tool-bet" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># help() function to get a general explanation of the class as well as a list of possible (mandatory and optional) input and output parameters </span>
<span class="n">fsl</span><span class="o">.</span><span class="n">BET</span><span class="o">.</span><span class="n">help</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wraps the executable command ``bet``.

FSL BET wrapper for skull stripping

For complete details, see the `BET Documentation.
&lt;https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/BET/UserGuide&gt;`_

Examples
--------
&gt;&gt;&gt; from nipype.interfaces import fsl
&gt;&gt;&gt; btr = fsl.BET()
&gt;&gt;&gt; btr.inputs.in_file = &#39;structural.nii&#39;
&gt;&gt;&gt; btr.inputs.frac = 0.7
&gt;&gt;&gt; btr.inputs.out_file = &#39;brain_anat.nii&#39;
&gt;&gt;&gt; btr.cmdline
&#39;bet structural.nii brain_anat.nii -f 0.70&#39;
&gt;&gt;&gt; res = btr.run() # doctest: +SKIP

Inputs::

        [Mandatory]
        in_file: (a pathlike object or string representing an existing file)
                input file to skull strip
                argument: ``%s``, position: 0

        [Optional]
        out_file: (a pathlike object or string representing a file)
                name of output skull stripped image
                argument: ``%s``, position: 1
        outline: (a boolean)
                create surface outline image
                argument: ``-o``
        mask: (a boolean)
                create binary mask image
                argument: ``-m``
        skull: (a boolean)
                create skull image
                argument: ``-s``
        no_output: (a boolean)
                Don&#39;t generate segmented output
                argument: ``-n``
        frac: (a float)
                fractional intensity threshold
                argument: ``-f %.2f``
        vertical_gradient: (a float)
                vertical gradient in fractional intensity threshold (-1, 1)
                argument: ``-g %.2f``
        radius: (an integer)
                head radius
                argument: ``-r %d``
        center: (a list of at most 3 items which are an integer)
                center of gravity in voxels
                argument: ``-c %s``
        threshold: (a boolean)
                apply thresholding to segmented brain image and mask
                argument: ``-t``
        mesh: (a boolean)
                generate a vtk mesh brain surface
                argument: ``-e``
        robust: (a boolean)
                robust brain centre estimation (iterates BET several times)
                argument: ``-R``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        padding: (a boolean)
                improve BET if FOV is very small in Z (by temporarily padding end
                slices)
                argument: ``-Z``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        remove_eyes: (a boolean)
                eye &amp; optic nerve cleanup (can be useful in SIENA)
                argument: ``-S``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        surfaces: (a boolean)
                run bet2 and then betsurf to get additional skull and scalp surfaces
                (includes registrations)
                argument: ``-A``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        t2_guided: (a pathlike object or string representing a file)
                as with creating surfaces, when also feeding in non-brain-extracted
                T2 (includes registrations)
                argument: ``-A2 %s``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        functional: (a boolean)
                apply to 4D fMRI data
                argument: ``-F``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        reduce_bias: (a boolean)
                bias field and neck cleanup
                argument: ``-B``
                mutually_exclusive: functional, reduce_bias, robust, padding,
                  remove_eyes, surfaces, t2_guided
        output_type: (&#39;NIFTI&#39; or &#39;NIFTI_PAIR&#39; or &#39;NIFTI_GZ&#39; or
                  &#39;NIFTI_PAIR_GZ&#39;)
                FSL output type
        args: (a string)
                Additional parameters to the command
                argument: ``%s``
        environ: (a dictionary with keys which are a bytes or None or a value
                  of class &#39;str&#39; and with values which are a bytes or None or a
                  value of class &#39;str&#39;, nipype default value: {})
                Environment variables

Outputs::

        out_file: (a pathlike object or string representing a file)
                path/name of skullstripped file (if generated)
        mask_file: (a pathlike object or string representing a file)
                path/name of binary brain mask (if generated)
        outline_file: (a pathlike object or string representing a file)
                path/name of outline file (if generated)
        meshfile: (a pathlike object or string representing a file)
                path/name of vtk mesh file (if generated)
        inskull_mask_file: (a pathlike object or string representing a file)
                path/name of inskull mask (if generated)
        inskull_mesh_file: (a pathlike object or string representing a file)
                path/name of inskull mesh outline (if generated)
        outskull_mask_file: (a pathlike object or string representing a file)
                path/name of outskull mask (if generated)
        outskull_mesh_file: (a pathlike object or string representing a file)
                path/name of outskull mesh outline (if generated)
        outskin_mask_file: (a pathlike object or string representing a file)
                path/name of outskin mask (if generated)
        outskin_mesh_file: (a pathlike object or string representing a file)
                path/name of outskin mesh outline (if generated)
        skull_mask_file: (a pathlike object or string representing a file)
                path/name of skull mask (if generated)
        skull_file: (a pathlike object or string representing a file)
                path/name of skull file (if generated)

References:
-----------
None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an instance of the fsl.BET object</span>
<span class="n">skullstrip</span> <span class="o">=</span> <span class="n">fsl</span><span class="o">.</span><span class="n">BET</span><span class="p">()</span>

<span class="c1"># Set input (and output)</span>
<span class="n">skullstrip</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="s1">&#39;ds000102/sub-01/anat/sub-01_T1w.nii.gz&#39;</span> 

<span class="n">skullstrip</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="s1">&#39;output/T1w_nipype_bet.nii.gz&#39;</span> <span class="c1"># Interfaces by default spit out results to the local directory why relative paths work (outputs are not stored in temporary files like in Nodes/Workflow)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Execute the node and shows outputs </span>
<span class="n">res</span> <span class="o">=</span> <span class="n">skullstrip</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">res</span><span class="o">.</span><span class="n">outputs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>inskull_mask_file = &lt;undefined&gt;
inskull_mesh_file = &lt;undefined&gt;
mask_file = &lt;undefined&gt;
meshfile = &lt;undefined&gt;
out_file = /storage/tmp/tmpnvedqc2o/output/T1w_nipype_bet.nii.gz
outline_file = &lt;undefined&gt;
outskin_mask_file = &lt;undefined&gt;
outskin_mesh_file = &lt;undefined&gt;
outskull_mask_file = &lt;undefined&gt;
outskull_mesh_file = &lt;undefined&gt;
skull_file = &lt;undefined&gt;
skull_mask_file = &lt;undefined&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gives you transparency to what&#39;s happening under the hood with one additional line</span>
<span class="n">skullstrip</span><span class="o">.</span><span class="n">cmdline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;bet ds000102/sub-01/anat/sub-01_T1w.nii.gz output/T1w_nipype_bet.nii.gz&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="nodes-the-light-wrapper-around-interfaces">
<h3>3.2. Nodes: The light wrapper around interfaces<a class="headerlink" href="#nodes-the-light-wrapper-around-interfaces" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>To streamline the analysis and to execute multiple interfaces in a sensible order, they need to be put in a Node.</p></li>
<li><p>A node is an object that executes a certain function: Nipype interface, a user-specified function or an external script.</p></li>
</ul>
<p>Each node consists of a name, an interface category and at least one input field, and at least one output field.</p>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> Nodes expose inputs and outputs of the Interface as its own and add additional functionality allowing to connect Nodes into a Workflow (directed graph):</p>
<img src="https://miykael.github.io/nipype_tutorial/static/images/node_two_nodes.png" style="display: block; margin: 0 auto; padding: 30px;" width="50%" height="50%">
<figcaption><b>Figure 3:</b> Nipype Nodes</figcaption></section>
<section id="mapnode">
<h3>MapNode<a class="headerlink" href="#mapnode" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Quite similar to a normal Node, but it can take a list of inputs and operate over each input separately, ultimately returning a list of outputs.</p></li>
<li><p>Example:  Multiple functional images (A) and each of them should be motion corrected (B1, B2, B3,..). Afterwards, put them all together into a GLM, i.e. the input for the GLM should be an array of [B1, B2, B3, …].</p></li>
</ul>
<center><img src=https://miykael.github.io/nipype_tutorial/static/images/mapnode.png></center>
<figcaption><b>Figure 4:</b> MapNode</figcaption>
</section>
<section id="iterables">
<h3>Iterables<a class="headerlink" href="#iterables" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>For repetitive steps: Iterables split up the execution workflow into many different branches.</p></li>
<li><p>Example: Running the same preprocessing on multiple subjects or doing statistical inference on multiple files.</p></li>
</ul>
<center><img src=https://miykael.github.io/nipype_tutorial/static/images/iterables.png></center>
<figcaption><b>Figure 5:</b> Iterables</figcaption></section>
<section id="joinnode">
<h3>JoinNode<a class="headerlink" href="#joinnode" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Has the opposite effect of iterables: JoinNode merges the different branches back into one node.</p></li>
<li><p>A JoinNode generalizes MapNode to operate in conjunction with an upstream iterable node to reassemble downstream results, e.g., to merge files into a group level analysis.</p></li>
</ul>
<center><img src=https://miykael.github.io/nipype_tutorial/static/images/joinnode.png></center>
<figcaption><b>Figure 6:</b> JoinNode</figcaption>
<section id="example-node">
<h4><strong>Example: Node</strong><a class="headerlink" href="#example-node" title="Permalink to this heading">#</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">nipype</span><span class="p">.</span><span class="nx">pipeline</span><span class="p">.</span><span class="nx">engine</span><span class="p">.</span><span class="nx">nodes</span> <span class="nx">module</span>

<span class="nx">nodename</span> <span class="o">=</span> <span class="nx">Nodetype</span><span class="p">(</span><span class="nx">interface_function</span><span class="p">(),</span> <span class="nx">name</span><span class="o">=</span><span class="s1">&#39;labelname&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>nodename:</strong> Variable name of the node in the python environment.</p></li>
<li><p><strong>Nodetype:</strong> Type of node: Node, MapNode or JoinNode.</p></li>
<li><p><strong>interface_function:</strong> Function the node should execute. Can be user specific or coming from an Interface.</p></li>
<li><p><strong>labelname:</strong> Label name of the node in the workflow environment (defines the name of the working directory).</p>
<ul>
<li><p>To execute a node, apply the <code class="docutils literal notranslate"><span class="pre">.run()</span></code> method</p></li>
<li><p>To return the output fields of the underlying interface, use <code class="docutils literal notranslate"><span class="pre">.outputs</span></code></p></li>
<li><p>To get help, <code class="docutils literal notranslate"><span class="pre">.help()</span></code> prints the interface help</p></li>
</ul>
</li>
</ul>
<p>The specification of base_dir is very important (and is why we needed to use absolute paths above) because otherwise all the outputs would be saved somewhere in the temporary files. Unlike interfaces, which by default spit out results to the local directly, the Workflow engine executes things off in its own directory hierarchy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create FSL BET Node with fractional intensity threshold of 0.3 and create a binary mask image</span>

<span class="c1"># For reasons that will become clear in the Workflow section, it&#39;s important to pass filenames to Nodes as absolute paths.</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;ds000102/sub-01/anat/sub-01_T1w.nii.gz&#39;</span><span class="p">)</span> 
<span class="n">output_file</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output/T1w_nipype_bet.nii.gz&#39;</span><span class="p">)</span>

<span class="c1"># Create FSL BET Node with fractional intensity threshold of 0.3 and create a binary mask image</span>
<span class="n">bet</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">BET</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bet_node&#39;</span><span class="p">)</span>

<span class="c1"># Define inputs </span>
<span class="n">bet</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">frac</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">bet</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">bet</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="n">input_file</span>
<span class="n">bet</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="n">output_file</span>

<span class="c1"># Run the node</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">bet</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:34:54,659 nipype.workflow INFO:
	 [Node] Setting-up &quot;bet_node&quot; in &quot;/storage/tmp/tmp155v5oga/bet_node&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:34:54,667 nipype.workflow INFO:
	 [Node] Executing &quot;bet_node&quot; &lt;nipype.interfaces.fsl.preprocess.BET&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:34:55,268 nipype.interface INFO:
	 stdout 2024-07-04T04:34:55.268472:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:34:55,270 nipype.interface INFO:
	 stdout 2024-07-04T04:34:55.268472:Error: input image sub-01_T1w not valid
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:34:55,272 nipype.interface INFO:
	 stdout 2024-07-04T04:34:55.268472:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:34:55,601 nipype.workflow INFO:
	 [Node] Finished &quot;bet_node&quot;, elapsed time 0.930461s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:34:55,606 nipype.workflow WARNING:
	 [Node] Error on &quot;bet_node&quot; (/storage/tmp/tmp155v5oga/bet_node)
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NodeExecutionError</span><span class="g g-Whitespace">                        </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">line</span> <span class="mi">17</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="n">bet</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">out_file</span> <span class="o">=</span> <span class="n">output_file</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="c1"># Run the node</span>
<span class="ne">---&gt; </span><span class="mi">17</span> <span class="n">res</span> <span class="o">=</span> <span class="n">bet</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py:527,</span> in <span class="ni">Node.run</span><span class="nt">(self, updatehash)</span>
<span class="g g-Whitespace">    </span><span class="mi">524</span> <span class="n">savepkl</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="s2">&quot;_inputs.pklz&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">get_traitsfree</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">526</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">527</span>     <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_interface</span><span class="p">(</span><span class="n">execute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">528</span> <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">529</span>     <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;[Node] Error on &quot;</span><span class="si">%s</span><span class="s1">&quot; (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py:645,</span> in <span class="ni">Node._run_interface</span><span class="nt">(self, execute, updatehash)</span>
<span class="g g-Whitespace">    </span><span class="mi">643</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_update_hash</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_results</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">645</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_command</span><span class="p">(</span><span class="n">execute</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py:771,</span> in <span class="ni">Node._run_command</span><span class="nt">(self, execute, copyfiles)</span>
<span class="g g-Whitespace">    </span><span class="mi">769</span>     <span class="c1"># Always pass along the traceback</span>
<span class="g g-Whitespace">    </span><span class="mi">770</span>     <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Traceback:</span><span class="se">\n</span><span class="si">{</span><span class="n">_tab</span><span class="p">(</span><span class="n">runtime</span><span class="o">.</span><span class="n">traceback</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="ne">--&gt; </span><span class="mi">771</span>     <span class="k">raise</span> <span class="n">NodeExecutionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">773</span> <span class="k">return</span> <span class="n">result</span>

<span class="ne">NodeExecutionError</span>: Exception raised while executing Node bet_node.

<span class="ne">Cmdline</span>:
	<span class="n">bet</span> <span class="n">sub</span><span class="o">-</span><span class="mi">01</span><span class="n">_T1w</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="o">/</span><span class="n">storage</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">tmpnvedqc2o</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">T1w_nipype_bet</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="o">-</span><span class="n">f</span> <span class="mf">0.30</span> <span class="o">-</span><span class="n">m</span>
<span class="ne">Stdout</span>:

	<span class="n">Error</span><span class="p">:</span> <span class="nb">input</span> <span class="n">image</span> <span class="n">sub</span><span class="o">-</span><span class="mi">01</span><span class="n">_T1w</span> <span class="ow">not</span> <span class="n">valid</span>

<span class="ne">Stderr</span>:

<span class="ne">Traceback</span>:
	<span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">subprocess</span> <span class="n">exited</span> <span class="k">with</span> <span class="n">code</span> <span class="mf">1.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shows produced outputs </span>
<span class="n">res</span><span class="o">.</span><span class="n">outputs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>inskull_mask_file = &lt;undefined&gt;
inskull_mesh_file = &lt;undefined&gt;
mask_file = &lt;undefined&gt;
meshfile = &lt;undefined&gt;
out_file = /storage/tmp/tmpnvedqc2o/output/T1w_nipype_bet.nii.gz
outline_file = &lt;undefined&gt;
outskin_mask_file = &lt;undefined&gt;
outskin_mesh_file = &lt;undefined&gt;
outskull_mask_file = &lt;undefined&gt;
outskull_mesh_file = &lt;undefined&gt;
skull_file = &lt;undefined&gt;
skull_mask_file = &lt;undefined&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot original input file</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_anat</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;BET input&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
          <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>

<span class="c1"># Plot skullstripped output file (out_file) through the outputs property</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_anat</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">out_file</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;BET output&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
          <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d5a60a9033bd5d03608bb9cb051c6ea8c74cab2e09420672dc3d406f7af4743f.png" src="_images/d5a60a9033bd5d03608bb9cb051c6ea8c74cab2e09420672dc3d406f7af4743f.png" />
<img alt="_images/845923ed033dc31ac234661ac793c3cba102534ac636ef8cdacc5056f5a1992e.png" src="_images/845923ed033dc31ac234661ac793c3cba102534ac636ef8cdacc5056f5a1992e.png" />
</div>
</div>
</section>
</section>
<section id="workflows">
<h3>3.3. Workflows<a class="headerlink" href="#workflows" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Define functionality for pipelined execution of interfaces</p></li>
<li><p>Consist of multiple nodes, each representing a specific interface.</p></li>
<li><p>The processing stream is encoded as a directed acyclic graph (DAG), where each stage of processing is a node. Nodes are unidirectionally dependent on others, ensuring no cycles and clear directionality. The Node and Workflow classes make these relationships explicit.</p></li>
<li><p>Edges represent the data flow between nodes.</p></li>
<li><p>Control the setup and the execution of individual interfaces.</p></li>
<li><p>Will take care of inputs and outputs of each interface and arrange the execution of each interface in the most efficient way.</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">nipype</span><span class="p">.</span><span class="nx">pipeline</span><span class="p">.</span><span class="nx">engine</span><span class="p">.</span><span class="nx">workflows</span> <span class="nx">module</span>

<span class="nx">Workflow</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">base_dir</span><span class="o">=</span><span class="nx">None</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>name:</strong> Label name of the workflow.</p></li>
<li><p><strong>base_dir:</strong> Defines the working directory for this instance of workflow element. Unlike interfaces, which by default store results in the local directory, the Workflow engine executes things off in its own directory hierarchy. By default (if not set manually), it is a temporary directory (/tmp).</p></li>
</ul>
<p>Workflow methods that we will use during this tutorial:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Workflow.connect()</span></code>: Connect nodes in the pipeline</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Workflow.write_graph()</span></code>: Generates a graphviz dot file and a png file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Workflow.run()</span></code>: Execute the workflow</p></li>
</ul>
<section id="example-workflow">
<h4><strong>Example: Workflow</strong><a class="headerlink" href="#example-workflow" title="Permalink to this heading">#</a></h4>
<p>First, define different nodes to:</p>
<ul class="simple">
<li><p>Skullstrip an image to obtain a mask</p></li>
<li><p>Smooth the original image</p></li>
<li><p>Mask the smoothed image</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">in_file</span> <span class="o">=</span> <span class="n">input_file</span> <span class="c1"># See node example</span>

<span class="c1"># Skullstrip process</span>
<span class="n">skullstrip</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">BET</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="n">in_file</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;skullstrip&quot;</span><span class="p">)</span>

<span class="c1"># Smooth process</span>
<span class="n">smooth</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">IsotropicSmooth</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="n">in_file</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;smooth&quot;</span><span class="p">)</span>

<span class="c1"># Mask process</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">ApplyMask</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mask&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a working directory for all workflows created during this workshop</span>
<span class="o">!</span> <span class="o">[</span> ! -d output/working_dir <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir output/working_dir

<span class="n">wf_work_dir</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;output/working_dir&#39;</span><span class="p">)</span> 

<span class="c1"># Initiation of a workflow with specifying the working directory.</span>
<span class="c1"># This specification of base_dir is very important (and is why we needed to use absolute paths above for the input files) because otherwise all the outputs would be saved somewhere in the temporary files.</span>
<span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;smoothflow&quot;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">wf_work_dir</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="connect-nodes-within-a-workflow">
<h4>Connect nodes within a workflow<a class="headerlink" href="#connect-nodes-within-a-workflow" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>method called <code class="docutils literal notranslate"><span class="pre">connect</span></code> that is going to do most of the work</p></li>
<li><p>checks if inputs and outputs are actually provided by the nodes that are being connected</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span> There are two different ways to call connect:</p>
<p>Establish one connection at a time:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="s2">&quot;source_output&quot;</span><span class="p">,</span> <span class="nx">dest</span><span class="p">,</span> <span class="s2">&quot;dest_input&quot;</span><span class="p">)</span> 
</pre></div>
</div>
<p>Establish multiple connections between two nodes at once:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">connect</span><span class="p">([(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">dest</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;source_output1&quot;</span><span class="p">,</span> <span class="s2">&quot;dest_input1&quot;</span><span class="p">),</span>
                         <span class="p">(</span><span class="s2">&quot;source_output2&quot;</span><span class="p">,</span> <span class="s2">&quot;dest_input2&quot;</span><span class="p">)</span>
                         <span class="p">])</span>
         <span class="p">])</span> 
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option 1: connect the binary mask of the skullstripping process to the mask node</span>
<span class="n">wf</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">skullstrip</span><span class="p">,</span> <span class="s2">&quot;mask_file&quot;</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="s2">&quot;mask_file&quot;</span><span class="p">)</span>

<span class="c1"># Option 2: connect the output of the smoothing node to the input of the masking node</span>
<span class="n">wf</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">smooth</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">)])])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Explore the workflow visually</span>
<span class="n">wf</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="s2">&quot;workflow_graph.dot&quot;</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span><span class="s2">&quot;smoothflow/workflow_graph.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:03,783 nipype.workflow INFO:
	 Generated workflow graph: /storage/tmp/tmpnvedqc2o/output/working_dir/smoothflow/workflow_graph.png (graph2use=hierarchical, simple_form=True).
</pre></div>
</div>
<img alt="_images/1a4df663e115ef30a998544286e65440c2d2b6070046ad45103b1c26c9186c8c.png" src="_images/1a4df663e115ef30a998544286e65440c2d2b6070046ad45103b1c26c9186c8c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Certain graph types also allow you to further inspect the individual connections between the nodes</span>
<span class="n">wf</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph2use</span><span class="o">=</span><span class="s1">&#39;flat&#39;</span><span class="p">)</span>

<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span><span class="s2">&quot;smoothflow/graph_detailed.png&quot;</span><span class="p">))</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:04,561 nipype.workflow INFO:
	 Generated workflow graph: /storage/tmp/tmpnvedqc2o/output/working_dir/smoothflow/graph.png (graph2use=flat, simple_form=True).
</pre></div>
</div>
<img alt="_images/9e3c819a37b16ea98986e1260d11c83d076f91a7edd9e662c6a87e8bad935a6b.png" src="_images/9e3c819a37b16ea98986e1260d11c83d076f91a7edd9e662c6a87e8bad935a6b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Execute the workflow (running serially here)</span>
<span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:04,601 nipype.workflow INFO:
	 Workflow smoothflow settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:04,611 nipype.workflow INFO:
	 Running serially.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:04,612 nipype.workflow INFO:
	 [Node] Setting-up &quot;smoothflow.skullstrip&quot; in &quot;/storage/tmp/tmpnvedqc2o/output/working_dir/smoothflow/skullstrip&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:04,618 nipype.workflow INFO:
	 [Node] Executing &quot;skullstrip&quot; &lt;nipype.interfaces.fsl.preprocess.BET&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,239 nipype.interface INFO:
	 stdout 2024-07-04T04:35:05.239431:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,242 nipype.interface INFO:
	 stdout 2024-07-04T04:35:05.239431:Error: input image sub-01_T1w not valid
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,243 nipype.interface INFO:
	 stdout 2024-07-04T04:35:05.239431:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,473 nipype.workflow INFO:
	 [Node] Finished &quot;skullstrip&quot;, elapsed time 0.852382s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,477 nipype.workflow WARNING:
	 [Node] Error on &quot;smoothflow.skullstrip&quot; (/storage/tmp/tmpnvedqc2o/output/working_dir/smoothflow/skullstrip)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,482 nipype.workflow ERROR:
	 Node skullstrip failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,483 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpnvedqc2o/crash-20240704-043505-ubuntu-skullstrip-c7ebcfef-612f-4f4f-bf39-942e42b2e1e8.pklz
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/linear.py&quot;, line 47, in run
    node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node skullstrip.

Cmdline:
	bet sub-01_T1w.nii.gz sub-01_T1w_brain.nii.gz -m
Stdout:

	Error: input image sub-01_T1w not valid

Stderr:

Traceback:
	RuntimeError: subprocess exited with code 1.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,486 nipype.workflow INFO:
	 [Node] Setting-up &quot;smoothflow.smooth&quot; in &quot;/storage/tmp/tmpnvedqc2o/output/working_dir/smoothflow/smooth&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,490 nipype.workflow INFO:
	 [Node] Executing &quot;smooth&quot; &lt;nipype.interfaces.fsl.maths.IsotropicSmooth&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,799 nipype.interface INFO:
	 stderr 2024-07-04T04:35:05.799398:Image Exception : #63 :: No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/anat/sub-01_T1w
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,801 nipype.interface INFO:
	 stderr 2024-07-04T04:35:05.801619:terminate called after throwing an instance of &#39;std::runtime_error&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:05,802 nipype.interface INFO:
	 stderr 2024-07-04T04:35:05.801619:  what():  No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/anat/sub-01_T1w
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,498 nipype.interface INFO:
	 stderr 2024-07-04T04:35:08.498210:/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/fslmaths: line 3: 2843711 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/fsl_6.0.7.4_20231005.simg fslmaths &quot;$@&quot;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,737 nipype.workflow INFO:
	 [Node] Finished &quot;smooth&quot;, elapsed time 3.244863s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,741 nipype.workflow WARNING:
	 [Node] Error on &quot;smoothflow.smooth&quot; (/storage/tmp/tmpnvedqc2o/output/working_dir/smoothflow/smooth)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,744 nipype.workflow ERROR:
	 Node smooth failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,745 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpnvedqc2o/crash-20240704-043508-ubuntu-smooth-2dd2bfc5-7a36-430b-916b-0e1d0b0d9120.pklz
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/linear.py&quot;, line 47, in run
    node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node smooth.

Cmdline:
	fslmaths /storage/tmp/tmpnvedqc2o/ds000102/sub-01/anat/sub-01_T1w.nii.gz -s 1.69864 /storage/tmp/tmpnvedqc2o/output/working_dir/smoothflow/smooth/sub-01_T1w_smooth.nii.gz
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/anat/sub-01_T1w
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/anat/sub-01_T1w
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/fslmaths: line 3: 2843711 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/fsl_6.0.7.4_20231005.simg fslmaths &quot;$@&quot;
Traceback:
	RuntimeError: subprocess exited with code 134.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,747 nipype.workflow INFO:
	 ***********************************
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,748 nipype.workflow ERROR:
	 could not run node: smoothflow.skullstrip
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,749 nipype.workflow INFO:
	 crashfile: /storage/tmp/tmpnvedqc2o/crash-20240704-043505-ubuntu-skullstrip-c7ebcfef-612f-4f4f-bf39-942e42b2e1e8.pklz
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,750 nipype.workflow ERROR:
	 could not run node: smoothflow.smooth
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,750 nipype.workflow INFO:
	 crashfile: /storage/tmp/tmpnvedqc2o/crash-20240704-043508-ubuntu-smooth-2dd2bfc5-7a36-430b-916b-0e1d0b0d9120.pklz
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:08,751 nipype.workflow INFO:
	 ***********************************
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NodeExecutionError</span><span class="g g-Whitespace">                        </span>Traceback (most recent call last)
<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/linear.py:47,</span> in <span class="ni">LinearPlugin.run</span><span class="nt">(self, graph, config, updatehash)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_status_callback</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">47</span>     <span class="n">node</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">updatehash</span><span class="o">=</span><span class="n">updatehash</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py:527,</span> in <span class="ni">Node.run</span><span class="nt">(self, updatehash)</span>
<span class="g g-Whitespace">    </span><span class="mi">526</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">527</span>     <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_interface</span><span class="p">(</span><span class="n">execute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">528</span> <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py:645,</span> in <span class="ni">Node._run_interface</span><span class="nt">(self, execute, updatehash)</span>
<span class="g g-Whitespace">    </span><span class="mi">644</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_results</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">645</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_command</span><span class="p">(</span><span class="n">execute</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py:771,</span> in <span class="ni">Node._run_command</span><span class="nt">(self, execute, copyfiles)</span>
<span class="g g-Whitespace">    </span><span class="mi">770</span>     <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Traceback:</span><span class="se">\n</span><span class="si">{</span><span class="n">_tab</span><span class="p">(</span><span class="n">runtime</span><span class="o">.</span><span class="n">traceback</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="ne">--&gt; </span><span class="mi">771</span>     <span class="k">raise</span> <span class="n">NodeExecutionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">773</span> <span class="k">return</span> <span class="n">result</span>

<span class="ne">NodeExecutionError</span>: Exception raised while executing Node skullstrip.

<span class="ne">Cmdline</span>:
	<span class="n">bet</span> <span class="n">sub</span><span class="o">-</span><span class="mi">01</span><span class="n">_T1w</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="n">sub</span><span class="o">-</span><span class="mi">01</span><span class="n">_T1w_brain</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span> <span class="o">-</span><span class="n">m</span>
<span class="ne">Stdout</span>:

	<span class="n">Error</span><span class="p">:</span> <span class="nb">input</span> <span class="n">image</span> <span class="n">sub</span><span class="o">-</span><span class="mi">01</span><span class="n">_T1w</span> <span class="ow">not</span> <span class="n">valid</span>

<span class="ne">Stderr</span>:

<span class="ne">Traceback</span>:
	<span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">subprocess</span> <span class="n">exited</span> <span class="k">with</span> <span class="n">code</span> <span class="mf">1.</span>

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Execute the workflow (running serially here)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">wf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/workflows.py:638,</span> in <span class="ni">Workflow.run</span><span class="nt">(self, plugin, plugin_args, updatehash)</span>
<span class="g g-Whitespace">    </span><span class="mi">636</span> <span class="k">if</span> <span class="n">str2bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;create_report&quot;</span><span class="p">]):</span>
<span class="g g-Whitespace">    </span><span class="mi">637</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_write_report_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">execgraph</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">638</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">execgraph</span><span class="p">,</span> <span class="n">updatehash</span><span class="o">=</span><span class="n">updatehash</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">639</span> <span class="n">datestr</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">640</span> <span class="k">if</span> <span class="n">str2bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;write_provenance&quot;</span><span class="p">]):</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/linear.py:82,</span> in <span class="ni">LinearPlugin.run</span><span class="nt">(self, graph, config, updatehash)</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span>     <span class="n">error</span><span class="p">,</span> <span class="n">cause</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>         <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> raised. Re-raising first.&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">79</span>         <span class="n">error</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span>     <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">82</span> <span class="k">raise</span> <span class="n">error</span> <span class="kn">from</span> <span class="nn">cause</span>

<span class="ne">RuntimeError</span>: 2 raised. Re-raising first.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the working directories of the workflow</span>
<span class="o">!</span>tree  output/working_dir/smoothflow/ -I <span class="s1">&#39;*js|*json|*html|*pklz|_report&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">output/working_dir/smoothflow/</span>
├── graph_detailed.dot
├── graph_detailed.png
├── graph.dot
├── graph.png
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">skullstrip</span>
│   ├── command.txt
│   └── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-01_T1w.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">/storage/tmp/tmpnvedqc2o/ds000102/sub-01/anat/sub-01_T1w.nii.gz</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">smooth</span>
│   └── command.txt
├── workflow_graph.dot
└── workflow_graph.png

2 directories, 9 files
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper function to plot 3D NIfTI images</span>
<span class="k">def</span> <span class="nf">plot_slice</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>

    <span class="c1"># Load the image</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>

    <span class="c1"># Cut in the middle of the brain</span>
    <span class="n">cut</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>

    <span class="c1"># Plot the data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">cut</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">input_file</span><span class="p">,</span>
                         <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s2">&quot;smoothflow/smooth/sub-01_T1w_smooth.nii.gz&quot;</span><span class="p">),</span>
                         <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s2">&quot;smoothflow/skullstrip/sub-01_T1w_brain_mask.nii.gz&quot;</span><span class="p">),</span>
                         <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s2">&quot;smoothflow/mask/sub-01_T1w_smooth_masked.nii.gz&quot;</span><span class="p">)]):</span>
    <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plot_slice</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">File ~/.local/lib/python3.10/site-packages/nibabel/loadsave.py:100,</span> in <span class="ni">load</span><span class="nt">(filename, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">99</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">100</span>     <span class="n">stat_result</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span> <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/smoothflow/smooth/sub-01_T1w_smooth.nii.gz&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">25</span><span class="p">],</span> <span class="n">line</span> <span class="mi">7</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">input_file</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                          <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s2">&quot;smoothflow/smooth/sub-01_T1w_smooth.nii.gz&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>                          <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s2">&quot;smoothflow/skullstrip/sub-01_T1w_brain_mask.nii.gz&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>                          <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s2">&quot;smoothflow/mask/sub-01_T1w_smooth_masked.nii.gz&quot;</span><span class="p">)]):</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">7</span>     <span class="n">plot_slice</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="nn">Cell In[24], line 5,</span> in <span class="ni">plot_slice</span><span class="nt">(fname)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">def</span> <span class="nf">plot_slice</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="c1"># Load the image</span>
<span class="ne">----&gt; </span><span class="mi">5</span>     <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="c1"># Cut in the middle of the brain</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/nibabel/loadsave.py:102,</span> in <span class="ni">load</span><span class="nt">(filename, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span>     <span class="n">stat_result</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span> <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">102</span>     <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No such file or no access: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span> <span class="k">if</span> <span class="n">stat_result</span><span class="o">.</span><span class="n">st_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span>     <span class="k">raise</span> <span class="n">ImageFileError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Empty file: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: No such file or no access: &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/smoothflow/smooth/sub-01_T1w_smooth.nii.gz&#39;
</pre></div>
</div>
<img alt="_images/b3af3f36c29c5b277032de457b8803a2d171aa4100131fcc0402149f824b19a4.png" src="_images/b3af3f36c29c5b277032de457b8803a2d171aa4100131fcc0402149f824b19a4.png" />
</div>
</div>
</section>
</section>
<section id="execution-plugins-execution-on-different-systems">
<h3>3.4. Execution Plugins: Execution on different systems<a class="headerlink" href="#execution-plugins-execution-on-different-systems" title="Permalink to this heading">#</a></h3>
<p>Allow seamless execution across many architectures and make using parallel computation quite easy.</p>
<ul class="simple">
<li><p>Local Machines:</p>
<ul>
<li><p><strong>Serial</strong>: Runs the workflow one node at a time in a single process locally. The order of the nodes is determined by a topolocial sort of the workflow.</p></li>
<li><p><strong>Multicore</strong>: Uses the Python multiprocessing library to distribute jobs as new processes on a local system.</p></li>
</ul>
</li>
<li><p>Submission to Cluster Schedulers:</p>
<ul>
<li><p>Plugins like HTCondor, PBS, SLURM, SGE, OAR, and LSF submit jobs to clusters managed by these job scheduling systems.</p></li>
</ul>
</li>
<li><p>Advanced Cluster Integration:</p>
<ul>
<li><p><strong>DAGMan</strong>: Manages complex workflow dependencies for submission to DAGMan cluster scheduler.</p></li>
<li><p><strong>IPython</strong>: Utilizes IPython parallel computing capabilities for distributed execution in clusters.</p></li>
</ul>
</li>
<li><p>Specialized Execution Plugins:</p>
<ul>
<li><p><strong>Soma-Workflow</strong>: Integrates with Soma-Workflow system for distributed execution in HPC environments.</p></li>
</ul>
</li>
</ul>
<p class="important-title" style="font-size: 1.2em; color: red;"><i class="fas fa-exclamation-circle" style="color: red;"></i> <span style="font-size: 1.5em;">Cluster operation often needs a special setup.</span></p>
<p>All plugins can be executed with:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">workflow</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="nx">PLUGIN_NAME</span><span class="p">,</span> <span class="nx">plugin_args</span><span class="o">=</span><span class="nx">ARGS_DICT</span><span class="p">)</span>
</pre></div>
</div>
<p>To run the workflow one node at a time:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="s1">&#39;Linear&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To distribute processing on a multicore machine, number of processors/threads will be automatically detected:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">)</span> 
</pre></div>
</div>
<p>Plugin arguments:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">arguments</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_procs&#39;</span> <span class="o">:</span> <span class="nx">num_threads</span><span class="p">,</span>
               <span class="s1">&#39;memory_gb&#39;</span> <span class="o">:</span> <span class="nx">num_gb</span><span class="p">}</span> 

<span class="nx">wf</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">,</span> <span class="nx">plugin_args</span><span class="o">=</span><span class="nx">arguments</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to use Nipype with SLURM simply call:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">wf</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">plugin</span><span class="o">=</span><span class="s1">&#39;SLURM&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p style="font-size: 13px;">Optional arguments:</p>
<p style="font-size: 13px;"><code>template</code>: If you want to use your own job submission template (the plugin generates a basic one by default).</p>
<p style="font-size: 13px;"><code>sbatch_args</code>: Takes any arguments such as nodes/partitions/gres/etc that you would want to pass on to the sbatch command underneath.</p>
<p style="font-size: 13px;"><code>jobid_re</code>: Regular expression for custom job submission id search.</p></section>
<section id="data-input-first-step-of-every-analysis">
<h3>3.5. Data Input: First step of every analysis<a class="headerlink" href="#data-input-first-step-of-every-analysis" title="Permalink to this heading">#</a></h3>
<p>Nipype provides many different modules how to get the data into the framework.</p>
<p>We will work through an example with the DataGrabber module:</p>
<ul class="simple">
<li><p><strong>DataGrabber:</strong>  Versatile input module to retrieve data from a local file system based on user-defined search criteria, including wildcard patterns, regular expressions, and directory hierarchies. It supports almost any file organization of your data.</p></li>
</ul>
<p>But there are many more alternatives available:</p>
<ul class="simple">
<li><p><strong>SelectFiles:</strong> A simpler alternative to the DataGrabber interface, built on Python format strings. Format strings allow you to replace named sections of template strings set off by curly braces ({}).</p></li>
<li><p><strong>BIDSDataGrabber:</strong> Get neuroimaging data organized in BIDS-compliant directory structures. It simplifies the process of accessing and organizing neuroimaging data for analysis pipelines.</p></li>
<li><p><strong>DataFinder:</strong>  Search for paths that match a given regular expression. Allows a less proscriptive approach to gathering input files compared to DataGrabber.</p></li>
<li><p><strong>FreeSurferSource:</strong> Specific case of a file grabber that facilitates the data import of outputs from the FreeSurfer recon-all algorithm.</p></li>
<li><p><strong>JSONFileGrabber:</strong> Datagrabber interface that loads a json file and generates an output for every first-level object.</p></li>
<li><p><strong>S3DataGrabber:</strong> Pull data from an Amazon S3 Bucket.</p></li>
<li><p><strong>SSHDataGrabber:</strong> Extension of DataGrabber module that downloads the file list and optionally the files from a SSH server.</p></li>
<li><p><strong>XNATSource:</strong> Pull data from an XNAT server.</p></li>
</ul>
<section id="example-datagrabber">
<h4><strong>Example: DataGrabber</strong><a class="headerlink" href="#example-datagrabber" title="Permalink to this heading">#</a></h4>
<p>Let’s assume we want to grab the anatomical and functional images of certain subjects of the Flanker dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree -L <span class="m">4</span> ds000102/ -I <span class="s1">&#39;*csv|*pdf&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">ds000102/</span>
├── CHANGES
├── dataset_description.json
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">derivatives</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">mriqc</span>
├── participants.tsv
├── README
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-01</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-01_T1w.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/Pf/6k/MD5E-s10581116--757e697a01eeea5c97a7d6fbc7153373.nii.gz/MD5E-s10581116--757e697a01eeea5c97a7d6fbc7153373.nii.gz</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-01_task-flanker_run-1_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/5m/w9/MD5E-s28061534--8e8c44ff53f9b5d46f2caae5916fa4ef.nii.gz/MD5E-s28061534--8e8c44ff53f9b5d46f2caae5916fa4ef.nii.gz</span>
│       ├── sub-01_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-01_task-flanker_run-2_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/2F/58/MD5E-s28143286--f0bcf782c3688e2cf7149b4665949484.nii.gz/MD5E-s28143286--f0bcf782c3688e2cf7149b4665949484.nii.gz</span>
│       └── sub-01_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-02</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-02_T1w.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/3m/FF/MD5E-s10737123--cbd4181ee26559e8ec0a441fa2f834a7.nii.gz/MD5E-s10737123--cbd4181ee26559e8ec0a441fa2f834a7.nii.gz</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-02_task-flanker_run-1_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/8v/2j/MD5E-s29188378--80050f0deb13562c24f2fc23f8d095bd.nii.gz/MD5E-s29188378--80050f0deb13562c24f2fc23f8d095bd.nii.gz</span>
│       ├── sub-02_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-02_task-flanker_run-2_bold.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">../../.git/annex/objects/fM/Kw/MD5E-s29193540--cc013f2d7d148b448edca8aada349d02.nii.gz/MD5E-s29193540--cc013f2d7d148b448edca8aada349d02.nii.gz</span>
│       └── sub-02_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-03</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-03_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/7W/9z/MD5E-s10707026--8f1858934cc7c7457e3a4a71cc2131fc.nii.gz/MD5E-s10707026--8f1858934cc7c7457e3a4a71cc2131fc.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-03_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/q6/kF/MD5E-s28755729--b19466702eee6b9385bd6e19e362f94c.nii.gz/MD5E-s28755729--b19466702eee6b9385bd6e19e362f94c.nii.gz
│       ├── sub-03_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-03_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/zV/K1/MD5E-s28782544--8d9700a435d08c90f0c1d534efdc8b69.nii.gz/MD5E-s28782544--8d9700a435d08c90f0c1d534efdc8b69.nii.gz
│       └── sub-03_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-04</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-04_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/FW/14/MD5E-s10738444--2a9a2ba4ea7d2324c84bf5a2882f196c.nii.gz/MD5E-s10738444--2a9a2ba4ea7d2324c84bf5a2882f196c.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-04_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9Z/0Q/MD5E-s29062799--27171406951ea275cb5857ea0dc32345.nii.gz/MD5E-s29062799--27171406951ea275cb5857ea0dc32345.nii.gz
│       ├── sub-04_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-04_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/FW/FZ/MD5E-s29071279--f89b61fe3ebab26df1374f2564bd95c2.nii.gz/MD5E-s29071279--f89b61fe3ebab26df1374f2564bd95c2.nii.gz
│       └── sub-04_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-05</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-05_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/k2/Kj/MD5E-s10753867--c4b5788da5f4c627f0f5862da5f46c35.nii.gz/MD5E-s10753867--c4b5788da5f4c627f0f5862da5f46c35.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-05_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/VZ/z5/MD5E-s29667270--0ce9ac78b6aa9a77fc94c655a6ff5a06.nii.gz/MD5E-s29667270--0ce9ac78b6aa9a77fc94c655a6ff5a06.nii.gz
│       ├── sub-05_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-05_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/z7/MP/MD5E-s29660544--752750dabb21e2cf28e87d1d550a71b9.nii.gz/MD5E-s29660544--752750dabb21e2cf28e87d1d550a71b9.nii.gz
│       └── sub-05_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-06</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-06_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/5w/G0/MD5E-s10620585--1132eab3830fe59b8a10b6582bb49004.nii.gz/MD5E-s10620585--1132eab3830fe59b8a10b6582bb49004.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-06_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/3x/qj/MD5E-s29386982--e671c0c647ce7d0d4596e35b702ee970.nii.gz/MD5E-s29386982--e671c0c647ce7d0d4596e35b702ee970.nii.gz
│       ├── sub-06_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-06_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9j/6P/MD5E-s29379265--e513a2746d2b5c603f96044cf48c557c.nii.gz/MD5E-s29379265--e513a2746d2b5c603f96044cf48c557c.nii.gz
│       └── sub-06_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-07</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-07_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/08/fF/MD5E-s10718092--38481fbc489dfb1ec4b174b57591a074.nii.gz/MD5E-s10718092--38481fbc489dfb1ec4b174b57591a074.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-07_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/z1/7W/MD5E-s28946009--5baf7a314874b280543fc0f91f2731af.nii.gz/MD5E-s28946009--5baf7a314874b280543fc0f91f2731af.nii.gz
│       ├── sub-07_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-07_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Jf/W7/MD5E-s28960603--682e13963bfc49cc6ae05e9ba5c62619.nii.gz/MD5E-s28960603--682e13963bfc49cc6ae05e9ba5c62619.nii.gz
│       └── sub-07_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-08</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-08_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/mw/MM/MD5E-s10561256--b94dddd8dc1c146aa8cd97f8d9994146.nii.gz/MD5E-s10561256--b94dddd8dc1c146aa8cd97f8d9994146.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-08_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/zX/v9/MD5E-s28641609--47314e6d1a14b8545686110b5b67f8b8.nii.gz/MD5E-s28641609--47314e6d1a14b8545686110b5b67f8b8.nii.gz
│       ├── sub-08_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-08_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/WZ/F0/MD5E-s28636310--4535bf26281e1c5556ad0d3468e7fe4e.nii.gz/MD5E-s28636310--4535bf26281e1c5556ad0d3468e7fe4e.nii.gz
│       └── sub-08_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-09</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-09_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/QJ/ZZ/MD5E-s10775967--e6a18e64bc0a6b17254a9564cf9b8f82.nii.gz/MD5E-s10775967--e6a18e64bc0a6b17254a9564cf9b8f82.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-09_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/k9/1X/MD5E-s29200533--59e86a903e0ab3d1d320c794ba1f0777.nii.gz/MD5E-s29200533--59e86a903e0ab3d1d320c794ba1f0777.nii.gz
│       ├── sub-09_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-09_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/W3/94/MD5E-s29223017--7f3fb9e260d3bd28e29b0b586ce4c344.nii.gz/MD5E-s29223017--7f3fb9e260d3bd28e29b0b586ce4c344.nii.gz
│       └── sub-09_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-10</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-10_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/5F/3f/MD5E-s10750712--bde2309077bffe22cb65e42ebdce5bfa.nii.gz/MD5E-s10750712--bde2309077bffe22cb65e42ebdce5bfa.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-10_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/3p/qp/MD5E-s29732696--339715d5cec387f4d44dfe94f304a429.nii.gz/MD5E-s29732696--339715d5cec387f4d44dfe94f304a429.nii.gz
│       ├── sub-10_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-10_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/11/Zx/MD5E-s29724034--16f2bf452524a315182f188becc1866d.nii.gz/MD5E-s29724034--16f2bf452524a315182f188becc1866d.nii.gz
│       └── sub-10_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-11</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-11_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/kj/xX/MD5E-s10534963--9e5bff7ec0b5df2850e1d05b1af281ba.nii.gz/MD5E-s10534963--9e5bff7ec0b5df2850e1d05b1af281ba.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-11_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/35/fk/MD5E-s28226875--d5012074c2c7a0a394861b010bcf9a8f.nii.gz/MD5E-s28226875--d5012074c2c7a0a394861b010bcf9a8f.nii.gz
│       ├── sub-11_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-11_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/j7/ff/MD5E-s28198976--c0a64e3b549568c44bb40b1588027c9a.nii.gz/MD5E-s28198976--c0a64e3b549568c44bb40b1588027c9a.nii.gz
│       └── sub-11_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-12</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-12_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/kx/2F/MD5E-s10550168--a7f651adc817b6678148b575654532a4.nii.gz/MD5E-s10550168--a7f651adc817b6678148b575654532a4.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-12_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/M0/fX/MD5E-s28403807--f1c3eb2e519020f4315a696ea845fc01.nii.gz/MD5E-s28403807--f1c3eb2e519020f4315a696ea845fc01.nii.gz
│       ├── sub-12_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-12_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/vW/V0/MD5E-s28424992--8740628349be3c056a0411bf4a852b25.nii.gz/MD5E-s28424992--8740628349be3c056a0411bf4a852b25.nii.gz
│       └── sub-12_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-13</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-13_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/wM/Xw/MD5E-s10609761--440413c3251d182086105649164222c6.nii.gz/MD5E-s10609761--440413c3251d182086105649164222c6.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-13_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/mf/M4/MD5E-s28180916--aa35f4ad0cf630d6396a8a2dd1f3dda6.nii.gz/MD5E-s28180916--aa35f4ad0cf630d6396a8a2dd1f3dda6.nii.gz
│       ├── sub-13_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-13_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/XP/76/MD5E-s28202786--8caf1ac548c87b2b35f85e8ae2bf72c1.nii.gz/MD5E-s28202786--8caf1ac548c87b2b35f85e8ae2bf72c1.nii.gz
│       └── sub-13_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-14</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-14_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Zw/0z/MD5E-s9223596--33abfb5da565f3487e3a7aebc15f940c.nii.gz/MD5E-s9223596--33abfb5da565f3487e3a7aebc15f940c.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-14_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Jp/29/MD5E-s29001492--250f1e4daa9be1d95e06af0d56629cc9.nii.gz/MD5E-s29001492--250f1e4daa9be1d95e06af0d56629cc9.nii.gz
│       ├── sub-14_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-14_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/PK/V2/MD5E-s29068193--5621a3b0af8132c509420b4ad9aaf8fb.nii.gz/MD5E-s29068193--5621a3b0af8132c509420b4ad9aaf8fb.nii.gz
│       └── sub-14_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-15</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-15_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Mz/qq/MD5E-s10752891--ddd2622f115ec0d29a0c7ab2366f6f95.nii.gz/MD5E-s10752891--ddd2622f115ec0d29a0c7ab2366f6f95.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-15_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/08/JJ/MD5E-s28285239--feda22c4526af1910fcee58d4c42f07e.nii.gz/MD5E-s28285239--feda22c4526af1910fcee58d4c42f07e.nii.gz
│       ├── sub-15_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-15_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9f/0W/MD5E-s28289760--433000a1def662e72d8433dba151c61b.nii.gz/MD5E-s28289760--433000a1def662e72d8433dba151c61b.nii.gz
│       └── sub-15_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-16</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-16_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/4g/8k/MD5E-s10927450--a196f7075c793328dd6ff3cebf36ea6b.nii.gz/MD5E-s10927450--a196f7075c793328dd6ff3cebf36ea6b.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-16_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/9z/g2/MD5E-s29757991--1a1648b2fa6cc74e31c94f109d8137ba.nii.gz/MD5E-s29757991--1a1648b2fa6cc74e31c94f109d8137ba.nii.gz
│       ├── sub-16_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-16_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/k8/4F/MD5E-s29773832--fe08739ea816254395b985ee704aaa99.nii.gz/MD5E-s29773832--fe08739ea816254395b985ee704aaa99.nii.gz
│       └── sub-16_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-17</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-17_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/jQ/MQ/MD5E-s10826014--8e2a6b062df4d1c4327802f2b905ef36.nii.gz/MD5E-s10826014--8e2a6b062df4d1c4327802f2b905ef36.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-17_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Wz/2P/MD5E-s28991563--9845f461a017a39d1f6e18baaa0c9c41.nii.gz/MD5E-s28991563--9845f461a017a39d1f6e18baaa0c9c41.nii.gz
│       ├── sub-17_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-17_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/jF/3m/MD5E-s29057821--84ccc041163bcc5b3a9443951e2a5a78.nii.gz/MD5E-s29057821--84ccc041163bcc5b3a9443951e2a5a78.nii.gz
│       └── sub-17_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-18</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-18_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/3v/pK/MD5E-s10571510--6fc4b5792bc50ea4d14eb5247676fafe.nii.gz/MD5E-s10571510--6fc4b5792bc50ea4d14eb5247676fafe.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-18_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/94/P2/MD5E-s28185776--5b3879ec6fc4bbe1e48efc64984f88cf.nii.gz/MD5E-s28185776--5b3879ec6fc4bbe1e48efc64984f88cf.nii.gz
│       ├── sub-18_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-18_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/qp/6K/MD5E-s28234699--58019d798a133e5d7806569374dd8160.nii.gz/MD5E-s28234699--58019d798a133e5d7806569374dd8160.nii.gz
│       └── sub-18_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-19</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-19_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Zw/p8/MD5E-s8861893--d338005753d8af3f3d7bd8dc293e2a97.nii.gz/MD5E-s8861893--d338005753d8af3f3d7bd8dc293e2a97.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-19_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/04/k6/MD5E-s28178448--3874e748258cf19aa69a05a7c37ad137.nii.gz/MD5E-s28178448--3874e748258cf19aa69a05a7c37ad137.nii.gz
│       ├── sub-19_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-19_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/mz/P4/MD5E-s28190932--91e6b3e4318ca28f01de8cb967cf8421.nii.gz/MD5E-s28190932--91e6b3e4318ca28f01de8cb967cf8421.nii.gz
│       └── sub-19_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-20</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-20_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/g1/FF/MD5E-s11025608--5929806a7aa5720fc755687e1450b06c.nii.gz/MD5E-s11025608--5929806a7aa5720fc755687e1450b06c.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-20_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/v5/ZJ/MD5E-s29931631--bf9abb057367ce66961f0b7913e8e707.nii.gz/MD5E-s29931631--bf9abb057367ce66961f0b7913e8e707.nii.gz
│       ├── sub-20_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-20_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/J3/KW/MD5E-s29945590--96cfd5b77cd096f6c6a3530015fea32d.nii.gz/MD5E-s29945590--96cfd5b77cd096f6c6a3530015fea32d.nii.gz
│       └── sub-20_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-21</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-21_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/K6/6K/MD5E-s8662805--77b262ddd929fa08d78591bfbe558ac6.nii.gz/MD5E-s8662805--77b262ddd929fa08d78591bfbe558ac6.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-21_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Wz/p9/MD5E-s28756041--9ae556d4e3042532d25af5dc4ab31840.nii.gz/MD5E-s28756041--9ae556d4e3042532d25af5dc4ab31840.nii.gz
│       ├── sub-21_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-21_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/xF/M3/MD5E-s28758438--81866411fc6b6333ec382a20ff0be718.nii.gz/MD5E-s28758438--81866411fc6b6333ec382a20ff0be718.nii.gz
│       └── sub-21_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-22</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-22_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/JG/ZV/MD5E-s9282392--9e7296a6a5b68df46b77836182b6681a.nii.gz/MD5E-s9282392--9e7296a6a5b68df46b77836182b6681a.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-22_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/qW/Gw/MD5E-s28002098--c6bea10177a38667ceea3261a642b3c6.nii.gz/MD5E-s28002098--c6bea10177a38667ceea3261a642b3c6.nii.gz
│       ├── sub-22_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-22_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/VX/Zj/MD5E-s28027568--b34d0df9ad62485aba25296939429885.nii.gz/MD5E-s28027568--b34d0df9ad62485aba25296939429885.nii.gz
│       └── sub-22_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-23</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-23_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/4Z/4x/MD5E-s10626062--db5a6ba6730b319c6425f2e847ce9b14.nii.gz/MD5E-s10626062--db5a6ba6730b319c6425f2e847ce9b14.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-23_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/VK/8F/MD5E-s28965005--4a9a96d9322563510ca14439e7fd6cea.nii.gz/MD5E-s28965005--4a9a96d9322563510ca14439e7fd6cea.nii.gz
│       ├── sub-23_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-23_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/56/20/MD5E-s29050413--753b0d2c23c4af6592501219c2e2c6bd.nii.gz/MD5E-s29050413--753b0d2c23c4af6592501219c2e2c6bd.nii.gz
│       └── sub-23_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-24</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-24_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/jQ/fV/MD5E-s10739691--458f0046eff18ee8c43456637766a819.nii.gz/MD5E-s10739691--458f0046eff18ee8c43456637766a819.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-24_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/km/fV/MD5E-s29354610--29ebfa60e52d49f7dac6814cb5fdc2bc.nii.gz/MD5E-s29354610--29ebfa60e52d49f7dac6814cb5fdc2bc.nii.gz
│       ├── sub-24_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-24_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Wj/KK/MD5E-s29423307--fedaa1d7c6e34420735bb3bbe5a2fe38.nii.gz/MD5E-s29423307--fedaa1d7c6e34420735bb3bbe5a2fe38.nii.gz
│       └── sub-24_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-25</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-25_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/Gk/FQ/MD5E-s8998578--f560d832f13e757b485c16d570bf6ebc.nii.gz/MD5E-s8998578--f560d832f13e757b485c16d570bf6ebc.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-25_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/XW/1v/MD5E-s29473003--49b04e7e4b450ec5ef93ff02d4158775.nii.gz/MD5E-s29473003--49b04e7e4b450ec5ef93ff02d4158775.nii.gz
│       ├── sub-25_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-25_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/Qm/M7/MD5E-s29460132--b0e9039e9f33510631f229c8c2193285.nii.gz/MD5E-s29460132--b0e9039e9f33510631f229c8c2193285.nii.gz
│       └── sub-25_task-flanker_run-2_events.tsv
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-26</span>
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│   │   └── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-26_T1w.nii.gz</span> -&gt; ../../.git/annex/objects/kf/9F/MD5E-s10850250--5f103b2660f488e4afa193f9307c1291.nii.gz/MD5E-s10850250--5f103b2660f488e4afa193f9307c1291.nii.gz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">func</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-26_task-flanker_run-1_bold.nii.gz</span> -&gt; ../../.git/annex/objects/QV/10/MD5E-s30127491--8e30aa4bbfcc461bac8598bf621283c5.nii.gz/MD5E-s30127491--8e30aa4bbfcc461bac8598bf621283c5.nii.gz
│       ├── sub-26_task-flanker_run-1_events.tsv
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Red -Color-Bold-Red-BGBlack">sub-26_task-flanker_run-2_bold.nii.gz</span> -&gt; ../../.git/annex/objects/3G/Q6/MD5E-s30162480--80fd132e7cb1600ab248249e78f6f1aa.nii.gz/MD5E-s30162480--80fd132e7cb1600ab248249e78f6f1aa.nii.gz
│       └── sub-26_task-flanker_run-2_events.tsv
├── T1w.json
└── task-flanker_bold.json

80 directories, 136 files
</pre></div>
</div>
</div>
</div>
<p>The two files we desire are at the following locations:</p>
<ul class="simple">
<li><p><strong>anatomical image:</strong>  <span style="color:blue">ds000102</span>/<span style="color:orange">sub-01</span>/anat/<span style="color:orange">sub-01</span>_T1w.nii.gz</p></li>
<li><p><strong>functional image:</strong> <span style="color:blue">ds000102</span>/<span style="color:orange">sub-01</span>/func/<span style="color:orange">sub-01</span>_task-flanker<span style="color:red">_run-1</span>_bold.nii.gz</p></li>
</ul>
<p>This means that we can rewrite the paths as follows:</p>
<ul class="simple">
<li><p><strong>anat</strong> = <span style="color:blue">base_directory</span>/sub-<span style="color:orange">[subject_id]</span>/anat/sub-<span style="color:orange">[subject_id]</span>_T1w.nii.gz</p></li>
<li><p><strong>func</strong> = <span style="color:blue">base_directory</span>/sub-<span style="color:orange">[subject_id]</span>/func/sub-<span style="color:orange">[subject_id]</span>_task-flanker_run_<span style="color:red">[run_id]</span>_bold.nii.gz</p></li>
</ul>
<p>Therefore, we need the parameters <span style="color:orange">subject_id</span> for the anatomical image and the parameters <span style="color:orange">subject_id</span>, and <span style="color:red">run_id</span> for the functional images. In the context of DataGabber, this is specified as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input: Set the input file path</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;ds000102&#39;</span><span class="p">)</span> <span class="c1">#base_directory of the data</span>

<span class="c1"># Dynamic parameters</span>
<span class="n">subj_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;02&#39;</span><span class="p">]</span> <span class="c1">#subject_id</span>
<span class="n">run_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">#run_id</span>

<span class="c1"># Initialise workflow</span>
<span class="n">wf_input</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;data_input&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">wf_work_dir</span><span class="p">)</span> <span class="c1"># base_dir: Set path where nipype will store stepwise results</span>
<span class="n">wf_input</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;crashfile_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create DataGrabber node with input fields for all dynamic parameters (e.g. subject identifier, run identifier), </span>
<span class="c1"># as well as the two desired output fields anat and func.</span>

<span class="n">dg</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span> <span class="n">DataGrabber</span><span class="p">(</span><span class="n">infields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;run_id&quot;</span><span class="p">],</span> <span class="n">outfields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;func&quot;</span><span class="p">]),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dg&quot;</span><span class="p">)</span>

<span class="c1"># Location of dataset folder</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">data_dir</span>
<span class="c1"># Necessary default parameters</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sort_filelist</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#return a sorted filelist to ensure to match files to correct runs/tasks</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span> <span class="c1">#wildcard</span>
<span class="c1"># Specify run_ids</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">run_list</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define arguments to fill the wildcards in the below paths </span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">anat</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]],</span>
    <span class="n">func</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span><span class="s2">&quot;run_id&quot;</span><span class="p">]],</span>
<span class="p">)</span>

<span class="c1"># Specify the template structure to find the specific data</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">field_template</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">anat</span><span class="o">=</span><span class="s2">&quot;sub-</span><span class="si">%s</span><span class="s2">/anat/sub-</span><span class="si">%s</span><span class="s2">_T1w.nii.gz&quot;</span><span class="p">,</span>
    <span class="n">func</span><span class="o">=</span><span class="s2">&quot;sub-</span><span class="si">%s</span><span class="s2">/func/sub-</span><span class="si">%s</span><span class="s2">_task-flanker_run-</span><span class="si">%d</span><span class="s2">_bold.nii.gz&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To feed dynamic parameters into the node either do this by specifying them directly as node inputs, or using another node and feed <strong>subject_id</strong> as connections to the DataGrabber node.</p>
<p>Specifying the input fields of DataGrabber directly for one subject:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">dg</span><span class="p">.</span><span class="nx">inputs</span><span class="p">.</span><span class="nx">subject_id</span> <span class="o">=</span> <span class="s1">&#39;01&#39;</span>
</pre></div>
</div>
<p>If we want to start our workflow from creating subgraphs, i.e. running it for more than one subject, we can use another node:
<strong>IdentityInterface</strong>, which is a special use case of <strong>iterables</strong>. It allows to create Nodes that do simple identity mapping, i.e. Nodes that only work on parameters/strings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infosource</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]),</span>
                  <span class="n">name</span><span class="o">=</span><span class="s2">&quot;infosource&quot;</span><span class="p">)</span>
<span class="c1"># Run a workflow iterating over various inputs using the iterables attribute of nodes --&gt; splits up the workflow</span>
<span class="n">infosource</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="n">subj_list</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connect the nodes and run the workflow</span>
<span class="n">wf_input</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">infosource</span><span class="p">,</span> <span class="n">dg</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="s2">&quot;subject_id&quot;</span><span class="p">)])])</span>

<span class="n">wf_input</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,271 nipype.workflow INFO:
	 Workflow data_input settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,283 nipype.workflow INFO:
	 Running serially.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,284 nipype.workflow INFO:
	 [Node] Setting-up &quot;data_input.dg&quot; in &quot;/storage/tmp/tmpnvedqc2o/output/working_dir/data_input/_subject_id_01/dg&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,290 nipype.workflow INFO:
	 [Node] Executing &quot;dg&quot; &lt;nipype.interfaces.io.DataGrabber&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,294 nipype.workflow INFO:
	 [Node] Finished &quot;dg&quot;, elapsed time 0.000885s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,300 nipype.workflow INFO:
	 [Node] Setting-up &quot;data_input.dg&quot; in &quot;/storage/tmp/tmpnvedqc2o/output/working_dir/data_input/_subject_id_02/dg&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,305 nipype.workflow INFO:
	 [Node] Executing &quot;dg&quot; &lt;nipype.interfaces.io.DataGrabber&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,308 nipype.workflow INFO:
	 [Node] Finished &quot;dg&quot;, elapsed time 0.000694s.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;networkx.classes.digraph.DiGraph at 0x7f0ef987b8e0&gt;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data-output">
<h3>3.6. Data Output<a class="headerlink" href="#data-output" title="Permalink to this heading">#</a></h3>
<p>A workflow working directory is like a cache containing the outputs of various processing stages and various extraneous information such as execution reports, hashfiles determining the input state of processes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree  output/working_dir/smoothflow/ -I <span class="s1">&#39;*js|*dot|*png|*html|*json&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">output/working_dir/smoothflow/</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">skullstrip</span>
│   ├── command.txt
│   ├── _inputs.pklz
│   ├── _node.pklz
│   ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">_report</span>
│   │   └── report.rst
│   ├── result_skullstrip.pklz
│   └── <span class=" -Color -Color-Bold -Color-Bold-Cyan">sub-01_T1w.nii.gz</span> -&gt; <span class=" -Color -Color-Bold -Color-Bold-Red">/storage/tmp/tmpnvedqc2o/ds000102/sub-01/anat/sub-01_T1w.nii.gz</span>
└── <span class=" -Color -Color-Bold -Color-Bold-Blue">smooth</span>
    ├── command.txt
    ├── _inputs.pklz
    ├── _node.pklz
    ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">_report</span>
    │   └── report.rst
    └── result_smooth.pklz

4 directories, 11 files
</pre></div>
</div>
</div>
</div>
<p>Data output modules allow to <em>restructure</em> and <em>rename</em> computed output and to spatially differentiate relevant output files from the temporary computed intermediate files in the working directory.</p>
<p>In this tutorial, we will look into the DataSink module:</p>
<ul class="simple">
<li><p><strong>DataSink:</strong> Nipype’s standard output module, which allows the creation of arbitrary input attributes. The names of these attributes define the directory structure to be created for storing the files or directories.</p></li>
</ul>
<p>Nipype also provides some simple frontends for storing values into a JSON File, MySQL and SQLite database or an XNAT Servers.</p>
<ul class="simple">
<li><p><strong>JSONFileSink</strong></p></li>
<li><p><strong>MySQLSink</strong></p></li>
<li><p><strong>SQLiteSink</strong></p></li>
<li><p><strong>XNATSink</strong></p></li>
</ul>
<section id="example-datasink">
<h4><strong>Example: DataSink</strong><a class="headerlink" href="#example-datasink" title="Permalink to this heading">#</a></h4>
<p>The following code segment defines the DataSink node and sets the <code class="docutils literal notranslate"><span class="pre">base_directory</span></code> in which all outputs will be stored. The <code class="docutils literal notranslate"><span class="pre">container</span></code> input creates a subdirectory within the base_directory.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">from</span> <span class="nx">nipype</span><span class="p">.</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">io</span> <span class="k">import</span> <span class="nx">DataSink</span>


<span class="nx">datasink</span> <span class="o">=</span> <span class="nx">Node</span><span class="p">(</span><span class="nx">DataSink</span><span class="p">(),</span> <span class="nx">name</span><span class="o">=</span><span class="s1">&#39;sinker&#39;</span><span class="p">)</span>
<span class="nx">datasink</span><span class="p">.</span><span class="nx">inputs</span><span class="p">.</span><span class="nx">base_directory</span> <span class="o">=</span> <span class="s1">&#39;/path/to/output&#39;</span>
<span class="nx">workflow</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">inputnode</span><span class="p">,</span> <span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="nx">datasink</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To store different outputs in the same place, a second port needs to be created with (.)  This stores the files in a separate subfolder called mask:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">workflow</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">inputnode</span><span class="p">,</span> <span class="s1">&#39;mask_out_file&#39;</span><span class="p">,</span> <span class="nx">datasink</span><span class="p">,</span> <span class="s1">&#39;container.mask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to store the files in the same folder, use the .&#64; syntax. The &#64; tells the DataSink interface to not create the subfolder. This will allow to create different named input ports for DataSink and allow the user to store the files in the same folder.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">workflow</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">inputnode</span><span class="p">,</span> <span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="nx">datasink</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">)</span>
<span class="nx">workflow</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">inputnode</span><span class="p">,</span> <span class="s1">&#39;mask_out_file&#39;</span><span class="p">,</span> <span class="nx">datasink</span><span class="p">,</span> <span class="s1">&#39;container.@mask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="important-title" style="font-size: 1.5em; color: purple;">
    🥳 <span style="font-size: 1.5em;">Final Example: Mini-Preprocessing-Workflow</span>
</p>
<ul class="simple">
<li><p><strong>Input Stream</strong>: DataGrabber to grab the functional image (run-1) of sub-01</p></li>
<li><p><strong>FSL-Interfaces</strong>: Motion correction and spatial smoothing (kernel of 4 mm) of the functional image</p></li>
<li><p><strong>Output Stream</strong>: DataSink to grab the motion-corrected image, the motion parameters and the smoothed image</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialise Workflow</span>
<span class="n">wf_preproc</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;preproc&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">wf_work_dir</span><span class="p">)</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">][</span><span class="s2">&quot;crashfile_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>

<span class="c1"># DataGrabber Node</span>
<span class="n">dg</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">interface</span><span class="o">=</span> <span class="n">DataGrabber</span><span class="p">(</span><span class="n">infields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="s2">&quot;run_id&quot;</span><span class="p">],</span> <span class="n">outfields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">]),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dg&quot;</span><span class="p">)</span>

<span class="c1"># Location of dataset folder</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">data_dir</span>
<span class="c1"># Necessary default parameters</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sort_filelist</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#return a sorted filelist to ensure to match files to correct runs/tasks</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subject_id</span> <span class="o">=</span> <span class="s1">&#39;01&#39;</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">func</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="s2">&quot;subject_id&quot;</span><span class="p">,</span> <span class="s2">&quot;run_id&quot;</span><span class="p">]],</span>
<span class="p">)</span>

<span class="c1"># Specify the template structure to find the specific data</span>
<span class="n">dg</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">field_template</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">func</span><span class="o">=</span><span class="s2">&quot;sub-</span><span class="si">%s</span><span class="s2">/func/sub-</span><span class="si">%s</span><span class="s2">_task-flanker_run-</span><span class="si">%d</span><span class="s2">_bold.nii.gz&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Motion Correction Node</span>
<span class="n">mcflirt</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">MCFLIRT</span><span class="p">(</span><span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> 
               <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mcflirt&#39;</span><span class="p">)</span>

<span class="c1"># Create Smoothing node</span>
<span class="n">smooth</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">fsl</span><span class="o">.</span><span class="n">IsotropicSmooth</span><span class="p">(</span><span class="n">fwhm</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
              <span class="n">name</span><span class="o">=</span><span class="s1">&#39;smooth&#39;</span><span class="p">)</span>

<span class="c1"># Connect the three nodes to each other</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">dg</span><span class="p">,</span> <span class="n">mcflirt</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;func&quot;</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">)]),</span>
                    <span class="p">(</span><span class="n">mcflirt</span><span class="p">,</span> <span class="n">smooth</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;out_file&quot;</span><span class="p">,</span> <span class="s2">&quot;in_file&quot;</span><span class="p">)])])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create DataSink object</span>
<span class="n">sinker</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">DataSink</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sinker&#39;</span><span class="p">)</span>

<span class="c1"># Name of the output folder</span>
<span class="n">sinker</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">base_directory</span> <span class="o">=</span> <span class="n">opj</span><span class="p">(</span><span class="n">wf_work_dir</span><span class="p">,</span> <span class="s1">&#39;preproc/results&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save output in one folder called &#39;preproc&#39; with .@</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">smooth</span><span class="p">,</span> <span class="n">sinker</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;sub-01.@in_file&#39;</span><span class="p">)]),</span>
                    <span class="p">(</span><span class="n">mcflirt</span><span class="p">,</span> <span class="n">sinker</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;sub-01.@mc_img&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;par_file&#39;</span><span class="p">,</span> <span class="s1">&#39;sub-01.@par_file&#39;</span><span class="p">)]),</span>
                   <span class="p">])</span>

<span class="c1"># Visualize the graph</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph2use</span><span class="o">=</span><span class="s1">&#39;colored&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">simple_form</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">opj</span><span class="p">(</span><span class="n">wf_preproc</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">wf_preproc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;graph.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,878 nipype.workflow INFO:
	 Generated workflow graph: /storage/tmp/tmpnvedqc2o/output/working_dir/preproc/graph.png (graph2use=colored, simple_form=True).
</pre></div>
</div>
<img alt="_images/d50ecb11d46510a81b52f8f497d82bc477d7ca337dfa8a8154e2fe6181394f2a.png" src="_images/d50ecb11d46510a81b52f8f497d82bc477d7ca337dfa8a8154e2fe6181394f2a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run workflow with distributed processing</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,903 nipype.workflow INFO:
	 Workflow preproc settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,911 nipype.workflow INFO:
	 Running in parallel.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:10,922 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 113.22/113.22, Free processors: 32/32.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:11,763 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.dg&quot; in &quot;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/dg&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:11,775 nipype.workflow INFO:
	 [Node] Executing &quot;dg&quot; &lt;nipype.interfaces.io.DataGrabber&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:11,782 nipype.workflow INFO:
	 [Node] Finished &quot;dg&quot;, elapsed time 0.001436s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:12,924 nipype.workflow INFO:
	 [Job 0] Completed (preproc.dg).
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:12,935 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 113.22/113.22, Free processors: 32/32.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:13,471 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.mcflirt&quot; in &quot;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:13,496 nipype.workflow INFO:
	 [Node] Executing &quot;mcflirt&quot; &lt;nipype.interfaces.fsl.preprocess.MCFLIRT&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:14,768 nipype.workflow INFO:
	 [Node] Finished &quot;mcflirt&quot;, elapsed time 1.259483s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:14,771 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:14,777 nipype.workflow WARNING:
	 [Node] Error on &quot;preproc.mcflirt&quot; (/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:14,927 nipype.workflow ERROR:
	 Node mcflirt failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:14,931 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpnvedqc2o/crash-20240704-043514-ubuntu-mcflirt-605fdcfa-2ef5-4dc5-a423-408fe524aa34.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node mcflirt.

Cmdline:
	mcflirt -in /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz -out /storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz -plots
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	Image Exception : #22 :: Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
	Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
	Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/mcflirt: line 3: 2843872 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/fsl_6.0.7.4_20231005.simg mcflirt &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;par_file&#39; trait of a MCFLIRTOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz.par&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz.par&#39; for output &#39;par_file&#39; of a MCFLIRT interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:14,936 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 113.22/113.22, Free processors: 32/32.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:16,923 nipype.workflow INFO:
	 ***********************************
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:16,927 nipype.workflow ERROR:
	 could not run node: preproc.mcflirt
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:16,928 nipype.workflow INFO:
	 crashfile: /storage/tmp/tmpnvedqc2o/crash-20240704-043514-ubuntu-mcflirt-605fdcfa-2ef5-4dc5-a423-408fe524aa34.txt
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:16,930 nipype.workflow INFO:
	 ***********************************
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
Cell In[37], line 2
      1 # Run workflow with distributed processing
----&gt; 2 wf_preproc.run(&#39;MultiProc&#39;)

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/workflows.py:638, in Workflow.run(self, plugin, plugin_args, updatehash)
    636 if str2bool(self.config[&quot;execution&quot;][&quot;create_report&quot;]):
    637     self._write_report_info(self.base_dir, self.name, execgraph)
--&gt; 638 runner.run(execgraph, updatehash=updatehash, config=self.config)
    639 datestr = datetime.utcnow().strftime(&quot;%Y%m%dT%H%M%S&quot;)
    640 if str2bool(self.config[&quot;execution&quot;][&quot;write_provenance&quot;]):

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/base.py:224, in DistributedPluginBase.run(self, graph, config, updatehash)
    218 if len(errors) &gt; 1:
    219     error, cause = (
    220         RuntimeError(f&quot;{len(errors)} raised. Re-raising first.&quot;),
    221         error,
    222     )
--&gt; 224 raise error from cause

RuntimeError: Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/multiproc.py&quot;, line 67, in run_node
    result[&quot;result&quot;] = node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node mcflirt.

Cmdline:
	mcflirt -in /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz -out /storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz -plots
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	Image Exception : #22 :: Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
	Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
	Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/mcflirt: line 3: 2843872 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/fsl_6.0.7.4_20231005.simg mcflirt &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;par_file&#39; trait of a MCFLIRTOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz.par&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz.par&#39; for output &#39;par_file&#39; of a MCFLIRT interface

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> tree output/working_dir/preproc/results
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>output/working_dir/preproc/results  [error opening dir]

0 directories, 0 files
</pre></div>
</div>
</div>
</div>
<p class="important-title" style="font-size: 1.5em; color: gold;"><i class="fas fa-lightbulb" style="color: gold;"></i> <span style="font-size: 1.5em;">Tip</span></p>
<ul>
DataSink offers the substitution input field to rename output files.
For example, to get rid of the string 'bold' and to adapt the file ending of the motion parameter file:
</ul><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define substitution strings</span>
<span class="n">substitutions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;_bold&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s1">&#39;.nii.gz.par&#39;</span><span class="p">,</span> <span class="s1">&#39;.par&#39;</span><span class="p">)]</span>

<span class="c1"># Feed the substitution strings to the DataSink node</span>
<span class="n">sinker</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">=</span> <span class="n">substitutions</span>

<span class="c1"># Run the workflow again with the substitutions in place</span>
<span class="n">wf_preproc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,362 nipype.workflow INFO:
	 Workflow preproc settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,375 nipype.workflow INFO:
	 Running serially.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,377 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.dg&quot; in &quot;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/dg&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,383 nipype.workflow INFO:
	 [Node] Executing &quot;dg&quot; &lt;nipype.interfaces.io.DataGrabber&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,387 nipype.workflow INFO:
	 [Node] Finished &quot;dg&quot;, elapsed time 0.000694s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,392 nipype.workflow INFO:
	 [Node] Setting-up &quot;preproc.mcflirt&quot; in &quot;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,397 nipype.workflow INFO:
	 [Node] Executing &quot;mcflirt&quot; &lt;nipype.interfaces.fsl.preprocess.MCFLIRT&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,681 nipype.interface INFO:
	 stderr 2024-07-04T04:35:17.681066:Image Exception : #63 :: No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,684 nipype.interface INFO:
	 stderr 2024-07-04T04:35:17.684005:Image Exception : #22 :: Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,685 nipype.interface INFO:
	 stderr 2024-07-04T04:35:17.684005:Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,686 nipype.interface INFO:
	 stderr 2024-07-04T04:35:17.684005:terminate called after throwing an instance of &#39;std::runtime_error&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,686 nipype.interface INFO:
	 stderr 2024-07-04T04:35:17.684005:  what():  Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:17,687 nipype.interface INFO:
	 stderr 2024-07-04T04:35:17.684005:Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,103 nipype.interface INFO:
	 stderr 2024-07-04T04:35:18.103220:/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/mcflirt: line 3: 2843937 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/fsl_6.0.7.4_20231005.simg mcflirt &quot;$@&quot;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,375 nipype.workflow INFO:
	 [Node] Finished &quot;mcflirt&quot;, elapsed time 0.973386s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,376 nipype.workflow WARNING:
	 Storing result file without outputs
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,381 nipype.workflow WARNING:
	 [Node] Error on &quot;preproc.mcflirt&quot; (/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,384 nipype.workflow ERROR:
	 Node mcflirt failed to run on host github-action-runner.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,385 nipype.workflow ERROR:
	 Saving crash info to /storage/tmp/tmpnvedqc2o/crash-20240704-043518-ubuntu-mcflirt-ced3cd79-51fb-44c8-b30c-f6e9086010d0.txt
Traceback (most recent call last):
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/linear.py&quot;, line 47, in run
    node.run(updatehash=updatehash)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 527, in run
    result = self._run_interface(execute=True)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 645, in _run_interface
    return self._run_command(execute)
  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py&quot;, line 771, in _run_command
    raise NodeExecutionError(msg)
nipype.pipeline.engine.nodes.NodeExecutionError: Exception raised while executing Node mcflirt.

Cmdline:
	mcflirt -in /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz -out /storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz -plots
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	Image Exception : #22 :: Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
	Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
	Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/mcflirt: line 3: 2843937 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/fsl_6.0.7.4_20231005.simg mcflirt &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;par_file&#39; trait of a MCFLIRTOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz.par&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz.par&#39; for output &#39;par_file&#39; of a MCFLIRT interface
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,387 nipype.workflow INFO:
	 ***********************************
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,387 nipype.workflow ERROR:
	 could not run node: preproc.mcflirt
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,388 nipype.workflow INFO:
	 crashfile: /storage/tmp/tmpnvedqc2o/crash-20240704-043518-ubuntu-mcflirt-ced3cd79-51fb-44c8-b30c-f6e9086010d0.txt
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>240704-04:35:18,389 nipype.workflow INFO:
	 ***********************************
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
NodeExecutionError                        Traceback (most recent call last)
Cell In[39], line 9
      6 sinker.inputs.substitutions = substitutions
      8 # Run the workflow again with the substitutions in place
----&gt; 9 wf_preproc.run()

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/workflows.py:638, in Workflow.run(self, plugin, plugin_args, updatehash)
    636 if str2bool(self.config[&quot;execution&quot;][&quot;create_report&quot;]):
    637     self._write_report_info(self.base_dir, self.name, execgraph)
--&gt; 638 runner.run(execgraph, updatehash=updatehash, config=self.config)
    639 datestr = datetime.utcnow().strftime(&quot;%Y%m%dT%H%M%S&quot;)
    640 if str2bool(self.config[&quot;execution&quot;][&quot;write_provenance&quot;]):

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/linear.py:82, in LinearPlugin.run(self, graph, config, updatehash)
     76 if len(errors) &gt; 1:
     77     error, cause = (
     78         RuntimeError(f&quot;{len(errors)} raised. Re-raising first.&quot;),
     79         error,
     80     )
---&gt; 82 raise error from cause

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/plugins/linear.py:47, in LinearPlugin.run(self, graph, config, updatehash)
     45     if self._status_callback:
     46         self._status_callback(node, &quot;start&quot;)
---&gt; 47     node.run(updatehash=updatehash)
     48 except Exception as exc:
     49     endstatus = &quot;exception&quot;

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py:527, in Node.run(self, updatehash)
    524 savepkl(op.join(outdir, &quot;_inputs.pklz&quot;), self.inputs.get_traitsfree())
    526 try:
--&gt; 527     result = self._run_interface(execute=True)
    528 except Exception:
    529     logger.warning(&#39;[Node] Error on &quot;%s&quot; (%s)&#39;, self.fullname, outdir)

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py:645, in Node._run_interface(self, execute, updatehash)
    643     self._update_hash()
    644     return self._load_results()
--&gt; 645 return self._run_command(execute)

File ~/.local/lib/python3.10/site-packages/nipype/pipeline/engine/nodes.py:771, in Node._run_command(self, execute, copyfiles)
    769     # Always pass along the traceback
    770     msg += f&quot;Traceback:\n{_tab(runtime.traceback)}&quot;
--&gt; 771     raise NodeExecutionError(msg)
    773 return result

NodeExecutionError: Exception raised while executing Node mcflirt.

Cmdline:
	mcflirt -in /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz -out /storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz -plots
Stdout:

Stderr:
	Image Exception : #63 :: No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	Image Exception : #22 :: Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
	Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	terminate called after throwing an instance of &#39;std::runtime_error&#39;
	  what():  Failed to read volume /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold.nii.gz
	Error : No image files match: /storage/tmp/tmpnvedqc2o/ds000102/sub-01/func/sub-01_task-flanker_run-1_bold
	/cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/mcflirt: line 3: 2843937 Aborted                 (core dumped) singularity --silent exec $neurodesk_singularity_opts --pwd &quot;$PWD&quot; /cvmfs/neurodesk.ardc.edu.au/containers/fsl_6.0.7.4_20231005/fsl_6.0.7.4_20231005.simg mcflirt &quot;$@&quot;
Traceback:
	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 453, in aggregate_outputs
	    setattr(outputs, key, val)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 330, in validate
	    value = super(File, self).validate(objekt, name, value, return_pathlike=True)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/traits_extension.py&quot;, line 135, in validate
	    self.error(objekt, name, str(value))
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/traits/base_trait_handler.py&quot;, line 74, in error
	    raise TraitError(
	traits.trait_errors.TraitError: The &#39;par_file&#39; trait of a MCFLIRTOutputSpec instance must be a pathlike object or string representing an existing file, but a value of &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz.par&#39; &lt;class &#39;str&#39;&gt; was specified.

	During handling of the above exception, another exception occurred:

	Traceback (most recent call last):
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 400, in run
	    outputs = self.aggregate_outputs(runtime)
	  File &quot;/home/ubuntu/.local/lib/python3.10/site-packages/nipype/interfaces/base/core.py&quot;, line 460, in aggregate_outputs
	    raise FileNotFoundError(msg)
	FileNotFoundError: No such file or directory &#39;/storage/tmp/tmpnvedqc2o/output/working_dir/preproc/mcflirt/sub-01_task-flanker_run-1_bold_mcf.nii.gz.par&#39; for output &#39;par_file&#39; of a MCFLIRT interface
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> tree output/working_dir/preproc/results
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>output/working_dir/preproc/results  [error opening dir]

0 directories, 0 files
</pre></div>
</div>
</div>
</div>
<p class="important-title" style="font-size: 1.1em; color: green;"><i class="fas fa-check-circle" style="color: green;"></i> <span style="font-size: 1.5em;">Nipype in a Nutshell</span></p>
<p>Nipype offers easy to use building blocks for:</p>
<ul class="simple">
<li><p>establishing neuroimaging data processing services</p></li>
<li><p>constructing tailored data processing pipelines</p></li>
</ul>
</section>
</section>
</section>
<section id="pydra-a-modern-dataflow-engine-developed-for-the-nipype-project">
<h2>4. Pydra: A modern dataflow engine developed for the Nipype project<a class="headerlink" href="#pydra-a-modern-dataflow-engine-developed-for-the-nipype-project" title="Permalink to this heading">#</a></h2>
<img src="https://raw.githubusercontent.com/nipype/pydra/master/docs/logo/pydra_logo.jpg" style="float: right; margin: 0 auto; padding: 5px;" width="30%" height="30%">
<ul class="simple">
<li><p>Pydra is a rewrite of the Nipype engine and forms the core of the Nipype 2.0 ecosystem and is meant to provide <strong>additional flexibility</strong> allowing users to define custom processing steps, interfaces and nested workflows.</p></li>
</ul>
<ul class="simple">
<li><p>Is a standalone project and designed to support analytics in <strong>any scientific domain</strong> (whereas Nipype is specifically designed for neuroimaging data analysis pipelines).</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\rightarrow\)</span>  Pydra aims to offer a lightweight Python (3.7+) dataflow engine for the construction, manipulation, and distributed execution of computational graphs. It serves as a tool for building reproducible, scalable, reusable, and fully automated scientific workflows.</p>
<p>The architecture in combination with several key features makes Pydra a customizable and powerful dataflow engine:</p>
<ul class="simple">
<li><p><strong>Architecture with three core components:</strong> Tasks (basic runnable components) including Workflows, Submitter (Classes for unpacking Tasks into standalone jobs) and Workers (Classes used to execute Tasks coordinate resource managment).</p></li>
<li><p><strong>Composable dataflows:</strong> Nested dataflows of arbitrary depths encouraging the creation of reusable dataflows.</p></li>
<li><p><strong>Global cache</strong> support to reduce recomputation.</p></li>
<li><p>Support for dataflow execution in <strong>containerized environments</strong> enabling greater consistency for reproducibility.</p></li>
<li><p><strong>Splitting &amp; combining semantics</strong> for creating nested loops over input sets (MapReduce extended to graphs).</p></li>
</ul>
<section id="key-features-in-more-detail">
<h3>Key features in more detail:<a class="headerlink" href="#key-features-in-more-detail" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Composable dataflows:</strong> A dataflow is represented as a directed acyclic graph, where each Task represents a Python function, execution of an external tool, or another dataflow. This enables the creation of simpe linear pipelines to complex nested dataflows of any depth. This approach promotes the development of reusable dataflows, enhancing modularity and scalability.</p></li>
</ul>
<center><img src= "https://github.com/nipype/pydra-tutorial/blob/master/figures/nested_workflow.png?raw=true" width="30%" height="30%"></center>
<figcaption><b>Figure 7:</b> Nested workflow</figcaption>
<div class="important">
  <p class="important-title" style="font-size: 1.3em; color: orange;"><i class="fas fa-search" style="color: orange;"></i> <span style="font-size: 1.3em;">Nipype-Pydra architectures</span></p>
  <ul>
    <li>Pydra dataflow components: Task (basic runnable component with named inputs and outputs) with subclass Workflow</li>
    <li>Nipype basic concepts: Node (defined inputs and outputs), Workflow</li>
  </ul>
</div>
<ul class="simple">
<li><p><strong>Support for Python functions (FunctionTask) and external (shell) commands (ShellCommandTask):</strong> Pydra enables the seamless incorporation and utilization of pre-existing functions within Python libraries, as well as external command-line tools. This facilitates straightforward integration of existing code and software into Pydra workflows.</p></li>
<li><p><strong>Support for execution of Tasks in containerized environments (ContainerTask):</strong> Any dataflow or Task can be executed in an associated container (via Docker or Singularity) enabling greater consistency for reproducibility.</p></li>
</ul>
<div class="important">
  <p class="important-title" style="font-size: 1.3em; color: orange;"><i class="fas fa-search" style="color: orange;"></i> <span style="font-size: 1.3em;">Nipype-Pydra architectures</span></p>
  <ul>
      <li>Pydra Task subclasses: FunctionTask, ShellCommandTask, ContainerTask (Docker, Singularity) </li>
    <li>Nipype advanced concepts: base interfaces or interfaces for using existing functionality in other packages: wrapping of command line tools (nipype.interfaces.base CommandLine), run arbitrary function as nipype interface (nipype.interfaces.utility Function)</li>
  </ul>
</div><ul class="simple">
<li><p><strong>Splitting &amp; combining semantics for creating nested loops over input sets:</strong> Versatile functionality for nested loop creation across input sets: Tasks or dataflows can iterate over input parameter sets, and their outputs can be recombined. This functionality resembles the Map-Reduce model, but Pydra extends this capability to graphs with nested dataflows.</p></li>
</ul>
<center><img src= https://pydra.readthedocs.io/en/latest/_images/nd_spl_3_comb1.png></center>
<figcaption><b>Figure 8:</b> Flexible splitting and merging in Pydra</figcaption>
<div class="important">
  <p class="important-title" style="font-size: 1.3em; color: orange;"><i class="fas fa-search" style="color: orange;"></i> <span style="font-size: 1.3em;">Pydra-Nipype architectures</span></p>
  <ul>
    <li>Pydra: Optional State class: splitter and combiner attribute to specify how inputs should be split into parameter sets, and combined after Task execution</li>
    <li>Nipype: MapNode, Iterables/ Synchronize, JoinNode</li>
  </ul>
</div>
<ul class="simple">
<li><p>Both Pydra and Nipype offer similar functionalities regarding</p>
<ul>
<li><p><strong>Hashing</strong> to manage task execution and caching of intermediate results. Hashes are computed for task inputs and parameters and used to determine task dependencies and to avoid unnecessary recomputation.</p></li>
<li><p><strong>Provenance Tracking</strong> capabilities to captures dataflow execution activities as a provenance graph. It tracks inputs, outputs, and resources consumed by each task in a workflow, providing a detailed record of the workflow execution.</p></li>
</ul>
</li>
</ul>
<p><strong>A content-addressable global cache to reduce recomputation:</strong> Hash values are computed for each graph and each Task. This supports reusing of previously computed and stored dataflows and Tasks. It also allows multiple people in or across laboratories to use each others’s execution outputs on the same data without having to rerun the same computation.</p>
<p><strong>Auditing and provenance tracking:</strong> Pydra provides a simple JSON-LD-based message passing mechanism to capture the dataflow execution activities as a provenance graph. These messages track inputs and outputs of each task in a dataflow, and the resources consumed by the task.</p>
  <p class="important-title" style="font-size: 1.3em; color: green;"><i class="fas fa-check-circle" style="color: green;"></i> <span style="font-size: 1.3em;">Take Home Message</span></p>
  <ul>
    <p><b>Pydra and Nipype are both open-source Python projects and offer similar functionalities for building and executing computational pipelines, including caching. However, they differ in their :</b></p>
    <li>
      <b>Design Philosophy:</b> Building pipelines for neuroimaging in vs. pipelines for any scientific domain 
    </li>
    <li>
      <b>Flexibility:</b> Very flexible splitting and merging semantics in Pydra to create complex pipelines of any depth
    </li>
    <li>
      <b>Execution Model:</b> Pydra leverages modern parallel and distributed computing frameworks such as Dask
    </li>
    <li>
      <b>Community and Ecosystem:</b> Well-established community and ecosystem vs. a growing community 
    </li>
  </ul>
</section>
</section>
<section id="dependencies-in-jupyter-python">
<h2>Dependencies in Jupyter/Python<a class="headerlink" href="#dependencies-in-jupyter-python" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Using the package <a class="reference external" href="https://github.com/rasbt/watermark">watermark</a> to print out computer characteristics and software versions.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install watermark
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Defaulting to user installation because normal site-packages is not writeable
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting watermark
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Downloading watermark-2.4.3-py2.py3-none-any.whl.metadata (1.4 kB)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: ipython&gt;=6.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from watermark) (8.18.1)
Requirement already satisfied: importlib-metadata&gt;=1.4 in /usr/lib/python3/dist-packages (from watermark) (4.6.4)
Requirement already satisfied: setuptools in /usr/lib/python3/dist-packages (from watermark) (59.6.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: decorator in /home/ubuntu/.local/lib/python3.10/site-packages (from ipython&gt;=6.0-&gt;watermark) (5.1.1)
Requirement already satisfied: jedi&gt;=0.16 in /home/ubuntu/.local/lib/python3.10/site-packages (from ipython&gt;=6.0-&gt;watermark) (0.19.1)
Requirement already satisfied: matplotlib-inline in /home/ubuntu/.local/lib/python3.10/site-packages (from ipython&gt;=6.0-&gt;watermark) (0.1.6)
Requirement already satisfied: prompt-toolkit&lt;3.1.0,&gt;=3.0.41 in /home/ubuntu/.local/lib/python3.10/site-packages (from ipython&gt;=6.0-&gt;watermark) (3.0.43)
Requirement already satisfied: pygments&gt;=2.4.0 in /usr/lib/python3/dist-packages (from ipython&gt;=6.0-&gt;watermark) (2.11.2)
Requirement already satisfied: stack-data in /home/ubuntu/.local/lib/python3.10/site-packages (from ipython&gt;=6.0-&gt;watermark) (0.6.3)
Requirement already satisfied: traitlets&gt;=5 in /home/ubuntu/.local/lib/python3.10/site-packages (from ipython&gt;=6.0-&gt;watermark) (5.14.0)
Requirement already satisfied: exceptiongroup in /home/ubuntu/.local/lib/python3.10/site-packages (from ipython&gt;=6.0-&gt;watermark) (1.2.0)
Requirement already satisfied: pexpect&gt;4.3 in /usr/lib/python3/dist-packages (from ipython&gt;=6.0-&gt;watermark) (4.8.0)
Requirement already satisfied: parso&lt;0.9.0,&gt;=0.8.3 in /home/ubuntu/.local/lib/python3.10/site-packages (from jedi&gt;=0.16-&gt;ipython&gt;=6.0-&gt;watermark) (0.8.3)
Requirement already satisfied: wcwidth in /home/ubuntu/.local/lib/python3.10/site-packages (from prompt-toolkit&lt;3.1.0,&gt;=3.0.41-&gt;ipython&gt;=6.0-&gt;watermark) (0.2.12)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: executing&gt;=1.2.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from stack-data-&gt;ipython&gt;=6.0-&gt;watermark) (2.0.1)
Requirement already satisfied: asttokens&gt;=2.1.0 in /home/ubuntu/.local/lib/python3.10/site-packages (from stack-data-&gt;ipython&gt;=6.0-&gt;watermark) (2.4.1)
Requirement already satisfied: pure-eval in /home/ubuntu/.local/lib/python3.10/site-packages (from stack-data-&gt;ipython&gt;=6.0-&gt;watermark) (0.2.2)
Requirement already satisfied: six&gt;=1.12.0 in /usr/lib/python3/dist-packages (from asttokens&gt;=2.1.0-&gt;stack-data-&gt;ipython&gt;=6.0-&gt;watermark) (1.16.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading watermark-2.4.3-py2.py3-none-any.whl (7.6 kB)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: Error parsing dependencies of distro-info: Invalid version: &#39;1.1build1&#39;</span>

</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">WARNING: Error parsing dependencies of python-debian: Invalid version: &#39;0.1.43ubuntu1&#39;</span>

</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Installing collected packages: watermark
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully installed watermark-2.4.3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> watermark

<span class="o">%</span><span class="k">watermark</span>
<span class="o">%</span><span class="k">watermark</span> --iversions
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Last updated: 2024-07-04T04:35:21.402383+00:00

Python implementation: CPython
Python version       : 3.10.12
IPython version      : 8.18.1

Compiler    : GCC 11.4.0
OS          : Linux
Release     : 5.15.0-67-generic
Machine     : x86_64
Processor   : x86_64
CPU cores   : 32
Architecture: 64bit

sys       : 3.10.12 (main, Nov 20 2023, 15:14:05) [GCC 11.4.0]
numpy     : 1.26.2
nilearn   : 0.10.2
matplotlib: 3.8.2
nipype    : 1.8.6
nibabel   : 5.2.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="references-resources">
<h2>References/ Resources<a class="headerlink" href="#references-resources" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Gorgolewski K, Burns CD, Madison C, Clark D, Halchenko YO, Waskom ML, Ghosh SS. (2011). Nipype: a flexible, lightweight and extensible neuroimaging data processing framework in Python. Front. Neuroinform. 5:13.</p>
<ul>
<li><p><a class="reference external" href="https://nipype.readthedocs.io/en/latest/">Nipype Documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/nipy/nipype">Nipype Github</a></p></li>
<li><p><a class="reference external" href="https://miykael.github.io/nipype_tutorial/">Nipype Tutorial</a></p></li>
</ul>
</li>
<li><p>Jarecka, Dorota &amp; Goncalves, Mathias &amp; Markiewicz, Christopher &amp; Esteban, Oscar &amp; Lo, Nicole &amp; Kaczmarzyk, Jakub &amp; Ghosh, Satrajit. (2020). Pydra - a flexible and lightweight dataflow engine for scientific analyses. 132-139. 10.25080/Majora-342d178e-012.</p>
<ul>
<li><p><a class="reference external" href="https://pydra.readthedocs.io/en/latest/">Pydra Documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/nipype/pydra">Pydra Github</a></p></li>
<li><p><a class="reference external" href="https://mybinder.org/v2/gh/nipype/pydra-tutorial/master">Pydra Tutorial</a></p></li>
<li><p><a class="reference external" href="https://github.com/nipype/pydra-ml">Pydra-ML</a></p></li>
</ul>
</li>
<li><p>Renton, A.I., Dao, T.T., Johnstone, T. et al. Neurodesk: an accessible, flexible and portable data analysis environment for reproducible neuroimaging. Nat Methods (2024). <a class="reference external" href="https://doi.org/10.1038/s41592-023-02145-x">https://doi.org/10.1038/s41592-023-02145-x</a></p>
<ul>
<li><p><a class="reference external" href="https://www.neurodesk.org/">Neurodesk Website</a></p></li>
<li><p><a class="reference external" href="https://www.neurodesk.org/example-notebooks/intro.html">Jupyter Notebook Examples on Neurodesk</a></p></li>
</ul>
</li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interactive-rise-slideshow">An interactive RISE slideshow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-neurodesk">Set up Neurodesk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-content">Table of content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-nipype">1. Introduction to Nipype</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nipype-in-jupyter-notebooks-on-neurodesk">2. Nipype in Jupyter Notebooks on Neurodesk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploration-of-nipype-s-building-blocks">3. Exploration of Nipype’s building blocks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-download-of-opensource-data-installations-and-imports"><strong>Preparation: Download of opensource data, installations and imports</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interfaces-the-core-pieces-of-nipype">3.1. Interfaces : The core pieces of Nipype</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-interface-for-fsl-s-brain-extraction-tool-bet"><strong>Example: Interface for FSL’s Brain Extraction Tool <em>BET</em></strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nodes-the-light-wrapper-around-interfaces">3.2. Nodes: The light wrapper around interfaces</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapnode">MapNode</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iterables">Iterables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#joinnode">JoinNode</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-node"><strong>Example: Node</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workflows">3.3. Workflows</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-workflow"><strong>Example: Workflow</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#connect-nodes-within-a-workflow">Connect nodes within a workflow</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#execution-plugins-execution-on-different-systems">3.4. Execution Plugins: Execution on different systems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-input-first-step-of-every-analysis">3.5. Data Input: First step of every analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-datagrabber"><strong>Example: DataGrabber</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-output">3.6. Data Output</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-datasink"><strong>Example: DataSink</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pydra-a-modern-dataflow-engine-developed-for-the-nipype-project">4. Pydra: A modern dataflow engine developed for the Nipype project</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-features-in-more-detail">Key features in more detail:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependencies-in-jupyter-python">Dependencies in Jupyter/Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references-resources">References/ Resources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Neurodesk Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>