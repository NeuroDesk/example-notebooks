

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Brain extraction with different software packages &#8212; Neurodesk</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-4Z9774J59Y"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4Z9774J59Y');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'brain_extraction_different_tools';</script>
    <link rel="canonical" href="https://neurodesk.github.io/example-notebooks/intro.html/brain_extraction_different_tools.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">Neurodesk</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    Brain extraction with different software packages
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/NeuroDesk/example-notebooks/blob/main/books/brain_extraction_different_tools.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/edit/main/books/brain_extraction_different_tools.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NeuroDesk/example-notebooks/issues/new?title=Issue%20on%20page%20%2Fbrain_extraction_different_tools.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/brain_extraction_different_tools.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Brain extraction with different software packages</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citation">Citation:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-neurodesk">Setup Neurodesk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-normalization-tools-ants">Advanced Normalization Tools (ANTs)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-functional-neuroimages-afni">Analysis of Functional NeuroImages (AFNI)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#freesurfer">FreeSurfer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fmrib-software-library-fsl">FMRIB Software Library (FSL)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data">Download Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#t1-image-for-brain-extraction">T1 Image for brain extraction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ants-brain-templates">ANTs Brain Templates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#brain-extraction">Brain Extraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ants">1. ANTs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#afni">2. AFNI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">3. FreeSurfer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fsl">4. FSL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><a href="https://colab.research.google.com/github/NeuroDesk/example-notebooks/blob/main/books/structural_imaging/brain_extraction_different_tools.ipynb" target="_parent"><img alt="Open In Google Colab" src="https://colab.research.google.com/assets/colab-badge.svg" />   </a></p>
<section id="brain-extraction-with-different-software-packages">
<h1>Brain extraction with different software packages<a class="headerlink" href="#brain-extraction-with-different-software-packages" title="Permalink to this heading">#</a></h1>
<p>Author: Monika Doerig</p>
<section id="citation">
<h2>Citation:<a class="headerlink" href="#citation" title="Permalink to this heading">#</a></h2>
<p><strong>Andy’s Brain Book:</strong></p>
<ul class="simple">
<li><p>This brain extraction example is based on the <a class="reference external" href="https://andysbrainbook.readthedocs.io/en/latest/ANTs/ANTs_Overview.html">Advanced Normalization Tools (ANTs)</a> chapter from Andy’s Brain Book (Jahn, 2022. <a class="reference external" href="https://zenodo.org/records/5879294">doi:10.5281/zenodo.5879293</a>)</p></li>
</ul>
<p><strong>SynthStrip:</strong></p>
<ul class="simple">
<li><p>SynthStrip: Skull-Stripping for Any Brain Image; Andrew Hoopes, Jocelyn S. Mora, Adrian V. Dalca, Bruce Fischl*, Malte Hoffmann* (*equal contribution); NeuroImage 260, 2022, 119474; https://doi.org/10.1016/j.neuroimage.2022.119474</p></li>
<li><p>Boosting skull-stripping performance for pediatric brain images; William Kelley, Nathan Ngo, Adrian V. Dalca, Bruce Fischl, Lilla Zöllei*, Malte Hoffmann* (*equal contribution); IEEE International Symposium on Biomedical Imaging (ISBI), 2024, forthcoming; https://arxiv.org/abs/2402.16634</p></li>
<li><p>SynthStrip tool: https://w3id.org/synthstrip</p></li>
</ul>
<p><strong>Opensource Data from OpenNeuro:</strong></p>
<ul class="simple">
<li><p>Kelly AMC and Uddin LQ and Biswal BB and Castellanos FX and Milham MP (2018). Flanker task (event-related). <a class="reference external" href="https://openneuro.org/datasets/ds000102/versions/00001">OpenNeuro Dataset ds000102</a></p></li>
<li><p>Kelly, A.M., Uddin, L.Q., Biswal, B.B., Castellanos, F.X., Milham, M.P. (2008). Competition between functional brain networks mediates behavioral variability. Neuroimage, 39(1):527-37</p></li>
</ul>
<p><strong>ANTs Brain Templates:</strong></p>
<ul class="simple">
<li><p>Avants, Brian; Tustison, Nick (2018). ANTs/ANTsR Brain Templates. figshare. Dataset. https://doi.org/10.6084/m9.figshare.915436.v2</p></li>
</ul>
</section>
<section id="setup-neurodesk">
<h2>Setup Neurodesk<a class="headerlink" href="#setup-neurodesk" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
import os
import sys
IN_COLAB = &#39;google.colab&#39; in sys.modules

if IN_COLAB:
  os.environ[&quot;LD_PRELOAD&quot;] = &quot;&quot;;
  os.environ[&quot;APPTAINER_BINDPATH&quot;] = &quot;/content,/tmp,/cvmfs&quot;
  os.environ[&quot;MPLCONFIGDIR&quot;] = &quot;/content/matplotlib-mpldir&quot;
  os.environ[&quot;LMOD_CMD&quot;] = &quot;/usr/share/lmod/lmod/libexec/lmod&quot;

  !curl -J -O https://raw.githubusercontent.com/NeuroDesk/neurocommand/main/googlecolab_setup.sh
  !chmod +x googlecolab_setup.sh
  !./googlecolab_setup.sh

  os.environ[&quot;MODULEPATH&quot;] = &#39;:&#39;.join(map(str, list(map(lambda x: os.path.join(os.path.abspath(&#39;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/&#39;), x),os.listdir(&#39;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/&#39;)))))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Output CPU information:</span>
<span class="o">!</span>cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;vendor&#39;</span> <span class="p">|</span> uniq
<span class="o">!</span>cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;model name&#39;</span> <span class="p">|</span> uniq
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vendor_id	: AuthenticAMD
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>model name	: AMD EPYC-Rome Processor
</pre></div>
</div>
</div>
</div>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>Since fMRI studies focus on brain tissue, our first step is to remove the skull and non-brain areas from the image.</p>
<p>In order to analyze fMRI data, you will need to load an fMRI analysis package. In this example we will use the following packages and algorithms to skull-strip the anatomical image:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Advanced Normalization Tools (ANTs): antsBrainExtraction.sh

Analysis of Functional NeuroImages (AFNI): 3dSkullStrip

FreeSurfer: SynthStrip

FSL (FMRIB Software Library, created by the University of Oxford): BET - Brain Extraction Tool
</pre></div>
</div>
<p>Each package is maintained by a team of professionals, and each is updated at least every few years or so.</p>
<section id="advanced-normalization-tools-ants">
<h3>Advanced Normalization Tools (ANTs)<a class="headerlink" href="#advanced-normalization-tools-ants" title="Permalink to this heading">#</a></h3>
<p>ANTs is a software package for normalizing data to a template.</p>
<p>Templates for public neuroimaging datasets, such as those from IXI, Oasis, NKI-1, and Kirby/MMRR, are intended for use with ANTs and are available for download from <a class="reference external" href="https://doi.org/10.6084/m9.figshare.915436.v2">figshare</a>. These templates include an average T1 neuroimage of the head and various tissue priors for cortex, white matter, cerebrospinal fluid, deep gray matter, brainstem and the cerebellum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lmod</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;ants/2.3.1&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Lmod&#39;,
 &#39;Warning:&#39;,
 &#39;The&#39;,
 &#39;environment&#39;,
 &#39;MODULEPATH&#39;,
 &#39;has&#39;,
 &#39;been&#39;,
 &#39;changed&#39;,
 &#39;in&#39;,
 &#39;unexpected&#39;,
 &#39;ways.&#39;,
 &#39;Lmod&#39;,
 &#39;is&#39;,
 &#39;unable&#39;,
 &#39;to&#39;,
 &#39;use&#39;,
 &#39;given&#39;,
 &#39;MODULEPATH.&#39;,
 &#39;It&#39;,
 &#39;is&#39;,
 &#39;using:&#39;,
 &#39;&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.&#39;,
 &#39;Please&#39;,
 &#39;use&#39;,
 &#39;&quot;module&#39;,
 &#39;use&#39;,
 &#39;to&#39;,
 &#39;change&#39;,
 &#39;MODULEPATH&#39;,
 &#39;instead.&#39;,
 &#39;ants/2.3.1&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="analysis-of-functional-neuroimages-afni">
<h3>Analysis of Functional NeuroImages (AFNI)<a class="headerlink" href="#analysis-of-functional-neuroimages-afni" title="Permalink to this heading">#</a></h3>
<p>AFNI is a suite of programs designed to analyze fMRI data. Created in the mid-1990’s by Bob Cox, AFNI is now used by hundreds of imaging labs around the world.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;afni/24.1.02&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lmod Warning: The environment MODULEPATH has been changed in unexpected ways.
Lmod is unable to use given MODULEPATH. It is using:

&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.

Please use &quot;module use ...&quot; to change MODULEPATH instead. 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Lmod&#39;,
 &#39;Warning:&#39;,
 &#39;The&#39;,
 &#39;environment&#39;,
 &#39;MODULEPATH&#39;,
 &#39;has&#39;,
 &#39;been&#39;,
 &#39;changed&#39;,
 &#39;in&#39;,
 &#39;unexpected&#39;,
 &#39;ways.&#39;,
 &#39;Lmod&#39;,
 &#39;is&#39;,
 &#39;unable&#39;,
 &#39;to&#39;,
 &#39;use&#39;,
 &#39;given&#39;,
 &#39;MODULEPATH.&#39;,
 &#39;It&#39;,
 &#39;is&#39;,
 &#39;using:&#39;,
 &#39;&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.&#39;,
 &#39;Please&#39;,
 &#39;use&#39;,
 &#39;&quot;module&#39;,
 &#39;use&#39;,
 &#39;to&#39;,
 &#39;change&#39;,
 &#39;MODULEPATH&#39;,
 &#39;instead.&#39;,
 &#39;ants/2.3.1&#39;,
 &#39;afni/24.1.02&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="freesurfer">
<h3>FreeSurfer<a class="headerlink" href="#freesurfer" title="Permalink to this heading">#</a></h3>
<p>FreeSurfer is a software package that enables you to analyze structural MRI images - in other words, you can use FreeSurfer to quantify the amount of grey matter and white matter in specific regions of the brain. You will also be able to calculate measurements such as the thickness, curvature, and volume of the different tissue types, and be able to correlate these with covariates; or, you can contrast these structural measurements between groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;freesurfer/7.3.2&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lmod Warning: The environment MODULEPATH has been changed in unexpected ways.
Lmod is unable to use given MODULEPATH. It is using:

&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.

Please use &quot;module use ...&quot; to change MODULEPATH instead. 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Lmod&#39;,
 &#39;Warning:&#39;,
 &#39;The&#39;,
 &#39;environment&#39;,
 &#39;MODULEPATH&#39;,
 &#39;has&#39;,
 &#39;been&#39;,
 &#39;changed&#39;,
 &#39;in&#39;,
 &#39;unexpected&#39;,
 &#39;ways.&#39;,
 &#39;Lmod&#39;,
 &#39;is&#39;,
 &#39;unable&#39;,
 &#39;to&#39;,
 &#39;use&#39;,
 &#39;given&#39;,
 &#39;MODULEPATH.&#39;,
 &#39;It&#39;,
 &#39;is&#39;,
 &#39;using:&#39;,
 &#39;&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.&#39;,
 &#39;Please&#39;,
 &#39;use&#39;,
 &#39;&quot;module&#39;,
 &#39;use&#39;,
 &#39;to&#39;,
 &#39;change&#39;,
 &#39;MODULEPATH&#39;,
 &#39;instead.&#39;,
 &#39;ants/2.3.1&#39;,
 &#39;afni/24.1.02&#39;,
 &#39;freesurfer/7.3.2&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="fmrib-software-library-fsl">
<h3>FMRIB Software Library (FSL)<a class="headerlink" href="#fmrib-software-library-fsl" title="Permalink to this heading">#</a></h3>
<p>FSL is a comprehensive library of analysis tools for FMRI, MRI and diffusion brain imaging data.
FSL has a tool to skull-strip an anatomical image called bet, or the Brain Extraction Tool.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;fsl/6.0.7.4&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lmod Warning: The environment MODULEPATH has been changed in unexpected ways.
Lmod is unable to use given MODULEPATH. It is using:

&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.

Please use &quot;module use ...&quot; to change MODULEPATH instead. 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Lmod&#39;,
 &#39;Warning:&#39;,
 &#39;The&#39;,
 &#39;environment&#39;,
 &#39;MODULEPATH&#39;,
 &#39;has&#39;,
 &#39;been&#39;,
 &#39;changed&#39;,
 &#39;in&#39;,
 &#39;unexpected&#39;,
 &#39;ways.&#39;,
 &#39;Lmod&#39;,
 &#39;is&#39;,
 &#39;unable&#39;,
 &#39;to&#39;,
 &#39;use&#39;,
 &#39;given&#39;,
 &#39;MODULEPATH.&#39;,
 &#39;It&#39;,
 &#39;is&#39;,
 &#39;using:&#39;,
 &#39;&quot;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/functional_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/rodent_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_registration:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/structural_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_segmentation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quantitative_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/workflows:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/hippocampus:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/image_reconstruction:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/data_organisation:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/electrophysiology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/phase_processing:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/programming:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/machine_learning:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/diffusion_imaging:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/body:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/visualization:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spectroscopy:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/quality_control:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/statistics:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/shape_analysis:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/spine:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/molecular_biology:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/bids_apps:/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/cryo_EM::&quot;.&#39;,
 &#39;Please&#39;,
 &#39;use&#39;,
 &#39;&quot;module&#39;,
 &#39;use&#39;,
 &#39;to&#39;,
 &#39;change&#39;,
 &#39;MODULEPATH&#39;,
 &#39;instead.&#39;,
 &#39;ants/2.3.1&#39;,
 &#39;afni/24.1.02&#39;,
 &#39;freesurfer/7.3.2&#39;,
 &#39;fsl/6.0.7.4&#39;]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="download-data">
<h2>Download Data<a class="headerlink" href="#download-data" title="Permalink to this heading">#</a></h2>
<section id="t1-image-for-brain-extraction">
<h3>T1 Image for brain extraction<a class="headerlink" href="#t1-image-for-brain-extraction" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PATTERN</span> <span class="o">=</span> <span class="s2">&quot;sub-08/anat&quot;</span>
<span class="o">!</span> datalad install https://github.com/OpenNeuroDatasets/ds000102.git
<span class="o">!</span> <span class="nb">cd</span> ds000102 <span class="o">&amp;&amp;</span> datalad get <span class="nv">$PATTERN</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clone attempt:   0%|              | 0.00/2.00 [00:00&lt;?, ? Candidate locations/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Enumerating: 0.00 Objects [00:00, ? Objects/s]

                                              

Counting:   0%|                               | 0.00/27.0 [00:00&lt;?, ? Objects/s]

                                                                                

Compressing:   0%|                            | 0.00/23.0 [00:00&lt;?, ? Objects/s]

                                                                                

Receiving:   0%|                             | 0.00/2.15k [00:00&lt;?, ? Objects/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                

Resolving:   0%|                                | 0.00/537 [00:00&lt;?, ? Deltas/s]

                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO   ] scanning for unlocked files (this may take some time) 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO   ] Remote origin not usable by git-annex; setting annex-ignore 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO   ] access to 1 dataset sibling s3-PRIVATE not auto-enabled, enable with:
| 		datalad siblings -d &quot;/storage/tmp/tmpbwquhaml/ds000102&quot; enable -s s3-PRIVATE 
<span class=" -Color -Color-Bold">install</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): /storage/tmp/tmpbwquhaml/ds000102 (<span class=" -Color -Color-Bold -Color-Bold-Magenta">dataset</span>)

</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total:   0%|                                   | 0.00/10.6M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   0%|            | 0.00/10.6M [00:00&lt;?, ? Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   0%|   | 33.4k/10.6M [00:00&lt;02:21, 74.4k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   0%|   | 51.8k/10.6M [00:00&lt;02:28, 70.9k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   1%|   | 85.6k/10.6M [00:01&lt;02:49, 61.9k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   1%|    | 103k/10.6M [00:01&lt;02:39, 65.6k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   1%|    | 120k/10.6M [00:01&lt;02:41, 64.8k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   1%|    | 138k/10.6M [00:02&lt;02:33, 68.1k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   1%|    | 155k/10.6M [00:02&lt;02:27, 70.5k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   2%|    | 173k/10.6M [00:02&lt;02:23, 72.4k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   2%|    | 190k/10.6M [00:02&lt;02:11, 79.1k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   2%|    | 207k/10.6M [00:02&lt;02:08, 80.6k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   2%|    | 225k/10.6M [00:03&lt;02:05, 82.3k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   3%|▏    | 277k/10.6M [00:03&lt;01:24, 122k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   3%|▏    | 294k/10.6M [00:03&lt;01:35, 107k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   3%|▏    | 347k/10.6M [00:03&lt;01:08, 150k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   4%|▏    | 399k/10.6M [00:04&lt;00:59, 171k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   4%|▏    | 451k/10.6M [00:04&lt;00:53, 189k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   5%|▏    | 503k/10.6M [00:04&lt;00:48, 207k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   5%|▎    | 556k/10.6M [00:04&lt;00:40, 246k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   6%|▎    | 644k/10.6M [00:04&lt;00:38, 259k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   7%|▎    | 712k/10.6M [00:05&lt;00:34, 287k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   7%|▎    | 765k/10.6M [00:05&lt;00:30, 319k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   8%|▍    | 834k/10.6M [00:05&lt;00:27, 355k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:   9%|▍    | 939k/10.6M [00:05&lt;00:24, 394k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  10%|▍   | 1.06M/10.6M [00:05&lt;00:21, 443k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  11%|▍   | 1.18M/10.6M [00:05&lt;00:16, 562k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  13%|▌   | 1.34M/10.6M [00:06&lt;00:17, 521k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  14%|▌   | 1.50M/10.6M [00:06&lt;00:13, 672k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  16%|▋   | 1.65M/10.6M [00:06&lt;00:13, 683k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  18%|▋   | 1.86M/10.6M [00:06&lt;00:11, 765k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  20%|▊   | 2.09M/10.6M [00:07&lt;00:10, 836k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  22%|▉   | 2.31M/10.6M [00:07&lt;00:09, 892k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  24%|▉   | 2.57M/10.6M [00:07&lt;00:08, 972k Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  27%|▊  | 2.85M/10.6M [00:07&lt;00:07, 1.05M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  30%|▉  | 3.17M/10.6M [00:07&lt;00:06, 1.15M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  33%|▉  | 3.48M/10.6M [00:08&lt;00:05, 1.23M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  36%|█  | 3.85M/10.6M [00:08&lt;00:04, 1.35M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  40%|█▏ | 4.21M/10.6M [00:08&lt;00:04, 1.47M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  44%|█▎ | 4.63M/10.6M [00:08&lt;00:03, 1.55M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  48%|█▍ | 5.08M/10.6M [00:09&lt;00:03, 1.69M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  53%|█▌ | 5.55M/10.6M [00:09&lt;00:02, 1.81M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  58%|█▋ | 6.07M/10.6M [00:09&lt;00:02, 1.96M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  63%|█▉ | 6.61M/10.6M [00:09&lt;00:01, 2.09M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  68%|██ | 7.21M/10.6M [00:09&lt;00:01, 2.25M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  74%|██▏| 7.83M/10.6M [00:10&lt;00:01, 2.41M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  81%|██▍| 8.50M/10.6M [00:10&lt;00:00, 2.58M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  85%|██▌| 8.98M/10.6M [00:10&lt;00:00, 2.58M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  88%|██▋| 9.27M/10.6M [00:10&lt;00:00, 2.44M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get sub-08/a .. 8_T1w.nii.gz:  94%|██▊| 9.96M/10.6M [00:10&lt;00:00, 3.18M Bytes/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-08/anat/sub-08_T1w.nii.gz (<span class=" -Color -Color-Bold -Color-Bold-Magenta">file</span>) [from s3-PUBLIC...]
<span class=" -Color -Color-Bold">get</span>(<span class=" -Color -Color-Bold -Color-Bold-Green">ok</span>): sub-08/anat (<span class=" -Color -Color-Bold -Color-Bold-Magenta">directory</span>)
action summary:
  get (ok: 2)

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_image</span> <span class="o">=</span> <span class="s1">&#39;ds000102/sub-08/anat/sub-08_T1w.nii.gz&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ants-brain-templates">
<h3>ANTs Brain Templates<a class="headerlink" href="#ants-brain-templates" title="Permalink to this heading">#</a></h3>
<p>You will need  templates to perform the brain extraction with ANTs. For this, we will use the OASIS brain templates, which are intended for use with <a class="reference external" href="http://stnava.github.io/ANTs/">ANTs</a> medical image processing tools.
However, it is up to you to determine which template works best for your data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the OASIS templates using wget</span>
<span class="o">!</span> wget https://ndownloader.figshare.com/files/3133832 -O OASIS.zip

<span class="c1"># Unzip the downloaded file</span>
<span class="o">!</span> unzip OASIS.zip -d OASIS

<span class="c1"># Remove zip file</span>
<span class="o">!</span> rm OASIS.zip

<span class="c1"># Delete templates that are not needed</span>
<span class="o">!</span> find OASIS/MICCAI2012-Multi-Atlas-Challenge-Data -type f ! -name <span class="s1">&#39;T_template0.nii.gz&#39;</span> ! -name <span class="s1">&#39;T_template0_BrainCerebellumProbabilityMask.nii.gz&#39;</span> -exec rm <span class="o">{}</span> +

<span class="c1"># Delete Priors2 subfolder</span>
<span class="o">!</span> rm -r OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/Priors2
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2024-11-08 08:55:07--  https://ndownloader.figshare.com/files/3133832
Resolving ndownloader.figshare.com (ndownloader.figshare.com)... 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>54.76.78.49, 54.154.246.233, 52.209.110.143, ...
Connecting to ndownloader.figshare.com (ndownloader.figshare.com)|54.76.78.49|:443... 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>connected.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HTTP request sent, awaiting response... 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>302 Found
Location: https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/3133832/Oasis.zip?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20241108/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20241108T085508Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=5184f7fd7367d4506b9b9a4d69eaa182bf74b5f7d00f23f9b083530ea7af89b3 [following]
--2024-11-08 08:55:08--  https://s3-eu-west-1.amazonaws.com/pfigshare-u-files/3133832/Oasis.zip?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIYCQYOYV5JSSROOA/20241108/eu-west-1/s3/aws4_request&amp;X-Amz-Date=20241108T085508Z&amp;X-Amz-Expires=10&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=5184f7fd7367d4506b9b9a4d69eaa182bf74b5f7d00f23f9b083530ea7af89b3
Resolving s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)... 52.218.101.75, 52.92.1.216, 52.218.0.51, ...
Connecting to s3-eu-west-1.amazonaws.com (s3-eu-west-1.amazonaws.com)|52.218.101.75|:443... 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>connected.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HTTP request sent, awaiting response... 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200 OK
Length: 55360609 (53M) [binary/octet-stream]
Saving to: ‘OASIS.zip’


OASIS.zip             0%[                    ]       0  --.-KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ]   8.00K  26.5KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ]  24.13K  39.9KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ]  32.13K  35.2KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ]  41.13K  34.2KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ]  49.13K  32.5KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ]  66.13K  35.5KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ]  83.13K  37.6KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 100.13K  39.8KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 117.13K  42.2KB/s               
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 134.13K  44.2KB/s    eta 20m 19s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 151.13K  45.4KB/s    eta 20m 19s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 185.13K  50.9KB/s    eta 20m 19s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 219.13K  55.7KB/s    eta 20m 19s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 253.13K  59.7KB/s    eta 15m 1s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 304.13K  67.0KB/s    eta 15m 1s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 372.13K  76.8KB/s    eta 15m 1s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 440.13K  85.5KB/s    eta 15m 1s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             0%[                    ] 508.13K  94.6KB/s    eta 9m 26s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             1%[                    ] 593.13K   106KB/s    eta 9m 26s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             1%[                    ] 661.13K   119KB/s    eta 9m 26s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             1%[                    ] 729.13K   129KB/s    eta 9m 26s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             1%[                    ] 848.13K   151KB/s    eta 9m 26s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             1%[                    ]   1001K   186KB/s    eta 5m 51s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             2%[                    ]   1.14M   219KB/s    eta 5m 51s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             2%[                    ]   1.33M   267KB/s    eta 5m 51s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             2%[                    ]   1.53M   310KB/s    eta 5m 51s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             3%[                    ]   1.74M   353KB/s    eta 3m 46s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             3%[                    ]   1.91M   392KB/s    eta 3m 46s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             3%[                    ]   2.04M   424KB/s    eta 3m 46s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             4%[                    ]   2.32M   517KB/s    eta 3m 46s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             4%[                    ]   2.62M   584KB/s    eta 3m 46s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             5%[&gt;                   ]   2.85M   621KB/s    eta 2m 35s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             5%[&gt;                   ]   3.04M   656KB/s    eta 2m 35s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             6%[&gt;                   ]   3.43M   757KB/s    eta 2m 35s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             7%[&gt;                   ]   3.88M   833KB/s    eta 2m 35s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             8%[&gt;                   ]   4.36M   966KB/s    eta 1m 49s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             9%[&gt;                   ]   4.85M  1.02MB/s    eta 1m 49s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip             9%[&gt;                   ]   5.23M  1.10MB/s    eta 1m 49s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            10%[=&gt;                  ]   5.51M  1.15MB/s    eta 1m 49s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            11%[=&gt;                  ]   6.12M  1.30MB/s    eta 1m 49s 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            12%[=&gt;                  ]   6.76M  1.42MB/s    eta 75s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            13%[=&gt;                  ]   7.26M  1.49MB/s    eta 75s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            14%[=&gt;                  ]   7.60M  1.55MB/s    eta 75s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            15%[==&gt;                 ]   8.38M  1.74MB/s    eta 75s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            17%[==&gt;                 ]   9.18M  1.91MB/s    eta 75s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            17%[==&gt;                 ]   9.42M  1.89MB/s    eta 56s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            19%[==&gt;                 ]  10.24M  2.03MB/s    eta 56s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            21%[===&gt;                ]  11.17M  2.21MB/s    eta 56s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            22%[===&gt;                ]  11.92M  2.40MB/s    eta 56s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            23%[===&gt;                ]  12.38M  2.46MB/s    eta 56s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            25%[====&gt;               ]  13.54M  2.65MB/s    eta 38s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            27%[====&gt;               ]  14.68M  2.88MB/s    eta 38s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            28%[====&gt;               ]  15.03M  2.83MB/s    eta 38s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            30%[=====&gt;              ]  16.18M  3.13MB/s    eta 38s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            33%[=====&gt;              ]  17.48M  3.31MB/s    eta 38s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            35%[======&gt;             ]  18.56M  3.52MB/s    eta 26s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            36%[======&gt;             ]  19.20M  3.51MB/s    eta 26s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            39%[======&gt;             ]  20.81M  3.80MB/s    eta 26s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            42%[=======&gt;            ]  22.38M  4.15MB/s    eta 26s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            43%[=======&gt;            ]  22.87M  4.18MB/s    eta 26s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            46%[========&gt;           ]  24.45M  4.36MB/s    eta 18s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            49%[========&gt;           ]  26.21M  4.65MB/s    eta 18s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            52%[=========&gt;          ]  27.71M  4.95MB/s    eta 18s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            54%[=========&gt;          ]  28.53M  5.05MB/s    eta 18s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            58%[==========&gt;         ]  30.70M  5.35MB/s    eta 18s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            62%[===========&gt;        ]  32.82M  5.83MB/s    eta 10s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            63%[===========&gt;        ]  33.49M  5.74MB/s    eta 10s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            67%[============&gt;       ]  35.56M  6.15MB/s    eta 10s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            71%[=============&gt;      ]  37.90M  6.51MB/s    eta 10s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            75%[==============&gt;     ]  39.90M  6.85MB/s    eta 10s    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            77%[==============&gt;     ]  40.92M  6.98MB/s    eta 5s     
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            82%[===============&gt;    ]  43.60M  7.13MB/s    eta 5s     
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            88%[================&gt;   ]  46.57M  7.60MB/s    eta 5s     
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            93%[=================&gt;  ]  49.54M  7.74MB/s    eta 5s     
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OASIS.zip            99%[==================&gt; ]  52.53M  8.17MB/s    eta 0s     
OASIS.zip           100%[===================&gt;]  52.80M  8.23MB/s    in 19s     

2024-11-08 08:55:28 (2.82 MB/s) - ‘OASIS.zip’ saved [55360609/55360609]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Archive:  OASIS.zip
  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0.nii.gz  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0_BrainCerebellum.nii.gz  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0_BrainCerebellumExtractionMask.nii.gz  
  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0_BrainCerebellumMask.nii.gz  
  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0_BrainCerebellumProbabilityMask.nii.gz  
  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0_BrainCerebellumRegistrationMask.nii.gz  
  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0_glm_4labelsJointFusion.nii.gz  
  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0_glm_6labelsJointFusion.nii.gz  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   creating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/Priors2/
  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/Priors2/priors1.nii.gz  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/Priors2/priors2.nii.gz  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/Priors2/priors3.nii.gz  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/Priors2/priors4.nii.gz  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/Priors2/priors5.nii.gz  
  inflating: OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/Priors2/priors6.nii.gz  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_template</span> <span class="o">=</span> <span class="s1">&#39;OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0.nii.gz&#39;</span>
<span class="n">brain_prior</span> <span class="o">=</span> <span class="s1">&#39;OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0_BrainCerebellumProbabilityMask.nii.gz&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="brain-extraction">
<h2>Brain Extraction<a class="headerlink" href="#brain-extraction" title="Permalink to this heading">#</a></h2>
<section id="ants">
<h3>1. ANTs<a class="headerlink" href="#ants" title="Permalink to this heading">#</a></h3>
<p>First, we will perform brain extraction with this ANTs commands:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> antsBrainExtraction.sh
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>antsBrainExtraction.sh performs template-based brain extraction.

Usage:

antsBrainExtraction.sh -d imageDimension
              -a anatomicalImage
              -e brainExtractionTemplate
              -m brainExtractionProbabilityMask
              &lt;OPT_ARGS&gt;
              -o outputPrefix

Example:

  bash /opt/ants-2.3.1/antsBrainExtraction.sh -d 3 -a t1.nii.gz -e brainWithSkullTemplate.nii.gz -m brainPrior.nii.gz -o output

Required arguments:

     -d:  Image dimension                       2 or 3 (for 2- or 3-dimensional image)
     -a:  Anatomical image                      Structural image, typically T1.  If more than one
                                                anatomical image is specified, subsequently specified
                                                images are used during the segmentation process.  However,
                                                only the first image is used in the registration of priors.
                                                Our suggestion would be to specify the T1 as the first image.
     -e:  Brain extraction template             Anatomical template created using e.g. LPBA40 data set with
                                                buildtemplateparallel.sh in ANTs.
     -m:  Brain extraction probability mask     Brain probability mask created using e.g. LPBA40 data set which
                                                have brain masks defined, and warped to anatomical template and
                                                averaged resulting in a probability image.
     -o:  Output prefix                         Output directory + file prefix

Optional arguments:

     -c:  Tissue classification                 A k-means segmentation is run to find gray or white matter around 
                                                the edge of the initial brain mask warped from the template.
                                                This produces a segmentation image with K classes, ordered by mean
                                                intensity in increasing order. With this option, you can control
                                                K and tell the script which classes represent CSF, gray and white matter. 
                                                Format (\&quot;KxcsfLabelxgmLabelxwmLabel\&quot;)
                                                Examples:   
                                                         -c 3x1x2x3 for T1 with K=3, CSF=1, GM=2, WM=3 (default)
                                                         -c 3x3x2x1 for T2 with K=3, CSF=3, GM=2, WM=1
                                                         -c 3x1x3x2 for FLAIR with K=3, CSF=1 GM=3, WM=2
                                                         -c 4x4x2x3 uses K=4, CSF=4, GM=2, WM=3

     -f:  Brain extraction registration mask    Mask used for registration to limit the metric computation to
                                                a specific region.
     -s:  image file suffix                     Any of the standard ITK IO formats e.g. nrrd, nii.gz (default), mhd
     -u:  use random seeding                    Use random number generated from system clock in Atropos (default = 1)
     -k:  keep temporary files                  Keep brain extraction/segmentation warps, etc (default = false).
     -q:  use floating point precision          Use antsRegistration with floating point precision.

     -z:  Test / debug mode                     If &gt; 0, runs a faster version of the script. Only for debugging, results will not be good.
</pre></div>
</div>
</div>
</div>
<p>To run the command using the OASIS templates, you can follow this structure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> antsBrainExtraction.sh -d <span class="m">3</span> -a <span class="nv">$input_image</span> -e <span class="nv">$brain_template</span> -m <span class="nv">$brain_prior</span> -o ANTS_Stripped_
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 
Will run Atropos segmentation with K=3. Classes labeled in order of mean intensity. Assuming CSF=1, GM=2, WM=3

The output directory &quot;ANTS_Stripped_&quot; does not exist. Making it.

    Using antsBrainExtraction with the following arguments:
      image dimension         = 3
      anatomical image        = ds000102/sub-08/anat/sub-08_T1w.nii.gz
      extraction template     = OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0.nii.gz
      extraction reg. mask    = 
      extraction prior        = OASIS/MICCAI2012-Multi-Atlas-Challenge-Data/T_template0_BrainCerebellumProbabilityMask.nii.gz
      output prefix           = ANTS_Stripped_
      output image suffix     = nii.gz

    N4 parameters (pre brain extraction):
      convergence             = [50x50x50x50,0.0000001]
      shrink factor           = 4
      B-spline parameters     = [200]

    Atropos parameters (extraction):
       convergence            = [3,0.0]
       likelihood             = Gaussian
       initialization         = kmeans[3]
       mrf                    = [0.1,1x1x1]
       use clock random seed  = 1

---------------------  Running antsBrainExtraction.sh on github-action-runner  ---------------------

--------------------------------------------------------------------------------------
 Bias correction of anatomical images (pre brain extraction)
   1) pre-process by truncating the image intensities
   2) run N4
--------------------------------------------------------------------------------------

BEGIN &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
/opt/ants-2.3.1//ImageMath 3 ANTS_Stripped_N4Truncated0.nii.gz TruncateImageIntensity ds000102/sub-08/anat/sub-08_T1w.nii.gz 0.01 0.999 256
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>END   &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;


BEGIN &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
/opt/ants-2.3.1//N4BiasFieldCorrection -d 3 -i ANTS_Stripped_N4Truncated0.nii.gz -s 4 -c [50x50x50x50,0.0000001] -b [200] -o ANTS_Stripped_N4Corrected0.nii.gz --verbose 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running N4 for 3-dimensional images.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mask not read.  Using the entire image as the mask.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Specified spline distance: 200mm
  original image size:  [176, 256, 256]
  padded image size:  [201, 401, 401]
  number of control points:  [4, 5, 5]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Current level = 1
  Iteration 1 (of 50).   Current convergence value = 0.000258536 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 2 (of 50).   Current convergence value = 0.000248828 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 3 (of 50).   Current convergence value = 0.000240245 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 4 (of 50).   Current convergence value = 0.000232668 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 5 (of 50).   Current convergence value = 0.00022608 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 6 (of 50).   Current convergence value = 0.000220297 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 7 (of 50).   Current convergence value = 0.000214742 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 8 (of 50).   Current convergence value = 0.000209961 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 9 (of 50).   Current convergence value = 0.000205729 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 10 (of 50).   Current convergence value = 0.000201525 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 11 (of 50).   Current convergence value = 0.000197393 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 12 (of 50).   Current convergence value = 0.000193677 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 13 (of 50).   Current convergence value = 0.00019035 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 14 (of 50).   Current convergence value = 0.000187294 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 15 (of 50).   Current convergence value = 0.000184611 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 16 (of 50).   Current convergence value = 0.000182274 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 17 (of 50).   Current convergence value = 0.000180015 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 18 (of 50).   Current convergence value = 0.000177968 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 19 (of 50).   Current convergence value = 0.000176021 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 20 (of 50).   Current convergence value = 0.000174094 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 21 (of 50).   Current convergence value = 0.000171951 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 22 (of 50).   Current convergence value = 0.000169746 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 23 (of 50).   Current convergence value = 0.000167645 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 24 (of 50).   Current convergence value = 0.000165552 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 25 (of 50).   Current convergence value = 0.000163502 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 26 (of 50).   Current convergence value = 0.000162474 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 27 (of 50).   Current convergence value = 0.00016215 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 28 (of 50).   Current convergence value = 0.000161625 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 29 (of 50).   Current convergence value = 0.000160964 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 30 (of 50).   Current convergence value = 0.000160438 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 31 (of 50).   Current convergence value = 0.000159709 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 32 (of 50).   Current convergence value = 0.000159056 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 33 (of 50).   Current convergence value = 0.000158104 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 34 (of 50).   Current convergence value = 0.000157114 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 35 (of 50).   Current convergence value = 0.000155974 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 36 (of 50).   Current convergence value = 0.000154861 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 37 (of 50).   Current convergence value = 0.000153546 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 38 (of 50).   Current convergence value = 0.000152239 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 39 (of 50).   Current convergence value = 0.000151147 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 40 (of 50).   Current convergence value = 0.000149921 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 41 (of 50).   Current convergence value = 0.000148829 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 42 (of 50).   Current convergence value = 0.000147763 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 43 (of 50).   Current convergence value = 0.000146349 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 44 (of 50).   Current convergence value = 0.00014523 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 45 (of 50).   Current convergence value = 0.000144099 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 46 (of 50).   Current convergence value = 0.000142761 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 47 (of 50).   Current convergence value = 0.000141342 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 48 (of 50).   Current convergence value = 0.000140069 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 49 (of 50).   Current convergence value = 0.000138855 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 50 (of 50).   Current convergence value = 0.000137506 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Current level = 2
  Iteration 1 (of 50).   Current convergence value = 0.000342861 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 2 (of 50).   Current convergence value = 0.000341625 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 3 (of 50).   Current convergence value = 0.000340768 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 4 (of 50).   Current convergence value = 0.000340175 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 5 (of 50).   Current convergence value = 0.00033827 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 6 (of 50).   Current convergence value = 0.000336399 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 7 (of 50).   Current convergence value = 0.000334478 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 8 (of 50).   Current convergence value = 0.000331891 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 9 (of 50).   Current convergence value = 0.000329826 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 10 (of 50).   Current convergence value = 0.000327873 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 11 (of 50).   Current convergence value = 0.000326366 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 12 (of 50).   Current convergence value = 0.000325203 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 13 (of 50).   Current convergence value = 0.000324245 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 14 (of 50).   Current convergence value = 0.000323119 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 15 (of 50).   Current convergence value = 0.000322634 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 16 (of 50).   Current convergence value = 0.000322995 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 17 (of 50).   Current convergence value = 0.00032329 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 18 (of 50).   Current convergence value = 0.000323898 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 19 (of 50).   Current convergence value = 0.000324528 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 20 (of 50).   Current convergence value = 0.000321647 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 21 (of 50).   Current convergence value = 0.000318242 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 22 (of 50).   Current convergence value = 0.000315148 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 23 (of 50).   Current convergence value = 0.000312036 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 24 (of 50).   Current convergence value = 0.000309086 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Iteration 25 (of 50).   Current convergence value = 0.00030673 (threshold = 1e-07)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>^C
</pre></div>
</div>
</div>
</div>
<p>The option <code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">3</span></code> means that it is a three-dimensional image; <code class="docutils literal notranslate"><span class="pre">-a</span></code> indicates the anatomical image to be stripped; and <code class="docutils literal notranslate"><span class="pre">-e</span></code> is used to supply a an anatomical template (with skull) and <code class="docutils literal notranslate"><span class="pre">-m</span></code> to provide a brain probability mask for skull-stripping , and <code class="docutils literal notranslate"><span class="pre">-o</span></code> is the label (prefix) for the output.</p>
</section>
<section id="afni">
<h3>2. AFNI<a class="headerlink" href="#afni" title="Permalink to this heading">#</a></h3>
<p>Next, we will use AFNI’s 3dSkullStrip for brain extraction</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> 3dSkullStrip -help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage: A program to extract the brain from surrounding.
  tissue from MRI T1-weighted images. 
  The simplest command would be:
        3dSkullStrip &lt;-input DSET&gt;

  Also consider the script @SSwarper, which combines the use of
  3dSkullStrip and nonlinear warping to an MNI template to produce
  a skull-stripped dataset in MNI space, plus the nonlinear warp
  that can used to transform other datasets from the same subject
  (e.g., EPI) to MNI space. (This script only applies to human brain
  images.)

  The fully automated process consists of three steps:
  1- Preprocessing of volume to remove gross spatial image 
  non-uniformity artifacts and reposition the brain in
  a reasonable manner for convenience.
    ** Note that in many cases, using 3dUnifize before **
    ** using 3dSkullStrip will give better results.    **
  2- Expand a spherical surface iteratively until it envelopes
  the brain. This is a modified version of the BET algorithm:
     Fast robust automated brain extraction, 
      by Stephen M. Smith, HBM 2002 v 17:3 pp 143-155
    Modifications include the use of:
     . outer brain surface
     . expansion driven by data inside and outside the surface
     . avoidance of eyes and ventricles
     . a set of operations to avoid the clipping of certain brain
       areas and reduce leakage into the skull in heavily shaded
       data
     . two additional processing stages to ensure convergence and
       reduction of clipped areas.
     . use of 3d edge detection, see Deriche and Monga references
       in 3dedge3 -help.
  3- The creation of various masks and surfaces modeling brain
     and portions of the skull

  Common examples of usage:
  -------------------------
  o 3dSkullStrip -input VOL -prefix VOL_PREFIX
     Vanilla mode, should work for most datasets.
  o 3dSkullStrip -input VOL -prefix VOL_PREFIX -push_to_edge
     Adds an aggressive push to brain edges. Use this option
     when the chunks of gray matter are not included. This option
     might cause the mask to leak into non-brain areas.
  o 3dSkullStrip -input VOL -surface_coil -prefix VOL_PREFIX -monkey
     Vanilla mode, for use with monkey data.
  o 3dSkullStrip -input VOL -prefix VOL_PREFIX -ld 30
     Use a denser mesh, in the cases where you have lots of 
     csf between gyri. Also helps when some of the brain is clipped
     close to regions of high curvature.

  Tips:
  -----
     I ran the program with the default parameters on 200+ datasets.
     The results were quite good in all but a couple of instances, here
     are some tips on fixing trouble spots:

     Clipping in frontal areas, close to the eye balls:
        + Try -push_to_edge option first.
          Can also try -no_avoid_eyes option.
     Clipping in general:
        + Try -push_to_edge option first.
          Can also use lower -shrink_fac, start with 0.5 then 0.4
     Problems down below:
        + Piece of cerebellum missing, reduce -shrink_fac_bot_lim 
          from default value.
        + Leakage in lower areas, increase -shrink_fac_bot_lim 
          from default value.
     Some lobules are not included:
        + Use a denser mesh. Start with -ld 30. If that still fails,
        try even higher density (like -ld 50) and increase iterations 
        (say to -niter 750). 
        Expect the program to take much longer in that case.
        + Instead of using denser meshes, you could try blurring the data 
        before skull stripping. Something like -blur_fwhm 2 did
        wonders for some of my data with the default options of 3dSkullStrip
        Blurring is a lot faster than increasing mesh density.
        + Use also a smaller -shrink_fac is you have lots of CSF between
        gyri.
     Massive chunks missing:
        + If brain has very large ventricles and lots of CSF between gyri,
        the ventricles will keep attracting the surface inwards. 
        This often happens with older brains. In such 
        cases, use the -visual option to see what is happening.
        For example, the options below did the trick in various
        instances. 
            -blur_fwhm 2 -use_skull  
        or for more stubborn cases increase csf avoidance with this cocktail
            -blur_fwhm 2 -use_skull -avoid_vent -avoid_vent -init_radius 75 
        + Too much neck in the volume might throw off the initialization
          step. You can fix this by clipping tissue below the brain with 
                 @clip_volume -below ZZZ -input INPUT  
          where ZZZ is a Z coordinate somewhere below the brain.

     Large regions outside brain included:
       + Usually because noise level is high. Try @NoisySkullStrip.

  Make sure that brain orientation is correct. This means the image in 
  AFNI&#39;s axial slice viewer should be close to the brain&#39;s axial plane.
  The same goes for the other planes. Otherwise, the program might do a lousy
  job removing the skull.

  Eye Candy Mode: 
  ---------------
  You can run 3dSkullStrip and have it send successive iterations
 to SUMA and AFNI. This is very helpful in following the
 progression of the algorithm and determining the source
 of trouble, if any.
  Example:
     afni -niml -yesplugouts &amp;
     suma -niml &amp;
     3dSkullStrip -input Anat+orig -o_ply anat_brain -visual

  Help section for the intrepid:
  ------------------------------
  3dSkullStrip  &lt; -input VOL &gt;
             [&lt; -o_TYPE PREFIX &gt;] [&lt; -prefix VOL_PREFIX &gt;] 
             [&lt; -spatnorm &gt;] [&lt; -no_spatnorm &gt;] [&lt; -write_spatnorm &gt;]
             [&lt; -niter N_ITER &gt;] [&lt; -ld LD &gt;] 
             [&lt; -shrink_fac SF &gt;] [&lt; -var_shrink_fac &gt;] 
             [&lt; -no_var_shrink_fac &gt;] [&lt; -shrink_fac_bot_lim SFBL &gt;]
             [&lt; -pushout &gt;] [&lt; -no_pushout &gt;] [&lt; -exp_frac FRAC]
             [&lt; -touchup &gt;] [&lt; -no_touchup &gt;]
             [&lt; -fill_hole R &gt;] [&lt; -NN_smooth NN_SM &gt;]
             [&lt; -smooth_final SM &gt;] [&lt; -avoid_vent &gt;] [&lt; -no_avoid_vent &gt;]
             [&lt; -use_skull &gt;] [&lt; -no_use_skull &gt;] 
             [&lt; -avoid_eyes &gt;] [&lt; -no_avoid_eyes &gt;] 
             [&lt; -use_edge &gt;] [&lt; -no_use_edge &gt;] 
             [&lt; -push_to_edge &gt;] [&lt;-no_push_to_edge&gt;]
             [&lt; -perc_int PERC_INT &gt;] 
             [&lt; -max_inter_iter MII &gt;] [-mask_vol | -orig_vol | -norm_vol]
             [&lt; -debug DBG &gt;] [&lt; -node_debug NODE_DBG &gt;]
             [&lt; -demo_pause &gt;]
             [&lt; -monkey &gt;] [&lt; -marmoset &gt;] [&lt;-rat&gt;]

  NOTE: Please report bugs and strange failures
        to saadz@mail.nih.gov

  Mandatory parameters:
     -input VOL: Input AFNI (or AFNI readable) volume.
                 

  Optional Parameters:
     -monkey: the brain of a monkey.
     -marmoset: the brain of a marmoset. 
                this one was tested on one dataset
                and may not work with non default
                options. Check your results!
     -rat: the brain of a rat.
           By default, no_touchup is used with the rat.
     -surface_coil: Data acquired with a surface coil.
     -o_TYPE PREFIX: prefix of output surface.
        where TYPE specifies the format of the surface
        and PREFIX is, well, the prefix.
        TYPE is one of: fs, 1d (or vec), sf, ply.
        More on that below.
     -skulls: Output surface models of the skull.
     -4Tom:   The output surfaces are named based
             on PREFIX following -o_TYPE option below.
     -prefix VOL_PREFIX: prefix of output volume.
        If not specified, the prefix is the same
        as the one used with -o_TYPE.
        The output volume is skull stripped version
        of the input volume. In the earlier version
        of the program, a mask volume was written out.
        You can still get that mask volume instead of the
        skull-stripped volume with the option -mask_vol . 
        NOTE: In the default setting, the output volume does not 
              have values identical to those in the input. 
              In particular, the range might be larger 
              and some low-intensity values are set to 0.
              If you insist on having the same range of values as in
              the input, then either use option -orig_vol, or run:
         3dcalc -nscale -a VOL+VIEW -b VOL_PREFIX+VIEW \
                -expr &#39;a*step(b)&#39; -prefix VOL_SAME_RANGE
              With the command above, you can preserve the range
              of values of the input but some low-intensity voxels would
              still be masked. If you want to preserve them, then use
              -mask_vol in the 3dSkullStrip command that would produce 
              VOL_MASK_PREFIX+VIEW. Then run 3dcalc masking with voxels
              inside the brain surface envelope:
         3dcalc -nscale -a VOL+VIEW -b VOL_MASK_PREFIX+VIEW \
                -expr &#39;a*step(b-3.01)&#39; -prefix VOL_SAME_RANGE_KEEP_LOW
     -norm_vol: Output a masked and somewhat intensity normalized and 
                thresholded version of the input. This is the default,
                and you can use -orig_vol to override it.
     -orig_vol: Output a masked version of the input AND do not modify
                the values inside the brain as -norm_vol would.
     -mask_vol: Output a mask volume instead of a skull-stripped
                volume.
                The mask volume contains:
                 0: Voxel outside surface
                 1: Voxel just outside the surface. This means the voxel
                    center is outside the surface but inside the 
                    bounding box of a triangle in the mesh. 
                 2: Voxel intersects the surface (a triangle), but center
                    lies outside.
                 3: Voxel contains a surface node.
                 4: Voxel intersects the surface (a triangle), center lies
                    inside surface. 
                 5: Voxel just inside the surface. This means the voxel
                    center is inside the surface and inside the 
                    bounding box of a triangle in the mesh. 
                 6: Voxel inside the surface. 
     -spat_norm: (Default) Perform spatial normalization first.
                 This is a necessary step unless the volume has
                 been &#39;spatnormed&#39; already.
     -no_spatnorm: Do not perform spatial normalization.
                   Use this option only when the volume 
                   has been run through the &#39;spatnorm&#39; process
     -spatnorm_dxyz DXYZ: Use DXY for the spatial resolution of the
                          spatially normalized volume. The default 
                          is the lowest of all three dimensions.
                          For human brains, use DXYZ of 1.0, for
                          primate brain, use the default setting.
     -write_spatnorm: Write the &#39;spatnormed&#39; volume to disk.
     -niter N_ITER: Number of iterations. Default is 250
        For denser meshes, you need more iterations
        N_ITER of 750 works for LD of 50.
     -ld LD: Parameter to control the density of the surface.
             Default is 20 if -no_use_edge is used,
             30 with -use_edge. See CreateIcosahedron -help
             for details on this option.
     -shrink_fac SF: Parameter controlling the brain vs non-brain
             intensity threshold (tb). Default is 0.6.
              tb = (Imax - t2) SF + t2 
             where t2 is the 2 percentile value and Imax is the local
             maximum, limited to the median intensity value.
             For more information on tb, t2, etc. read the BET paper
             mentioned above. Note that in 3dSkullStrip, SF can vary across 
             iterations and might be automatically clipped in certain areas.
             SF can vary between 0 and 1.
             0: Intensities &lt; median inensity are considered non-brain
             1: Intensities &lt; t2 are considered non-brain
     -var_shrink_fac: Vary the shrink factor with the number of
             iterations. This reduces the likelihood of a surface
             getting stuck on large pools of CSF before reaching
             the outer surface of the brain. (Default)
     -no_var_shrink_fac: Do not use var_shrink_fac.
     -shrink_fac_bot_lim SFBL: Do not allow the varying SF to go
             below SFBL . Default 0.65, 0.4 when edge detection is used. 
             This option helps reduce potential for leakage below 
             the cerebellum.
             In certain cases where you have severe non-uniformity resulting
             in low signal towards the bottom of the brain, you will need to
             reduce this parameter.
     -pushout: Consider values above each node in addition to values
               below the node when deciding on expansion. (Default)
     -no_pushout: Do not use -pushout.
     -exp_frac FRAC: Speed of expansion (see BET paper). Default is 0.1.
     -touchup: Perform touchup operations at end to include
               areas not covered by surface expansion. 
               Use -touchup -touchup for aggressive makeup.
               (Default is -touchup)
     -no_touchup: Do not use -touchup
     -fill_hole R: Fill small holes that can result from small surface
                   intersections caused by the touchup operation.
                   R is the maximum number of pixels on the side of a hole
                   that can be filled. Big holes are not filled.
                   If you use -touchup, the default R is 10. Otherwise 
                   the default is 0.
                   This is a less than elegant solution to the small
                   intersections which are usually eliminated
                   automatically. 
     -NN_smooth NN_SM: Perform Nearest Neighbor coordinate interpolation
                       every few iterations. Default is 72
     -smooth_final SM: Perform final surface smoothing after all iterations.
                       Default is 20 smoothing iterations.
                       Smoothing is done using Taubin&#39;s method, 
                       see SurfSmooth -help for detail.
     -avoid_vent: avoid ventricles. Default.
                  Use this option twice to make the avoidance more
                  aggressive. That is at times needed with old brains.
     -no_avoid_vent: Do not use -avoid_vent.
     -init_radius RAD: Use RAD for the initial sphere radius.
                       For the automatic setting, there is an
                       upper limit of 100mm for humans.
                       For older brains with lots of CSF, you
                       might benefit from forcing the radius 
                       to something like 75mm
     -avoid_eyes: avoid eyes. Default
     -no_avoid_eyes: Do not use -avoid_eyes.
     -use_edge: Use edge detection to reduce leakage into meninges and eyes.
                Default.
     -no_use_edge: Do no use edges.
     -push_to_edge: Perform aggressive push to edge at the end.
                    This option might cause leakage.
     -no_push_to_edge: (Default).
     -use_skull: Use outer skull to limit expansion of surface into
                 the skull due to very strong shading artifacts.
                 This option is buggy at the moment, use it only 
                 if you have leakage into skull.
     -no_use_skull: Do not use -use_skull (Default).
     -send_no_skull: Do not send the skull surface to SUMA if you are
                     using  -talk_suma
     -perc_int PERC_INT: Percentage of segments allowed to intersect
                         surface. Ideally this should be 0 (Default). 
                         However, few surfaces might have small stubborn
                         intersections that produce a few holes.
                         PERC_INT should be a small number, typically
                         between 0 and 0.1. A -1 means do not do
                         any testing for intersection.
     -max_inter_iter N_II: Number of iteration to remove intersection
                           problems. With each iteration, the program
                           automatically increases the amount of smoothing
                           to get rid of intersections. Default is 4
     -blur_fwhm FWHM: Blur dset after spatial normalization.
                      Recommended when you have lots of CSF in brain
                      and when you have protruding gyri (finger like)
                      Recommended value is 2..4. 
     -interactive: Make the program stop at various stages in the 
                   segmentation process for a prompt from the user
                   to continue or skip that stage of processing.
                   This option is best used in conjunction with options
                   -talk_suma and -feed_afni
     -demo_pause: Pause at various step in the process to facilitate
                  interactive demo while 3dSkullStrip is communicating
                  with AFNI and SUMA. See &#39;Eye Candy&#39; mode below and
                  -talk_suma option. 
     -fac FAC: Multiply input dataset by FAC if range of values is too
               small.

 Specifying output surfaces using -o or -o_TYPE options: 
    -o_TYPE outSurf specifies the output surface, 
            TYPE is one of the following:
       fs: FreeSurfer ascii surface. 
       fsp: FeeSurfer ascii patch surface. 
            In addition to outSurf, you need to specify
            the name of the parent surface for the patch.
            using the -ipar_TYPE option.
            This option is only for ConvertSurface 
       sf: SureFit surface. 
           For most programs, you are expected to specify prefix:
           i.e. -o_sf brain. In some programs, you are allowed to 
           specify both .coord and .topo file names: 
           i.e. -o_sf XYZ.coord TRI.topo
           The program will determine your choice by examining 
           the first character of the second parameter following
           -o_sf. If that character is a &#39;-&#39; then you have supplied
           a prefix and the program will generate the coord and topo names.
       vec (or 1D): Simple ascii matrix format. 
            For most programs, you are expected to specify prefix:
            i.e. -o_1D brain. In some programs, you are allowed to 
            specify both coord and topo file names: 
            i.e. -o_1D brain.1D.coord brain.1D.topo
            coord contains 3 floats per line, representing 
            X Y Z vertex coordinates.
            topo contains 3 ints per line, representing 
            v1 v2 v3 triangle vertices.
       ply: PLY format, ascii or binary.
       stl: STL format, ascii or binary (see also STL under option -i_TYPE).
       byu: BYU format, ascii or binary.
       mni: MNI obj format, ascii only.
       gii: GIFTI format, ascii.
            You can also enforce the encoding of data arrays
            by using gii_asc, gii_b64, or gii_b64gz for 
            ASCII, Base64, or Base64 Gzipped. 
            If AFNI_NIML_TEXT_DATA environment variable is set to YES, the
            the default encoding is ASCII, otherwise it is Base64.
       obj: No support for writing OBJ format exists yet.
 Note that if the surface filename has the proper extension, 
 it is enough to use the -o option and let the programs guess
 the type from the extension.

  SUMA communication options:
      -talk_suma: Send progress with each iteration to SUMA.
      -refresh_rate rps: Maximum number of updates to SUMA per second.
                         The default is the maximum speed.
      -send_kth kth: Send the kth element to SUMA (default is 1).
                     This allows you to cut down on the number of elements
                     being sent to SUMA.
      -sh &lt;SumaHost&gt;: Name (or IP address) of the computer running SUMA.
                      This parameter is optional, the default is 127.0.0.1 
      -ni_text: Use NI_TEXT_MODE for data transmission.
      -ni_binary: Use NI_BINARY_MODE for data transmission.
                  (default is ni_binary).
      -feed_afni: Send updates to AFNI via SUMA&#39;s talk.
   -np PORT_OFFSET: Provide a port offset to allow multiple instances of
                    AFNI &lt;--&gt; SUMA, AFNI &lt;--&gt; 3dGroupIncorr, or any other
                    programs that communicate together to operate on the same
                    machine. 
                    All ports are assigned numbers relative to PORT_OFFSET.
         The same PORT_OFFSET value must be used on all programs
           that are to talk together. PORT_OFFSET is an integer in
           the inclusive range [1025 to 65500]. 
         When you want to use multiple instances of communicating programs, 
           be sure the PORT_OFFSETS you use differ by about 50 or you may
           still have port conflicts. A BETTER approach is to use -npb below.
   -npq PORT_OFFSET: Like -np, but more quiet in the face of adversity.
   -npb PORT_OFFSET_BLOC: Similar to -np, except it is easier to use.
                          PORT_OFFSET_BLOC is an integer between 0 and
                          MAX_BLOC. MAX_BLOC is around 4000 for now, but
                          it might decrease as we use up more ports in AFNI.
                          You should be safe for the next 10 years if you 
                          stay under 2000.
                          Using this function reduces your chances of causing
                          port conflicts.

         See also afni and suma options: -list_ports and -port_number for 
            information about port number assignments.

         You can also provide a port offset with the environment variable
            AFNI_PORT_OFFSET. Using -np overrides AFNI_PORT_OFFSET.

   -max_port_bloc: Print the current value of MAX_BLOC and exit.
                   Remember this value can get smaller with future releases.
                   Stay under 2000.
   -max_port_bloc_quiet: Spit MAX_BLOC value only and exit.
   -num_assigned_ports: Print the number of assigned ports used by AFNI 
                        then quit.
   -num_assigned_ports_quiet: Do it quietly.

     Port Handling Examples:
     -----------------------
         Say you want to run three instances of AFNI &lt;--&gt; SUMA.
         For the first you just do: 
            suma -niml -spec ... -sv ...  &amp;
            afni -niml &amp;
         Then for the second instance pick an offset bloc, say 1 and run
            suma -niml -npb 1 -spec ... -sv ...  &amp;
            afni -niml -npb 1 &amp;
         And for yet another instance:
            suma -niml -npb 2 -spec ... -sv ...  &amp;
            afni -niml -npb 2 &amp;
         etc.

         Since you can launch many instances of communicating programs now,
            you need to know wich SUMA window, say, is talking to which AFNI.
            To sort this out, the titlebars now show the number of the bloc 
            of ports they are using. When the bloc is set either via 
            environment variables AFNI_PORT_OFFSET or AFNI_PORT_BLOC, or  
            with one of the -np* options, window title bars change from 
            [A] to [A#] with # being the resultant bloc number.
         In the examples above, both AFNI and SUMA windows will show [A2]
            when -npb is 2.



     -visual: Equivalent to using -talk_suma -feed_afni -send_kth 5

     -debug DBG: debug levels of 0 (default), 1, 2, 3.
        This is no Rick Reynolds debug, which is oft nicer
        than the results, but it will do.
     -node_debug NODE_DBG: Output lots of parameters for node
                         NODE_DBG for each iteration.
     The next 3 options are for specifying surface coordinates
     to keep the program from having to recompute them.
     The options are only useful for saving time during debugging.
     -brain_contour_xyz_file BRAIN_CONTOUR_XYZ.1D
     -brain_hull_xyz_file BRAIN_HULL_XYZ.1D
     -skull_outer_xyz_file SKULL_OUTER_XYZ.1D
     -help: The help you need

   [-novolreg]: Ignore any Rotate, Volreg, Tagalign, 
                or WarpDrive transformations present in 
                the Surface Volume.
   [-noxform]: Same as -novolreg
   [-setenv &quot;&#39;ENVname=ENVvalue&#39;&quot;]: Set environment variable ENVname
                to be ENVvalue. Quotes are necessary.
             Example: suma -setenv &quot;&#39;SUMA_BackgroundColor = 1 0 1&#39;&quot;
                See also options -update_env, -environment, etc
                in the output of &#39;suma -help&#39;
  Common Debugging Options:
   [-trace]: Turns on In/Out debug and Memory tracing.
             For speeding up the tracing log, I recommend 
             you redirect stdout to a file when using this option.
             For example, if you were running suma you would use:
             suma -spec lh.spec -sv ... &gt; TraceFile
             This option replaces the old -iodbg and -memdbg.
   [-TRACE]: Turns on extreme tracing.
   [-nomall]: Turn off memory tracing.
   [-yesmall]: Turn on memory tracing (default).
  NOTE: For programs that output results to stdout
    (that is to your shell/screen), the debugging info
    might get mixed up with your results.


Global Options (available to all AFNI/SUMA programs)
  -h: Mini help, at time, same as -help in many cases.
  -help: The entire help output
  -HELP: Extreme help, same as -help in majority of cases.
  -h_view: Open help in text editor. AFNI will try to find a GUI editor
  -hview : on your machine. You can control which it should use by
           setting environment variable AFNI_GUI_EDITOR.
  -h_web: Open help in web browser. AFNI will try to find a browser.
  -hweb : on your machine. You can control which it should use by
          setting environment variable AFNI_GUI_EDITOR. 
  -h_find WORD: Look for lines in this programs&#39;s -help output that match
                (approximately) WORD.
  -h_raw: Help string unedited
  -h_spx: Help string in sphinx loveliness, but do not try to autoformat
  -h_aspx: Help string in sphinx with autoformatting of options, etc.
  -all_opts: Try to identify all options for the program from the
             output of its -help option. Some options might be missed
             and others misidentified. Use this output for hints only.
  


Compile Date:
   Apr  9 2024

       Ziad S. Saad SSCC/NIMH/NIH saadz@mail.nih.gov     
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> 3dSkullStrip -input <span class="nv">$input_image</span> -prefix AFNI_ss.nii.gz -push_to_edge
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3dSkullStrip: Pushing to Edge ...
The intensity in the output dataset is a modified version
of the intensity in the input volume.
To obtain a masked version of the input with identical values inside
the brain, you can either use 3dSkullStrip&#39;s -orig_vol option
or run the following command:
  3dcalc -a ds000102/sub-08/anat/sub-08_T1w.nii.gz -b ./AFNI_ss.nii.gz+orig -expr &#39;a*step(b)&#39; \
         -prefix ./AFNI_ss.nii.gz_orig_vol
to generate a new masked version of the input.
</pre></div>
</div>
</div>
</div>
<p>From <a class="reference external" href="https://afni.nimh.nih.gov/pub/dist/doc/program_help/3dSkullStrip.html">AFNI’s documentation</a>:</p>
<p><code class="docutils literal notranslate"><span class="pre">-push_to_edge</span></code>: Adds an aggressive push to brain edges. Use this option when the chunks of gray matter are not included. This option might cause the mask to leak into non-brain areas.</p>
</section>
<section id="id1">
<h3>3. FreeSurfer<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>FreeSurfer’s SynthStrip is a skull-stripping tool that extracts brain voxels from a landscape of image types, ranging across imaging modalities, resolutions, and subject populations. It leverages a deep learning strategy to synthesize arbitrary training images from segmentation maps, yielding a robust model agnostic to acquisition specifics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> mri_synthstrip --help
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>usage: mri_synthstrip [-h] -i file [-o file] [-m file] [-g] [-b BORDER]
                      [--no-csf] [--model file]

Robust, universal skull-stripping for brain images of any type. If you use
SynthStrip in your analysis, please cite: SynthStrip: Skull-Stripping for Any
Brain Image. A Hoopes, JS Mora, AV Dalca, B Fischl, M Hoffmann. NeuroImage 206
(2022), 119474. https://doi.org/10.1016/j.neuroimage.2022.119474

optional arguments:
  -h, --help            show this help message and exit
  -i file, --image file
                        Input image to skullstrip.
  -o file, --out file   Save stripped image to path.
  -m file, --mask file  Save binary brain mask to path.
  -g, --gpu             Use the GPU.
  -b BORDER, --border BORDER
                        Mask border threshold in mm. Default is 1.
  --no-csf              Exclude CSF from brain border.
  --model file          Alternative model weights.
</pre></div>
</div>
</div>
</div>
<p>Next, you can run SynthStrip using the following syntax. In this command, “synth_stripped.nii.gz” will be the skull-stripped version of the input image “sub-08_T1w.nii.gz.” Use the <code class="docutils literal notranslate"><span class="pre">-m</span></code> flag to save a binary brain mask:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> mri_synthstrip -i <span class="nv">$input_image</span> -o synth_stripped.nii.gz -m synth_mask.nii.gz
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configuring model on the CPU
Running SynthStrip model version 1
Input image read from: ds000102/sub-08/anat/sub-08_T1w.nii.gz
Masked image saved to: synth_stripped.nii.gz
Binary brain mask saved to: synth_mask.nii.gz
If you use SynthStrip in your analysis, please cite:
----------------------------------------------------
SynthStrip: Skull-Stripping for Any Brain Image.
A Hoopes, JS Mora, AV Dalca, B Fischl, M Hoffmann.
NeuroImage 206 (2022), 119474.
</pre></div>
</div>
</div>
</div>
</section>
<section id="fsl">
<h3>4. FSL<a class="headerlink" href="#fsl" title="Permalink to this heading">#</a></h3>
<p>Another option for brain extraction is FSL’s BET (Brain Extraction Tool):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> bet
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Usage:    bet &lt;input&gt; &lt;output&gt; [options]

Main bet2 options:
  -o          generate brain surface outline overlaid onto original image
  -m          generate binary brain mask
  -s          generate approximate skull image
  -n          don&#39;t generate segmented brain image output
  -f &lt;f&gt;      fractional intensity threshold (0-&gt;1); default=0.5; smaller values give larger brain outline estimates
  -g &lt;g&gt;      vertical gradient in fractional intensity threshold (-1-&gt;1); default=0; positive values give larger brain outline at bottom, smaller at top
  -r &lt;r&gt;      head radius (mm not voxels); initial surface sphere is set to half of this
  -c &lt;x y z&gt;  centre-of-gravity (voxels not mm) of initial mesh surface.
  -t          apply thresholding to segmented brain image and mask
  -e          generates brain surface as mesh in .vtk format

Variations on default bet2 functionality (mutually exclusive options):
  (default)   just run bet2
  -R          robust brain centre estimation (iterates BET several times)
  -S          eye &amp; optic nerve cleanup (can be useful in SIENA - disables -o option)
  -B          bias field &amp; neck cleanup (can be useful in SIENA)
  -Z          improve BET if FOV is very small in Z (by temporarily padding end slices)
  -F          apply to 4D FMRI data (uses -f 0.3 and dilates brain mask slightly)
  -A          run bet2 and then betsurf to get additional skull and scalp surfaces (includes registrations)
  -A2 &lt;T2&gt;    as with -A, when also feeding in non-brain-extracted T2 (includes registrations)

Miscellaneous options:
  -v          verbose (switch on diagnostic messages)
  -h          display this help, then exits
  -d          debug (don&#39;t delete temporary intermediate images)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span> bet <span class="nv">$input_image</span> anat_bet.nii.gz -m 
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this heading">#</a></h2>
<p>Now we will compare the skull-stripped results with the original T1 image to assess the effectiveness of the brain extraction process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ipyniivue</span> <span class="kn">import</span> <span class="n">AnyNiivue</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Markdown</span>

<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;### T1 image&quot;</span><span class="p">))</span>

<span class="n">nv_T1</span> <span class="o">=</span> <span class="n">AnyNiivue</span><span class="p">()</span>
<span class="n">nv_T1</span><span class="o">.</span><span class="n">load_volumes</span><span class="p">([{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}])</span>
<span class="n">nv_T1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p class="rubric">T1 image</p>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b40c3fc3220a42c0b346beea1e7c0919", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;### ANTs BrainExtraction&quot;</span><span class="p">))</span>

<span class="n">nv_ANTS</span> <span class="o">=</span> <span class="n">AnyNiivue</span><span class="p">()</span>
<span class="n">nv_ANTS</span><span class="o">.</span><span class="n">load_volumes</span><span class="p">([{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;ANTS_Stripped_BrainExtractionBrain.nii.gz&quot;</span><span class="p">}])</span>
<span class="n">nv_ANTS</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p class="rubric">ANTs BrainExtraction</p>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5445103eb09f41648387ccaae3650fd6", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;### AFNI 3dSkullStrip&quot;</span><span class="p">))</span>

<span class="n">nv_AFNI</span> <span class="o">=</span> <span class="n">AnyNiivue</span><span class="p">()</span>
<span class="n">nv_AFNI</span><span class="o">.</span><span class="n">load_volumes</span><span class="p">([{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;AFNI_ss.nii.gz&quot;</span><span class="p">}])</span>
<span class="n">nv_AFNI</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p class="rubric">AFNI 3dSkullStrip</p>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b47ee1980bb14c2a80ab7b0d893ef7be", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;### FreeSurfer SynthStrip&quot;</span><span class="p">))</span>

<span class="n">nv_FreeSurfer</span> <span class="o">=</span> <span class="n">AnyNiivue</span><span class="p">()</span>
<span class="n">nv_FreeSurfer</span><span class="o">.</span><span class="n">load_volumes</span><span class="p">([{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;synth_stripped.nii.gz&quot;</span><span class="p">}])</span>
<span class="n">nv_FreeSurfer</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p class="rubric">FreeSurfer SynthStrip</p>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "57050ef0ff874db9bfffab1d3f43cf6b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;### FSL BET&quot;</span><span class="p">))</span>

<span class="n">nv_FSL</span> <span class="o">=</span> <span class="n">AnyNiivue</span><span class="p">()</span>
<span class="n">nv_FSL</span><span class="o">.</span><span class="n">load_volumes</span><span class="p">([{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;anat_bet.nii.gz&quot;</span><span class="p">}])</span>
<span class="n">nv_FSL</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<p class="rubric">FSL BET</p>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "90eff8a58b93440b9e7990d1c4f9afde", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citation">Citation:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-neurodesk">Setup Neurodesk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-normalization-tools-ants">Advanced Normalization Tools (ANTs)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-functional-neuroimages-afni">Analysis of Functional NeuroImages (AFNI)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#freesurfer">FreeSurfer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fmrib-software-library-fsl">FMRIB Software Library (FSL)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data">Download Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#t1-image-for-brain-extraction">T1 Image for brain extraction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ants-brain-templates">ANTs Brain Templates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#brain-extraction">Brain Extraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ants">1. ANTs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#afni">2. AFNI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">3. FreeSurfer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fsl">4. FSL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Neurodesk Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>