

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>QSMxT Example &#8212; Neurodesk</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'structural_imaging/qsmxt_example';</script>
    <link rel="canonical" href="https://neurodesk.github.io/example-notebooks/intro.html/structural_imaging/qsmxt_example.html" />
    <link rel="shortcut icon" href="../_static/neurodesk.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SCT Toolbox Example" href="sct_toolbox_example.html" />
    <link rel="prev" title="Basic Nipype Example" href="nipype_module_example.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/neurodesk.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/neurodesk.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Structural Imaging</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nipype_module_example.html">Basic Nipype Example</a></li>


<li class="toctree-l2 current active"><a class="current reference internal" href="#">QSMxT Example</a></li>










<li class="toctree-l2"><a class="reference internal" href="sct_toolbox_example.html">SCT Toolbox Example</a></li>


</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../functional_imaging/intro.html">Functional Imaging</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../functional_imaging/nipype_fsl_all_levels_flanker.html">FSL’s fMRI Data Analysis via Nipype</a></li>




<li class="toctree-l2"><a class="reference internal" href="../functional_imaging/fmriprep_example.html">Fmriprep Example</a></li>


</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://play-ashburn.neurodesk.org/v2/gh/neurodesk/example-notebooks/v2/gh/neurodesk/example-notebooks/master?urlpath=tree/structural_imaging/qsmxt_example.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/neurodesk/example-notebooks/blob/master/structural_imaging/qsmxt_example.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/neurodesk/example-notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/neurodesk/example-notebooks/edit/main/structural_imaging/qsmxt_example.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/neurodesk/example-notebooks/issues/new?title=Issue%20on%20page%20%2Fstructural_imaging/qsmxt_example.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/structural_imaging/qsmxt_example.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>QSMxT Example</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">QSMxT Example</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-neurodesk">Setup Neurodesk</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#qsmxt-interactive-notebook">QSMxT Interactive Notebook</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-qsm">What is QSM?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-qsmxt">What is QSMxT?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-i-access-qsmxt">How do I access QSMxT?</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-example-dicoms">Download example DICOMs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#load-qsmxt">Load QSMxT</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-standardisation">Data standardisation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sort-dicoms">Sort DICOMs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-to-bids">Convert to BIDS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-input-data">Inspect input data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#run-qsm-pipeline">Run QSM pipeline</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#view-qsm-results">View QSM results</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#segment-t1-weighted-images">Segment T1-weighted images</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#view-segmentations">View segmentations</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#run-analysis-pipeline">Run analysis pipeline</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-visualisation">Quantitative visualisation</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><a href="https://play-ashburn.neurodesk.org/v2/gh/neurodesk/example-notebooks/main?labpath=/home/jovyan/examples/example-notebooks/structural_imaging/qsmxt_example.ipynb" target="_parent"><img src="https://img.shields.io/badge/launch-binder-579aca.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADUElEQVR4nCyTzUtkRxfGn6pTtz/FtvsVp32NKBgF6QiBCU505xBpBdsJiMkyi2SRxSSEZPI3JKuEbGYREgaCi0zMENBeSCSCqwzRCCIzSBtHuqEl9ihif9zbfe+tqnCaqdXh1q1znuec31EAkM/nEYlEcH5+jmw2K5VSwvM8rVT3GmEYIh6PUxiGtlKpmNHRUQRBgK2tLdDi4iLOzs4wMjKCaDRKxhijlLIRx0kmk8lhIkoHQeArpTpaa5vJZCgej9vj42NMT09DVSoVXF5ewm21SAihAbwJ4HM/CO42ms2slJIT/wvgD2vtN9baQ8/zqFqtaiKCYIlLS0uklNJBEHwspfyu2WpF+lIpTIyPo9Fs4sXZGYzWiMVinTAMPyWi7621VCwWtSgUCuxNSynfl1L+zDLvzs3pd+/do/8PDsJrt1EqlfDL+rp+9vw5xWIxobV+T2u97jgOScdxjLU2o5R66LquffvOHfPJ/fuqL5USFxcXgs9bt2+LLx88UIPZrAmCwBLRQwBpfistayFaBZCBELqvr4+01uAJOI6DiOPg5uYG2Vu3MDc3R51ORwsh+olopft2cnISxpgvhBBvdNptWyqVZOnkBP/LZPD6xARe1mqonp+jVqvh1ydPcHV1ZdiGtbZORL91m7i8vLzt+/47+Xxe53I5+vPpU9xcX+O14WEcHBygv78fuVwOPP/t7W19eHhI0Wj0942NjbxaXV1Fu91uEhFb6c52fn4ejUYD+/v73XhsbIxBQrlcxs7ODqSUFkBjZWUFMpPJwFq7z/Stra1ZrthqtdgWewZb9DyPi6BYLHIC+2oSf/f29kIODQ1Ba/2YIerp6RG+79tkMgm+dF23i3E6nWYGGF/L/xhjQmvt41QqBbm3t8cQ/QPgaykllUqlIAgCI4RAIpFgCsFxo1E35XI5UEoRgK+klC9OT09JLCwsCMdx5NHRkZmamnqktf5gYGAAMzMzmJ2dNaxid3dXsrV6vQ4ierS5uflhoVCQYRgawcsEQLDsRCJhr6+vP/J9/7NOp5Nj2dwL3rxYLPZMKfVtOp3+0XVdwX0CYBXL44ArWWsZrB9yudxP1Wp12vO88VfLdNLTk/yrVnvpu64rm82m4e98/gsAAP//Lbmu802E+U4AAAAASUVORK5CYII=" alt="Open In Binder"/>  </a>
<a href="https://colab.research.google.com/github/NeuroDesk/example-notebooks/blob/main/structural_imaging/qsmxt_example.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>   </a></p>
<section id="qsmxt-example">
<h1>QSMxT Example<a class="headerlink" href="#qsmxt-example" title="Permalink to this heading">#</a></h1>
<p>Author: Ashley Stewart</p>
<p>Original paper: <a class="reference external" href="https://onlinelibrary.wiley.com/doi/10.1002/mrm.29048">https://onlinelibrary.wiley.com/doi/10.1002/mrm.29048</a></p>
</section>
<section id="setup-neurodesk">
<h1>Setup Neurodesk<a class="headerlink" href="#setup-neurodesk" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%capture
import os
import sys
IN_COLAB = &#39;google.colab&#39; in sys.modules

if IN_COLAB:
  os.environ[&quot;LD_PRELOAD&quot;] = &quot;&quot;;
  os.environ[&quot;APPTAINER_BINDPATH&quot;] = &quot;/content,/tmp,/cvmfs&quot;
  os.environ[&quot;MPLCONFIGDIR&quot;] = &quot;/content/matplotlib-mpldir&quot;
  os.environ[&quot;LMOD_CMD&quot;] = &quot;/usr/share/lmod/lmod/libexec/lmod&quot;

  !curl -J -O https://raw.githubusercontent.com/NeuroDesk/neurocommand/main/googlecolab_setup.sh
  !chmod +x googlecolab_setup.sh
  !./googlecolab_setup.sh

  os.environ[&quot;MODULEPATH&quot;] = &#39;:&#39;.join(map(str, list(map(lambda x: os.path.join(os.path.abspath(&#39;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/&#39;), x),os.listdir(&#39;/cvmfs/neurodesk.ardc.edu.au/neurodesk-modules/&#39;)))))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Output CPU information:</span>
<span class="o">!</span>cat<span class="w"> </span>/proc/cpuinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;vendor&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq
<span class="o">!</span>cat<span class="w"> </span>/proc/cpuinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;model name&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vendor_id	: GenuineIntel
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>model name	: Intel(R) Xeon(R) Platinum 8167M CPU @ 2.00GHz
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="qsmxt-interactive-notebook">
<h1>QSMxT Interactive Notebook<a class="headerlink" href="#qsmxt-interactive-notebook" title="Permalink to this heading">#</a></h1>
<p>This interactive notebook estimates Quantitative Susceptibility Maps (QSMs) for two gradient-echo (GRE) MRI acquisitions using <a class="reference external" href="https://github.com/QSMxT/QSMxT">QSMxT</a> provided by the <a class="reference external" href="https://neurodesk.org">Neurodesk</a> project.</p>
<section id="what-is-qsm">
<h2>What is QSM?<a class="headerlink" href="#what-is-qsm" title="Permalink to this heading">#</a></h2>
<p>QSM is a form of quantitative MRI (qMRI) that estimates the magnetic susceptibility distribution across an imaged object. Magnetic susceptibility is the degree to which a material becomes magnetised by an external magnetic field. Major contributors to susceptibility include iron, calcium, and myelin, with the susceptibility of water typically approximating a zero-reference, though it is slightly diamagnetic. Read more about QSM <a class="reference external" href="https://onlinelibrary.wiley.com/doi/10.1002/mrm.25358">here</a>.</p>
</section>
<section id="what-is-qsmxt">
<h2>What is QSMxT?<a class="headerlink" href="#what-is-qsmxt" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/QSMxT/QSMxT">QSMxT</a> is a suite of tools for building and running automated pipelines for QSM that:</p>
<ul class="simple">
<li><p>is available open-source without any licensing required;</p></li>
<li><p>is distributed as a software container making it straightforward to access and install (Neurodesk!)</p></li>
<li><p>scales its processing to execute across many acquisitions through jobs parallelisation (using multiple processors or HPCs) provided by <a class="reference external" href="https://nipype.readthedocs.io">Nipype</a>;</p></li>
<li><p>automates steps that usually require manual intervention and scripting, including:</p>
<ul>
<li><p>DICOM to <a class="reference external" href="https://bids-specification.readthedocs.io/en/stable/index.html">BIDS</a> conversion;</p></li>
<li><p>QSM reconstruction using a range of algorithms;</p></li>
<li><p>segmentation using <a class="reference external" href="https://github.com/Deep-MI/FastSurfer">FastSurfer</a>;</p></li>
<li><p>group space generation using <a class="reference external" href="https://github.com/ANTsX/ANTs">ANTs</a>;</p></li>
<li><p>export of susceptibility statistics by subject and region of interest (ROI) to CSV.</p></li>
</ul>
</li>
</ul>
<p><img alt="image.png" src="structural_imaging/attachment:image.png" /></p>
</section>
<section id="how-do-i-access-qsmxt">
<h2>How do I access QSMxT?<a class="headerlink" href="#how-do-i-access-qsmxt" title="Permalink to this heading">#</a></h2>
<p>There are a few ways you can access QSMxT:</p>
<ul class="simple">
<li><p><strong>This notebook</strong>: You can access QSMxT in this notebook right now!</p>
<ul>
<li><p>If you are running this on a Neurodesk Play instance, you can upload your own data into the sidebar via drag-and-drop.</p></li>
</ul>
</li>
<li><p><strong>Neurodesktop</strong>: QSMxT is in the applications menu of Neurodesktop.</p>
<ul>
<li><p>On Neurodesk Play, upload your own data into the desktop via drag-and-drop.</p></li>
<li><p>On a local install of Neurodesk, bring any necessary files into the shared <code class="docutils literal notranslate"><span class="pre">~/neurodesktop-storage</span></code> directory</p></li>
</ul>
</li>
<li><p><strong>Local install</strong>: QSMxT can also be installed via the <a class="reference external" href="https://github.com/QSMxT/QSMxT#installation">Docker container</a></p></li>
<li><p><strong>HPC install</strong>: QSMxT can also be installed via the <a class="reference external" href="https://github.com/QSMxT/QSMxT#installation">Singularity container</a> for use on HPCs</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download-example-dicoms">
<h1>Download example DICOMs<a class="headerlink" href="#download-example-dicoms" title="Permalink to this heading">#</a></h1>
<p>Here, we download some example DICOMs from our OSF repository for QSMxT.</p>
<p>These data include GRE and T1-weighted acquisitions for one subject (duplicated to act as two subjects).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>osfclient
<span class="o">!</span>osf<span class="w"> </span>-p<span class="w"> </span>ru43c<span class="w"> </span>clone<span class="w"> </span>.<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="o">!</span>tar<span class="w"> </span>xf<span class="w"> </span>osfstorage/dicoms-unsorted.tar
<span class="o">!</span>rm<span class="w"> </span>-rf<span class="w"> </span>osfstorage/
<span class="o">!</span>tree<span class="w"> </span>dicoms-unsorted<span class="w"> </span><span class="p">|</span><span class="w"> </span>head
<span class="o">!</span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;...\nThere are `ls dicoms-unsorted | wc -l` unsorted DICOMs in ./dicoms-unsorted/&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Defaulting to user installation because normal site-packages is not writeable
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting osfclient
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Downloading osfclient-0.0.5-py2.py3-none-any.whl (39 kB)
Requirement already satisfied: requests in /usr/lib/python3/dist-packages (from osfclient) (2.25.1)
Requirement already satisfied: tqdm in /usr/lib/python3/dist-packages (from osfclient) (4.57.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: six in /usr/lib/python3/dist-packages (from osfclient) (1.16.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Installing collected packages: osfclient
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully installed osfclient-0.0.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">dicoms-unsorted</span>
├── MR.1.1.dcm
├── MR.1.10.dcm
├── MR.1.100.dcm
├── MR.1.101.dcm
├── MR.1.102.dcm
├── MR.1.103.dcm
├── MR.1.104.dcm
├── MR.1.105.dcm
├── MR.1.106.dcm
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>...
There are 1216 unsorted DICOMs in ./dicoms-unsorted/
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="load-qsmxt">
<h1>Load QSMxT<a class="headerlink" href="#load-qsmxt" title="Permalink to this heading">#</a></h1>
<p>To load QSMxT inside a notebook, we can use the available module system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lmod</span>
<span class="k">await</span> <span class="n">lmod</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;qsmxt/1.3.5&#39;</span><span class="p">)</span>
<span class="o">!</span>qsmxt_version.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>v1.3.5 (commit date: Sat Feb 25 22:06:42 2023 +1000) (container version qsmxt_1.3.5_20230227.simg (singularity))
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-standardisation">
<h1>Data standardisation<a class="headerlink" href="#data-standardisation" title="Permalink to this heading">#</a></h1>
<p>QSMxT requires input data to conform to the <a class="reference external" href="https://bids.neuroimaging.io/">Brain Imaging Data Structure (BIDS)</a>.</p>
<p>Luckily, QSMxT also provides scripts that can convert unorganised NIfTI or DICOM images to BIDS.</p>
<section id="sort-dicoms">
<h2>Sort DICOMs<a class="headerlink" href="#sort-dicoms" title="Permalink to this heading">#</a></h2>
<p>Before we can convert DICOMs to BIDS cleanly, we need to sort the DICOMs by subject, session and series.</p>
<p>We can sort the DICOMs using <code class="docutils literal notranslate"><span class="pre">run_0_dicomSort.py</span></code>.</p>
<p>Note that this script relies on accurate DICOM header information. If your data is sorted incorrectly, you may need to manually correct the sorting, or sort the files yourself. Be sure to follow the folder structure shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>run_0_dicomSort.py<span class="w"> </span>dicoms-unsorted<span class="w"> </span>dicoms-sorted
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running QSMxT v1.3.5 (commit date: Sat Feb 25 22:06:42 2023 +1000)
INFO: Command: /opt/QSMxT/run_0_dicomSort.py dicoms-unsorted dicoms-sorted
INFO: Python interpreter: /opt/miniconda-4.7.12.1/bin/python3
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Reading file list...
WARNING: No .IMA or .dcm files found! Checking all files for valid DICOM headers...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: 1216 DICOM files found.
INFO: Sorting DICOMs in /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/dicoms-sorted...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Identified subject: 2
INFO: Identified session: 2 #1 20170705
INFO: Identified series: sub-2/ses-1/5_qsm_p2_1mmiso_te20
INFO: Identified series: sub-2/ses-1/6_qsm_p2_1mmiso_te20
INFO: Identified series: sub-2/ses-1/6_mp2rage_highres_0p5iso_slab
INFO: Identified session: 1 #1 20170705
INFO: Identified series: sub-1/ses-1/6_qsm_p2_1mmiso_te20
INFO: Identified series: sub-1/ses-1/6_mp2rage_highres_0p5iso_slab
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Identified series: sub-1/ses-1/5_qsm_p2_1mmiso_te20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Warnings occurred!
INFO: Finished
</pre></div>
</div>
</div>
</div>
<p>Now we can see clearly that there are two subjects, each with one session, each with three DICOM series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w"> </span>dicoms-sorted<span class="w"> </span>-L<span class="w"> </span><span class="m">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">dicoms-sorted</span>
├── log_2023-06-29_07-13-27382392.txt
├── references.txt
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-1</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">ses-1</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">5_qsm_p2_1mmiso_te20</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">6_mp2rage_highres_0p5iso_slab</span>
│       └── <span class=" -Color -Color-Bold -Color-Bold-Blue">6_qsm_p2_1mmiso_te20</span>
└── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-2</span>
    └── <span class=" -Color -Color-Bold -Color-Bold-Blue">ses-1</span>
        ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">5_qsm_p2_1mmiso_te20</span>
        ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">6_mp2rage_highres_0p5iso_slab</span>
        └── <span class=" -Color -Color-Bold -Color-Bold-Blue">6_qsm_p2_1mmiso_te20</span>

10 directories, 2 files
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-to-bids">
<h2>Convert to BIDS<a class="headerlink" href="#convert-to-bids" title="Permalink to this heading">#</a></h2>
<p>Now that the DICOMs are sorted, we can convert to BIDS using <code class="docutils literal notranslate"><span class="pre">run_1_dicomConvert.py</span></code>.</p>
<p>The DICOM to BIDS conversion must identify which series should be used for QSM reconstruction (T2*-weighted), and which series should be used for segmentation (T1-weighted). Because this information is not stored in the DICOM header, the user must provide it, or QSMxT can make a guess based on the <code class="docutils literal notranslate"><span class="pre">ProtocolName</span></code> field. By default, QSMxT assumes series matching any of the patterns in <code class="docutils literal notranslate"><span class="pre">['*qsm*',</span> <span class="pre">'*t2starw*']</span></code> are to be used for QSM, and series matching the pattern <code class="docutils literal notranslate"><span class="pre">['*t1w*']</span></code> are to be used for segmentation. If series cannot be identified, the user must do so. At minimum, at least one QSM series must be identified.</p>
<p>If QSMxT is run interactively, the user will be prompted to identify the relevant series’. However, because we are running QSMxT in a notebook, we disable the interactivity using <code class="docutils literal notranslate"><span class="pre">--auto_yes</span></code> and provide the missing information using command-line arguments (<code class="docutils literal notranslate"><span class="pre">--t1w_protocol_patterns</span></code> and <code class="docutils literal notranslate"><span class="pre">--t2starw_protocol_patterns</span></code>). In this case, the T1-weighted scan requires identification, so we pass <code class="docutils literal notranslate"><span class="pre">--t2starw_protocol_patterns</span> <span class="pre">&quot;*mp2rage*&quot;</span></code>:</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>!run_1_dicomConvert.py dicoms-sorted bids \
    --t1w_protocol_patterns &quot;*mp2rage*&quot; \
    --auto_yes
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running QSMxT v1.3.5 (commit date: Sat Feb 25 22:06:42 2023 +1000)
INFO: Command: /opt/QSMxT/run_1_dicomConvert.py dicoms-sorted bids --t1w_protocol_patterns *mp2rage* --auto_yes
INFO: Python interpreter: /opt/miniconda-4.7.12.1/bin/python3
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Converting all DICOMs to NIfTI...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running command: &#39;dcm2niix -z n -o &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data&quot; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/dicoms-sorted/sub-2/ses-1/6_qsm_p2_1mmiso_te20&quot; &gt;&gt; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data/dcm2niix_output.txt&quot;&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running command: &#39;dcm2niix -z n -o &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data&quot; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/dicoms-sorted/sub-2/ses-1/6_mp2rage_highres_0p5iso_slab&quot; &gt;&gt; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data/dcm2niix_output.txt&quot;&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running command: &#39;dcm2niix -z n -o &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data&quot; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/dicoms-sorted/sub-2/ses-1/5_qsm_p2_1mmiso_te20&quot; &gt;&gt; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data/dcm2niix_output.txt&quot;&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running command: &#39;dcm2niix -z n -o &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data&quot; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/dicoms-sorted/sub-1/ses-1/6_qsm_p2_1mmiso_te20&quot; &gt;&gt; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data/dcm2niix_output.txt&quot;&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running command: &#39;dcm2niix -z n -o &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data&quot; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/dicoms-sorted/sub-1/ses-1/6_mp2rage_highres_0p5iso_slab&quot; &gt;&gt; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data/dcm2niix_output.txt&quot;&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running command: &#39;dcm2niix -z n -o &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data&quot; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/dicoms-sorted/sub-1/ses-1/5_qsm_p2_1mmiso_te20&quot; &gt;&gt; &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data/dcm2niix_output.txt&quot;&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Loading JSON headers from &#39;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/.../extra_data&#39; folders...
INFO: Checking for GE data requiring correction...
INFO: Loading updated JSON headers from &#39;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/.../extra_data&#39; folders...
INFO: Enumerating protocol names from JSON headers...
INFO: All protocol names identified: [&#39;mp2rage_highres_0p5iso_slab&#39;, &#39;qsm_p2_1mmiso_te20&#39;]
INFO: Enumerating t2starw protocol names using match patterns [&#39;*t2starw*&#39;, &#39;*qsm*&#39;]...
INFO: Identified the following protocols as t2starw: [&#39;qsm_p2_1mmiso_te20&#39;]
INFO: Enumerating t1w protocol names using match patterns [&#39;*mp2rage*&#39;]...
INFO: Identified the following protocols as t1w: [&#39;mp2rage_highres_0p5iso_slab&#39;]
INFO: Parsing relevant details from JSON headers...
INFO: Parsing relevant JSON data from sub-2/ses-1...
INFO: Parsing relevant JSON data from sub-2/ses-1...
INFO: Parsing relevant JSON data from sub-1/ses-1...
INFO: Parsing relevant JSON data from sub-1/ses-1...
INFO: Renaming files...
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data/6_mp2rage_highres_0p5iso_slab_mp2rage_highRes_0p5iso_slab_20170705150219_6.json -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/anat/sub-2_ses-1_run-01_T1w.json
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data/6_mp2rage_highres_0p5iso_slab_mp2rage_highRes_0p5iso_slab_20170705150219_6.nii -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/anat/sub-2_ses-1_run-01_T1w.nii
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data/5_qsm_p2_1mmiso_te20_QSM_p2_1mmIso_TE20_20170705134507_5.json -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/anat/sub-2_ses-1_run-01_part-mag_T2starw.json
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data/5_qsm_p2_1mmiso_te20_QSM_p2_1mmIso_TE20_20170705134507_5.nii -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/anat/sub-2_ses-1_run-01_part-mag_T2starw.nii
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data/6_qsm_p2_1mmiso_te20_QSM_p2_1mmIso_TE20_20170705134507_6_ph.json -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/anat/sub-2_ses-1_run-01_part-phase_T2starw.json
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/extra_data/6_qsm_p2_1mmiso_te20_QSM_p2_1mmIso_TE20_20170705134507_6_ph.nii -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-2/ses-1/anat/sub-2_ses-1_run-01_part-phase_T2starw.nii
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data/6_mp2rage_highres_0p5iso_slab_mp2rage_highRes_0p5iso_slab_20170705150219_6.json -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/anat/sub-1_ses-1_run-01_T1w.json
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data/6_mp2rage_highres_0p5iso_slab_mp2rage_highRes_0p5iso_slab_20170705150219_6.nii -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/anat/sub-1_ses-1_run-01_T1w.nii
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data/5_qsm_p2_1mmiso_te20_QSM_p2_1mmIso_TE20_20170705134507_5.json -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/anat/sub-1_ses-1_run-01_part-mag_T2starw.json
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data/5_qsm_p2_1mmiso_te20_QSM_p2_1mmIso_TE20_20170705134507_5.nii -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/anat/sub-1_ses-1_run-01_part-mag_T2starw.nii
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data/6_qsm_p2_1mmiso_te20_QSM_p2_1mmIso_TE20_20170705134507_6_ph.json -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/anat/sub-1_ses-1_run-01_part-phase_T2starw.json
INFO: Renaming /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/extra_data/6_qsm_p2_1mmiso_te20_QSM_p2_1mmIso_TE20_20170705134507_6_ph.nii -&gt; /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids/sub-1/ses-1/anat/sub-1_ses-1_run-01_part-phase_T2starw.nii
INFO: Generating details for BIDS datset_description.json...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Writing BIDS dataset_description.json...
INFO: Writing BIDS .bidsignore file...
INFO: Writing BIDS dataset README...
INFO: Finished
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w"> </span>bids
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">bids</span>
├── README
├── dataset_description.json
├── log_2023-06-29_07-13-40381217.txt
├── references.txt
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-1</span>
│   └── <span class=" -Color -Color-Bold -Color-Bold-Blue">ses-1</span>
│       ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
│       │   ├── sub-1_ses-1_run-01_T1w.json
│       │   ├── sub-1_ses-1_run-01_T1w.nii
│       │   ├── sub-1_ses-1_run-01_part-mag_T2starw.json
│       │   ├── sub-1_ses-1_run-01_part-mag_T2starw.nii
│       │   ├── sub-1_ses-1_run-01_part-phase_T2starw.json
│       │   └── sub-1_ses-1_run-01_part-phase_T2starw.nii
│       └── <span class=" -Color -Color-Bold -Color-Bold-Blue">extra_data</span>
│           └── dcm2niix_output.txt
└── <span class=" -Color -Color-Bold -Color-Bold-Blue">sub-2</span>
    └── <span class=" -Color -Color-Bold -Color-Bold-Blue">ses-1</span>
        ├── <span class=" -Color -Color-Bold -Color-Bold-Blue">anat</span>
        │   ├── sub-2_ses-1_run-01_T1w.json
        │   ├── sub-2_ses-1_run-01_T1w.nii
        │   ├── sub-2_ses-1_run-01_part-mag_T2starw.json
        │   ├── sub-2_ses-1_run-01_part-mag_T2starw.nii
        │   ├── sub-2_ses-1_run-01_part-phase_T2starw.json
        │   └── sub-2_ses-1_run-01_part-phase_T2starw.nii
        └── <span class=" -Color -Color-Bold -Color-Bold-Blue">extra_data</span>
            └── dcm2niix_output.txt

8 directories, 18 files
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="inspect-input-data">
<h1>Inspect input data<a class="headerlink" href="#inspect-input-data" title="Permalink to this heading">#</a></h1>
<p>Here we define a function we will use to visualise NIfTI images so we can view some of the input data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_nii</span><span class="p">(</span><span class="n">nii_path</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">imshow_args</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
    <span class="kn">import</span> <span class="nn">glob</span>

    <span class="c1"># load data</span>
    <span class="n">data_1</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">nii_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>

    <span class="c1"># get middle slices</span>
    <span class="n">slc_data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">data_1</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data_1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,:,:])</span>
    <span class="n">slc_data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">data_1</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data_1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,:])</span>
    <span class="n">slc_data3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">data_1</span><span class="p">[:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data_1</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># show slices</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">slc_data1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">imshow_args</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">slc_data2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">imshow_args</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">slc_data3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">imshow_args</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">1.55</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_nii</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;bids/sub-*/ses-*/anat/*mag*T2starw*nii*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Magnitude&quot;</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">show_nii</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;bids/sub-*/ses-*/anat/*phase*T2starw*nii*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Phase&quot;</span><span class="p">)</span>
<span class="n">show_nii</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;bids/sub-*/ses-*/anat/*T1w*nii*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;T1-weighted&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bae634601f7615cb24d105ee3aaf1933e53152c1172c009c35c05c69febfe33e.png" src="../_images/bae634601f7615cb24d105ee3aaf1933e53152c1172c009c35c05c69febfe33e.png" />
<img alt="../_images/e302ff4e1e143ceae6a31d672f06f2f7e89dd76b3ee628d36458dd6b0dd8eea7.png" src="../_images/e302ff4e1e143ceae6a31d672f06f2f7e89dd76b3ee628d36458dd6b0dd8eea7.png" />
<img alt="../_images/3ea5e069a90debe6b6d5a456d589ff4550671d70017f2f3b1accf951cb766728.png" src="../_images/3ea5e069a90debe6b6d5a456d589ff4550671d70017f2f3b1accf951cb766728.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="run-qsm-pipeline">
<h1>Run QSM pipeline<a class="headerlink" href="#run-qsm-pipeline" title="Permalink to this heading">#</a></h1>
<p>We are now ready to reconstruct QSM!</p>
<p>QSMxT automates all QSM reconstruction steps from masking, phase combination, phase unwrapping, background field correction, dipole-inversion, and QSM averaging, if necessary.</p>
<p>The pipeline can be fine-tuned using a wide range of algorithms and parameters that are exposed, and this is easiest to do via the CLI interface.</p>
<p>However, QSMxT also provides a range of sensible defaults fit for different purposes. We can list the premade pipelines using <code class="docutils literal notranslate"><span class="pre">--list_premades</span></code>. For the full pipeline details used for each premade pipeline, see <a class="reference external" href="https://github.com/QSMxT/QSMxT/blob/master/qsm_pipelines.json">qsm_pipelines.json</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>run_2_qsm.py<span class="w"> </span>--list_premades
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running QSMxT v1.3.5 (commit date: Sat Feb 25 22:06:42 2023 +1000)
INFO: Parsing arguments...
=== Premade pipelines ===
default: Default QSMxT settings (GRE)
gre: Applies suggested settings for 3D-GRE images
epi: Applies suggested settings for 3D-EPI images (assumes human brain)
bet: Applies a traditional BET-masking approach (artefact reduction unavailable)
fast: Applies a set of fast algorithms
body: Applies suggested settings for non-brain applications
nextqsm: Applies suggested settings for running the NeXtQSM algorithm (assumes human brain)
INFO: Finished
</pre></div>
</div>
</div>
</div>
<p>For this demonstration, we will go with the <code class="docutils literal notranslate"><span class="pre">fast</span></code> pipeline. We also include <code class="docutils literal notranslate"><span class="pre">--auto_yes</span></code> to avoid the interactive CLI interface.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>run_2_qsm.py<span class="w"> </span>bids<span class="w"> </span>qsm<span class="w"> </span>--premade<span class="w"> </span>fast<span class="w"> </span>--auto_yes
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running QSMxT v1.3.5 (commit date: Sat Feb 25 22:06:42 2023 +1000)
INFO: Parsing arguments...
INFO: Starting log file: /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/qsmxt_log.log
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running QSMxT v1.3.5 (commit date: Sat Feb 25 22:06:42 2023 +1000)
INFO: Python interpreter: /opt/miniconda-4.7.12.1/bin/python3
INFO: Command: run_2_qsm.py /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/bids /home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm --premade &#39;fast&#39; --auto_yes
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Creating nipype workflow for sub-2/ses-1/run-01...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Creating nipype workflow for sub-1/ses-1/run-01...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:10,242 nipype.workflow INFO:
	 Workflow workflow_qsm settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:10,294 nipype.workflow INFO:
	 Running in parallel.
230629-07:14:10,301 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 8 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:10,397 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-2.ses-1.run-01.func_read-json-se&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/func_read-json-se&quot;.
230629-07:14:10,404 nipype.workflow INFO:
	 [Node] Executing &quot;func_read-json-se&quot; &lt;nipype.interfaces.utility.wrappers.Function&gt;
230629-07:14:10,407 nipype.workflow INFO:
	 [Node] Setting-up &quot;_func_read-json-me0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/func_read-json-me/mapflow/_func_read-json-me0&quot;.
230629-07:14:10,410 nipype.workflow INFO:
	 [Node] Executing &quot;_func_read-json-me0&quot; &lt;nipype.interfaces.utility.wrappers.Function&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:10,564 nipype.workflow INFO:
	 [Node] Finished &quot;func_read-json-se&quot;, elapsed time 0.001718s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:10,565 nipype.workflow INFO:
	 [Node] Finished &quot;_func_read-json-me0&quot;, elapsed time 0.001628s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:12,302 nipype.workflow INFO:
	 [Job 0] Completed (workflow_qsm.sub-2.ses-1.run-01.func_read-json-me).
230629-07:14:12,305 nipype.workflow INFO:
	 [Job 1] Completed (workflow_qsm.sub-2.ses-1.run-01.func_read-json-se).
230629-07:14:12,307 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 6 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:12,409 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-2.ses-1.run-01.nibabel_read-nii&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/nibabel_read-nii&quot;.
230629-07:14:12,413 nipype.workflow INFO:
	 [Node] Executing &quot;nibabel_read-nii&quot; &lt;nipype.interfaces.utility.wrappers.Function&gt;
230629-07:14:12,416 nipype.workflow INFO:
	 [Node] Setting-up &quot;_nibabel_numpy_scale-phase0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/nibabel_numpy_scale-phase/mapflow/_nibabel_numpy_scale-phase0&quot;.
230629-07:14:12,419 nipype.workflow INFO:
	 [Node] Executing &quot;_nibabel_numpy_scale-phase0&quot; &lt;interfaces.nipype_interface_scalephase.ScalePhaseInterface&gt;
230629-07:14:12,420 nipype.workflow INFO:
	 [Node] Finished &quot;nibabel_read-nii&quot;, elapsed time 0.005331s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:12,932 nipype.workflow INFO:
	 [Node] Finished &quot;_nibabel_numpy_scale-phase0&quot;, elapsed time 0.510798s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:14,303 nipype.workflow INFO:
	 [Job 2] Completed (workflow_qsm.sub-2.ses-1.run-01.nibabel_read-nii).
230629-07:14:14,305 nipype.workflow INFO:
	 [Job 3] Completed (workflow_qsm.sub-2.ses-1.run-01.nibabel_numpy_scale-phase).
230629-07:14:14,306 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 5 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:14,366 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-1.ses-1.run-01.func_read-json-se&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/func_read-json-se&quot;.
230629-07:14:14,367 nipype.workflow INFO:
	 [Node] Setting-up &quot;_func_read-json-me0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/func_read-json-me/mapflow/_func_read-json-me0&quot;.
230629-07:14:14,368 nipype.workflow INFO:
	 [Node] Executing &quot;func_read-json-se&quot; &lt;nipype.interfaces.utility.wrappers.Function&gt;
230629-07:14:14,370 nipype.workflow INFO:
	 [Node] Executing &quot;_func_read-json-me0&quot; &lt;nipype.interfaces.utility.wrappers.Function&gt;
230629-07:14:14,371 nipype.workflow INFO:
	 [Node] Finished &quot;func_read-json-se&quot;, elapsed time 0.000797s.
230629-07:14:14,372 nipype.workflow INFO:
	 [Node] Finished &quot;_func_read-json-me0&quot;, elapsed time 0.000764s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:16,304 nipype.workflow INFO:
	 [Job 4] Completed (workflow_qsm.sub-1.ses-1.run-01.func_read-json-me).
230629-07:14:16,305 nipype.workflow INFO:
	 [Job 5] Completed (workflow_qsm.sub-1.ses-1.run-01.func_read-json-se).
230629-07:14:16,307 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 3 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:16,362 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-1.ses-1.run-01.nibabel_read-nii&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/nibabel_read-nii&quot;.
230629-07:14:16,365 nipype.workflow INFO:
	 [Node] Executing &quot;nibabel_read-nii&quot; &lt;nipype.interfaces.utility.wrappers.Function&gt;
230629-07:14:16,369 nipype.workflow INFO:
	 [Node] Setting-up &quot;_nibabel_numpy_scale-phase0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/nibabel_numpy_scale-phase/mapflow/_nibabel_numpy_scale-phase0&quot;.
230629-07:14:16,369 nipype.workflow INFO:
	 [Node] Finished &quot;nibabel_read-nii&quot;, elapsed time 0.00231s.
230629-07:14:16,372 nipype.workflow INFO:
	 [Node] Executing &quot;_nibabel_numpy_scale-phase0&quot; &lt;interfaces.nipype_interface_scalephase.ScalePhaseInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:16,877 nipype.workflow INFO:
	 [Node] Finished &quot;_nibabel_numpy_scale-phase0&quot;, elapsed time 0.502612s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:18,306 nipype.workflow INFO:
	 [Job 6] Completed (workflow_qsm.sub-1.ses-1.run-01.nibabel_read-nii).
230629-07:14:18,307 nipype.workflow INFO:
	 [Job 7] Completed (workflow_qsm.sub-1.ses-1.run-01.nibabel_numpy_scale-phase).
230629-07:14:18,309 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:18,368 nipype.workflow INFO:
	 [Node] Setting-up &quot;_nibabel_as-canonical0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/nibabel_as-canonical/mapflow/_nibabel_as-canonical0&quot;.
230629-07:14:18,371 nipype.workflow INFO:
	 [Node] Setting-up &quot;_nibabel_as-canonical0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/nibabel_as-canonical/mapflow/_nibabel_as-canonical0&quot;.
230629-07:14:18,373 nipype.workflow INFO:
	 [Node] Executing &quot;_nibabel_as-canonical0&quot; &lt;nipype.interfaces.utility.wrappers.Function&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:18,371 nipype.workflow INFO:
	 [Node] Executing &quot;_nibabel_as-canonical0&quot; &lt;nipype.interfaces.utility.wrappers.Function&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:18,453 nipype.workflow INFO:
	 [Node] Finished &quot;_nibabel_as-canonical0&quot;, elapsed time 0.078458s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:18,453 nipype.workflow INFO:
	 [Node] Finished &quot;_nibabel_as-canonical0&quot;, elapsed time 0.029758s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:20,308 nipype.workflow INFO:
	 [Job 8] Completed (workflow_qsm.sub-2.ses-1.run-01.nibabel_as-canonical).
230629-07:14:20,309 nipype.workflow INFO:
	 [Job 9] Completed (workflow_qsm.sub-1.ses-1.run-01.nibabel_as-canonical).
230629-07:14:20,311 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:20,373 nipype.workflow INFO:
	 [Node] Setting-up &quot;_nibabel_numpy_nilearn_axial-resampling0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/nibabel_numpy_nilearn_axial-resampling/mapflow/_nibabel_numpy_nilearn_axial-resampling0&quot;.
230629-07:14:20,376 nipype.workflow INFO:
	 [Node] Executing &quot;_nibabel_numpy_nilearn_axial-resampling0&quot; &lt;interfaces.nipype_interface_axialsampling.AxialSamplingInterface&gt;
230629-07:14:20,376 nipype.workflow INFO:
	 [Node] Setting-up &quot;_nibabel_numpy_nilearn_axial-resampling0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/nibabel_numpy_nilearn_axial-resampling/mapflow/_nibabel_numpy_nilearn_axial-resampling0&quot;.
Loading mag=sub-2_ses-1_run-01_part-mag_T2starw.nii...
Loading pha=sub-2_ses-1_run-01_part-phase_T2starw_scaled.nii...
230629-07:14:20,380 nipype.workflow INFO:
	 [Node] Executing &quot;_nibabel_numpy_nilearn_axial-resampling0&quot; &lt;interfaces.nipype_interface_axialsampling.AxialSamplingInterface&gt;
Obliquity = [2.09768775 2.2770863  1.90738745]; norm = 3.6364189473319284 &lt; 10.0; no resampling needed.
Loading mag=sub-1_ses-1_run-01_part-mag_T2starw.nii...
230629-07:14:20,383 nipype.workflow INFO:
	 [Node] Finished &quot;_nibabel_numpy_nilearn_axial-resampling0&quot;, elapsed time 0.005028s.
Loading pha=sub-1_ses-1_run-01_part-phase_T2starw_scaled.nii...
Obliquity = [2.09768775 2.2770863  1.90738745]; norm = 3.6364189473319284 &lt; 10.0; no resampling needed.
230629-07:14:20,388 nipype.workflow INFO:
	 [Node] Finished &quot;_nibabel_numpy_nilearn_axial-resampling0&quot;, elapsed time 0.005775s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:22,310 nipype.workflow INFO:
	 [Job 10] Completed (workflow_qsm.sub-2.ses-1.run-01.nibabel_numpy_nilearn_axial-resampling).
230629-07:14:22,311 nipype.workflow INFO:
	 [Job 11] Completed (workflow_qsm.sub-1.ses-1.run-01.nibabel_numpy_nilearn_axial-resampling).
230629-07:14:22,313 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:22,372 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-2.ses-1.run-01.mrt_romeo_combine&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/mrt_romeo_combine&quot;.
230629-07:14:22,374 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-1.ses-1.run-01.mrt_romeo_combine&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/mrt_romeo_combine&quot;.
230629-07:14:22,377 nipype.workflow INFO:
	 [Node] Executing &quot;mrt_romeo_combine&quot; &lt;interfaces.nipype_interface_romeo.RomeoB0Interface&gt;
230629-07:14:22,379 nipype.workflow INFO:
	 [Node] Executing &quot;mrt_romeo_combine&quot; &lt;interfaces.nipype_interface_romeo.RomeoB0Interface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:14:24,312 nipype.workflow INFO:
	 [MultiProc] Running 2 tasks, and 0 jobs ready. Free memory (GB): 12.77/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-1.ses-1.run-01.mrt_romeo_combine
                       * workflow_qsm.sub-2.ses-1.run-01.mrt_romeo_combine
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:16:40,752 nipype.workflow INFO:
	 [Node] Finished &quot;mrt_romeo_combine&quot;, elapsed time 138.371953s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:16:40,922 nipype.workflow INFO:
	 [Node] Finished &quot;mrt_romeo_combine&quot;, elapsed time 138.540173s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:16:42,444 nipype.workflow INFO:
	 [Job 12] Completed (workflow_qsm.sub-2.ses-1.run-01.mrt_romeo_combine).
230629-07:16:42,445 nipype.workflow INFO:
	 [Job 13] Completed (workflow_qsm.sub-1.ses-1.run-01.mrt_romeo_combine).
230629-07:16:42,447 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:16:42,506 nipype.workflow INFO:
	 [Node] Setting-up &quot;_fsl-bet0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/mask_workflow/fsl-bet/mapflow/_fsl-bet0&quot;.
230629-07:16:42,509 nipype.workflow INFO:
	 [Node] Executing &quot;_fsl-bet0&quot; &lt;interfaces.nipype_interface_bet2.Bet2Interface&gt;
230629-07:16:42,510 nipype.workflow INFO:
	 [Node] Setting-up &quot;_fsl-bet0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/mask_workflow/fsl-bet/mapflow/_fsl-bet0&quot;.
230629-07:16:42,512 nipype.workflow INFO:
	 [Node] Executing &quot;_fsl-bet0&quot; &lt;interfaces.nipype_interface_bet2.Bet2Interface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:16:44,447 nipype.workflow INFO:
	 [MultiProc] Running 2 tasks, and 0 jobs ready. Free memory (GB): 12.77/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-1.ses-1.run-01.mask_workflow.fsl-bet
                       * workflow_qsm.sub-2.ses-1.run-01.mask_workflow.fsl-bet
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:07,197 nipype.workflow INFO:
	 [Node] Finished &quot;_fsl-bet0&quot;, elapsed time 24.682423s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:07,534 nipype.workflow INFO:
	 [Node] Finished &quot;_fsl-bet0&quot;, elapsed time 25.023028s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:08,468 nipype.workflow INFO:
	 [Job 14] Completed (workflow_qsm.sub-2.ses-1.run-01.mask_workflow.fsl-bet).
230629-07:17:08,469 nipype.workflow INFO:
	 [Job 15] Completed (workflow_qsm.sub-1.ses-1.run-01.mask_workflow.fsl-bet).
230629-07:17:08,471 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:08,534 nipype.workflow INFO:
	 [Node] Setting-up &quot;_scipy_numpy_nibabel_bet_erode0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/mask_workflow/scipy_numpy_nibabel_bet_erode/mapflow/_scipy_numpy_nibabel_bet_erode0&quot;.
230629-07:17:08,536 nipype.workflow INFO:
	 [Node] Setting-up &quot;_scipy_numpy_nibabel_bet_erode0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/mask_workflow/scipy_numpy_nibabel_bet_erode/mapflow/_scipy_numpy_nibabel_bet_erode0&quot;.
230629-07:17:08,538 nipype.workflow INFO:
	 [Node] Executing &quot;_scipy_numpy_nibabel_bet_erode0&quot; &lt;interfaces.nipype_interface_erode.ErosionInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:08,536 nipype.workflow INFO:
	 [Node] Executing &quot;_scipy_numpy_nibabel_bet_erode0&quot; &lt;interfaces.nipype_interface_erode.ErosionInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:09,820 nipype.workflow INFO:
	 [Node] Finished &quot;_scipy_numpy_nibabel_bet_erode0&quot;, elapsed time 1.280762s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:09,896 nipype.workflow INFO:
	 [Node] Finished &quot;_scipy_numpy_nibabel_bet_erode0&quot;, elapsed time 1.307907s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:10,470 nipype.workflow INFO:
	 [Job 16] Completed (workflow_qsm.sub-2.ses-1.run-01.mask_workflow.scipy_numpy_nibabel_bet_erode).
230629-07:17:10,471 nipype.workflow INFO:
	 [Job 17] Completed (workflow_qsm.sub-1.ses-1.run-01.mask_workflow.scipy_numpy_nibabel_bet_erode).
230629-07:17:10,473 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:10,538 nipype.workflow INFO:
	 [Node] Setting-up &quot;_qsmjl_laplacian-unwrapping0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/qsm_workflow/qsmjl_laplacian-unwrapping/mapflow/_qsmjl_laplacian-unwrapping0&quot;.
230629-07:17:10,540 nipype.workflow INFO:
	 [Node] Executing &quot;_qsmjl_laplacian-unwrapping0&quot; &lt;interfaces.nipype_interface_qsmjl.LaplacianUnwrappingInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:17:12,472 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 10.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-2.ses-1.run-01.qsm_workflow.qsmjl_laplacian-unwrapping
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:18:03,160 nipype.workflow INFO:
	 [Node] Finished &quot;_qsmjl_laplacian-unwrapping0&quot;, elapsed time 52.618858s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:18:04,525 nipype.workflow INFO:
	 [Job 18] Completed (workflow_qsm.sub-2.ses-1.run-01.qsm_workflow.qsmjl_laplacian-unwrapping).
230629-07:18:04,528 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:18:04,589 nipype.workflow INFO:
	 [Node] Setting-up &quot;_qsmjl_laplacian-unwrapping0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/qsm_workflow/qsmjl_laplacian-unwrapping/mapflow/_qsmjl_laplacian-unwrapping0&quot;.
230629-07:18:04,591 nipype.workflow INFO:
	 [Node] Executing &quot;_qsmjl_laplacian-unwrapping0&quot; &lt;interfaces.nipype_interface_qsmjl.LaplacianUnwrappingInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:18:06,529 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 10.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-1.ses-1.run-01.qsm_workflow.qsmjl_laplacian-unwrapping
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:18:57,857 nipype.workflow INFO:
	 [Node] Finished &quot;_qsmjl_laplacian-unwrapping0&quot;, elapsed time 53.264157s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:18:58,580 nipype.workflow INFO:
	 [Job 19] Completed (workflow_qsm.sub-1.ses-1.run-01.qsm_workflow.qsmjl_laplacian-unwrapping).
230629-07:18:58,582 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:18:58,646 nipype.workflow INFO:
	 [Node] Setting-up &quot;_qsmjl_phase-to-freq0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/qsm_workflow/qsmjl_phase-to-freq/mapflow/_qsmjl_phase-to-freq0&quot;.
230629-07:18:58,648 nipype.workflow INFO:
	 [Node] Executing &quot;_qsmjl_phase-to-freq0&quot; &lt;interfaces.nipype_interface_qsmjl.PhaseToFreqInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:00,583 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 10.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-2.ses-1.run-01.qsm_workflow.qsmjl_phase-to-freq
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:14,281 nipype.workflow INFO:
	 [Node] Finished &quot;_qsmjl_phase-to-freq0&quot;, elapsed time 15.631823s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:14,594 nipype.workflow INFO:
	 [Job 20] Completed (workflow_qsm.sub-2.ses-1.run-01.qsm_workflow.qsmjl_phase-to-freq).
230629-07:19:14,596 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:14,658 nipype.workflow INFO:
	 [Node] Setting-up &quot;_qsmjl_phase-to-freq0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/qsm_workflow/qsmjl_phase-to-freq/mapflow/_qsmjl_phase-to-freq0&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:14,662 nipype.workflow INFO:
	 [Node] Executing &quot;_qsmjl_phase-to-freq0&quot; &lt;interfaces.nipype_interface_qsmjl.PhaseToFreqInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:16,598 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 10.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-1.ses-1.run-01.qsm_workflow.qsmjl_phase-to-freq
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:30,170 nipype.workflow INFO:
	 [Node] Finished &quot;_qsmjl_phase-to-freq0&quot;, elapsed time 15.505896s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:30,611 nipype.workflow INFO:
	 [Job 21] Completed (workflow_qsm.sub-1.ses-1.run-01.qsm_workflow.qsmjl_phase-to-freq).
230629-07:19:30,613 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:30,673 nipype.workflow INFO:
	 [Node] Setting-up &quot;_qsmjl_vsharp0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/qsm_workflow/qsmjl_vsharp/mapflow/_qsmjl_vsharp0&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:30,675 nipype.workflow INFO:
	 [Node] Executing &quot;_qsmjl_vsharp0&quot; &lt;interfaces.nipype_interface_qsmjl.VsharpInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:19:32,613 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 10.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-2.ses-1.run-01.qsm_workflow.qsmjl_vsharp
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:20:02,322 nipype.workflow INFO:
	 [Node] Finished &quot;_qsmjl_vsharp0&quot;, elapsed time 31.644661s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:20:02,644 nipype.workflow INFO:
	 [Job 22] Completed (workflow_qsm.sub-2.ses-1.run-01.qsm_workflow.qsmjl_vsharp).
230629-07:20:02,646 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:20:02,706 nipype.workflow INFO:
	 [Node] Setting-up &quot;_qsmjl_vsharp0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/qsm_workflow/qsmjl_vsharp/mapflow/_qsmjl_vsharp0&quot;.
230629-07:20:02,708 nipype.workflow INFO:
	 [Node] Executing &quot;_qsmjl_vsharp0&quot; &lt;interfaces.nipype_interface_qsmjl.VsharpInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:20:04,648 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 10.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-1.ses-1.run-01.qsm_workflow.qsmjl_vsharp
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:20:34,734 nipype.workflow INFO:
	 [Node] Finished &quot;_qsmjl_vsharp0&quot;, elapsed time 32.024516s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:20:36,678 nipype.workflow INFO:
	 [Job 23] Completed (workflow_qsm.sub-1.ses-1.run-01.qsm_workflow.qsmjl_vsharp).
230629-07:20:36,680 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:20:36,747 nipype.workflow INFO:
	 [Node] Setting-up &quot;_qsmjl_rts0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/qsm_workflow/qsmjl_rts/mapflow/_qsmjl_rts0&quot;.
230629-07:20:36,749 nipype.workflow INFO:
	 [Node] Executing &quot;_qsmjl_rts0&quot; &lt;interfaces.nipype_interface_qsmjl.RtsQsmInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:20:38,681 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 8.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-2.ses-1.run-01.qsm_workflow.qsmjl_rts
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:21:17,604 nipype.workflow INFO:
	 [Node] Finished &quot;_qsmjl_rts0&quot;, elapsed time 40.8532s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:21:18,720 nipype.workflow INFO:
	 [Job 24] Completed (workflow_qsm.sub-2.ses-1.run-01.qsm_workflow.qsmjl_rts).
230629-07:21:18,722 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:21:18,781 nipype.workflow INFO:
	 [Node] Setting-up &quot;_qsmjl_rts0&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/qsm_workflow/qsmjl_rts/mapflow/_qsmjl_rts0&quot;.
230629-07:21:18,783 nipype.workflow INFO:
	 [Node] Executing &quot;_qsmjl_rts0&quot; &lt;interfaces.nipype_interface_qsmjl.RtsQsmInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:21:20,723 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 8.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_qsm.sub-1.ses-1.run-01.qsm_workflow.qsmjl_rts
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:21:59,96 nipype.workflow INFO:
	 [Node] Finished &quot;_qsmjl_rts0&quot;, elapsed time 40.311588s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:00,762 nipype.workflow INFO:
	 [Job 25] Completed (workflow_qsm.sub-1.ses-1.run-01.qsm_workflow.qsmjl_rts).
230629-07:22:00,764 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:00,821 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-2.ses-1.run-01.nibabel_numpy_qsm-average&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/nibabel_numpy_qsm-average&quot;.
230629-07:22:00,823 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-1.ses-1.run-01.nibabel_numpy_qsm-average&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/nibabel_numpy_qsm-average&quot;.
230629-07:22:00,828 nipype.workflow INFO:
	 [Node] Executing &quot;nibabel_numpy_qsm-average&quot; &lt;interfaces.nipype_interface_nonzeroaverage.NonzeroAverageInterface&gt;
230629-07:22:00,828 nipype.workflow INFO:
	 [Node] Executing &quot;nibabel_numpy_qsm-average&quot; &lt;interfaces.nipype_interface_nonzeroaverage.NonzeroAverageInterface&gt;
230629-07:22:00,830 nipype.workflow INFO:
	 [Node] Finished &quot;nibabel_numpy_qsm-average&quot;, elapsed time 0.000247s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:00,830 nipype.workflow INFO:
	 [Node] Finished &quot;nibabel_numpy_qsm-average&quot;, elapsed time 0.00032s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:02,764 nipype.workflow INFO:
	 [Job 26] Completed (workflow_qsm.sub-2.ses-1.run-01.nibabel_numpy_qsm-average).
230629-07:22:02,765 nipype.workflow INFO:
	 [Job 27] Completed (workflow_qsm.sub-1.ses-1.run-01.nibabel_numpy_qsm-average).
230629-07:22:02,767 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:02,823 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-2.ses-1.run-01.nipype_datasink&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-2/ses-1/run-01/nipype_datasink&quot;.
230629-07:22:02,825 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_qsm.sub-1.ses-1.run-01.nipype_datasink&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/qsm/workflow_qsm/sub-1/ses-1/run-01/nipype_datasink&quot;.
230629-07:22:02,830 nipype.workflow INFO:
	 [Node] Executing &quot;nipype_datasink&quot; &lt;nipype.interfaces.io.DataSink&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:02,831 nipype.workflow INFO:
	 [Node] Executing &quot;nipype_datasink&quot; &lt;nipype.interfaces.io.DataSink&gt;
230629-07:22:02,835 nipype.workflow INFO:
	 [Node] Finished &quot;nipype_datasink&quot;, elapsed time 0.001561s.
230629-07:22:02,837 nipype.workflow INFO:
	 [Node] Finished &quot;nipype_datasink&quot;, elapsed time 0.001195s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:04,766 nipype.workflow INFO:
	 [Job 28] Completed (workflow_qsm.sub-2.ses-1.run-01.nipype_datasink).
230629-07:22:04,767 nipype.workflow INFO:
	 [Job 29] Completed (workflow_qsm.sub-1.ses-1.run-01.nipype_datasink).
230629-07:22:04,769 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Finished
</pre></div>
</div>
</div>
</div>
<section id="view-qsm-results">
<h2>View QSM results<a class="headerlink" href="#view-qsm-results" title="Permalink to this heading">#</a></h2>
<p>Let’s have a look at the generated <code class="docutils literal notranslate"><span class="pre">qsm</span></code> folder:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w"> </span>qsm/<span class="w"> </span>-L<span class="w"> </span><span class="m">1</span><span class="w"> </span>--dirsfirst
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">qsm/</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">mask</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">qsm_final</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">workflow_qsm</span>
├── command.txt
├── pypeline.log
├── qsmxt_log.log
├── references.txt
└── settings.json

3 directories, 5 files
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">references.txt</span></code> file contains a list of all the algorithms used and relevant citations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>qsm/references.txt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>== Citations ==

 - QSMxT: Stewart AW, Robinson SD, O&#39;Brien K, et al. QSMxT: Robust masking and artifact reduction for quantitative susceptibility mapping. Magnetic Resonance in Medicine. 2022;87(3):1289-1300. doi:10.1002/mrm.29048

 - QSMxT: Stewart AW, Bollman S, et al. QSMxT/QSMxT. GitHub; 2022. https://github.com/QSMxT/QSMxT

 - Brain extraction: Smith SM. Fast robust automated brain extraction. Human Brain Mapping. 2002;17(3):143-155. doi:10.1002/hbm.10062

 - Brain extraction: Liangfu Chen. liangfu/bet2 - Standalone Brain Extraction Tool. GitHub; 2015. https://github.com/liangfu/bet2

 - Unwrapping algorithm - Laplacian: Schofield MA, Zhu Y. Fast phase unwrapping algorithm for interferometric applications. Optics letters. 2003 Jul 15;28(14):1194-6. doi:10.1364/OL.28.001194

 - Unwrapping algorithm - Laplacian: Zhou D, Liu T, Spincemaille P, Wang Y. Background field removal by solving the Laplacian boundary value problem. NMR in Biomedicine. 2014 Mar;27(3):312-9. doi:10.1002/nbm.3064

 - Unwrapping algorithm - ROMEO: Dymerska B, Eckstein K, Bachrata B, et al. Phase unwrapping with a rapid opensource minimum spanning tree algorithm (ROMEO). Magnetic Resonance in Medicine. 2021;85(4):2294-2308. doi:10.1002/mrm.28563

 - Background field removal - V-SHARP: Wu B, Li W, Guidon A et al. Whole brain susceptibility mapping using compressed sensing. Magnetic resonance in medicine. 2012 Jan;67(1):137-47. doi:10.1002/mrm.23000

 - QSM algorithm - RTS: Kames C, Wiggermann V, Rauscher A. Rapid two-step dipole inversion for susceptibility mapping with sparsity priors. Neuroimage. 2018 Feb 15;167:276-83. doi:10.1016/j.neuroimage.2017.11.018

 - Julia package - QSM.jl: kamesy. GitHub; 2022. https://github.com/kamesy/QSM.jl

 - Julia package - MriResearchTools: Eckstein K. korbinian90/MriResearchTools.jl. GitHub; 2022. https://github.com/korbinian90/MriResearchTools.jl

 - Python package - nibabel: Brett M, Markiewicz CJ, Hanke M, et al. nipy/nibabel. GitHub; 2019. https://github.com/nipy/nibabel

 - Python package - scipy: Virtanen P, Gommers R, Oliphant TE, et al. SciPy 1.0: fundamental algorithms for scientific computing in Python. Nat Methods. 2020;17(3):261-272. doi:10.1038/s41592-019-0686-2

 - Python package - numpy: Harris CR, Millman KJ, van der Walt SJ, et al. Array programming with NumPy. Nature. 2020;585(7825):357-362. doi:10.1038/s41586-020-2649-2

 - Python package - Nipype: Gorgolewski K, Burns C, Madison C, et al. Nipype: A Flexible, Lightweight and Extensible Neuroimaging Data Processing Framework in Python. Frontiers in Neuroinformatics. 2011;5. Accessed April 20, 2022. doi:10.3389/fninf.2011.00013
</pre></div>
</div>
</div>
</div>
<p>Let’s view one of the QSM results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_nii</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;qsm/qsm_final/*/*.nii*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=+</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">show_nii</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;qsm/qsm_final/*/*.nii*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=+</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>

<span class="ne">IndexError</span>: list index out of range
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="segment-t1-weighted-images">
<h1>Segment T1-weighted images<a class="headerlink" href="#segment-t1-weighted-images" title="Permalink to this heading">#</a></h1>
<p>QSMxT doesn’t just reconstruct QSM - it also assists with segmentation and quantitative analysis!</p>
<p>QSMxT uses FastSurfer to segment our T1-weighted images and automatically registers them to the T2*-weighted/QSM space:</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>run_3_segment.py<span class="w"> </span>bids<span class="w"> </span>segmentations
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running QSMxT v1.3.5 (commit date: Sat Feb 25 22:06:42 2023 +1000)
INFO: Command: /opt/QSMxT/run_3_segment.py bids segmentations
INFO: Python interpreter: /opt/miniconda-4.7.12.1/bin/python3
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running with 2 processors.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:10,719 nipype.workflow INFO:
	 Workflow workflow_segmentation settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:10,729 nipype.workflow INFO:
	 Running in parallel.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:10,779 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 4 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:10,825 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-2.ses-1.run-01.fastsurfer_segment-t1&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-2/ses-1/run-01/fastsurfer_segment-t1&quot;.
230629-07:22:10,831 nipype.workflow INFO:
	 [Node] Executing &quot;fastsurfer_segment-t1&quot; &lt;interfaces.nipype_interface_fastsurfer.FastSurferInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:22:12,784 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 3 jobs ready. Free memory (GB): 2.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_segmentation.sub-2.ses-1.run-01.fastsurfer_segment-t1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:52:24,381 nipype.workflow INFO:
	 [Node] Finished &quot;fastsurfer_segment-t1&quot;, elapsed time 1813.54689s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:52:24,564 nipype.workflow INFO:
	 [Job 0] Completed (workflow_segmentation.sub-2.ses-1.run-01.fastsurfer_segment-t1).
230629-07:52:24,568 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 4 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:52:24,626 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-2.ses-1.run-01.ants_register-t1-to-qsm&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-2/ses-1/run-01/ants_register-t1-to-qsm&quot;.
230629-07:52:24,631 nipype.workflow INFO:
	 [Node] Executing &quot;ants_register-t1-to-qsm&quot; &lt;nipype.interfaces.ants.registration.RegistrationSynQuick&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:52:26,567 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 3 jobs ready. Free memory (GB): 9.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_segmentation.sub-2.ses-1.run-01.ants_register-t1-to-qsm
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-07:59:59,548 nipype.workflow INFO:
	 [Node] Finished &quot;ants_register-t1-to-qsm&quot;, elapsed time 454.914917s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:00:01,16 nipype.workflow INFO:
	 [Job 1] Completed (workflow_segmentation.sub-2.ses-1.run-01.ants_register-t1-to-qsm).
230629-08:00:01,18 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 3 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:00:01,50 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-1.ses-1.run-01.fastsurfer_segment-t1&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-1/ses-1/run-01/fastsurfer_segment-t1&quot;.
230629-08:00:01,53 nipype.workflow INFO:
	 [Node] Executing &quot;fastsurfer_segment-t1&quot; &lt;interfaces.nipype_interface_fastsurfer.FastSurferInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:00:03,19 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 2 jobs ready. Free memory (GB): 2.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_segmentation.sub-1.ses-1.run-01.fastsurfer_segment-t1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:30:26,9 nipype.workflow INFO:
	 [Node] Finished &quot;fastsurfer_segment-t1&quot;, elapsed time 1824.954863s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:30:26,823 nipype.workflow INFO:
	 [Job 2] Completed (workflow_segmentation.sub-1.ses-1.run-01.fastsurfer_segment-t1).
230629-08:30:26,825 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 3 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:30:26,857 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-1.ses-1.run-01.ants_register-t1-to-qsm&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-1/ses-1/run-01/ants_register-t1-to-qsm&quot;.
230629-08:30:26,862 nipype.workflow INFO:
	 [Node] Executing &quot;ants_register-t1-to-qsm&quot; &lt;nipype.interfaces.ants.registration.RegistrationSynQuick&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:30:28,824 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 2 jobs ready. Free memory (GB): 9.17/13.17, Free processors: 0/2.
                     Currently running:
                       * workflow_segmentation.sub-1.ses-1.run-01.ants_register-t1-to-qsm
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:43,967 nipype.workflow INFO:
	 [Node] Finished &quot;ants_register-t1-to-qsm&quot;, elapsed time 437.104452s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:45,266 nipype.workflow INFO:
	 [Job 3] Completed (workflow_segmentation.sub-1.ses-1.run-01.ants_register-t1-to-qsm).
230629-08:37:45,268 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:45,298 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-2.ses-1.run-01.numpy_numpy_nibabel_mgz2nii&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-2/ses-1/run-01/numpy_numpy_nibabel_mgz2nii&quot;.
230629-08:37:45,299 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-1.ses-1.run-01.numpy_numpy_nibabel_mgz2nii&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-1/ses-1/run-01/numpy_numpy_nibabel_mgz2nii&quot;.
230629-08:37:45,302 nipype.workflow INFO:
	 [Node] Executing &quot;numpy_numpy_nibabel_mgz2nii&quot; &lt;interfaces.nipype_interface_mgz2nii.Mgz2NiiInterface&gt;
230629-08:37:45,303 nipype.workflow INFO:
	 [Node] Executing &quot;numpy_numpy_nibabel_mgz2nii&quot; &lt;interfaces.nipype_interface_mgz2nii.Mgz2NiiInterface&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:45,884 nipype.workflow INFO:
	 [Node] Finished &quot;numpy_numpy_nibabel_mgz2nii&quot;, elapsed time 0.579095s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:45,898 nipype.workflow INFO:
	 [Node] Finished &quot;numpy_numpy_nibabel_mgz2nii&quot;, elapsed time 0.593768s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:47,268 nipype.workflow INFO:
	 [Job 4] Completed (workflow_segmentation.sub-2.ses-1.run-01.numpy_numpy_nibabel_mgz2nii).
230629-08:37:47,269 nipype.workflow INFO:
	 [Job 5] Completed (workflow_segmentation.sub-1.ses-1.run-01.numpy_numpy_nibabel_mgz2nii).
230629-08:37:47,271 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
230629-08:37:47,301 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-2.ses-1.run-01.ants_transform-segmentation-to-qsm&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-2/ses-1/run-01/ants_transform-segmentation-to-qsm&quot;.
230629-08:37:47,304 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-1.ses-1.run-01.ants_transform-segmentation-to-qsm&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-1/ses-1/run-01/ants_transform-segmentation-to-qsm&quot;.
230629-08:37:47,309 nipype.workflow INFO:
	 [Node] Executing &quot;ants_transform-segmentation-to-qsm&quot; &lt;nipype.interfaces.ants.resampling.ApplyTransforms&gt;
230629-08:37:47,311 nipype.workflow INFO:
	 [Node] Executing &quot;ants_transform-segmentation-to-qsm&quot; &lt;nipype.interfaces.ants.resampling.ApplyTransforms&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:48,845 nipype.workflow INFO:
	 [Node] Finished &quot;ants_transform-segmentation-to-qsm&quot;, elapsed time 1.53381s.
230629-08:37:48,849 nipype.workflow INFO:
	 [Node] Finished &quot;ants_transform-segmentation-to-qsm&quot;, elapsed time 1.535227s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:49,270 nipype.workflow INFO:
	 [Job 6] Completed (workflow_segmentation.sub-2.ses-1.run-01.ants_transform-segmentation-to-qsm).
230629-08:37:49,272 nipype.workflow INFO:
	 [Job 7] Completed (workflow_segmentation.sub-1.ses-1.run-01.ants_transform-segmentation-to-qsm).
230629-08:37:49,273 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
230629-08:37:49,305 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-2.ses-1.run-01.nipype_datasink&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-2/ses-1/run-01/nipype_datasink&quot;.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:49,309 nipype.workflow INFO:
	 [Node] Setting-up &quot;workflow_segmentation.sub-1.ses-1.run-01.nipype_datasink&quot; in &quot;/home/runnerx/actions-runner/_work/example-notebooks/example-notebooks/structural_imaging/segmentations/workflow_segmentation/sub-1/ses-1/run-01/nipype_datasink&quot;.
230629-08:37:49,316 nipype.workflow INFO:
	 [Node] Executing &quot;nipype_datasink&quot; &lt;nipype.interfaces.io.DataSink&gt;
230629-08:37:49,316 nipype.workflow INFO:
	 [Node] Executing &quot;nipype_datasink&quot; &lt;nipype.interfaces.io.DataSink&gt;
230629-08:37:49,319 nipype.workflow INFO:
	 [Node] Finished &quot;nipype_datasink&quot;, elapsed time 0.001465s.
230629-08:37:49,319 nipype.workflow INFO:
	 [Node] Finished &quot;nipype_datasink&quot;, elapsed time 0.001362s.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230629-08:37:51,272 nipype.workflow INFO:
	 [Job 8] Completed (workflow_segmentation.sub-2.ses-1.run-01.nipype_datasink).
230629-08:37:51,273 nipype.workflow INFO:
	 [Job 9] Completed (workflow_segmentation.sub-1.ses-1.run-01.nipype_datasink).
230629-08:37:51,275 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 13.17/13.17, Free processors: 2/2.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Finished
</pre></div>
</div>
</div>
</div>
<section id="view-segmentations">
<h2>View segmentations<a class="headerlink" href="#view-segmentations" title="Permalink to this heading">#</a></h2>
<p>Let’s have a look at the generated <code class="docutils literal notranslate"><span class="pre">segmentations</span></code> folder:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w"> </span>segmentations<span class="w"> </span>-L<span class="w"> </span><span class="m">1</span><span class="w"> </span>--dirsfirst
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">segmentations</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">qsm_segmentations</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">t1_segmentations</span>
├── <span class=" -Color -Color-Bold -Color-Bold-Blue">workflow_segmentation</span>
├── log_2023-06-29_07-22-09097778.txt
└── references.txt

3 directories, 2 files
</pre></div>
</div>
</div>
</div>
<p>We can see that we have segmentation files in both the QSM space and the T1-weighted space:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree<span class="w"> </span>segmentations/*segmentations
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">segmentations/qsm_segmentations</span>
└── <span class=" -Color -Color-Bold -Color-Bold-Blue">_work</span>
    ├── sub-1_ses-1_run-01_T1w_segmentation_nii_trans.nii
    └── sub-2_ses-1_run-01_T1w_segmentation_nii_trans.nii
<span class=" -Color -Color-Bold -Color-Bold-Blue">segmentations/t1_segmentations</span>
└── <span class=" -Color -Color-Bold -Color-Bold-Blue">_work</span>
    ├── sub-1_ses-1_run-01_T1w_segmentation_nii.nii
    └── sub-2_ses-1_run-01_T1w_segmentation_nii.nii

1 directory, 2 files
</pre></div>
</div>
</div>
</div>
<p>Once again, we can view any relevant citations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat<span class="w"> </span>segmentations/details_and_citations.txt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cat: segmentations/details_and_citations.txt: No such file or directory
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="run-analysis-pipeline">
<h1>Run analysis pipeline<a class="headerlink" href="#run-analysis-pipeline" title="Permalink to this heading">#</a></h1>
<p>The final pipeline we will run is the analysis pipeline. This simply looks at each of our QSM images and associated segmentations to produce a CSV spreadsheet containing susceptibility statistics for each ROI grouped by subject:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>run_5_analysis.py<span class="w"> </span>--segmentations<span class="w"> </span>segmentations/qsm_segmentations/*<span class="w"> </span>--qsm_files<span class="w"> </span>qsm/qsm_final/*/*.nii*<span class="w"> </span>--output_dir<span class="w"> </span>analysis<span class="w"> </span>--labels_file<span class="w"> </span>/opt/QSMxT/aseg_labels.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: Running QSMxT v1.3.5 (commit date: Sat Feb 25 22:06:42 2023 +1000)
INFO: Command: /opt/QSMxT/run_5_analysis.py --segmentations segmentations/qsm_segmentations/_work --qsm_files qsm/qsm_final/*/*.nii* --output_dir analysis --labels_file /opt/QSMxT/aseg_labels.csv
INFO: Python interpreter: /opt/miniconda-4.7.12.1/bin/python3
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/opt/QSMxT/run_5_analysis.py&quot;, line 332, in &lt;module&gt;
    run_analysis(args)
  File &quot;/opt/QSMxT/run_5_analysis.py&quot;, line 324, in run_analysis
    calculate_statistics(args, logger)
  File &quot;/opt/QSMxT/run_5_analysis.py&quot;, line 260, in calculate_statistics
    same_segmentation_for_all_subjects(args, logger)
  File &quot;/opt/QSMxT/run_5_analysis.py&quot;, line 229, in same_segmentation_for_all_subjects
    seg = load_nii_as_array(args.segmentations[0])
  File &quot;/opt/QSMxT/run_5_analysis.py&quot;, line 188, in load_nii_as_array
    nii = nib.load(file)
  File &quot;/opt/miniconda-4.7.12.1/lib/python3.8/site-packages/nibabel/loadsave.py&quot;, line 55, in load
    raise ImageFileError(f&#39;Cannot work out file type of &quot;{filename}&quot;&#39;)
nibabel.filebasedimages.ImageFileError: Cannot work out file type of &quot;segmentations/qsm_segmentations/_work&quot;
</pre></div>
</div>
</div>
</div>
<p>Here, we view some susceptibility statistics for the left Putamen:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head<span class="w"> </span>analysis/sub-1*csv<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span>
<span class="o">!</span>cat<span class="w"> </span>analysis/*.csv<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Left-Putamen
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>head: cannot open &#39;analysis/sub-1*csv&#39; for reading: No such file or directory
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cat: &#39;analysis/*.csv&#39;: No such file or directory
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="quantitative-visualisation">
<h1>Quantitative visualisation<a class="headerlink" href="#quantitative-visualisation" title="Permalink to this heading">#</a></h1>
<p>While QSMxT produces numerical outputs, we can also use some straightforward Python to visualise some of the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>seaborn
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Defaulting to user installation because normal site-packages is not writeable
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting seaborn
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Downloading seaborn-0.12.2-py3-none-any.whl (293 kB)
?25l     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">0.0/293.3 kB</span> <span class=" -Color -Color-Red">?</span> eta <span class=" -Color -Color-Cyan">-:--:--</span>
     ━━━━━━━━╺━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">61.4/293.3 kB</span> <span class=" -Color -Color-Red">2.2 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:01</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">293.3/293.3 kB</span> <span class=" -Color -Color-Red">4.9 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hRequirement already satisfied: numpy!=1.24.0,&gt;=1.17 in /home/runnerx/.local/lib/python3.10/site-packages (from seaborn) (1.25.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pandas&gt;=0.25 in /home/runnerx/.local/lib/python3.10/site-packages (from seaborn) (2.0.3)
Requirement already satisfied: matplotlib!=3.6.1,&gt;=3.1 in /home/runnerx/.local/lib/python3.10/site-packages (from seaborn) (3.7.1)
Requirement already satisfied: contourpy&gt;=1.0.1 in /home/runnerx/.local/lib/python3.10/site-packages (from matplotlib!=3.6.1,&gt;=3.1-&gt;seaborn) (1.1.0)
Requirement already satisfied: cycler&gt;=0.10 in /home/runnerx/.local/lib/python3.10/site-packages (from matplotlib!=3.6.1,&gt;=3.1-&gt;seaborn) (0.11.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in /home/runnerx/.local/lib/python3.10/site-packages (from matplotlib!=3.6.1,&gt;=3.1-&gt;seaborn) (4.40.0)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /home/runnerx/.local/lib/python3.10/site-packages (from matplotlib!=3.6.1,&gt;=3.1-&gt;seaborn) (1.4.4)
Requirement already satisfied: packaging&gt;=20.0 in /usr/lib/python3/dist-packages (from matplotlib!=3.6.1,&gt;=3.1-&gt;seaborn) (21.3)
Requirement already satisfied: pillow&gt;=6.2.0 in /usr/lib/python3/dist-packages (from matplotlib!=3.6.1,&gt;=3.1-&gt;seaborn) (9.0.1)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /usr/lib/python3/dist-packages (from matplotlib!=3.6.1,&gt;=3.1-&gt;seaborn) (2.4.7)
Requirement already satisfied: python-dateutil&gt;=2.7 in /home/runnerx/.local/lib/python3.10/site-packages (from matplotlib!=3.6.1,&gt;=3.1-&gt;seaborn) (2.8.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytz&gt;=2020.1 in /usr/lib/python3/dist-packages (from pandas&gt;=0.25-&gt;seaborn) (2022.1)
Requirement already satisfied: tzdata&gt;=2022.1 in /home/runnerx/.local/lib/python3.10/site-packages (from pandas&gt;=0.25-&gt;seaborn) (2023.3)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: six&gt;=1.5 in /usr/lib/python3/dist-packages (from python-dateutil&gt;=2.7-&gt;matplotlib!=3.6.1,&gt;=3.1-&gt;seaborn) (1.16.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Installing collected packages: seaborn
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully installed seaborn-0.12.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define regions of interest</span>
<span class="c1"># see https://github.com/QSMxT/QSMxT/blob/master/aseg_labels.csv for a full list</span>
<span class="n">rois</span> <span class="o">=</span> <span class="p">{</span> 
    <span class="s2">&quot;Thalamus&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">49</span><span class="p">],</span>
    <span class="s2">&quot;Pallidum&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">],</span>
    <span class="s2">&quot;Caudate&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
    <span class="s2">&quot;Putamen&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">51</span><span class="p">],</span>
    <span class="s2">&quot;Brain stem&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">16</span><span class="p">],</span>
    <span class="s2">&quot;CSF&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">257</span><span class="p">,</span> <span class="mi">701</span><span class="p">],</span>
    <span class="s2">&quot;White matter&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">177</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">roi_names</span> <span class="o">=</span> <span class="p">{</span> <span class="n">value</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rois</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rois</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">}</span>
<span class="n">roi_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">roi</span> <span class="ow">in</span> <span class="n">rois</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">roi</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load a reconstruction</span>
<span class="n">qsm</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;qsm/qsm_final/*/*.nii*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">seg</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;segmentations/qsm_segmentations/*.nii*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># load a reconstruction</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">qsm</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;qsm/qsm_final/*/*.nii*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">seg</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;segmentations/qsm_segmentations/*.nii*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="ne">IndexError</span>: list index out of range
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># retain only the rois</span>
<span class="n">qsm</span> <span class="o">=</span> <span class="n">qsm</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">roi_ids</span><span class="p">)]</span>
<span class="n">seg</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">roi_ids</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># retain only the rois</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">qsm</span> <span class="o">=</span> <span class="n">qsm</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">roi_ids</span><span class="p">)]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">seg</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">roi_ids</span><span class="p">)]</span>

<span class="ne">NameError</span>: name &#39;qsm&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert to a dataframe for plotting purposes</span>
<span class="n">seg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">roi_names</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s1">&#39;qsm&#39;</span> <span class="p">:</span> <span class="n">qsm</span><span class="p">,</span> <span class="s1">&#39;seg&#39;</span> <span class="p">:</span> <span class="n">seg</span> <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">28</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># convert to a dataframe for plotting purposes</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">seg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">roi_names</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s1">&#39;qsm&#39;</span> <span class="p">:</span> <span class="n">qsm</span><span class="p">,</span> <span class="s1">&#39;seg&#39;</span> <span class="p">:</span> <span class="n">seg</span> <span class="p">})</span>

<span class="ne">NameError</span>: name &#39;seg&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;seg&#39;</span><span class="p">)[</span><span class="s1">&#39;qsm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;seg&#39;</span><span class="p">)[</span><span class="s1">&#39;qsm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

<span class="ne">NameError</span>: name &#39;data&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">medians</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;seg&#39;</span><span class="p">)[</span><span class="s1">&#39;qsm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">medians</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">medians</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;seg&#39;</span><span class="p">)[</span><span class="s1">&#39;qsm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">order</span> <span class="o">=</span> <span class="n">medians</span><span class="o">.</span><span class="n">index</span>

<span class="ne">NameError</span>: name &#39;data&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;qsm&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;seg&#39;</span><span class="p">,</span> <span class="n">fliersize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Region of interest&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Susceptibility (ppm)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;QSM&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">31</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># plot</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;qsm&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;seg&#39;</span><span class="p">,</span> <span class="n">fliersize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;data&#39; is not defined
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./structural_imaging"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="nipype_module_example.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Basic Nipype Example</p>
      </div>
    </a>
    <a class="right-next"
       href="sct_toolbox_example.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">SCT Toolbox Example</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">QSMxT Example</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-neurodesk">Setup Neurodesk</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#qsmxt-interactive-notebook">QSMxT Interactive Notebook</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-qsm">What is QSM?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-qsmxt">What is QSMxT?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-i-access-qsmxt">How do I access QSMxT?</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-example-dicoms">Download example DICOMs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#load-qsmxt">Load QSMxT</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-standardisation">Data standardisation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sort-dicoms">Sort DICOMs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-to-bids">Convert to BIDS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-input-data">Inspect input data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#run-qsm-pipeline">Run QSM pipeline</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#view-qsm-results">View QSM results</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#segment-t1-weighted-images">Segment T1-weighted images</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#view-segmentations">View segmentations</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#run-analysis-pipeline">Run analysis pipeline</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-visualisation">Quantitative visualisation</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Neurodesk Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>